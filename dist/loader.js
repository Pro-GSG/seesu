/**
 * Debounce and throttle function's decorator plugin 1.0.5
 *
 * Copyright (c) 2009 Filatov Dmitry (alpha@zforms.ru)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

/*! jQuery v2.1.4 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */

/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),e.length*8))}function rstr_hmac_md5(e,t){var n=rstr2binl(e);n.length>16&&(n=binl_md5(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=binl_md5(r.concat(rstr2binl(t)),512+t.length*8);return binl2rstr(binl_md5(i.concat(o),640))}function rstr2hex(e){try{hexcase}catch(t){hexcase=0}var n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i;for(var s=0;s<e.length;s++)i=e.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(i&15);return r}function str2rstr_utf8(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function rstr2binl(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<n%32;return t}function binl2rstr(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n=1732584193,r=-271733879,i=-1732584194,s=271733878;for(var o=0;o<e.length;o+=16){var u=n,a=r,f=i,l=s;n=md5_ff(n,r,i,s,e[o+0],7,-680876936),s=md5_ff(s,n,r,i,e[o+1],12,-389564586),i=md5_ff(i,s,n,r,e[o+2],17,606105819),r=md5_ff(r,i,s,n,e[o+3],22,-1044525330),n=md5_ff(n,r,i,s,e[o+4],7,-176418897),s=md5_ff(s,n,r,i,e[o+5],12,1200080426),i=md5_ff(i,s,n,r,e[o+6],17,-1473231341),r=md5_ff(r,i,s,n,e[o+7],22,-45705983),n=md5_ff(n,r,i,s,e[o+8],7,1770035416),s=md5_ff(s,n,r,i,e[o+9],12,-1958414417),i=md5_ff(i,s,n,r,e[o+10],17,-42063),r=md5_ff(r,i,s,n,e[o+11],22,-1990404162),n=md5_ff(n,r,i,s,e[o+12],7,1804603682),s=md5_ff(s,n,r,i,e[o+13],12,-40341101),i=md5_ff(i,s,n,r,e[o+14],17,-1502002290),r=md5_ff(r,i,s,n,e[o+15],22,1236535329),n=md5_gg(n,r,i,s,e[o+1],5,-165796510),s=md5_gg(s,n,r,i,e[o+6],9,-1069501632),i=md5_gg(i,s,n,r,e[o+11],14,643717713),r=md5_gg(r,i,s,n,e[o+0],20,-373897302),n=md5_gg(n,r,i,s,e[o+5],5,-701558691),s=md5_gg(s,n,r,i,e[o+10],9,38016083),i=md5_gg(i,s,n,r,e[o+15],14,-660478335),r=md5_gg(r,i,s,n,e[o+4],20,-405537848),n=md5_gg(n,r,i,s,e[o+9],5,568446438),s=md5_gg(s,n,r,i,e[o+14],9,-1019803690),i=md5_gg(i,s,n,r,e[o+3],14,-187363961),r=md5_gg(r,i,s,n,e[o+8],20,1163531501),n=md5_gg(n,r,i,s,e[o+13],5,-1444681467),s=md5_gg(s,n,r,i,e[o+2],9,-51403784),i=md5_gg(i,s,n,r,e[o+7],14,1735328473),r=md5_gg(r,i,s,n,e[o+12],20,-1926607734),n=md5_hh(n,r,i,s,e[o+5],4,-378558),s=md5_hh(s,n,r,i,e[o+8],11,-2022574463),i=md5_hh(i,s,n,r,e[o+11],16,1839030562),r=md5_hh(r,i,s,n,e[o+14],23,-35309556),n=md5_hh(n,r,i,s,e[o+1],4,-1530992060),s=md5_hh(s,n,r,i,e[o+4],11,1272893353),i=md5_hh(i,s,n,r,e[o+7],16,-155497632),r=md5_hh(r,i,s,n,e[o+10],23,-1094730640),n=md5_hh(n,r,i,s,e[o+13],4,681279174),s=md5_hh(s,n,r,i,e[o+0],11,-358537222),i=md5_hh(i,s,n,r,e[o+3],16,-722521979),r=md5_hh(r,i,s,n,e[o+6],23,76029189),n=md5_hh(n,r,i,s,e[o+9],4,-640364487),s=md5_hh(s,n,r,i,e[o+12],11,-421815835),i=md5_hh(i,s,n,r,e[o+15],16,530742520),r=md5_hh(r,i,s,n,e[o+2],23,-995338651),n=md5_ii(n,r,i,s,e[o+0],6,-198630844),s=md5_ii(s,n,r,i,e[o+7],10,1126891415),i=md5_ii(i,s,n,r,e[o+14],15,-1416354905),r=md5_ii(r,i,s,n,e[o+5],21,-57434055),n=md5_ii(n,r,i,s,e[o+12],6,1700485571),s=md5_ii(s,n,r,i,e[o+3],10,-1894986606),i=md5_ii(i,s,n,r,e[o+10],15,-1051523),r=md5_ii(r,i,s,n,e[o+1],21,-2054922799),n=md5_ii(n,r,i,s,e[o+8],6,1873313359),s=md5_ii(s,n,r,i,e[o+15],10,-30611744),i=md5_ii(i,s,n,r,e[o+6],15,-1560198380),r=md5_ii(r,i,s,n,e[o+13],21,1309151649),n=md5_ii(n,r,i,s,e[o+4],6,-145523070),s=md5_ii(s,n,r,i,e[o+11],10,-1120210379),i=md5_ii(i,s,n,r,e[o+2],15,718787259),r=md5_ii(r,i,s,n,e[o+9],21,-343485551),n=safe_add(n,u),r=safe_add(r,a),i=safe_add(i,f),s=safe_add(s,l)}return Array(n,r,i,s)}function md5_cmn(e,t,n,r,i,s){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(r,s)),i),n)}function md5_ff(e,t,n,r,i,s,o){return md5_cmn(t&n|~t&r,e,t,i,s,o)}function md5_gg(e,t,n,r,i,s,o){return md5_cmn(t&r|n&~r,e,t,i,s,o)}function md5_hh(e,t,n,r,i,s,o){return md5_cmn(t^n^r,e,t,i,s,o)}function md5_ii(e,t,n,r,i,s,o){return md5_cmn(n^(t|~r),e,t,i,s,o)}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function bit_rol(e,t){return e<<t|e>>>32-t}var spv={};(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0;n<this.length;n++)if(this[n]==e)return n;return-1}),spv.getArrayNoDubs=function(e,t){t=t||[];for(var n=0;n<e.length;n++)t.indexOf(e[n])==-1&&t.push(e[n]);return t},spv.once=function(e){var t;return function(){if(e){var n=e;return e=null,t=n.apply(this,arguments)}return t}},spv.mapfn=function(e){return function(t){if(!t)return t;var n=new Array(t.length);for(var r=0;r<t.length;r++)n[r]=e(t[r],r);return n}};var C=function(e){return e};spv.hasEveryArgs=function(){return Array.prototype.every.call(arguments,C)},spv.getExistingItems=function(e){var t=[];for(var n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},typeof window!="undefined"&&(e=spv.addEvent=window.addEventListener?function(e,t,n){return e.addEventListener(t,n,!1),n}:function(e,t,n){return e.attachEvent("on"+t,n),n},t=spv.removeEvent=window.addEventListener?function(e,t,n){if(!e.removeEventListener)return;e.removeEventListener(t,n,!1)}:function(e,t,n){if(!e.detachEvent)return;e.detachEvent("on"+t,n)}),n=spv.getDefaultView=function(e){return e.defaultView||e.parentWindow},r=spv.domReady=function(e,t){var n=spv.getDefaultView(e);if(!n)return;if(e.readyState=="complete"||e.readyState=="loaded"||e.readyState=="interactive")t();else{var r,i=function(){r||(r=!0,spv.removeEvent(n,"load",i),spv.removeEvent(e,"DOMContentLoaded",i),t())};spv.addEvent(n,"load",i),spv.addEvent(e,"DOMContentLoaded",i)}},i=spv.doesContain=function(e,t){var n=t?t.call(e):e.valueOf();for(var r=0;r<this.length;r++)if(t){if(t.call(this[r])==n)return r}else if(this[r].valueOf()==n)return r;return-1},spv.hasCommonItems=function(e,t){if(!t)return!1;for(var n=0;n<e.length;n++)if(t.indexOf(e[n])!=-1)return!0;return!1};var k=function(e,t,n){for(var r=0;r<t.length;r++)t[r]!==n&&e.push(t[r]);return e},L=function(e,t,n){for(var r=0;r<t.length;r++)n.indexOf(t[r])==-1&&e.push(t[r]);return e};o=spv.arrayExclude=function(e,t){var n=[];return e?t instanceof Array?L(n,e,t):k(n,e,t):n},s=spv.shuffleArray=function(e){var t=[],n,r;for(var i=0;i<e.length;i++)r=e[i],n=Math.floor(Math.random()*(i+1)),t[i]=t[n],t[n]=r;return t},u=function(e,t){var n=[];for(var r=0;r<t.length;r++){var i=t[r],s=typeof i=="function"?i(e):spv.getTargetField(e,i);s&&n.push(s)}return n},b=spv.getDiffObj=function(e,t){var n,r={},i={};for(n in e)i[n]=!0;for(n in t)i[n]=!0;for(n in i)e[n]!==t[n]&&(r[n]=t[n]);return r},y=function(e){var t=function(){};t.prototype=e;var n=new t;return n.constructor=t,n},a=spv.matchWords=function(e,t){var n=t.split(/[\s\.\—\-\—\–\_\|\+\(\)\*\&\!\?\@\,\\\/\❤\♡\'\"\[\]]+/gi),r={};if(n.length){r.forward=!0;var i=!0,s=e;for(var o=0;o<n.length;o++){var u=s.indexOf(n[o]);if(u==-1){r.forward=!1;break}s.slice(u+n[o].length)}if(!r.forward)for(var o=0;o<n.length;o++)if(e.indexOf(n[o])==-1){i=!1;break}r.any=i}return r},f=spv.searchInArray=function(e,t,n){t=l(t);var r,i,s;if(t){r=[];if(n)for(i=0;i<e.length;i++){s=e[i];var o=u(s,n);o.join(" ").search(t)>-1&&r.push(s)}else for(i=0;i<e.length;i++)s=e[i],typeof s=="string"&&s.search(t)>-1&&r.push(s)}return r};var A=/([$\^*()+\[\]{}|.\/?\\])/g;spv.escapeRegExp=function(e,t){return t&&(e=e.replace(/\s+/g," ").replace(/(^\s)|(\s$)/g,"")),e.replace(A,"\\$1")},l=function(e){if(e.replace(/\s/g,"")){e=spv.escapeRegExp(e,!0).split(/\s/g);for(var t=0;t<e.length;t++)e[t]="((^|\\s)"+e[t]+")";return e=e.join("|"),new RegExp(e,"gi")}},spv.getStringPattern=l,c=function(e){var t=Date.now();e?(e(),console.log((new Date-t)/1e3)):console.log(t/1e3)},spv.collapseAll=function(){var e=[];for(var t=0;t<arguments.length;t++){var n=arguments[t];if(n instanceof Array)for(var r=0;r<n.length;r++)e.indexOf(n[r])==-1&&e.push(n[r]);else e.indexOf(n)==-1&&e.push(n)}return e},h=spv.toRealArray=function(e,t){return e instanceof Array?e:e&&typeof e=="object"&&e.length?Array.prototype.slice.call(e):e&&(!t||spv.getTargetField(e,t))?[e]:[]},spv.memorize=function(e,t){var n={};return t?function(){var r=t.apply(this,arguments);if(!n.hasOwnProperty(r)){var i=n[r]=e.apply(this,arguments);return i}return n[r]}:function(t){if(!n.hasOwnProperty(t)){var r=n[t]=e.apply(this,arguments);return r}return n[t]}},spv.f={allOf:function(){var e=0,t=new Array(arguments.length-1);for(e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){var e;for(var n=0;n<t.length;n++){e=t[n].apply(this,arguments);if(!e)return e}return e}},firstOf:function(){var e=0,t=new Array(arguments.length-1);for(e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){var e;for(var n=0;n<t.length;n++){e=t[n].apply(this,arguments);if(e)return e}return e}}};var O={},M=function(e){return Array.isArray(e)?e:(O[e]||(O[e]=e.split(".")),O[e])};p=function(e,t){t=M(t);var n,r=e;for(var i=0;i<t.length;i++){if(r[t[i]]==n)return;r=r[t[i]]}return r},spv.setTargetField=function(e,t,n){t=M(t);var r=e;for(var i=0;i<t.length;i++){var s=t[i];if(i!=t.length-1){var o=r[s];o||(o=r[s]={}),r=o}else r[s]=n}return!0};var _=function(e,t){return t instanceof Function?t(e):Array.isArray(t)?spv.getTargetField(e,t):t instanceof Object?typeof t.field=="function"?t.field(e):spv.getTargetField(e,t.field):spv.getTargetField(e,t)};d=spv.sortByRules=function(e,t,n){if(e instanceof Object&&t instanceof Object){var r=0;for(var i=0;i<n.length;i++)if(!r){var s=n[i],o=_(e,s),u=_(t,s);o=o||!!o,u=u||!!u,o>u?r=s.reverse?-1:1:o<u&&(r=s.reverse?1:-1)}return r}},spv.getSortFunc=function(e){return function(t,n){return d(t,n,e)}},v=spv.makeIndexByField=function(e,t,n){var r={};if(e&&e.length)for(var i=0;i<e.length;i++){var s,o=e[i],u=spv.getTargetField(o,t);if(u||typeof u=="number")if(u instanceof Array)for(var a=0;a<u.length;a++)s=u[a]+"",n||(s=s.toLowerCase()),r[s]||(r[s]=[],r[s].real_name=u[a]),r[s].indexOf(o)==-1&&r[s].push(o);else s=u+"",n||(s=s.toLowerCase()),r[s]||(r[s]=[],r[s].real_name=u),r[s].indexOf(o)==-1&&r[s].push(o);else r["#other"]||(r["#other"]=[]),r["#other"].indexOf(o)==-1&&r["#other"].push(o)}return r},m=function(e,t,n){var r,i=[];i.not=[];if(!e)return i;if(n)for(r=0;r<e.length;r++){if(!e[r])continue;typeof n=="function"?n(spv.getTargetField(e[r],t))?i.push(e[r]):i.not.push(e[r]):spv.getTargetField(e[r],t)===n?i.push(e[r]):i.not.push(e[r])}else for(r=0;r<e.length;r++){if(!e[r])continue;var s=spv.getTargetField(e[r],t);s?i.push(s):i.not.push(e[r])}return i};var D=function(e,t){for(var n in t){if(!t.hasOwnProperty(n))continue;e[n]=t[n]}return e},P=Object.assign?function(e,t){return Object.assign(e,t)}:D;g=spv.cloneObj=function(e,t,n,r){var i=e||{},s;if(n||r){for(s in t){if(!t.hasOwnProperty(s))continue;if(!r||!!~r.indexOf(s))if(!n||!~n.indexOf(s))i[s]=t[s]}return i}return P(i,t)},w=function(e){if(e>0){if(e>10&&e<20)return 2;var t="0"+e;return t=parseFloat(t.slice(t.length-1)),t===0?2:t==1?0:t<5?1:2}if(e===0)return 2},spv.getUnitBaseNum=w,E=spv.stringifyParams=function(e,t,n,r,i){i=i||{},n=n||"";if(typeof e=="string")return e;var s=[];for(var o in e)(!t||t.indexOf(o)==-1)&&s.push(o+n+e[o]);return i.not_sort||s.sort(),s.join(r||"")},S=function(e){var t=""+e,n="";for(var r=t.length-1;r>=0;r--)n=t[r]+n,(t.length-r)%3===0&&(n=" "+n);return n};var H=0;(function(){var e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,t=function(e,t,n){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);return typeof r!="undefined"?this._super=r:delete this._super,i}};x=function(){},x.extendTo=function(n,r){typeof r=="function"&&(r=spv.coe(r));var i=this.prototype,s=new this;s.constr_id=H++;for(var o in r){var u=typeof r[o]=="function"&&typeof i[o]=="function"&&e.test(r[o]);s[o]=u?t(o,r[o],i):r[o]}return n.prototype=s,n.prototype.constructor=n,n.prototype.onExtend&&n.prototype.onExtend.call(n.prototype,r,i),n.extendTo=x.extendTo,n.extend=x.extend,n},x.extend=function(e,t){return this.extendTo(function(){},e)}})(),spv.Class=x,spv.passingContext=function(t){return function(e){var n=new Array(arguments.length);for(var r=0;r<arguments.length;r++)n[r]=arguments[r];n.shift(),t.apply(e,n)}},spv.precall=function(t,n){return function(){return t.apply(this,arguments),n.apply(this,arguments)}},function(){function o(o,u){var a=o.naming||t,f=u.naming||a,l=u.building||o.building||n,c=u.partWrapping||o.partWrapping||e,h=o.builder,p=u.partBuilder,d=typeof u.props=="function"?spv.coe(u.props):u.props,v=o.onExtend,m=u.onExtend?r(v||i,u.onExtend):v,g=l(h||i),y=p?c(g,p):g,b=f(y);b.naming=f,b.building=l,b.partWrapping=c,b.builder=y,b.onExtend=m;var w=a(i);return w.prototype=o.prototype,b.prototype=new w,d&&(spv.cloneObj(b.prototype,d),m&&m(b.prototype,d,o.prototype)),b.prototype.constructor=o,b.extendTo=function(e,t){console.log("don't use extendTo");var n=this.naming,r=n(i);return r.prototype=this.prototype,s.call(r,e,t)},b}var e=function(e,t){return function(r,i,s,o,u,a,f,l,c,h,p){e(r,i,s,o,u,a,f,l,c,h,p),t(r,i,s,o,u,a,f,l,c,h,p)}},t=function(e){return function(n){e(this,n)}},n=function(e){return function(n){e(n)}},r=function(e,t){return function(n,r,i){e(n,r,i),t(n,r,i)}},i=function(){},s=x.extendTo;o.legInit=function(e){var t=e.builder;e.prototype.init=function(e,n,r,i,s,o,u,a){t(this,e,n,r,i,s,o,u,a)}},spv.inh=o}(),T=function(e,t,n,r){arguments.length==3&&typeof n!="boolean"&&(r=n,n=!1);var i;return function(){var s=arguments,o=this;n&&!i&&e.apply(r||this,s),clearTimeout(i),i=setTimeout(function(){!n&&e.apply(r||o,s),i=null},t)}},N=function(e,t,n){var r,i,s;return function(){i=arguments,s=!0,n=n||this;if(!r){var o=function(){s?(e.apply(n,i),s=!1,r=setTimeout(o,t)):r=null};o()}}},spv.capitalize=function(e,t){var n=t?/(^|\s)(.)/:/(^|\s)(.)/g;return e.replace(n,function(e,t,n){return t+n.toUpperCase()})},function(){var e=new RegExp("\\%[^\\s\\%]+?\\%","gi"),t=new RegExp("\\%([^\\s\\%]+?)\\%"),n=function(e,t,n){e[t]||(e[t]=[]),e[t].push(n)},r=function(e){e=e||window.document;for(var t=0;t<this.length;t++)this[t]&&typeof this[t]=="string"&&(this[t]=e.createTextNode(this[t]));return this},i=function(e,t){for(var n=0;n<this.vars[e].length;n++)this[this.vars[e][n]]=t;return this};spv.createComlexText=function(s,o){var u=s.match(e),a=s.split(e),f=[];f.vars={},f.setVar=i,f.makeDom=r;for(var l=0;l<a.length;l++){f.push(a[l]);if(u[l]){var c=u[l].match(t)[1];n(f.vars,c,f.length),f.push(null)}}return o||f.makeDom(),f}}(),spv.Depdc=function(e){e&&this.init()},spv.Depdc.prototype={constructor:spv.Depdc,init:function(){this.dep_list=[]},addDepend:function(e){this.dep_list.indexOf(e)==-1&&this.dep_list.push(e)},removeDepend:function(e){this.dep_list=o(this.dep_list,e)},softAbort:function(e){e&&this.removeDepend(e),this.dep_list.length||this.abort()}},spv.makeIndexByField=v,spv.getTargetField=p,spv.throttle=N,spv.debounce=T,spv.filter=m,spv.zerofyString=function(e,t){typeof e!="string"&&(e=""+e);while(e.length<t)e="0"+e;return e};var B=function(e,t){var n=t,r=[e];while(n&&n.prop_name)r.unshift(n.prop_name),n=n.parent;return r.join(".")},j=function(e){var t=[{parent:null,prop_name:"",obj:e}],n,r,i,s=[],o=[];while(t.length){n=t.shift();for(i in n.obj){if(!n.obj.hasOwnProperty(i)||!n.obj[i])continue;if(Array.isArray(n.obj[i]))continue;typeof n.obj[i]=="object"&&t.push({parent:n,prop_name:i,obj:n.obj[i]})}s.push(n)}for(r=0;r<s.length;r++){n=s[r];for(i in n.obj){if(!n.obj.hasOwnProperty(i))continue;(typeof n.obj[i]=="string"||!n.obj[i]||Array.isArray(n.obj[i]))&&o.push({field_path:B(i,n),field_path_value:n.obj[i]})}}return o};spv.mapProps=function(e,t,n){for(var r in e){var i=spv.getTargetField(t,e[r]);typeof i!="undefined"&&spv.setTargetField(n,r,i)}return n};var F=function(e){var t=[e],n=[],r,i;while(t.length){r=t.shift();if(r.parts_map)for(var s in r.parts_map){if(!r.parts_map.hasOwnProperty(s))continue;var o=r.parts_map[s];if(typeof o.props_map=="string"&&o.parts_map)throw console.log(["you can not have parts in",o,"since it is simple string from field:"+o.props_map]),new Error("you can not have parts in this place since it is simple string from field:"+o.props_map);t.push(o)}n.push(r)}for(i=0;i<n.length;i++){r=n[i];if(typeof r.props_map=="object"&&!Array.isArray(r.props_map)){var u=j(r.props_map);r.props_map=u}}return e},I=/^\^+/gi,q=function(e,t,n,r){var i=n,s=e,o=e.charAt(0);if(o=="^"){s=e.slice(1);var u=e.length-s.length;while(u){--u,i=t.parent_data;if(!i)break}}else{if(o=="@")throw new Error("");if(o=="#"){s=e.slice(1),i=r;if(!r)throw new Error}}return p(i,s)},R=function(e,t,n,r,i){var s;if(typeof e=="string")s=q(e,n,t,r);else if(Array.isArray(e))if(e.length>1){var o=e[0];typeof o=="string"&&(o=i[o]),s=o(e[1]&&q(e[1],n,t,r))}else s=e[0];return s},U=function(e,t,n,r,i){for(var s=0;s<n.map_opts.props_map.length;s++){var o=n.map_opts.props_map[s],u=o.field_path_value;u||(u=o.field_path);var a=R(u,t,n,r,i);spv.setTargetField(e,o.field_path,a)}},z=function(e,t,n,r,i){if(typeof t.map_opts.props_map=="string")return R(t.map_opts.props_map,r,t,e,i);var s={};U(s,r,t,e,i);for(var o in t.map_opts.parts_map){var u=t.map_opts.parts_map[o],a=u.is_array?[]:{};spv.setTargetField(s,o,a),n.push({map_opts:u,parent_data:r,parent_map:t.map_opts,writeable_array:a,data_scope:null})}return s},W=function(e,t,n,r){var i={map_opts:e,parent_data:t,parent_map:null,writeable_array:e.is_array?[]:{},data_scope:null},s=[i],o;while(s.length){var u=s.shift(),a;u.map_opts.source?a=p(u.parent_data,u.map_opts.source):a=u.parent_data;if(!a)continue;if(!u.map_opts.is_array){u.data_scope=a,o=z(n,u,s,u.data_scope,r);if(typeof o!="object")throw new Error("use something more simple!");spv.cloneObj(u.writeable_array,o)}else{u.data_scope=h(a),u.writeable_array.length=u.data_scope.length;for(var f=0;f<u.data_scope.length;f++){var l=u.data_scope[f];u.writeable_array[f]=z(n,u,s,l,r)}}}return i.writeable_array},X=function(e,t){this.config=e,this.converters=t,this.pconfig=null;var n=this;return function(){return n.execute.apply(n,arguments)}};X.prototype.execute=function(e,t,n){return this.pconfig||(this.pconfig=F(this.config)),W(this.pconfig,e,t,n||this.converters)},spv.MorphMap=X,spv.mmap=function(e,t){return new X(e,t)},spv.coe=function(e){var t={},n=function(e){spv.cloneObj(t,e)};return e(n),t};var V=/[\u00C0-\u1FFF\u2C00-\uD7FF\w]/gi,$=function(e){var t=e.match(V);return t?t.join("").toLowerCase():""};spv.hardTrim=$,spv.insertItem=function(e,t,n){var r=e.length,i=t,s;for(var o=n;o<r+1;o++)s=e[o],e[o]=i,i=s;return e},spv.removeItem=function(e,t){for(var n=t+1;n<e.length;n++)e[n-1]=e[n];return e.length=e.length-1,e},spv.findAndRemoveItem=function(e,t){var n=e.indexOf(t);return n===-1?e:spv.removeItem(e,n)},String.prototype.startsWith?spv.startsWith=function(e,t,n){return e.startsWith(t,n)}:spv.startsWith=function(e,t,n){var r=t.length,i=n||0;for(;i<r;i++)if(e.charAt(i)!=t.charAt(i))return!1;return!0},spv.getDeprefixFunc=function(e,t){var n={};return function(r){return n.hasOwnProperty(r)||(spv.startsWith(r,e)?n[r]=t?!0:r.slice(e.length):n[r]=!1),n[r]}},spv.getPrefixingFunc=function(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e+n),t[n]}},spv.forEachKey=function(e,t,n,r){for(var i in e){if(!e.hasOwnProperty(i))continue;t(e[i],i,n,r)}},spv.countKeys=function(e,t){var n=0;for(var r in e)t?e[r]&&n++:n++;return n}})(),define("spv",[],function(){return spv}),define("env",[],function(){var e=function(e,t){var n=e.replace(/^\?/,"").split("&"),r={};for(var i=0;i<n.length;i++){var s=n[i].split("="),o=s[0],u=s[1];t&&(o=decodeURIComponent(o),u=decodeURIComponent(u)),r[o]=u}return r},t;(function(e){var n=/(webkit)[ \/]([\w.]+)/,r=/(opera)(?:.*version)?[ \/]([\w.]+)/,i=/(msie) ([\w.]+)/,s=/(mozilla)(?:.*? rv:([\w.]+))?/,o=e&&e.navigator&&e.navigator.userAgent;t=function(){o=o.toLowerCase();var e=n.exec(o)||r.exec(o)||i.exec(o)||o.indexOf("compatible")<0&&s.exec(o)||[];return{browser:e[1]||"",version:e[2]||"0"}}})(window);var n=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,r=function(r){var i=t(),s={bro:i,get_url_parameters:e},o=e(r.location.search,!0);s.cross_domain_allowed=!r.location.protocol.match(/(http\:)|(file\:)/),s.xhr2=!!n;if(typeof lg_smarttv_app!="undefined"||navigator.userAgent.search(/LG Browser/i)&&(window.NetCastExit||window.NetCastBack))s.deep_sanbdox=!0,s.as_application=!1,s.app_type="lg_smarttv_app";else if(typeof process=="object"&&window.process.nextTick&&typeof navigator=="object")s.app_type="nodewebkit",s.as_application=!1,s.deep_sanbdox=!0,s.needs_url_history=!0,s.torrents_support=!0,s.cross_domain_allowed=!0;else if(window.tizen)s.app_type="tizen_app",s.as_application=!1,s.deep_sanbdox=!0,s.needs_url_history=!0;else if(typeof widget=="object"&&!window.widget.fake_widget)i.browser=="opera"?window.opera.extension?s.app_type="opera_extension":(s.app_type="opera_widget",s.deep_sanbdox=!0):s.app_type="apple_db_widget",s.deep_sanbdox=!0,s.as_application=!0;else if(typeof chrome=="object"&&r.location.protocol=="chrome-extension:"){var u=navigator.userAgent.indexOf("OPR")!=-1;r.location.pathname=="/index.html"?(s.app_type=u?"opera_app":"chrome_app",s.as_application=!1,s.needs_url_history=!0,s.need_favicon=!0):(s.chrome_like_ext=!0,s.app_type=u?"opera_extension":"chrome_extension",s.as_application=!0)}else r.location.protocol.match(/http/)?(r.parent!=r&&o.access_token&&o.user_id?(s.app_type="vkontakte",s.check_resize=!0):(s.need_favicon=!0,s.app_type="web_app"),s.as_application=!1,s.needs_url_history=!0):r.pokki&&r.pokki.show?(s.safe_data=!0,s.app_type="pokki_app",s.cross_domain_allowed=!0,s.deep_sanbdox=!0):typeof btapp=="object"?(s.app_type="utorrent_app",s.as_application=!1,s.deep_sanbdox=!0):i.browser=="mozilla"?(s.app_type="firefox_widget",s.as_application=!0):(s.app_type=!1,s.unknown_app=!0,s.needs_url_history=!0);try{r.document.createEvent("TouchEvent")&&(s.touch_support=!0)}catch(a){}s.app_type?s[s.app_type]=!0:(s.app_type="unknown_app_type"+(r.navigator.userAgent&&": "+r.navigator.userAgent),s.unknown_app_type=!0,s.deep_sanbdox=!0),s.iframe_support=!s.utorrent_app&&(!s.unknown_app_type||r.location.protocol=="file:");var f=function(){return(r.navigator.language||r.navigator.browserLanguage||"en").slice(0,2).toLowerCase()};return s.vkontakte?o.language==="0"?s.lang="ru":o.language==="3"?s.lang="en":s.lang=f():s.lang=f(),s}(window);typeof widget!="object"&&(window.widget={fake_widget:!0,identifier:0,showNotification:function(){return!1},openURL:function(e){window.open(e)}}),function(){var e;window.widget&&!window.widget.fake_widget?window.widget.openURL?e=function(){return window.widget.openURL.apply(window.widget,arguments)}:e=function(e){var t=window.document.createElement("a");t.href=e,t.click()}:window.pokki&&pokki.openURLInDefaultBrowser?e=function(){return pokki.openURLInDefaultBrowser.apply(pokki,arguments)}:r.tizen_app?e=function(e){var t=new window.tizen.ApplicationControl("http://tizen.org/appcontrol/operation/view",e);window.tizen.application.launchAppControl(t,null,function(){i.log("launch appControl succeeded")},function(e){i.log("launch appControl failed. Reason: "+e&&e.name)})}:e=function(e){return window.open(e)},r.openURL=e,window.pokki&&pokki.showWebSheet&&(r.showWebPage=function(e,t,n,i,s){var o=function(e){n&&n(e),pokki.hideWebSheet()},u=function(e){var n=t.apply(this,arguments);return n?(r.hideWebPages(),!1):!0};return pokki.showWebSheet(e,i||640,s||480,u,o)},r.hideWebPages=function(){return pokki.hideWebSheet()},r.clearWebPageCookies=function(){return pokki.clearWebSheetCookies()})}();if(typeof i!="object"){var i={};window.navigator.userAgent.match(/Opera/)?i.log=function(){opera.postError.apply(opera,arguments)}:typeof System!="undefined"&&System.Debug?i.log=function(e){System.Debug.outputString(e)}:i.log=function(){}}return function(){var e=typeof window!="undefined"?window:exports;if(e.btoa)return;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u}),e.atob||(e.atob=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u})}(),r}),define("localizer",{"music-cond":{original:"Music Conductor",ru:"Музыкальный кондуктор"},"no-dgs-id":{original:"Artist's discogs profile was not found",ru:"Discogs профиль артиста не был найден"},"Hypem-cant-load":{original:"Your browser does not support XHR2 to load data from hypem.com",ru:"Ваш браузер не поддерживает XHR2, необходимый чтобы загружать данные с hypem.com"},"Art-sc-likes":{original:"Artist soundcloud likes",ru:"Понравившиеся композиции на soundcloud"},"Art-sc-songs":{original:"From soundcloud profle",ru:"Из soundcloud профиля"},"Sc-profile-not-found":{original:"Artist's soundcloud profile was not found",ru:"Soundcloud профиль артиста не был найден"},"no-soundcloud-profile":{original:"Artist does not have soundcloud profile",ru:"У артиста нет страницы на soundcloud"},"Blogged-all-hypem":{original:"Blogged, all and sundry (hypem.com)",ru:"Из блогов, все подряд (hypem.com)"},"Blogged-25-hypem":{original:"Blogged, 25-250 Favorites (hypem.com)",ru:"Из блогов, у 25-250 в избранном (hypem.com)"},"Blogged-250-hypem":{original:"Blogged, 250+ Favorites (hypem.com)",ru:"Из блогов, у 250+ в избранном (hypem.com)"},News:{original:"News",ru:"Новости"},Acquaintances:{original:"Acquaintances",ru:"Знакомства"},vk_photo_meet_need:{original:'If you want to meet this person you need to upload photo to your vk.com profile and press "%button_name%" button',ru:'Чтобы познакомиться, необходимо загрузить фотографию в свой профиль во вконтакте, после чего нажать кнопку "%button_name%"'},vk_photo_update:{original:"Get photo from my vk.com profile",ru:"Получить фотографию из моего профиля вконтакте"},"play-random-best-of-arts":{original:"Play random best tracks of this artists",ru:"Играть случайные лучшие композиции этих артистов"},"your-pmus-f-aq":{original:"Your personal music, friends and acquaintances",ru:"Твоя персональная музыка, друзья и знакомства"},"listeners-looks":{original:"People who have listened to this track, look like this",ru:"Люди, слушавшие эту композицию, выглядят примерно так:"},"rels-people-you":{original:"People which want to meet you",ru:"Люди, которые хотят познакомиться с тобой"},"rels-you-people":{original:"People you want to meet",ru:"Люди, с которыми ты хочешь познакомиться"},"user-want-you":{original:"This user wants to meet you",ru:"Этот пользователь хочеть познакомиться с тобой"},"you-want-user":{original:"You want to meet this user",ru:"Ты хочешь познакомиться с этим пользователем"},"Free-songs":{original:"Free",ru:"Бесплатные"},"Explore-songs-exfm":{original:"Explorable from ex.fm",ru:"Ознакомляющие (ex.fm)"},"Trending-songs-exfm":{original:"Trending on ex.fm",ru:"Актуальные (ex.fm)"},"if-you-accept-one-i":{original:"If you accept invite from one of the users, then",ru:"Если ты примешь приглашение от одного из пользователей, то"},"if-user-accept-i":{original:"If user accepts your invite, then",ru:"Если пользователь примет твоё приглашение, то "},"you-familiar":{original:"Are you familiar with this user",ru:"Ты знаком с этим пользователем"},"if-one-accept-i":{original:"If one of the users accepts your invite, then",ru:"Если один из пользователей примет твоё приглашение, то"},"will-get-link":{original:"you will get link to his profile after 5 days",ru:"через 5 дней ты получешь ссылку на его профиль"},"wget-link":{original:"You will get profile link",ru:"Ссылка на профиль появится"},"Search-resuls":{original:"%query% search resuls",ru:"Результаты поиска %query%"},attime:{original:"at",ru:"в"},m1:{original:"January",ru:"января"},m2:{original:"February",ru:"февраля"},m3:{original:"March",ru:"марта"},m4:{original:"April",ru:"апреля"},m5:{original:"May",ru:"мая"},m6:{original:"June",ru:"июня"},m7:{original:"July",ru:"июля"},m8:{original:"August",ru:"августа"},m9:{original:"September",ru:"сентября"},m10:{original:"October",ru:"октября"},m11:{original:"November",ru:"ноября"},m12:{original:"December",ru:"декабря"},"enter-code":{original:"Enter here code",ru:"Помести сюда полученный код"},"use-code":{original:"use code",ru:"использовать код"},"input-code":{original:"input code",ru:"ввести код"},refresh:{original:"refresh",ru:"обновить"},"want-meet":{original:"Want to meet",ru:"Хочу познакомиться"},"Pop-tags":{original:"Popular tags",ru:"Популярные теги"},"User-listening":{original:"Users are listening",ru:"Пользователи слушают"},"last-week-с":{original:"Last week",ru:"Последнюю неделю город"},reg:{original:"registration",ru:"регистрация"},listening:{original:"is listening",ru:"слушает"},"listen-this":{original:"listen this",ru:"слушал это"},search:{original:"Search",ru:"Поиск"},"search-big":{original:"Search artists, albums, songs, tags",ru:"Ищи артистов, альбомы, композиции, тэги"},trysearches:{original:"try to search",ru:"Попробуй найти"},Download:{original:"Download",ru:"Скачать"},"search-control-hint":{original:"Use keyboard: up and down arrows, enter",ru:"Используй клавиатуру: стрелки вверх, вниз и клавишу ввод"},reccoms:{original:"Recommendations",ru:"Рекомендации"},"reccoms-for-you":{original:"Recommendations for you",ru:"Рекомендации для тебя"},"reccoms-for":{original:"Recommendations for",ru:"Рекомендации для"},"vk-audio":{original:"Vkontakte audio",ru:"Аудиозаписи во вконтакте"},grant:{original:"grant",ru:"дать доступ"},"user-granted-lfm":{original:"I've granted my account access to Seesu",ru:"Я дал Сису доступ к своей учётной записи"},"give-reccoms":{original:"give me recommendations",ru:"получить рекомендации"},"grant-lfm-desc":{original:"It's simple and safe. It does not require your last.fm password.",ru:"Это просто и безопасно, не требует твой пароль от last.fm"},"or-type-username":{original:"or type username",ru:"или введи имя пользователя"},"type-friend-desc":{original:" (you can type your friend)",ru:"(ты можешь ввести своего друга)"},"give-love":{original:"give me loved tracks",ru:"получить любимые композиции"},"loved-tracks":{original:"Loved Tracks",ru:"Любимые композиции"},playlists:{original:"Playlists",ru:"Плейлисты"},profile:{original:"profile",ru:"страница"},Tag:{original:"Tag",ru:"Тег"},Tags:{original:"Tags",ru:"Теги"},"get-albums":{original:"get albums",ru:"получить альбомы"},"Similar-to":{original:"Similar to",ru:"Похожие на"},"similar-arts":{original:"Similar artists",ru:"Похожие артисты"},albums:{original:"albums",ru:"альбомы"},artcard:{original:"artist card",ru:"карточка артиста"},"Best-tracks":{original:"Best tracks",ru:"Лучшие композиции"},"Week-chart":{original:"Week chart",ru:"Недельный чарт"},Top:{original:"Top",ru:"Лучшие"},"Top-tracks":{original:"Top tracks",ru:"Лучшие композиции"},"stop-flash":{original:"To stop annoing «Adobe Flash Player Security» window copy this address:",ru:"Чтобы убрать сообщение об  «Adobe Flash Player Security» скопируй следующий адрес"},"add-to-wl":{original:"add it to white list on",ru:"добавь его в белый список на"},flashpage:{original:"flash internet security page",ru:"странице безопасности флеша"},"and-restart":{original:"and then restart Seesu",ru:"и перезапусти Сису"},"addto-lfm-favs":{original:"add to favorites",ru:"добавить в избранное"},"lastfm-sharing-access":{original:"To share by last.fm",ru:"Что бы делиться музыкой с помощью last.fm"},"lastfm-loveit-access":{original:"To add song to your favorites",ru:"Чтобы добавить композицию в избранное"},"lastfm-tagging-access":{original:"To add tags to song",ru:"Чтобы присвоить композиции теги"},"lastfm-scrobble-access":{original:"To scrobble to last.fm",ru:"Для скроблинга в last.fm"},"lastfm-reccoms-access":{original:"To get your music recommendations",ru:"Чтобы получить рекомендации"},"grant-love-lfm-access":{original:"To get your favorite tracks",ru:"Чтобы получить свои любимые композиции"},"to-get-access":{original:"To get access",ru:"Чтобы получить доступ"},"lfm-auth-invitation":{original:"you must grant access to Seesu from last.fm",ru:"тебе нужно дать Сису доступ к своей учётной записи на last.fm"},"to-find-and-play":{original:"To find and play",ru:"Чтобы найти и прослушать"},"to-find-better":{original:"To find better",ru:"Чтобы найти более подходящие"},"music-files-from-vk":{original:"music files you",ru:"музыкальные файлы"},"vk-auth-invitation":{original:"need to login to vk.com (vkontakte.ru)",ru:"тебе необходимо войти во vkontakte.ru (vk.com)"},"stabilization-of-vk":{original:"Some files were found using test vkontakte.ru (vk.com) accaunt. Searching files for new compositions can break at any time. This will not happen if you use your own accaunt",ru:"Некоторые файлы найдены с помощью тестовой учётной записи vkontakte.ru (vk.com), поиск файлов для новых композиций может прекратится в любой момент. Этого не произойдёт, если ты будешь использовать свою учётную запись vkontakte"},"to-meet-man-vk-short":{original:"To meet with this man",ru:"Чтобы познакомиться с этим человеком"},"to-meet-man-vk":{original:"If you want to meet this man you need to sign in to vk.com (vkontakte.ru)",ru:"Если ты хочешь познакомиться с этим человеком, то ты должен войти во vkontakte.ru (vk.com)"},"to-get-mp3-sign-to-vk":{original:"To get mp3 files you need to sign in to vk.com (vkontakte.ru)",ru:"Чтобы получить доступ к mp3 файлам ты должен войти во vkontakte.ru (vk.com)"},"to-get-mp3-login-to-vk":{original:"To get mp3 files you need to login to vk.com or to vkontakte.ru",ru:"Чтобы получить доступ к mp3 файлам ты должен дать доступ к своей учётной записи vkontakte.ru или vk.com"},sign:{original:"sign in",ru:"войти"},"you-may":{original:"You may",ru:"Ты можешь"},"create-acc":{original:"create new account",ru:"создать учётную запись"},"its-free":{original:"(it's free)",ru:"(это бесплатно)"},"open-api-secure":{original:"Try both if you get «Open API security breach».",ru:"Попробуй и то и другое, если у тебя появляется сообщение «Open API security breach»."},email:{original:"E-mail",ru:"Почта"},password:{original:"Password",ru:"Пароль"},savepass:{original:"Save password in Seesu",ru:"Сохранить пароль в Сису"},"rept-song":{original:"Repeat playing song",ru:"Повторять играющую композицию"},"dont-rept-pl":{original:"Do not repeat playlist",ru:"Не повторять плейлист"},"playlist-getmp3":{original:"Find files for compositions",ru:"Найти композициям файлы"},"playlist-export":{original:"Save playlist to *.m3u file",ru:"Сохранить плейлист в m3u файл"},addsong:{original:"add song to",ru:"добавить композицию в"},"to-search":{original:"Search ",ru:"Искать "},"in-artists":{original:"in artists",ru:"в артистах"},"in-tracks":{original:"in tracks",ru:"в композициях"},"in-tags":{original:"in tags",ru:"в тегах"},"in-albums":{original:"in albums",ru:"в альбомах"},Songs:{original:"Songs",ru:"Композиции"},Artists:{original:"Artists",ru:"Артисты"},Tracks:{original:"Tracks",ru:"Треки"},"Show-all":{original:"Show all",ru:"Показать все"},Albums:{original:"Albums",ru:"Альбомы"},"full-list":{original:"full list",ru:"полный список"},oartists:{original:"artists",ru:"артистов"},otracks:{original:"tracks",ru:"композиций"},otags:{original:"tags",ru:"тегов"},oalbums:{original:"albums",ru:"альбомов"},video:{original:"Video",ru:"Видео"},"hide-them":{original:"hide them",ru:"скрыть их"},"show-them":{original:"show them",ru:"показать их"},show:{original:"show",ru:"показать"},"direct-vk-search":{original:"Search mp3  directly in vkontakte",ru:"Искать mp3 прямо во вконтакте"},"fine-more":{original:"find more",ru:"Найти больше"},now_playing:{original:"Now Playing",ru:"Сейчас играет"},"nothing-found":{original:"Nothing found",ru:"Не найдено"},files:{original:"Files",ru:"Файлы"},"show-all-files":{original:"show all files",ru:"показать все файлы"},"ask-rating-help":{original:"Hi! My name is Gleb. I've created seesu and I have been developing it since september 2009 beside to my primary job. If you like it, than set rating %app_url% please. This is very important for me.",ru:"Привет, меня зовут Глеб, я создал сису и развиваю её с сентября 2009 года в свободное от основной работы время. Если она тебе нравится прошу поставить оценку %app_url% — это очень важно для меня. Довольные люди обычно не ставят оценок, при этом недовольных никакая лень не остановит :("},"at-this-page":{original:"at this page",ru:"на этой странице"},"cr-new-playlist":{original:"new playlist named",ru:"новый плейлист"},"post-song":{original:"Post song",ru:"Отправить композицию"},"to-own-wall":{original:"to own wall",ru:"на свою стену"},"or-wall-of-f":{original:"or to the friend's wall",ru:"или на стену одного из друзей"},"to-play-vk-audio":{original:'To play "my audio"',ru:'Чтобы проигрывать "мои аудиозаписи"'},"to-find-vk-friends":{original:"To select your vk.com friend",ru:"Чтобы выбрать стену друга на vk.com"},"to-post-and-find-vk":{original:"To select your vk.com friend and post him song",ru:"Чтобы выбрать стену друга и отправить композицию на его стену"},"load-more":{original:"load more",ru:"загрузить больше"},"accept-inv":{original:"Accept invite",ru:"Принять приглашение"},"more-ab-info":{original:"more about artist",ru:"больше об артисте"},"All-a-world":{original:"All around the World",ru:"По всему миру"},Hyped:{original:"Hyped",ru:"Набирающие популярность"},Unique:{original:"Unique",ru:"Уникальные"},"Most Loved":{original:"Most Loved",ru:'В "любимом" у пользователей'},Countries:{original:"Countries",ru:"Страны"},"Cities of %country%":{original:"Cities of %country%",ru:'Города страны "%country%"'},"Artists lists":{original:"Artists lists",ru:"Списки артистов"},"Songs lists":{original:"Songs lists",ru:"Списки композиций"},"Top Songs":{original:"Top Songs",ru:"Лучшие композиции"},"Top Artists":{original:"Top Artists",ru:"Лучшие артисты"},"Latest Blogged music from hypem.com":{original:"Latest Blogged music from hypem.com",ru:"Свежаяйшая музыка из блогов, собранная hypem.com"},"Latest Blogged remixes from hypem.com":{original:"Latest Blogged remixes from hypem.com",ru:"Свежайшие ремиксы из блогов, собранные hypem.com"},"Popular Now on hypem.com":{original:"Popular Now on hypem.com",ru:"Популярное сейчас на hypem.com"},"Albums from Discogs":{original:"Albums from Discogs",ru:"Альбомы с discogs"},"Albums of %artist% from last.fm":{original:"Albums of %artist% from last.fm",ru:"Альбомы «%artist%» с last.fm"},"Similar to «%artist%» artists":{original:"Similar to «%artist%» artists",ru:"Артисты похожие на «%artist%»"},"Fresh songs":{original:"Fresh songs",ru:"Свежие композиции"},"Most Favorites":{original:"Most Favorites",ru:"В избранном у пользователей"},"Most Reblogged":{original:"Most Reblogged",ru:"Наиболее упоминаемое в блогах"},"vk.com tracks":{original:"vk.com tracks",ru:"композиции с vk.com"},"vk.com friends":{original:"друзья с vk.com",ru:""},"Last.fm friends":{original:"Last.fm friends",ru:"друзья с last.fm"},Neighbours:{original:"Neighbours",ru:"Соседи"},Friends:{original:"Friends",ru:"Друзья"},"VK-Recommended":{original:"Recommended",ru:"Рекомендации"},"«My audio»":{original:"«My audio»",ru:"«Мои аудиозаписи»"},"Top fans":{original:"Top fans",ru:"Большие фанаты"},lastfm_fans:{original:"Last.fm \n song fans",ru:"Фанаты \n на last.fm"},enabled:{original:"enabled",ru:"включить"},disabled:{original:"disabled",ru:"отключить"},lfm_scrobbling:{original:"scrobbling to last.fm",ru:"last.fm скроблинг"},"shuffl-list":{original:"Shuffled playlist playing",ru:"Воспроизводить плейлист случайным образом"},your_tags:{original:"Your tags",ru:"Твои теги"},top_track_tags:{original:"Top tags of track",ru:"Теги композиции"},artist_tags:{original:"Artist tags",ru:"Теги артиста"},dmca_notice:{original:"Seesu follows terms of service of each api it uses. Seesu does not store any content. Each service follows DMCA. Feel free to report abuse.",ru:"Сису соблюдает условия использования каждого сервиса, которого она использует и не хранит какого-либо контента. Каждый сервис соблюдает DMCA. Вы имеете возможность направить им жалобы на нарушения копирайта."},"report-abuse":{original:"report abuse",ru:"пожаловаться"},"":{original:"",ru:""},"disable-search":{original:"Disable searching in this source",ru:"Отключить поиск файлов в этом источнике"},"wait-before-play":{original:"Wait for files from this source before start playing",ru:"Дожидаться списка файлов из этого источника до воспроизведения"},"need-audioplayers":{original:"To play music you must install flash or use browser which supports mp3 HTML5 Audio",ru:"Что бы приложение воспроизводило музыку установите флеш или воспользуйтесь браузером поддерживающим воспроизведение mp3 с помощью HTML5 audio (например Chrome или Safari)"},"posts-from":{original:"Posts form",ru:"Записи из"},"":{original:"",ru:""}}),!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(a,b){function s(e){var t="length"in e&&e.length,r=n.type(e);return"function"===r||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}function x(e,t,r){if(n.isFunction(t))return n.grep(e,function(e,n){return!!t.call(e,n,e)!==r});if(t.nodeType)return n.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(w.test(t))return n.filter(t,e,r);t=n.filter(t,e)}return n.grep(e,function(e){return g.call(t,e)>=0!==r})}function D(e,t){while((e=e[t])&&1!==e.nodeType);return e}function G(e){var t=F[e]={};return n.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+K.uid++}function P(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(O,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:N.test(r)?n.parseJSON(r):r}catch(s){}M.set(e,t,r)}else r=void 0;return r}function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(e){}}function ja(e,t){return n.nodeName(e,"table")&&n.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ka(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function la(e){var t=ga.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function ma(e,t){for(var n=0,r=e.length;r>n;n++)L.set(e[n],"globalEval",!t||L.get(t[n],"globalEval"))}function na(e,t){var r,i,s,o,u,a,f,l;if(1===t.nodeType){if(L.hasData(e)&&(o=L.access(e),u=L.set(t,o),l=o.events)){delete u.handle,u.events={};for(s in l)for(r=0,i=l[s].length;i>r;r++)n.event.add(t,s,l[s][r])}M.hasData(e)&&(a=M.access(e),f=n.extend({},a),M.set(t,f))}}function oa(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&n.nodeName(e,t)?n.merge([e],r):r}function pa(e,t){var n=t.nodeName.toLowerCase();"input"===n&&T.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function sa(e,t){var r,i=n(t.createElement(e)).appendTo(t.body),s=a.getDefaultComputedStyle&&(r=a.getDefaultComputedStyle(i[0]))?r.display:n.css(i[0],"display");return i.detach(),s}function ta(e){var t=l,r=ra[e];return r||(r=sa(e,t),"none"!==r&&r||(qa=(qa||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=qa[0].contentDocument,t.write(),t.close(),r=sa(e,t),qa.detach()),ra[e]=r),r}function xa(e,t,r){var i,s,o,u,a=e.style;return r=r||wa(e),r&&(u=r.getPropertyValue(t)||r[t]),r&&(""!==u||n.contains(e.ownerDocument,e)||(u=n.style(e,t)),va.test(u)&&ua.test(t)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=r.width,a.width=i,a.minWidth=s,a.maxWidth=o)),void 0!==u?u+"":u}function ya(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function Fa(e,t){if(t in e)return t;var n=t[0].toUpperCase()+t.slice(1),r=t,i=Ea.length;while(i--)if(t=Ea[i]+n,t in e)return t;return r}function Ga(e,t,n){var r=Aa.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Ha(e,t,r,i,s){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,u=0;4>o;o+=2)"margin"===r&&(u+=n.css(e,r+R[o],!0,s)),i?("content"===r&&(u-=n.css(e,"padding"+R[o],!0,s)),"margin"!==r&&(u-=n.css(e,"border"+R[o]+"Width",!0,s))):(u+=n.css(e,"padding"+R[o],!0,s),"padding"!==r&&(u+=n.css(e,"border"+R[o]+"Width",!0,s)));return u}function Ia(e,t,r){var i=!0,s="width"===t?e.offsetWidth:e.offsetHeight,o=wa(e),u="border-box"===n.css(e,"boxSizing",!1,o);if(0>=s||null==s){if(s=xa(e,t,o),(0>s||null==s)&&(s=e.style[t]),va.test(s))return s;i=u&&(k.boxSizingReliable()||s===e.style[t]),s=parseFloat(s)||0}return s+Ha(e,t,r||(u?"border":"content"),i,o)+"px"}function Ja(e,t){for(var r,i,s,o=[],u=0,a=e.length;a>u;u++)i=e[u],i.style&&(o[u]=L.get(i,"olddisplay"),r=i.style.display,t?(o[u]||"none"!==r||(i.style.display=""),""===i.style.display&&S(i)&&(o[u]=L.access(i,"olddisplay",ta(i.nodeName)))):(s=S(i),"none"===r&&s||L.set(i,"olddisplay",s?r:n.css(i,"display"))));for(u=0;a>u;u++)i=e[u],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[u]||"":"none"));return e}function Ka(e,t,n,r,i){return new Ka.prototype.init(e,t,n,r,i)}function Sa(){return setTimeout(function(){La=void 0}),La=n.now()}function Ta(e,t){var n,r=0,i={height:e};for(t=t?1:0;4>r;r+=2-t)n=R[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function Ua(e,t,n){for(var r,i=(Ra[t]||[]).concat(Ra["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function Va(e,t,r){var i,s,o,u,a,f,l,c,h=this,p={},d=e.style,v=e.nodeType&&S(e),m=L.get(e,"fxshow");r.queue||(a=n._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,f=a.empty.fire,a.empty.fire=function(){a.unqueued||f()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,n.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[d.overflow,d.overflowX,d.overflowY],l=n.css(e,"display"),c="none"===l?L.get(e,"olddisplay")||ta(e.nodeName):l,"inline"===c&&"none"===n.css(e,"float")&&(d.display="inline-block")),r.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=r.overflow[0],d.overflowX=r.overflow[1],d.overflowY=r.overflow[2]}));for(i in t)if(s=t[i],Na.exec(s)){if(delete t[i],o=o||"toggle"===s,s===(v?"hide":"show")){if("show"!==s||!m||void 0===m[i])continue;v=!0}p[i]=m&&m[i]||n.style(e,i)}else l=void 0;if(n.isEmptyObject(p))"inline"===("none"===l?ta(e.nodeName):l)&&(d.display=l);else{m?"hidden"in m&&(v=m.hidden):m=L.access(e,"fxshow",{}),o&&(m.hidden=!v),v?n(e).show():h.done(function(){n(e).hide()}),h.done(function(){var t;L.remove(e,"fxshow");for(t in p)n.style(e,t,p[t])});for(i in p)u=Ua(v?m[i]:0,i,h),i in m||(m[i]=u.start,v&&(u.end=u.start,u.start="width"===i||"height"===i?1:0))}}function Wa(e,t){var r,i,s,o,u;for(r in e)if(i=n.camelCase(r),s=t[i],o=e[r],n.isArray(o)&&(s=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),u=n.cssHooks[i],u&&"expand"in u){o=u.expand(o),delete e[i];for(r in o)r in e||(e[r]=o[r],t[r]=s)}else t[i]=s}function Xa(e,t,r){var i,s,o=0,u=Qa.length,a=n.Deferred().always(function(){delete f.elem}),f=function(){if(s)return!1;for(var t=La||Sa(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,i=1-r,o=0,u=l.tweens.length;u>o;o++)l.tweens[o].run(i);return a.notifyWith(e,[l,i,n]),1>i&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:n.extend({},t),opts:n.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:La||Sa(),duration:r.duration,tweens:[],createTween:function(t,r){var i=n.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,r=t?l.tweens.length:0;if(s)return this;for(s=!0;r>n;n++)l.tweens[n].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),c=l.props;for(Wa(c,l.opts.specialEasing);u>o;o++)if(i=Qa[o].call(l,e,c,l.opts))return i;return n.map(c,Ua,l),n.isFunction(l.opts.start)&&l.opts.start.call(e,l),n.fx.timer(n.extend(f,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function qb(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,s=0,o=t.toLowerCase().match(E)||[];if(n.isFunction(r))while(i=o[s++])"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function rb(e,t,r,i){function u(l){var h;return s[l]=!0,n.each(e[l]||[],function(e,n){var a=n(t,r,i);return"string"!=typeof a||o||s[a]?o?!(h=a):void 0:(t.dataTypes.unshift(a),u(a),!1)}),h}var s={},o=e===mb;return u(t.dataTypes[0])||!s["*"]&&u("*")}function sb(e,t){var r,i,s=n.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((s[r]?e:i||(i={}))[r]=t[r]);return i&&n.extend(!0,e,i),e}function tb(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function ub(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Ab(e,t,r,i){var s;if(n.isArray(t))n.each(t,function(t,n){r||wb.test(e)?i(e,n):Ab(e+"["+("object"==typeof n?t:"")+"]",n,r,i)});else if(r||"object"!==n.type(t))i(e,t);else for(s in t)Ab(e+"["+s+"]",t[s],r,i)}function Jb(e){return n.isWindow(e)?e:9===e.nodeType&&e.defaultView}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.4",n=function(e,t){return new n.fn.init(e,t)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(e,t){return t.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:d.call(this)},pushStack:function(e){var t=n.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return n.each(this,e,t)},map:function(e){return this.pushStack(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[a]||{},a++),"object"==typeof u||n.isFunction(u)||(u={}),a===f&&(u=this,a--);f>a;a++)if(null!=(e=arguments[a]))for(t in e)r=u[t],i=e[t],u!==i&&(l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},u[t]=n.extend(l,o,i)):void 0!==i&&(u[t]=i));return u},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===n.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!n.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==n.type(e)||e.nodeType||n.isWindow(e)?!1:e.constructor&&!j.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[i.call(e)]||"object":typeof e},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(e){return e.replace(p,"ms-").replace(q,r)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,u=s(e);if(n){if(u){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(u){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(o,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(s(Object(e))?n.merge(r,"string"==typeof e?[e]:e):f.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:g.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;n>r;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(t,n,r){var i,o=0,u=t.length,a=s(t),f=[];if(a)for(;u>o;o++)i=n(t[o],o,r),null!=i&&f.push(i);else for(o in t)i=n(t[o],o,r),null!=i&&f.push(i);return e.apply([],f)},guid:1,proxy:function(e,t){var r,i,s;return"string"==typeof t&&(r=e[t],t=e,e=r),n.isFunction(e)?(i=d.call(arguments,2),s=function(){return e.apply(t||this,i.concat(d.call(arguments)))},s.guid=e.guid=e.guid||n.guid++,s):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){h["[object "+t+"]"]=t.toLowerCase()});var t=function(e){function ot(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],l=t.nodeType,"string"!=typeof e||!e||1!==l&&9!==l&&11!==l)return r;if(!i&&v){if(11!==l&&(s=Z.exec(e)))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return D.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName)return D.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=1!==l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+gt(d[c]);S=et.test(e)&&vt(t.parentNode)||t,x=d.join(",")}if(x)try{return D.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ut(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function at(e){return e[w]=!0,e}function ft(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function ct(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||L)-(~e.sourceIndex||L);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function dt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function vt(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function mt(){}function gt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function yt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n){for(var r=0,i=t.length;i>r;r++)ot(e,t[r],n);return n}function Et(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function St(e,t,n,r,i,s){return r&&!r[w]&&(r=St(r)),i&&!i[w]&&(i=St(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:Et(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=Et(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?H(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=Et(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):D.apply(o,g)})}function xt(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return H(t,e)>-1},u,!0),h=[function(e,n,r){var i=!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r));return t=null,i}];s>a;a++)if(n=r.relative[e[a].type])h=[yt(bt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++)if(r.relative[e[i].type])break;return St(a>1&&bt(h),a>1&&gt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&xt(e.slice(a,i)),s>i&&xt(e=e.slice(i)),s>i&&gt(e))}h.push(n)}return bt(h)}function Tt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}if(v+=m,n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=M.call(a));y=Et(y)}D.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&ot.uniqueSort(a)}return l&&(S=E,f=b),g};return n?at(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+1*new Date,E=e.document,S=0,x=0,T=ut(),N=ut(),C=ut(),k=function(e,t){return e===t&&(c=!0),0},L=1<<31,A={}.hasOwnProperty,O=[],M=O.pop,_=O.push,D=O.push,P=O.slice,H=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",j="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",I=F.replace("w","w#"),q="\\["+j+"*("+F+")(?:"+j+"*([*^$|!~]?=)"+j+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+j+"*\\]",R=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",U=new RegExp(j+"+","g"),z=new RegExp("^"+j+"+|((?:^|[^\\\\])(?:\\\\.)*)"+j+"+$","g"),W=new RegExp("^"+j+"*,"+j+"*"),X=new RegExp("^"+j+"*([>+~]|"+j+")"+j+"*"),V=new RegExp("="+j+"*([^\\]'\"]*?)"+j+"*\\]","g"),$=new RegExp(R),J=new RegExp("^"+I+"$"),K={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+R),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+j+"*(even|odd|(([+-]|)(\\d*)n|)"+j+"*(?:([+-]|)"+j+"*(\\d+)|))"+j+"*\\)|)","i"),bool:new RegExp("^(?:"+B+")$","i"),needsContext:new RegExp("^"+j+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+j+"*((?:-\\d)?\\d*)"+j+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+j+"?|("+j+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},it=function(){h()};try{D.apply(O=P.call(E.childNodes),E.childNodes),O[E.childNodes.length].nodeType}catch(st){D={apply:O.length?function(e,t){_.apply(e,P.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=ot.support={},s=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},h=ot.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:E;return o!==p&&9===o.nodeType&&o.documentElement?(p=o,d=o.documentElement,i=o.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",it,!1):i.attachEvent&&i.attachEvent("onunload",it)),v=!s(o),n.attributes=ft(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ft(function(e){return e.appendChild(o.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(o.getElementsByClassName),n.getById=ft(function(e){return d.appendChild(e).id=w,!o.getElementsByName||!o.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return v?t.getElementsByClassName(e):void 0},g=[],m=[],(n.qsa=Y.test(o.querySelectorAll))&&(ft(function(e){d.appendChild(e).innerHTML="<a id='"+w+"'></a><select id='"+w+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+j+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+j+"*(?:value|"+B+")"),e.querySelectorAll("[id~="+w+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]")}),ft(function(e){var t=o.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+j+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ft(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",R)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===o||e.ownerDocument===E&&b(E,e)?-1:t===o||t.ownerDocument===E&&b(E,t)?1:l?H(l,e)-H(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,u=[e],a=[t];if(!i||!s)return e===o?-1:t===o?1:i?-1:s?1:l?H(l,e)-H(l,t):0;if(i===s)return ct(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?ct(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},o):p},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return ot(t,p,null,[e]).length>0},ot.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},ot.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&A.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ot.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=ot.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=ot.selectors={cacheLength:50,createPseudo:at,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+j+")"+e+"("+j+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(U," ")+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=H(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:at(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),t[0]=null,!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return e=e.replace(nt,rt),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:at(function(e){return J.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:dt(function(){return[0]}),last:dt(function(e,t){return[t-1]}),eq:dt(function(e,t,n){return[0>n?n+t:n]}),even:dt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:dt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:dt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:dt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ht(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pt(t);return mt.prototype=r.filters=r.pseudos,r.setFilters=new mt,o=ot.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter)!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ot.error(e):N(e,a).slice(0)},u=ot.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=xt(t[n]),s[w]?r.push(s):i.push(s);s=C(e,Tt(i,r)),s.selector=e}return s},a=ot.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&vt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&gt(f),!e)return D.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&vt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=ft(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),ft(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||lt("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ft(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||lt("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),ft(function(e){return null==e.getAttribute("disabled")})||lt(B,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),ot}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;n.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?n.find.matchesSelector(i,e)?[i]:[]:n.find.matches(e,n.grep(t,function(e){return 1===e.nodeType}))},n.fn.extend({find:function(e){var t,r=this.length,i=[],s=this;if("string"!=typeof e)return this.pushStack(n(e).filter(function(){for(t=0;r>t;t++)if(n.contains(s[t],this))return!0}));for(t=0;r>t;t++)n.find(e,s[t],i);return i=this.pushStack(r>1?n.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,"string"==typeof e&&u.test(e)?n(e):e||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||y).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof n?t[0]:t,n.merge(this,n.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:l,!0)),v.test(r[1])&&n.isPlainObject(t))for(r in t)n.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=l.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=l,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):n.isFunction(e)?"undefined"!=typeof y.ready?y.ready(e):e(n):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),n.makeArray(e,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(e,t,r){var i=[],s=void 0!==r;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(s&&n(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),n.fn.extend({has:function(e){var t=n(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++)if(n.contains(this,t[e]))return!0})},closest:function(e,t){for(var r,i=0,s=this.length,o=[],a=u.test(e)||"string"!=typeof e?n(e,t||this.context):0;s>i;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&n.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?n.unique(o):o)},index:function(e){return e?"string"==typeof e?g.call(n(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(n.unique(n.merge(this.get(),n(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),n.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return n.dir(e,"parentNode")},parentsUntil:function(e,t,r){return n.dir(e,"parentNode",r)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return n.dir(e,"nextSibling")},prevAll:function(e){return n.dir(e,"previousSibling")},nextUntil:function(e,t,r){return n.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return n.dir(e,"previousSibling",r)},siblings:function(e){return n.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return n.sibling(e.firstChild)},contents:function(e){return e.contentDocument||n.merge([],e.childNodes)}},function(e,t){n.fn[e]=function(r,i){var s=n.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(s=n.filter(i,s)),this.length>1&&(C[e]||n.unique(s),B.test(e)&&s.reverse()),this.pushStack(s)}});var E=/\S+/g,F={};n.Callbacks=function(e){e="string"==typeof e?F[e]||G(e):n.extend({},e);var t,r,i,s,o,u,a=[],f=!e.once&&[],l=function(n){for(t=e.memory&&n,r=!0,u=s||0,s=0,o=a.length,i=!0;a&&o>u;u++)if(a[u].apply(n[0],n[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):t?a=[]:c.disable())},c={add:function(){if(a){var r=a.length;!function u(t){n.each(t,function(t,r){var i=n.type(r);"function"===i?e.unique&&c.has(r)||a.push(r):r&&r.length&&"string"!==i&&u(r)})}(arguments),i?o=a.length:t&&(s=r,l(t))}return this},remove:function(){return a&&n.each(arguments,function(e,t){var r;while((r=n.inArray(t,a,r))>-1)a.splice(r,1),i&&(o>=r&&o--,u>=r&&u--)}),this},has:function(e){return e?n.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],o=0,this},disable:function(){return a=f=t=void 0,this},disabled:function(){return!a},lock:function(){return f=void 0,t||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return!a||r&&!f||(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},n.extend({Deferred:function(e){var t=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],r="pending",i={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var e=arguments;return n.Deferred(function(r){n.each(t,function(t,o){var u=n.isFunction(e[t])&&e[t];s[o[1]](function(){var e=u&&u.apply(this,arguments);e&&n.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?n.extend(e,i):i}},s={};return i.pipe=i.then,n.each(t,function(e,n){var o=n[2],u=n[3];i[n[1]]=o.add,u&&o.add(function(){r=u},t[1^e][2].disable,t[2][2].lock),s[n[0]]=function(){return s[n[0]+"With"](this===s?i:this,arguments),this},s[n[0]+"With"]=o.fireWith}),i.promise(s),e&&e.call(s,s),s},when:function(e){var t=0,r=d.call(arguments),i=r.length,s=1!==i||e&&n.isFunction(e.promise)?i:0,o=1===s?e:n.Deferred(),u=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)r[t]&&n.isFunction(r[t].promise)?r[t].promise().done(u(t,l,r)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,r),o.promise()}});var H;n.fn.ready=function(e){return n.ready.promise().done(e),this},n.extend({isReady:!1,readyWait:1,holdReady:function(e){e?n.readyWait++:n.ready(!0)},ready:function(e){(e===!0?--n.readyWait:n.isReady)||(n.isReady=!0,e!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}}),n.ready.promise=function(e){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(e)},n.ready.promise();var J=n.access=function(e,t,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===n.type(r)){s=!0;for(a in r)n.access(e,t,a,r[a],!0,o,u)}else if(void 0!==i&&(s=!0,n.isFunction(i)||(u=!0),l&&(u?(t.call(e,i),t=null):(l=t,t=function(e,t,r){return l.call(n(e),r)})),t))for(;f>a;a++)t(e[a],r,u?i:i.call(e[a],a,t(e[a],r)));return s?e:l?t.call(e):f?t(e[0],r):o};n.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(e){if(!K.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=K.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t)}catch(i){t[this.expando]=r,n.extend(e,t)}}return this.cache[r]||(this.cache[r]={}),r},set:function(e,t,r){var i,s=this.key(e),o=this.cache[s];if("string"==typeof t)o[t]=r;else if(n.isEmptyObject(o))n.extend(this.cache[s],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,n.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i,s,o=this.key(e),u=this.cache[o];if(void 0===t)this.cache[o]={};else{n.isArray(t)?i=t.concat(t.map(n.camelCase)):(s=n.camelCase(t),t in u?i=[t,s]:(i=s,i=i in u?[i]:i.match(E)||[])),r=i.length;while(r--)delete u[i[r]]}},hasData:function(e){return!n.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;n.extend({hasData:function(e){return M.hasData(e)||L.hasData(e)},data:function(e,t,n){return M.access(e,t,n)},removeData:function(e,t){M.remove(e,t)},_data:function(e,t,n){return L.access(e,t,n)},_removeData:function(e,t){L.remove(e,t)}}),n.fn.extend({data:function(e,t){var r,i,s,o=this[0],u=o&&o.attributes;if(void 0===e){if(this.length&&(s=M.get(o),1===o.nodeType&&!L.get(o,"hasDataAttrs"))){r=u.length;while(r--)u[r]&&(i=u[r].name,0===i.indexOf("data-")&&(i=n.camelCase(i.slice(5)),P(o,i,s[i])));L.set(o,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){M.set(this,e)}):J(this,function(t){var r,i=n.camelCase(e);if(o&&void 0===t){if(r=M.get(o,e),void 0!==r)return r;if(r=M.get(o,i),void 0!==r)return r;if(r=P(o,i,void 0),void 0!==r)return r}else this.each(function(){var n=M.get(this,i);M.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&M.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){M.remove(this,e)})}}),n.extend({queue:function(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=L.get(e,t),r&&(!i||n.isArray(r)?i=L.access(e,t,n.makeArray(r)):i.push(r)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=n.queue(e,t),i=r.length,s=r.shift(),o=n._queueHooks(e,t),u=function(){n.dequeue(e,t)};"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===t&&r.unshift("inprogress"),delete o.stop,s.call(e,u,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return L.get(e,r)||L.access(e,r,{empty:n.Callbacks("once memory").add(function(){L.remove(e,[t+"queue",r])})})}}),n.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?n.queue(this[0],e):void 0===t?this:this.each(function(){var r=n.queue(this,e,t);n._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&n.dequeue(this,e)})},dequeue:function(e){return this.each(function(){n.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,s=n.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(u--)r=L.get(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(e,t){return e=t||e,"none"===n.css(e,"display")||!n.contains(e.ownerDocument,e)},T=/^(?:checkbox|radio)$/i;!function(){var e=l.createDocumentFragment(),t=e.appendChild(l.createElement("div")),n=l.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),k.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;n.event={global:{},add:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.get(e);if(g){r.handler&&(o=r,r=o.handler,s=o.selector),r.guid||(r.guid=n.guid++),(f=g.events)||(f=g.events={}),(u=g.handle)||(u=g.handle=function(t){return typeof n!==U&&n.event.triggered!==t.type?n.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(E)||[""],l=t.length;while(l--)a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d&&(h=n.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=n.event.special[d]||{},c=n.extend({type:d,origType:m,data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&n.expr.match.needsContext.test(s),namespace:v.join(".")},o),(p=f[d])||(p=f[d]=[],p.delegateCount=0,h.setup&&h.setup.call(e,i,v,u)!==!1||e.addEventListener&&e.addEventListener(d,u,!1)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),n.event.global[d]=!0)}},remove:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.hasData(e)&&L.get(e);if(g&&(f=g.events)){t=(t||"").match(E)||[""],l=t.length;while(l--)if(a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d){h=n.event.special[d]||{},d=(i?h.delegateType:h.bindType)||d,p=f[d]||[],a=a[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=p.length;while(o--)c=p[o],!s&&m!==c.origType||r&&r.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(e,c));u&&!p.length&&(h.teardown&&h.teardown.call(e,v,g.handle)!==!1||n.removeEvent(e,d,g.handle),delete f[d])}else for(d in f)n.event.remove(e,d+t[l],r,i,!0);n.isEmptyObject(f)&&(delete g.handle,L.remove(e,"events"))}},trigger:function(e,t,r,i){var s,o,u,f,c,h,p,d=[r||l],v=j.call(e,"type")?e.type:e,m=j.call(e,"namespace")?e.namespace.split("."):[];if(o=u=r=r||l,3!==r.nodeType&&8!==r.nodeType&&!X.test(v+n.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,e=e[n.expando]?e:new n.Event(v,"object"==typeof e&&e),e.isTrigger=i?2:3,e.namespace=m.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:n.makeArray(t,[e]),p=n.event.special[v]||{},i||!p.trigger||p.trigger.apply(r,t)!==!1)){if(!i&&!p.noBubble&&!n.isWindow(r)){for(f=p.delegateType||v,X.test(f+v)||(o=o.parentNode);o;o=o.parentNode)d.push(o),u=o;u===(r.ownerDocument||l)&&d.push(u.defaultView||u.parentWindow||a)}s=0;while((o=d[s++])&&!e.isPropagationStopped())e.type=s>1?f:p.bindType||v,h=(L.get(o,"events")||{})[e.type]&&L.get(o,"handle"),h&&h.apply(o,t),h=c&&o[c],h&&h.apply&&n.acceptData(o)&&(e.result=h.apply(o,t),e.result===!1&&e.preventDefault());return e.type=v,i||e.isDefaultPrevented()||p._default&&p._default.apply(d.pop(),t)!==!1||!n.acceptData(r)||c&&n.isFunction(r[v])&&!n.isWindow(r)&&(u=r[c],u&&(r[c]=null),n.event.triggered=v,r[v](),n.event.triggered=void 0,u&&(r[c]=u)),e.result}},dispatch:function(e){e=n.event.fix(e);var t,r,i,s,o,u=[],a=d.call(arguments),f=(L.get(this,"events")||{})[e.type]||[],l=n.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=n.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,r=0;while((o=s.handlers[r++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((n.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var r,i,s,o,u=[],a=t.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!==this;f=f.parentNode||this)if(f.disabled!==!0||"click"!==e.type){for(i=[],r=0;a>r;r++)o=t[r],s=o.selector+" ",void 0===i[s]&&(i[s]=o.needsContext?n(s,this).index(f)>=0:n.find(s,this,null,[f]).length),i[s]&&i.push(o);i.length&&u.push({elem:f,handlers:i})}return a<t.length&&u.push({elem:this,handlers:t.slice(a)}),u},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||l,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[n.expando])return e;var t,r,i,s=e.type,o=e,u=this.fixHooks[s];u||(this.fixHooks[s]=u=W.test(s)?this.mouseHooks:V.test(s)?this.keyHooks:{}),i=u.props?this.props.concat(u.props):this.props,e=new n.Event(o),t=i.length;while(t--)r=i[t],e[r]=o[r];return e.target||(e.target=l),3===e.target.nodeType&&(e.target=e.target.parentNode),u.filter?u.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return n.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,i){var s=n.extend(new n.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?n.event.trigger(s,null,t):n.event.dispatch.call(t,s),s.isDefaultPrevented()&&r.preventDefault()}},n.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},n.Event=function(e,t){return this instanceof n.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?Z:$):this.type=e,t&&n.extend(this,t),this.timeStamp=e&&e.timeStamp||n.now(),void (this[n.expando]=!0)):new n.Event(e,t)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Z,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Z,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Z,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){n.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,s=e.relatedTarget,o=e.handleObj;return(!s||s!==i&&!n.contains(i,s))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){n.event.simulate(t,e.target,n.event.fix(e),!0)};n.event.special[t]={setup:function(){var n=this.ownerDocument||this,i=L.access(n,t);i||n.addEventListener(e,r,!0),L.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this,i=L.access(n,t)-1;i?L.access(n,t,i):(n.removeEventListener(e,r,!0),L.remove(n,t))}}}),n.fn.extend({on:function(e,t,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof t&&(r=r||t,t=void 0);for(u in e)this.on(u,t,r,e[u],s);return this}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=$;else if(!i)return this;return 1===s&&(o=i,i=function(e){return n().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=n.guid++)),this.each(function(){n.event.add(this,e,i,r,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,n(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=$),this.each(function(){n.event.remove(this,e,r,t)})},trigger:function(e,t){return this.each(function(){n.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?n.event.trigger(e,t,r,!0):void 0}});var aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ba=/<([\w:]+)/,ca=/<|&#?\w+;/,da=/<(?:script|style|link)/i,ea=/checked\s*(?:[^=]|=\s*.checked.)/i,fa=/^$|\/(?:java|ecma)script/i,ga=/^true\/(.*)/,ha=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ia={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ia.optgroup=ia.option,ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead,ia.th=ia.td,n.extend({clone:function(e,t,r){var i,s,o,u,a=e.cloneNode(!0),f=n.contains(e.ownerDocument,e);if(!(k.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||n.isXMLDoc(e)))for(u=oa(a),o=oa(e),i=0,s=o.length;s>i;i++)pa(o[i],u[i]);if(t)if(r)for(o=o||oa(e),u=u||oa(a),i=0,s=o.length;s>i;i++)na(o[i],u[i]);else na(e,a);return u=oa(a,"script"),u.length>0&&ma(u,!f&&oa(e,"script")),a},buildFragment:function(e,t,r,i){for(var s,o,u,a,f,l,c=t.createDocumentFragment(),h=[],p=0,d=e.length;d>p;p++)if(s=e[p],s||0===s)if("object"===n.type(s))n.merge(h,s.nodeType?[s]:s);else if(ca.test(s)){o=o||c.appendChild(t.createElement("div")),u=(ba.exec(s)||["",""])[1].toLowerCase(),a=ia[u]||ia._default,o.innerHTML=a[1]+s.replace(aa,"<$1></$2>")+a[2],l=a[0];while(l--)o=o.lastChild;n.merge(h,o.childNodes),o=c.firstChild,o.textContent=""}else h.push(t.createTextNode(s));c.textContent="",p=0;while(s=h[p++])if((!i||-1===n.inArray(s,i))&&(f=n.contains(s.ownerDocument,s),o=oa(c.appendChild(s),"script"),f&&ma(o),r)){l=0;while(s=o[l++])fa.test(s.type||"")&&r.push(s)}return c},cleanData:function(e){for(var t,r,i,s,o=n.event.special,u=0;void 0!==(r=e[u]);u++){if(n.acceptData(r)&&(s=r[L.expando],s&&(t=L.cache[s]))){if(t.events)for(i in t.events)o[i]?n.event.remove(r,i):n.removeEvent(r,i,t.handle);L.cache[s]&&delete L.cache[s]}delete M.cache[r[M.expando]]}}}),n.fn.extend({text:function(e){return J(this,function(e){return void 0===e?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=ja(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=ja(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=e?n.filter(e,this):this,s=0;null!=(r=i[s]);s++)t||1!==r.nodeType||n.cleanData(oa(r)),r.parentNode&&(t&&n.contains(r.ownerDocument,r)&&ma(oa(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(n.cleanData(oa(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return n.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!da.test(e)&&!ia[(ba.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(aa,"<$1></$2>");try{for(;i>r;r++)t=this[r]||{},1===t.nodeType&&(n.cleanData(oa(t,!1)),t.innerHTML=e);t=0}catch(s){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,n.cleanData(oa(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(t,r){t=e.apply([],t);var i,s,o,u,a,f,l=0,c=this.length,h=this,p=c-1,d=t[0],v=n.isFunction(d);if(v||c>1&&"string"==typeof d&&!k.checkClone&&ea.test(d))return this.each(function(e){var n=h.eq(e);v&&(t[0]=d.call(this,e,n.html())),n.domManip(t,r)});if(c&&(i=n.buildFragment(t,this[0].ownerDocument,!1,this),s=i.firstChild,1===i.childNodes.length&&(i=s),s)){for(o=n.map(oa(i,"script"),ka),u=o.length;c>l;l++)a=i,l!==p&&(a=n.clone(a,!0,!0),u&&n.merge(o,oa(a,"script"))),r.call(this[l],a,l);if(u)for(f=o[o.length-1].ownerDocument,n.map(o,la),l=0;u>l;l++)a=o[l],fa.test(a.type||"")&&!L.access(a,"globalEval")&&n.contains(f,a)&&(a.src?n._evalUrl&&n._evalUrl(a.src):n.globalEval(a.textContent.replace(ha,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){n.fn[e]=function(e){for(var r,i=[],s=n(e),o=s.length-1,u=0;o>=u;u++)r=u===o?this:this.clone(!0),n(s[u])[t](r),f.apply(i,r.get());return this.pushStack(i)}});var qa,ra={},ua=/^margin/,va=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wa=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):a.getComputedStyle(e,null)};!function(){var e,t,r=l.documentElement,i=l.createElement("div"),s=l.createElement("div");if(s.style){s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===s.style.backgroundClip,i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",i.appendChild(s);function o(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(i);var n=a.getComputedStyle(s,null);e="1%"!==n.top,t="4px"===n.width,r.removeChild(i)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return o(),e},boxSizingReliable:function(){return null==t&&o(),t},reliableMarginRight:function(){var e,t=s.appendChild(l.createElement("div"));return t.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",s.style.width="1px",r.appendChild(i),e=!parseFloat(a.getComputedStyle(t,null).marginRight),r.removeChild(i),s.removeChild(t),e}})}}(),n.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var za=/^(none|table(?!-c[ea]).+)/,Aa=new RegExp("^("+Q+")(.*)$","i"),Ba=new RegExp("^([+-])=("+Q+")","i"),Ca={position:"absolute",visibility:"hidden",display:"block"},Da={letterSpacing:"0",fontWeight:"400"},Ea=["Webkit","O","Moz","ms"];n.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=xa(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=n.camelCase(t),f=e.style;return t=n.cssProps[a]||(n.cssProps[a]=Fa(f,a)),u=n.cssHooks[t]||n.cssHooks[a],void 0===r?u&&"get"in u&&void 0!==(s=u.get(e,!1,i))?s:f[t]:(o=typeof r,"string"===o&&(s=Ba.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(n.css(e,t)),o="number"),null!=r&&r===r&&("number"!==o||n.cssNumber[a]||(r+="px"),k.clearCloneStyle||""!==r||0!==t.indexOf("background")||(f[t]="inherit"),u&&"set"in u&&void 0===(r=u.set(e,r,i))||(f[t]=r)),void 0)}},css:function(e,t,r,i){var s,o,u,a=n.camelCase(t);return t=n.cssProps[a]||(n.cssProps[a]=Fa(e.style,a)),u=n.cssHooks[t]||n.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,r)),void 0===s&&(s=xa(e,t,i)),"normal"===s&&t in Da&&(s=Da[t]),""===r||r?(o=parseFloat(s),r===!0||n.isNumeric(o)?o||0:s):s}}),n.each(["height","width"],function(e,t){n.cssHooks[t]={get:function(e,r,i){return r?za.test(n.css(e,"display"))&&0===e.offsetWidth?n.swap(e,Ca,function(){return Ia(e,t,i)}):Ia(e,t,i):void 0},set:function(e,r,i){var s=i&&wa(e);return Ga(e,r,i?Ha(e,t,i,"border-box"===n.css(e,"boxSizing",!1,s),s):0)}}}),n.cssHooks.marginRight=ya(k.reliableMarginRight,function(e,t){return t?n.swap(e,{display:"inline-block"},xa,[e,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(e,t){n.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+R[r]+t]=s[r]||s[r-2]||s[0];return i}},ua.test(e)||(n.cssHooks[e+t].set=Ga)}),n.fn.extend({css:function(e,t){return J(this,function(e,t,r){var i,s,o={},u=0;if(n.isArray(t)){for(i=wa(e),s=t.length;s>u;u++)o[t[u]]=n.css(e,t[u],!1,i);return o}return void 0!==r?n.style(e,t,r):n.css(e,t)},e,t,arguments.length>1)},show:function(){return Ja(this,!0)},hide:function(){return Ja(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}}),n.Tween=Ka,Ka.prototype={constructor:Ka,init:function(e,t,r,i,s,o){this.elem=e,this.prop=r,this.easing=s||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(n.cssNumber[r]?"":"px")},cur:function(){var e=Ka.propHooks[this.prop];return e&&e.get?e.get(this):Ka.propHooks._default.get(this)},run:function(e){var t,r=Ka.propHooks[this.prop];return this.options.duration?this.pos=t=n.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):Ka.propHooks._default.set(this),this}},Ka.prototype.init.prototype=Ka.prototype,Ka.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=n.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){n.fx.step[e.prop]?n.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[n.cssProps[e.prop]]||n.cssHooks[e.prop])?n.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Ka.propHooks.scrollTop=Ka.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},n.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},n.fx=Ka.prototype.init,n.fx.step={};var La,Ma,Na=/^(?:toggle|show|hide)$/,Oa=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pa=/queueHooks$/,Qa=[Va],Ra={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),s=Oa.exec(t),o=s&&s[3]||(n.cssNumber[e]?"":"px"),u=(n.cssNumber[e]||"px"!==o&&+i)&&Oa.exec(n.css(r.elem,e)),a=1,f=20;if(u&&u[3]!==o){o=o||u[3],s=s||[],u=+i||1;do a=a||".5",u/=a,n.style(r.elem,e,u+o);while(a!==(a=r.cur()/i)&&1!==a&&--f)}return s&&(u=r.start=+u||+i||0,r.unit=o,r.end=s[1]?u+(s[1]+1)*s[2]:+s[2]),r}]};n.Animation=n.extend(Xa,{tweener:function(e,t){n.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,s=e.length;s>i;i++)r=e[i],Ra[r]=Ra[r]||[],Ra[r].unshift(t)},prefilter:function(e,t){t?Qa.unshift(e):Qa.push(e)}}),n.speed=function(e,t,r){var i=e&&"object"==typeof e?n.extend({},e):{complete:r||!r&&t||n.isFunction(e)&&e,duration:e,easing:r&&t||t&&!n.isFunction(t)&&t};return i.duration=n.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in n.fx.speeds?n.fx.speeds[i.duration]:n.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){n.isFunction(i.old)&&i.old.call(this),i.queue&&n.dequeue(this,i.queue)},i},n.fn.extend({fadeTo:function(e,t,n,r){return this.filter(S).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,r,i){var s=n.isEmptyObject(e),o=n.speed(t,r,i),u=function(){var t=Xa(this,n.extend({},e),o);(s||L.get(this,"finish"))&&t.stop(!0)};return u.finish=u,s||o.queue===!1?this.each(u):this.queue(o.queue,u)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",o=n.timers,u=L.get(this);if(s)u[s]&&u[s].stop&&i(u[s]);else for(s in u)u[s]&&u[s].stop&&Pa.test(s)&&i(u[s]);for(s=o.length;s--;)o[s].elem!==this||null!=e&&o[s].queue!==e||(o[s].anim.stop(r),t=!1,o.splice(s,1));(t||!r)&&n.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=L.get(this),i=r[e+"queue"],s=r[e+"queueHooks"],o=n.timers,u=i?i.length:0;for(r.finish=!0,n.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;u>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish})}}),n.each(["toggle","show","hide"],function(e,t){var r=n.fn[t];n.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(Ta(t,!0),e,n,i)}}),n.each({slideDown:Ta("show"),slideUp:Ta("hide"),slideToggle:Ta("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){n.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),n.timers=[],n.fx.tick=function(){var e,t=0,r=n.timers;for(La=n.now();t<r.length;t++)e=r[t],e()||r[t]!==e||r.splice(t--,1);r.length||n.fx.stop(),La=void 0},n.fx.timer=function(e){n.timers.push(e),e()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ma||(Ma=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Ma),Ma=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(e,t){return e=n.fx?n.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e=l.createElement("input"),t=l.createElement("select"),n=t.appendChild(l.createElement("option"));e.type="checkbox",k.checkOn=""!==e.value,k.optSelected=n.selected,t.disabled=!0,k.optDisabled=!n.disabled,e=l.createElement("input"),e.value="t",e.type="radio",k.radioValue="t"===e.value}();var Ya,Za,$a=n.expr.attrHandle;n.fn.extend({attr:function(e,t){return J(this,n.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){n.removeAttr(this,e)})}}),n.extend({attr:function(e,t,r){var i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===U?n.prop(e,t,r):(1===o&&n.isXMLDoc(e)||(t=t.toLowerCase(),i=n.attrHooks[t]||(n.expr.match.bool.test(t)?Za:Ya)),void 0===r?i&&"get"in i&&null!==(s=i.get(e,t))?s:(s=n.find.attr(e,t),null==s?void 0:s):null!==r?i&&"set"in i&&void 0!==(s=i.set(e,r,t))?s:(e.setAttribute(t,r+""),r):void n.removeAttr(e,t))},removeAttr:function(e,t){var r,i,s=0,o=t&&t.match(E);if(o&&1===e.nodeType)while(r=o[s++])i=n.propFix[r]||r,n.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r)},attrHooks:{type:{set:function(e,t){if(!k.radioValue&&"radio"===t&&n.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}}}),Za={set:function(e,t,r){return t===!1?n.removeAttr(e,r):e.setAttribute(r,r),r}},n.each(n.expr.match.bool.source.match(/\w+/g),function(e,t){var r=$a[t]||n.find.attr;$a[t]=function(e,t,n){var i,s;return n||(s=$a[t],$a[t]=i,i=null!=r(e,t,n)?t.toLowerCase():null,$a[t]=s),i}});var _a=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(e,t){return J(this,n.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[n.propFix[e]||e]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!n.isXMLDoc(e),o&&(t=n.propFix[t]||t,s=n.propHooks[t]),void 0!==r?s&&"set"in s&&void 0!==(i=s.set(e,r,t))?i:e[t]=r:s&&"get"in s&&null!==(i=s.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||_a.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ab=/[\t\r\n\f]/g;n.fn.extend({addClass:function(e){var t,r,i,s,o,u,a="string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ab," "):" ")){o=0;while(s=t[o++])i.indexOf(" "+s+" ")<0&&(i+=s+" ");u=n.trim(i),r.className!==u&&(r.className=u)}return this},removeClass:function(e){var t,r,i,s,o,u,a=0===arguments.length||"string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ab," "):"")){o=0;while(s=t[o++])while(i.indexOf(" "+s+" ")>=0)i=i.replace(" "+s+" "," ");u=e?n.trim(i):"",r.className!==u&&(r.className=u)}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(n.isFunction(e)?function(r){n(this).toggleClass(e.call(this,r,this.className,t),t)}:function(){if("string"===r){var t,i=0,s=n(this),o=e.match(E)||[];while(t=o[i++])s.hasClass(t)?s.removeClass(t):s.addClass(t)}else(r===U||"boolean"===r)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||e===!1?"":L.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ab," ").indexOf(t)>=0)return!0;return!1}});var bb=/\r/g;n.fn.extend({val:function(e){var t,r,i,s=this[0];if(arguments.length)return i=n.isFunction(e),this.each(function(r){var s;1===this.nodeType&&(s=i?e.call(this,r,n(this).val()):e,null==s?s="":"number"==typeof s?s+="":n.isArray(s)&&(s=n.map(s,function(e){return null==e?"":e+""})),t=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))});if(s)return t=n.valHooks[s.type]||n.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(s,"value"))?r:(r=s.value,"string"==typeof r?r.replace(bb,""):null==r?"":r)}}),n.extend({valHooks:{option:{get:function(e){var t=n.find.attr(e,"value");return null!=t?t:n.trim(n.text(e))}},select:{get:function(e){for(var t,r,i=e.options,s=e.selectedIndex,o="select-one"===e.type||0>s,u=o?null:[],a=o?s+1:i.length,f=0>s?a:o?s:0;a>f;f++)if(r=i[f],!(!r.selected&&f!==s||(k.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&n.nodeName(r.parentNode,"optgroup"))){if(t=n(r).val(),o)return t;u.push(t)}return u},set:function(e,t){var r,i,s=e.options,o=n.makeArray(t),u=s.length;while(u--)i=s[u],(i.selected=n.inArray(i.value,o)>=0)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(e,t){return n.isArray(t)?e.checked=n.inArray(n(e).val(),t)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){n.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),n.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var cb=n.now(),db=/\?/;n.parseJSON=function(e){return JSON.parse(e+"")},n.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,t=r.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+e),t};var eb=/#.*$/,fb=/([?&])_=[^&]*/,gb=/^(.*?):[ \t]*([^\r\n]*)$/gm,hb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ib=/^(?:GET|HEAD)$/,jb=/^\/\//,kb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,lb={},mb={},nb="*/".concat("*"),ob=a.location.href,pb=kb.exec(ob.toLowerCase())||[];n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ob,type:"GET",isLocal:hb.test(pb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":nb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?sb(sb(e,n.ajaxSettings),t):sb(n.ajaxSettings,e)},ajaxPrefilter:qb(lb),ajaxTransport:qb(mb),ajax:function(e,t){function T(e,t,o,a){var l,g,y,w,E,x=t;2!==b&&(b=2,u&&clearTimeout(u),r=void 0,s=a||"",S.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(w=tb(c,S,o)),w=ub(c,w,S,l),l?(c.ifModified&&(E=S.getResponseHeader("Last-Modified"),E&&(n.lastModified[i]=E),E=S.getResponseHeader("etag"),E&&(n.etag[i]=E)),204===e||"HEAD"===c.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,l=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),S.status=e,S.statusText=(t||x)+"",l?d.resolveWith(h,[g,x,S]):d.rejectWith(h,[S,x,y]),S.statusCode(m),m=void 0,f&&p.trigger(l?"ajaxSuccess":"ajaxError",[S,c,l?g:y]),v.fireWith(h,[S,x]),f&&(p.trigger("ajaxComplete",[S,c]),--n.active||n.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i,s,o,u,a,f,l,c=n.ajaxSetup({},t),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?n(h):n.event,d=n.Deferred(),v=n.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!o){o={};while(t=gb.exec(s))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||w;return r&&r.abort(t),T(0,t),this}};if(d.promise(S).complete=v.add,S.success=S.done,S.error=S.fail,c.url=((e||c.url||ob)+"").replace(eb,"").replace(jb,pb[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=n.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(a=kb.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===pb[1]&&a[2]===pb[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(pb[3]||("http:"===pb[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=n.param(c.data,c.traditional)),rb(lb,c,t,S),2===b)return S;f=n.event&&c.global,f&&0===n.active++&&n.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!ib.test(c.type),i=c.url,c.hasContent||(c.data&&(i=c.url+=(db.test(i)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=fb.test(i)?i.replace(fb,"$1_="+cb++):i+(db.test(i)?"&":"?")+"_="+cb++)),c.ifModified&&(n.lastModified[i]&&S.setRequestHeader("If-Modified-Since",n.lastModified[i]),n.etag[i]&&S.setRequestHeader("If-None-Match",n.etag[i])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&S.setRequestHeader("Content-Type",c.contentType),S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+nb+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)S.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,S,c)!==!1&&2!==b){w="abort";for(l in{success:1,error:1,complete:1})S[l](c[l]);if(r=rb(mb,c,t,S)){S.readyState=1,f&&p.trigger("ajaxSend",[S,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){S.abort("timeout")},c.timeout));try{b=1,r.send(g,T)}catch(x){if(!(2>b))throw x;T(-1,x)}}else T(-1,"No Transport");return S}return S.abort()},getJSON:function(e,t,r){return n.get(e,t,r,"json")},getScript:function(e,t){return n.get(e,void 0,t,"script")}}),n.each(["get","post"],function(e,t){n[t]=function(e,r,i,s){return n.isFunction(r)&&(s=s||i,i=r,r=void 0),n.ajax({url:e,type:t,dataType:s,data:r,success:i})}}),n._evalUrl=function(e){return n.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(e){var t;return n.isFunction(e)?this.each(function(t){n(this).wrapAll(e.call(this,t))}):(this[0]&&(t=n(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(n.isFunction(e)?function(t){n(this).wrapInner(e.call(this,t))}:function(){var t=n(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=n.isFunction(e);return this.each(function(r){n(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},n.expr.filters.visible=function(e){return!n.expr.filters.hidden(e)};var vb=/%20/g,wb=/\[\]$/,xb=/\r?\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;n.param=function(e,t){var r,i=[],s=function(e,t){t=n.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(e)||e.jquery&&!n.isPlainObject(e))n.each(e,function(){s(this.name,this.value)});else for(r in e)Ab(r,e[r],t,s);return i.join("&").replace(vb,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=n.prop(this,"elements");return e?n.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!n(this).is(":disabled")&&zb.test(this.nodeName)&&!yb.test(e)&&(this.checked||!T.test(e))}).map(function(e,t){var r=n(this).val();return null==r?null:n.isArray(r)?n.map(r,function(e){return{name:t.name,value:e.replace(xb,"\r\n")}}):{name:t.name,value:r.replace(xb,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Bb=0,Cb={},Db={0:200,1223:204},Eb=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var e in Cb)Cb[e]()}),k.cors=!!Eb&&"withCredentials"in Eb,k.ajax=Eb=!!Eb,n.ajaxTransport(function(e){var t;return k.cors||Eb&&!e.crossDomain?{send:function(n,r){var i,s=e.xhr(),o=++Bb;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete Cb[o],t=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status,s.statusText):r(Db[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:void 0,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=Cb[o]=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(t)throw u}},abort:function(){t&&t()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return n.globalEval(e),e}}}),n.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),n.ajaxTransport("script",function(e){if(e.crossDomain){var t,r;return{send:function(i,s){t=n("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&s("error"===e.type?404:200,e.type)}),l.head.appendChild(t[0])},abort:function(){r&&r()}}}});var Fb=[],Gb=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Fb.pop()||n.expando+"_"+cb++;return this[e]=!0,e}}),n.ajaxPrefilter("json jsonp",function(e,t,r){var i,s,o,u=e.jsonp!==!1&&(Gb.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gb.test(e.data)&&"data");return u||"jsonp"===e.dataTypes[0]?(i=e.jsonpCallback=n.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,u?e[u]=e[u].replace(Gb,"$1"+i):e.jsonp!==!1&&(e.url+=(db.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||n.error(i+" was not called"),o[0]},e.dataTypes[0]="json",s=a[i],a[i]=function(){o=arguments},r.always(function(){a[i]=s,e[i]&&(e.jsonpCallback=t.jsonpCallback,Fb.push(i)),o&&n.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),n.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||l;var i=v.exec(e),s=!r&&[];return i?[t.createElement(i[1])]:(i=n.buildFragment([e],t,s),s&&s.length&&n(s).remove(),n.merge([],i.childNodes))};var Hb=n.fn.load;n.fn.load=function(e,t,r){if("string"!=typeof e&&Hb)return Hb.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=n.trim(e.slice(a)),e=e.slice(0,a)),n.isFunction(t)?(r=t,t=void 0):t&&"object"==typeof t&&(s="POST"),u.length>0&&n.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){o=arguments,u.html(i?n("<div>").append(n.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,o||[e.responseText,t,e])}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){n.fn[t]=function(e){return this.on(t,e)}}),n.expr.filters.animated=function(e){return n.grep(n.timers,function(t){return e===t.elem}).length};var Ib=a.document.documentElement;n.offset={setOffset:function(e,t,r){var i,s,o,u,a,f,l,c=n.css(e,"position"),h=n(e),p={};"static"===c&&(e.style.position="relative"),a=h.offset(),o=n.css(e,"top"),f=n.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+f).indexOf("auto")>-1,l?(i=h.position(),u=i.top,s=i.left):(u=parseFloat(o)||0,s=parseFloat(f)||0),n.isFunction(t)&&(t=t.call(e,r,a)),null!=t.top&&(p.top=t.top-a.top+u),null!=t.left&&(p.left=t.left-a.left+s),"using"in t?t.using.call(e,p):h.css(p)}},n.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){n.offset.setOffset(this,e,t)});var t,r,i=this[0],s={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,n.contains(t,i)?(typeof i.getBoundingClientRect!==U&&(s=i.getBoundingClientRect()),r=Jb(o),{top:s.top+r.pageYOffset-t.clientTop,left:s.left+r.pageXOffset-t.clientLeft}):s},position:function(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===n.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),n.nodeName(e[0],"html")||(i=e.offset()),i.top+=n.css(e[0],"borderTopWidth",!0),i.left+=n.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-n.css(r,"marginTop",!0),left:t.left-i.left-n.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||Ib;while(e&&!n.nodeName(e,"html")&&"static"===n.css(e,"position"))e=e.offsetParent;return e||Ib})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var r="pageYOffset"===t;n.fn[e]=function(n){return J(this,function(e,n,i){var s=Jb(e);return void 0===i?s?s[t]:e[n]:void (s?s.scrollTo(r?a.pageXOffset:i,r?i:a.pageYOffset):e[n]=i)},e,n,arguments.length,null)}}),n.each(["top","left"],function(e,t){n.cssHooks[t]=ya(k.pixelPosition,function(e,r){return r?(r=xa(e,t),va.test(r)?n(e).position()[t]+"px":r):void 0})}),n.each({Height:"height",Width:"width"},function(e,t){n.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){n.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return J(this,function(t,r,i){var s;return n.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===i?n.css(t,r,u):n.style(t,r,i,u)},t,o?i:void 0,o,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Kb=a.jQuery,Lb=a.$;return n.noConflict=function(e){return a.$===n&&(a.$=Lb),e&&a.jQuery===n&&(a.jQuery=Kb),n},typeof b===U&&(a.jQuery=a.$=n),n}),define("view_serv",["spv","env","localizer","jquery"],function(e,t,n,r){var i={};(function(){var e={},t=window.document.body.style,n,r,s={transition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend"};for(var o in s)if(o in t){r=s[o];break}["transform","-o-transform","-webkit-transform","-moz-transform"].forEach(function(e){!n&&e in t&&(n=e)}),r&&(e.transition=r),n&&(e.transform=n),i.css=e})();var s=function(e,t){var n=t.split(" "),r=e;for(var i=0;i<n.length;i++){var s=new RegExp("(^|\\s)"+n[i]+"(\\s|$)","g");e.match(s)||(r=(r+" "+n[i]).replace(/\s+/g," ").replace(/(^ | $)/g,""))}return r},o=function(e,t){var n=new RegExp("(^|\\s)"+t+"(\\s|$)","g");return e.replace(n,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},u=function(e,t){return e.indexOf(t)==-1?s(e,t):o(e,t)},a=function(e,t){this.node=e,this.html_el_state=t||e.className||""};a.prototype={addState:function(e){this.html_el_state=s(this.html_el_state,e)},toggleState:function(e){this.html_el_state=u(this.html_el_state,e)},removeState:function(e){this.html_el_state=o(this.html_el_state,e)},applyStates:function(){this.node.className=this.html_el_state},getFullState:function(){return this.html_el_state}},i.handleDocument=function(r,s){var o=new a(window.document.documentElement);t.touch_support&&o.addState("touch-screen"),t.as_application?(o.addState("as-application"),o.removeState("not-as-application")):o.addState("not-as-application"),t.unknown_app_type||(t.chrome_like_ext?o.addState("chrome-extension"):o.addState(t.app_type.replace("_","-"))),t.cross_domain_allowed&&o.addState("cross-domain-allowed"),i.css.transform?o.addState("yes-transform_support"):o.addState("no-transform_upport"),e.domReady(r,function(){var e=new a(r.documentElement,o.getFullState());e.applyStates()}),e.domReady(r,function(){r.head||(r.head=r.getElementsByTagName("head")[0]);var e=function(e){var t=e&&e.childNodes.length;for(var n=t-1;n>=0;n--)e.removeChild(e.childNodes[n]);return e},i=t.lang,s=r.getElementsByClassName("lang"),o=[],u=function(e){var t=e.className,r=t.split(/\s/);for(var s=0;s<r.length;s++){var u=r[s];if(u.match(/localize/)){var a=n[u.replace("localize-","")],f=a&&(a[i]||a.original);if(f){o.push([e,f]);break}}}},a;for(a=0;a<s.length;a++)u(s[a]);for(a=0;a<o.length;a++){var f=o[a];e(f[0]).appendChild(r.createTextNode(f[1]))}})};var f=function(){var t={},n={},i=function(e,t){n[e]||(n[e]=[]),n[e].push(t)},s=function(t,r){n[t]&&(n[t]=e.arrayExclude(n[t],r))},o=function(e){var t=n[e];if(t)while(t.length){var r=t.shift();r.call()}};return function(n){if(typeof n.cache_allowed!="boolean")throw new Error("cache_allowed must be true or false");var u="",a,f,l=n.url,c=n.node||new Image,h=r.Deferred(),p=h.promise({abort:function(){c&&(c.src=""),this.queued&&this.queued.abort(),v(),c=null,n=null,u="abort"}}),d=function(){y()},v=function(){c&&(e.removeEvent(c,"load",m),e.removeEvent(c,"error",g)),s(l,d)},m=function(e){if(a)return;a=!0,h.resolve(c),v(),p&&p.queued&&p.queued.abort(),p.timeout_num&&clearTimeout(p.timeout_num),e&&e.type=="load"&&o(n.url),c=null,n=null,u="loaded"},g=function(){h.reject(c),v(),c=null,n=null,u="error"};e.addEvent(c,"load",m),e.addEvent(c,"error",g);var y=function(){if(f)return;f=!0,c.src=n.url,c.complete?(n.cache_allowed&&(t[n.url]=!0),m()):n.timeout&&(p.timeout_num=setTimeout(function(){h.reject(c,"timeout"),v(),c=null,n=null,u="timeout"},n.timeout))};return n.queue&&!t[n.url]?(i(n.url,d),p.queued=n.queue.add(y)):y(),p}}();return i.loadImage=f,i}),define("js/libs/w_storage",[],function(){"use strict";var e=function(e){return e};typeof JSON=="object"&&JSON.stringify&&(e=function(e){return typeof e=="object"?JSON.stringify(e):e});var t={},n=function(){return!1},r=function(){return!1};typeof widget=="object"&&!widget.fake_widget&&typeof widget.setPreferenceForKey=="function"?(n=function(e){return widget.preferenceForKey(e)},r=function(t,n){return widget.setPreferenceForKey(e(n),t)}):typeof localStorage=="object"?(n=function(e){return localStorage.getItem(e)},r=function(t,n,r){if(!r)return null;try{return localStorage.setItem(t,e(n))}catch(i){return null}}):typeof System!="undefined"&&System.Gadget&&System.Gadget.Settings&&(n=function(e){return System.Gadget.Settings.readString(e)},r=function(t,n){return System.Gadget.Settings.writeString(t,e(n))});var i=function(e){var r=t[e];return typeof r!="undefined"?r:n(e)},s=function(e,n,i){return t[e]=n,r(e,n,i)},o=function(e,t,n){return e?typeof t=="undefined"?i(e):s(e,t,n):!1};return o}),define("js/preloaded_nk",{lfm_key:"2803b2bcbc53f132b4d4117ec1509d65",lfm_secret:"77fd498ed8592022e61863244b53077d",sc_key:"HNVCUV6apk9ANn8tLERpag",dgs_key:"cVGXKbVEDAEynWEkjPff",dgs_secret:"cYsihuumOovTdZKBvziDJhyzDUKpiedW"}),define("app_serv",["spv","localizer","js/libs/w_storage","js/preloaded_nk","env"],function(e,t,n,r,i){var s={};s.getRemainTimeText=function(e,t){var n=new Date(e),r="";return t&&(r+=f("wget-link")+" "),r+=n.getDate()+" "+f("m"+(n.getMonth()+1))+" "+f("attime")+" "+n.getHours()+":"+n.getMinutes(),r},s.complexEach=function(e,t,n){if(!e)return;var r=0;for(var i=0;i<e.length;i++){if(!e[i])continue;e[i].length>r&&(r=e[i].length)}var s=n||[],o;for(var u=0;u<r;u++){var a=[s];for(var f=0;f<e.length;f++)a.push(e[f]&&e[f][u]);o=t.apply(null,a)}return o},function(){function e(e){return!e||e=="loaded"||e=="complete"}var t=document.firstElementChild.firstElementChild.getElementsByTagName("script");t=t[t.length-1],s.loadJS=function(n,r){var i=document.createElement("script"),s;i.onreadystatechange=i.onload=function(){!s&&e(i.readyState)&&(s=!0,r(),i.onload=i.onreadystatechange=null)},i.src=n,t.parentNode.insertBefore(i,t)}}(),s.getInternetConnectionStatus=function(e){var t=new Image;t.onload=function(){e(!0)},t.onerror=function(){e(!1)},t.src="http://www.google-analytics.com/__utm.gif?"+Math.random()+new Date};var o=function(e,t){var n=e.replace(/^\?/,"").split("&"),r={};for(var i=0;i<n.length;i++){var s=n[i].split("="),o=s[0],u=s[1];t&&(o=decodeURIComponent(o),u=decodeURIComponent(u)),r[o]=u}return r};s.get_url_parameters=o,function(){var e=["vk_token_info","dg_auth","lfm_scrobble_s","lfmsk","big_vk_cookie"],t=function(e){if(e===Object(e))return e;if(typeof e=="string"){var t=e.charAt(0),n=e.charAt(e.length-1);if(t=="{"&&n=="}"||t=="["&&n=="]")try{e=JSON.parse(e)}catch(r){}return e}return e};s.store=function(r,s,o){var u=!!r&&e.indexOf(r)>-1;return typeof s!="undefined"?(s&&u&&i.pokki_app&&(s=pokki.scramble(s)),n(r,s,o)):(s=n(r,s,o),u&&i.pokki_app&&(s=pokki.descramble(s)),t(s))},s.getPreloadedNK=function(e){if(i.pokki_app){var t=pokki.getScrambled(e);if(t)return t}var n=r;if(n&&n[e])return n[e]}}(),s.app_env=i;var u=i.app_type=="nodewebkit";s.getSafeIframe=function(){var e=document.createElement("iframe");return u&&(e.setAttribute("nwdisable",!0),e.setAttribute("nwfaketop",!0)),e};var a={},f=function(){var e=i.lang;return function(n,r){return t[n]?t[n][e]||t[n].original:r?(a[n]={original:r},r):"no this localization: "+n}}();return s.localize=f,s.parseArtistInfo=function(t){var n={};if(t&&t.artist){var r=t.artist;n.artist=e.getTargetField(r,"name"),n.bio=(n.bio=e.getTargetField(r,"bio.summary"))&&n.bio.replace(new RegExp("ws.audioscrobbler.com","g"),"www.last.fm"),n.similars=(n.similars=e.getTargetField(r,"similar.artist"))&&e.toRealArray(n.similars),n.tags=(n.tags=e.getTargetField(r,"tags.tag"))&&e.toRealArray(n.tags),n.images=(n.images=e.getTargetField(r,"image"))&&(n.images=e.toRealArray(n.images))&&e.filter(n.images,"#text")}return n},s}),function(e,t,n){"use strict";function r(e){return String.fromCharCode(e)}function i(e){return e&&"number"==typeof e.length?"function"!=typeof e.hasOwnProperty&&"function"!=typeof e.constructor?!0:e instanceof t||n&&e instanceof n||"[object Object]"!==L.call(e)||"function"==typeof e.callee:!1}function s(e,t,n){var r;if(e)if(p(e))for(r in e)"prototype"!=r&&"length"!=r&&"name"!=r&&e.hasOwnProperty(r)&&t.call(n,e[r],r);else if(e.forEach&&e.forEach!==s)e.forEach(t,n);else if(i(e))for(r=0;e.length>r;r++)t.call(n,e[r],r);else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r);return e}function o(e){return s(arguments,function(t){t!==e&&s(t,function(t,n){e[n]=t})}),e}function u(e){return parseInt(e,10)}function a(){}function f(e){return e}function l(e){return function(){return e}}function c(e){return e!==void 0}function h(e){return"string"==typeof e}function p(e){return"function"==typeof e}function d(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function v(e){return e&&e.$evalAsync&&e.$watch}function m(e,t){var n=t;return/^\$+/.test(e)?n=void 0:d(t)?n="$WINDOW":t&&document===t?n="$DOCUMENT":v(t)&&(n="$SCOPE"),n}function g(e,t){return JSON.stringify(e,m,t?"  ":null)}function y(e,t){function n(e){return-1!=e.indexOf(m)}function r(e){return-1!=e.indexOf(x)}function i(t){var n=t||1;return e.length>y+n?e.charAt(y+n):!1}function s(e){return e>="0"&&"9">=e}function u(e){return" "==e||"\r"==e||"	"==e||"\n"==e||""==e||" "==e}function a(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||"_"==e||"$"==e}function f(e){return"-"==e||"+"==e||s(e)}function l(t,n,r){throw r=r||y,Error("Lexer Error: "+t+" at column"+(c(n)?"s "+n+"-"+y+" ["+e.substring(n,r)+"]":" "+r)+" in expression ["+e+"].")}function h(){for(var t="",n=y;e.length>y;){var r=S(e.charAt(y));if("."==r||s(r))t+=r;else{var o=i();if("e"==r&&f(o))t+=r;else if(f(r)&&o&&s(o)&&"e"==t.charAt(t.length-1))t+=r;else{if(!f(r)||o&&s(o)||"e"!=t.charAt(t.length-1))break;l("Invalid exponent")}}y++}t=1*t,g.push({index:n,text:t,json:!0,fn:function(){return t}})}function p(){for(var n,r,i,f="",l=y;e.length>y;){var c=e.charAt(y);if("."!=c&&!a(c)&&!s(c))break;"."==c&&(n=y),f+=c,y++}if(n)for(r=y;e.length>r;){var c=e.charAt(r);if("("==c){i=f.substr(n-l+1),f=f.substr(0,n-l),y=r;break}if(!u(c))break;r++}var h={index:l,text:f,propToWatch:!0};if(M.hasOwnProperty(f))h.fn=h.json=M[f];else{var p=E(f,t);h.fn=o(function(e,t){return p(e,t)},{assign:function(e,t){return w(e,f,t)}})}g.push(h),i&&(g.push({index:n,text:".",json:!1}),g.push({index:n+1,text:i,json:!1}))}function d(t){var n=y;y++;for(var r="",i=t,s=!1;e.length>y;){var o=e.charAt(y);if(i+=o,s){if("u"==o){var u=e.substring(y+1,y+5);u.match(/[\da-f]{4}/i)||l("Invalid unicode escape [\\u"+u+"]"),y+=4,r+=String.fromCharCode(parseInt(u,16))}else{var a=_[o];r+=a?a:o}s=!1}else if("\\"==o)s=!0;else{if(o==t)return y++,g.push({index:n,text:i,string:r,json:!0,fn:function(){return r}}),void 0;r+=o}y++}l("Unterminated quote",n)}for(var v,m,g=[],y=0,b=[],x=":";e.length>y;){if(m=e.charAt(y),n("\"'"))d(m);else if(s(m)||n(".")&&s(i()))h();else if(a(m))p(),r("{,")&&"{"==b[0]&&(v=g[g.length-1])&&(v.json=-1==v.text.indexOf("."));else if(n("(){}[].,;:"))g.push({index:y,text:m,json:r(":[,")&&n("{[")||n("}]:,")}),n("{[")&&b.unshift(m),n("}]")&&b.shift(),y++;else{if(u(m)){y++;continue}var T=m+i(),N=T+i(2),C=M[m],k=M[T],L=M[N];L?(g.push({index:y,text:N,fn:L}),y+=3):k?(g.push({index:y,text:T,fn:k}),y+=2):C?(g.push({index:y,text:m,fn:C,json:r("[,:")&&n("+-")}),y+=1):l("Unexpected next character ",y,y+1)}x=m}return g}function b(e,t,n,r){function i(t,n){throw Error("Syntax Error: Token '"+n.text+"' "+t+" at column "+(n.index+1)+" of the expression ["+e+"] starting at ["+e.substring(n.index)+"].")}function s(){if(0===F.length)throw Error("Unexpected end of expression: "+e);return F[0]}function u(e,t,n,r){if(F.length>0){var i=F[0],s=i.text;if(s==e||s==t||s==n||s==r||!e&&!t&&!n&&!r)return i}return!1}function f(e,n,r,s){var o=u(e,n,r,s);return o?(t&&!o.json&&i("is not valid json",o),F.shift(),o):!1}function c(e){f(e)||i("is unexpected, expecting ["+e+"]",u())}function h(e,t){return o(function(n,r){return e(n,r,t)},{constant:t.constant})}function p(e,t,n){return o(function(r,i){return t(r,i,e,n)},{constant:e.constant&&n.constant})}function d(){for(var e=[];;)if(F.length>0&&!u("}",")",";","]")&&e.push(X()),!f(";"))return o(1==e.length?e[0]:function(t,n){for(var r,i=0;e.length>i;i++){var s=e[i];s&&(r=s(t,n))}return r},{propsToWatch:I})}function v(){for(var e,t=g();;){if(!(e=f("|")))return t;t=p(t,e.fn,m())}}function m(){for(var e=f(),t=n(e.text),r=[];;){if(!(e=f(":"))){var i=function(e,n,i){for(var s=[i],o=0;r.length>o;o++)s.push(r[o](e,n));return t.apply(e,s)};return function(){return i}}r.push(g())}}function g(){return q()}function b(){var t,n,r=S();return(n=f("="))?(r.assign||i("implies assignment but ["+e.substring(0,n.index)+"] can not be assigned to",n),t=S(),function(e,n){return r.assign(e,t(e,n),n)}):r}function S(){for(var e,t=x();;){if(!(e=f("||")))return t;t=p(t,e.fn,x())}}function x(){var e,t=T();return(e=f("&&"))&&(t=p(t,e.fn,x())),t}function T(){var e,t=N();return(e=f("==","!=","===","!=="))&&(t=p(t,e.fn,T())),t}function N(){var e,t=C();return(e=f("<",">","<=",">="))&&(t=p(t,e.fn,N())),t}function C(){for(var e,t=k();e=f("+","-");)t=p(t,e.fn,k());return t}function k(){for(var e,t=L();e=f("*","/","%");)t=p(t,e.fn,L());return t}function L(){var e;return f("+")?A():(e=f("-"))?p(j,e.fn,L()):(e=f("!"))?h(e.fn,L()):A()}function A(){var e;if(f("("))e=X(),c(")");else if(f("["))e=P();else if(f("{"))e=H();else{var t=f();e=t.fn,e||i("not a primary expression",t),t.json&&(e.constant=e.literal=!0)}for(var n,r;n=f("(","[",".");)"("===n.text?(e=R(e,r),r=null):"["===n.text?(r=e,e=W(e)):"."===n.text?(r=e,e=U(e)):i("IMPOSSIBLE");return e}function O(e){var t=f().text,n=E(t,r);return o(function(t,r){return n(e(t,r),r)},{assign:function(n,r,i){return w(e(n,i),t,r)}})}function M(e){var t=g();return c("]"),o(function(n,r){var i,s,o=e(n,r),u=t(n,r);return o?(i=o[u],i&&i.then&&(s=i,"$$v"in i||(s.$$v=void 0,s.then(function(e){s.$$v=e})),i=i.$$v),i):void 0},{assign:function(n,r,i){return e(n,i)[t(n,i)]=r}})}function _(e,t){var n=[];if(")"!=s().text)do n.push(g());while(f(","));return c(")"),function(r,i){for(var s=[],o=t?t(r,i):r,u=0;n.length>u;u++)s.push(n[u](r,i));var f=e(r,i)||a;return f.apply?f.apply(o,s):f(s[0],s[1],s[2],s[3],s[4])}}function P(){var e=[],t=!0;if("]"!=s().text)do{var n=g();e.push(n),n.constant||(t=!1)}while(f(","));return c("]"),o(function(t,n){for(var r=[],i=0;e.length>i;i++)r.push(e[i](t,n));return r},{literal:!0,constant:t})}function H(){var e=[],t=!0;if("}"!=s().text)do{var n=f(),r=n.string||n.text;c(":");var i=g();e.push({key:r,value:i}),i.constant||(t=!1)}while(f(","));return c("}"),o(function(t,n){for(var r={},i=0;e.length>i;i++){var s=e[i],o=s.value(t,n);r[s.key]=o}return r},{literal:!0,constant:t})}var B,j=l(0),F=y(e,r),I=D(F),q=b,R=_,U=O,W=M,X=v;return t?(q=S,R=U=W=X=function(){i("is not valid json",{text:e,index:0})},B=A()):B=d(),0!==F.length&&i("is an unexpected token",F[0]),B.literal=!!B.literal,B.constant=!!B.constant,B}function w(e,t,n){for(var r=t.split("."),i=0;r.length>1;i++){var s=r.shift(),o=e[s];o||(o={},e[s]=o),e=o}return e[r.shift()]=n,n}function E(e){if(P.hasOwnProperty(e))return P[e];var t=function(t,n){return n&&H(n,e)||H(t,e)};return P[e]=t}var S=function(e){return h(e)?e.toLowerCase():e},x=function(e){return h(e)?e.toUpperCase():e},T=function(e){return h(e)?e.replace(/[A-Z]/g,function(e){return r(32|e.charCodeAt(0))}):e},N=function(e){return h(e)?e.replace(/[a-z]/g,function(e){return r(-33&e.charCodeAt(0))}):e};"i"!=="I".toLowerCase()&&(S=T,x=N);var n,C,k=u((/msie (\d+)/.exec(S(navigator.userAgent))||[])[1]),L=([].slice,[].push,Object.prototype.toString);e.angular,e.angular||(e.angular={}),a.$inject=[],f.$inject=[],C=9>k?function(e){return e=e.nodeName?e:e[0],e.scopeName&&"HTML"!=e.scopeName?x(e.scopeName+":"+e.nodeName):e.nodeName}:function(e){return e.nodeName?e.nodeName:e[0].nodeName};var A,O,M={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},"undefined":a,"+":function(e,t,n,r){return n=n(e,t),r=r(e,t),c(n)?c(r)?n+r:n:c(r)?r:void 0},"-":function(e,t,n,r){return n=n(e,t),r=r(e,t),(c(n)?n:0)-(c(r)?r:0)},"*":function(e,t,n,r){return n(e,t)*r(e,t)},"/":function(e,t,n,r){return n(e,t)/r(e,t)},"%":function(e,t,n,r){return n(e,t)%r(e,t)},"^":function(e,t,n,r){return n(e,t)^r(e,t)},"=":a,"===":function(e,t,n,r){return n(e,t)===r(e,t)},"!==":function(e,t,n,r){return n(e,t)!==r(e,t)},"==":function(e,t,n,r){return n(e,t)==r(e,t)},"!=":function(e,t,n,r){return n(e,t)!=r(e,t)},"<":function(e,t,n,r){return n(e,t)<r(e,t)},">":function(e,t,n,r){return n(e,t)>r(e,t)},"<=":function(e,t,n,r){return n(e,t)<=r(e,t)},">=":function(e,t,n,r){return n(e,t)>=r(e,t)},"&&":function(e,t,n,r){return n(e,t)&&r(e,t)},"||":function(e,t,n,r){return n(e,t)||r(e,t)},"&":function(e,t,n,r){return n(e,t)&r(e,t)},"|":function(e,t,n,r){return r(e,t)(e,t,n(e,t))},"!":function(e,t,n){return!n(e,t)}},_={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'},D=function(e){for(var t=[],n=0;e.length>n;n++){var r=e[n];r.propToWatch&&t.push(r.text)}return t},P={},H=function(e,t){for(var n,r=t.split("."),i=e,s=0;r.length>s;s++){if(i[r[s]]===n)return;i=i[r[s]]}return i},B=function(){return A.apply(this,arguments)};(function(){function e(e,u){for(var a,f,l,c,h=0,p=[],d=e.length,v=!1,m=[];d>h;)-1!=(a=e.indexOf(r,h))&&-1!=(f=e.indexOf(i,a+s))?(h!=a&&p.push(e.substring(h,a)),p.push(l=t(c=e.substring(a+s,f))),l.exp=c,h=f+o,v=!0):(h!=d&&p.push(e.substring(h)),h=d);return(d=p.length)||(p.push(""),d=1),!u||v?(m.length=d,l=function(t){try{for(var r,i=0,s=d;s>i;i++)"function"==typeof (r=p[i])&&(r=r(t),null==r||void 0==r?r="":"string"!=typeof r&&(r=r||"number"==typeof r?g(r):"")),r||"number"==typeof r||(r=""),m[i]=r;return m.join("")}catch(o){var u=Error("Error while interpolating: "+e+"\n"+(""+o));n(u)}},l.exp=e,l.parts=p,l):void 0}var t=B,n=function(e){throw e},r="{{",i="}}",s=r.length,o=i.length;O=e})();var j;(function(){var e={};j=function(t,n){switch(typeof t){case"string":return e.hasOwnProperty(t)?e[t]:e[t]=b(t,!1,n);case"function":return t;default:return a}}})(),A=function(e){return j(e,F.getFilterFn)};var F={parseExpression:A,interpolateExpressions:O};e.angbo=F}(window,function(){},function(){}),typeof define=="function"&&define.amd&&define("pv/StatementsAngularParser.min",[],function(){return angbo}),define("pv/pvTemplate/StandartChange",["spv","../StatementsAngularParser.min"],function(e,t){var n=function(e,t){var n=e.calls_flow_index[t];n&&(e.calls_flow_index[t]=null,n.abort())},r=function(e,t){e.calls_flow_index[t]=null},i=function(e){var t=new Array(e.length);for(var n=0;n<e.length;n++){var r=e[n].split("."),i=r[0];t[n]=i}return t},s=function(n,r,s){var o=r.calculator,u;if(!o)if(r.complex_statement){o=t.interpolateExpressions(r.complex_statement);var a=e.filter(o.parts,"propsToWatch");u=[],u=u.concat.apply(u,a)}else r.statement&&(o=t.parseExpression(r.statement),u=o.propsToWatch);if(!s)throw new Error("directive_name must be provided");this.directive_name=s,this.data=r.data,this.calculator=o,this.all_vs=u,this.simplifyValue=r.simplifyValue,this.setValue=r.setValue,this.getValue=r.getValue,this.sfy_values=o?i(this.all_vs):null;if(o){var f=this.getValue(n,this.data);this.simplifyValue&&(f=this.simplifyValue.call(this,f)),this.original_value=f}!n.pvprsd};return s.prototype={changeValue:function(e,t){r(t.context,t.w_cache_key);if(t.current_value!=e){var n=t.current_value;t.current_value=e,this.setValue(t.node,e,n,t)}},checkFunc:function(e,t,r,i){n(t.context,t.w_cache_key);var s=this.calculator(e);this.simplifyValue&&(s=this.simplifyValue(s));if(t.current_value!=s)if(r){var o=t.context.calls_flow.pushToFlow(this.changeValue,this,[s,t],!1,!1,!1,i);t.context.calls_flow_index[t.w_cache_key]=o}else this.changeValue(s,t)},createBinding:function(){var e=function(e,t,n){this.standch.checkFunc(e,this,t,n)};return function(t,n){var r={w_cache_key:t.pvprsd+"_"+t.pvprsd_inst+"*"+this.directive_name,data:this.data,standch:this,context:n,node:t,current_value:this.original_value,pv_type_data:null,values:this.all_vs,sfy_values:this.sfy_values,checkFunc:e};return r}}()},s.getFieldsTreesBases=i,s}),define("pv/pvTemplate/directives_parsers",["spv","jquery","../StatementsAngularParser.min","./StandartChange"],function(e,t,n,r){function v(e,n,i,s,o){var u=o.PvSimpleSampler;return new r(e,{data:{sample_node:s,getSample:i},simplifyValue:function(e){return!!e},statement:n,getValue:function(e,t){return e.pvwhen_content},setValue:function(e,n,r,i){if(n&&!e.pvwhen_content){e.pvwhen_content=!0;var s,o=i.context;i.data.getSample?s=i.data.getSample():(i.data.sampler||(i.data.sampler=new u(i.data.sample_node,o.struc_store,o.getSample)),s=i.data.sampler.getClone()),i.root_node=s,t(e).after(s);var a=i.context.parseAppended(s);i.destroyer=function(){e.pvwhen_content=!1,t(i.root_node).remove();for(var n=0;n<a.length;n++)a[n].dead=!0;i.context.checkChunks()},i.context.pvTreeChange()}else!n&&e.pvwhen_content&&i.destroyer()}},"pv-when")}function g(e,t,n,r){return t||n?"":r?" ":""}function y(e){return e?e.replace(s,g):e}var i=".",s=/(^\s+)|(\s+$)|(\s{2,})/gi,o=/\s+/gi,u=function(t){var n=t.replace(/^-/,"").split("-");if(n.length>1)for(var r=1;r<n.length;r++)n[r]=e.capitalize(n[r]);return n.join("")},a=function(){var t=function(t,n){return e.getTargetField(t,n)},n=function(t,n,r,i){return e.setTargetField(t,i.data,n||"")};return function(e,s,o,a){var f=s.split(i);for(var l=0;l<f.length;l++)f[l]=u(f[l]);return s=f.join(i),new r(e,{data:s,statement:o,getValue:t,setValue:n},a)}}(),f=/\S[\S\s]*?\:[\s]*?\{\{[\S\s]+?\}\}/gi,l=/\S[\S\s]*?\:[\s]*?(?:\{\{[\S\s]+?\}\})|(?:\S+?(\s|$))/gi,c=/^\s*|s*?$/,h=/\s*\:\s*?(?=\{\{)/,p=/(^\{\{)|(\}\}$)/gi,d=r.getFieldsTreesBases,m=function(e,t){var n=t||[];for(var r in e)n.push(r);return n};return{config:function(){var e={one_parse:{"pv-import":!0,"pv-when":!0},one_parse_list:[],pseudo:{"pv-when-condition":!0},pseudo_list:[],scope_generators:{"pv-nest":!0,"pv-repeat":!0,"pv-foreign":!0},scope_g_list:[],states_using_directives:{"pv-text":!0,"pv-class":!0,"pv-props":!0,"pv-type":!0,"pv-repeat":!0},sud_list:[],directives:{"pv-text":!0,"pv-class":!0,"pv-props":!0,"pv-anchor":!0,"pv-type":!0,"pv-events":!0},directives_names_list:[],comment_directives:{"pv-replace":!0,"pv-importable":!0},comment_directives_names_list:[]};return m(e.directives,e.directives_names_list),m(e.scope_generators,e.scope_g_list),m(e.states_using_directives,e.sud_list),m(e.comment_directives,e.comment_directives_names_list),m(e.one_parse,e.one_parse_list),m(e.pseudo,e.pseudo_list),e}(),getIndexList:m,getFieldsTreesBases:d,patching_directives:{"pv-import":function(){var e=1;return function(t,n,r,i){var s=n.map[2]?{key:e,samples:n.map[2]}:null,o=r(n.sample_name,!0,s),u=t.parentNode;return u.replaceChild(o,t),o}}(),"pv-when":function(e,t,n,r){var i=this,s=e.parentNode,o=t,u=document.createComment("anchor for pv-when");s.replaceChild(u,e);var a={new_scope_generator:!0,instructions:{"pv-when-condition":v(u,o,!1,e,i)}};return u.directives_data=a,u},"pv-replace":function(e,t,n,r){t.done=!0;var i=this,s=r&&r.samples,o=s&&s[t.sample_name]||t.sample_name,u=e.parentNode;if(!t["pv-when"]){var a=n(o,!0);return u.replaceChild(a,e),a}var f=document.createComment("anchor for pv-when");u.replaceChild(f,e);var l={new_scope_generator:!0,instructions:{"pv-when-condition":v(f,t["pv-when"],function(){return n(o,!0)},null,i)}};return f.directives_data=l,f}},comment_directives_p:{"pv-replace":function(e,t,n,r){var i={},s=t,o=s.match(l);for(var u=0;u<o.length;u++){o[u]=o[u].replace(c,"");var a=o[u].indexOf(":"),f=o[u].slice(0,a),h=o[u].slice(a+1).replace(p,"");if(!f||!h)throw new Error("wrong declaration: "+s);i[f]=h}return i}},directives_p:{"pv-text":function(){var e=function(e){return t(e).text()},n=function(e,n){t(e).text(n)};return function(t,i,s){return new r(t,{complex_statement:i,getValue:e,setValue:n},s)}}(),"pv-class":function(){var e=function(e){return e.className},t=function(e,t){e.className=t};return function(n,i,s){return i=y(i),new r(n,{complex_statement:i,getValue:e,setValue:t,simplifyValue:y},s)}}(),"pv-props":function(e,t,n){var r=[],i=t,s=i.match(f);for(var o=0;o<s.length;o++){s[o]=s[o].replace(c,"").split(h);var u=s[o][0],l=s[o][1]&&s[o][1].replace(p,"");if(!u||!l)throw new Error("wrong declaration: "+i);var d=a(e,u,l,u+"$"+n);d&&r.push(d)}return r},"pv-when":function(e,t,n){if(!t)return;return t},"pv-type":function(){var e=function(){return""},t=function(e,t,n,r){var i=t.split(o);r.pv_type_data.marks={};for(var s=0;s<i.length;s++)i[s]&&(r.pv_type_data.marks[i[s]]=!0);r.context._pvTypesChange()};return function(n,i,s){if(!i)return;return i=y(i),new r(n,{complex_statement:i,getValue:e,setValue:t,simplifyValue:y},s)}}(),"pv-events":function(){var e=function(e,t,n){n=n&&n.split(",");var r={};if(n)for(var i=0;i<n.length;i++)r[n[i]]=!0;return{event_name:e,fn:function(e,n){r.sp&&e.stopPropagation(),r.pd&&e.preventDefault(),n.callEventCallback(this,e,t.slice())}}},t=function(e){for(var t=0;t<e.length;t++){var r=e[t];r.indexOf("{{")!=-1&&(e[t]=n.interpolateExpressions(r))}return e};return function(n,r){var i=[],s=r.split(o);for(var u=0;u<s.length;u++){var a=s[u].split(":"),f=a.shift(),l=f.split("|");i.push(e(l[0],t(a),l[1]))}return i}}()},scope_generators_p:{"pv-nest":function(t,r){var i=r,s=i.split("|"),o;if(s[1]){var u=n.parseExpression("obj |"+s[1]);o=function(e){return u({obj:e})}}var a=s[0].split(/\s+/gi),f,l,c,h;for(var p=0;p<a.length;p++){var d=a[p];if(!d)continue;if(e.startsWith(d,"for_model:"))f=d.slice("for_model:".length);else if(e.startsWith(d,"controller:"))c=d.slice("controller:".length);else{var v=d.split(":");l||(l=v[0]),h||(h=v[1]||"")}}return{coll_name:l,for_model:f,controller_name:c,space:h,filterFn:o}},"pv-repeat":function(e,t){var r=t,i=r.match(/^\s*(.+)\s+in\s+(.*)\s*$/),s,o,u,a;if(!i)throw new Error("Expected ngRepeat in form of '_item_ in _collection_' but got '"+r+"'.");s=i[1],o=i[2],i=s.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);if(!i)throw new Error("'item' in 'item in collection' should be identifier or (key, value) but got '"+s+"'.");u=i[3]||i[1],a=i[2];var f=n.parseExpression(o),l=f.propsToWatch,c=d(l);return{expression:r,valueIdent:u,keyIdent:a,calculator:f,sfy_values:c}}}}}),define("pv/pvTemplate/getCachedPVData",["spv","./directives_parsers"],function(e,t){var n=t.comment_directives_p,r=t.directives_p,i=t.scope_generators_p,s=t.config,o=s.comment_directives,u={},a=/(^.+?)\s/,f=e.getDeprefixFunc("pv-",!0),l=function(e,t){t.instances_ci||(t.instances_ci={});var n=t.instances_ci;return n.hasOwnProperty(e)?n[e]++:n[e]=0,n[e]},c=function(e,t,r){var i={new_scope_generator:null,instructions:{},replacing_data:null},s=e.textContent,u=s.match(a);u=u&&u[1];if(o.hasOwnProperty(u)){var f=s.replace(a,""),l=n[u].call(r,e,f,u,t);i.instructions[u]=l}return i},h=function(){var t=function(e,t){var n=e.nodeName==="SCRIPT"?e:e.querySelector('script[type="pv-import-map"]'),r;n===e&&(r=e),n.parentNode===e&&(r=e,e.removeChild(r));var i=r&&JSON.parse(r.textContent);return{sample_name:t,map:i}},n=s.one_parse_list,o=s.scope_g_list,u=s.directives_names_list,a=s.one_parse;return function(s,l,c){var h={new_scope_generator:null,instructions:{},replacing_data:null},p=0,d="",v="",m=s.attributes,g=!1,y=[];for(p=0;p<m.length;p++)d=m[p].name,f(d)&&y.push({name:d,node:m[p]});var b=e.makeIndexByField(y,"name"),w;for(p=0;p<n.length;p++)v=n[p],b[v]&&b[v].length&&(w=b[v][0].node.value,r[v]&&(w=r[v].call(c,s,w,v,l)),h.instructions[v]=w);for(p=0;p<o.length;p++){v=o[p];if(b[v]&&b[v].length){if(g)throw new Error("can't be multiply scrope generators on one node");w=b[v][0].node.value,i[v]&&(w=i[v].call(c,s,w)),h.instructions[v]=w,a[v]||(h.new_scope_generator=!0,g=!0)}}for(p=0;p<u.length;p++)v=u[p],b[v]&&b[v].length&&(w=b[v][0].node.value,r[v]&&(w=r[v].call(c,s,w,v,l)),h.instructions[v]=w);b["pv-import"]&&(h.instructions["pv-import"]=t(s,b["pv-import"][0].node.value));for(var p=0;p<y.length;p++)s.removeAttributeNode(y[p].node);return h}}(),p=function(e,t){var n=++t.struc_counter;return e.pvprsd=n,e.pvprsd_inst=l(n,t),n},d=function(e,t,n){var r=t||u;r[p(e,r)]=n},v=function(){return function(e,t,n,r,i){var s=null,o=null,a=e.pvprsd,f=t||u;return typeof a!="undefined"?a&&(s=f[a]):(f.struc_counter||(f.struc_counter=0),n?s=c(e,r,i):s=h(e,r,i),d(e,t,s)),o||s}}();return v.setStrucKey=d,v.getNodeInstanceCount=l,v}),define("pv/pvTemplate/parser",["spv","jquery","../StatementsAngularParser.min","./directives_parsers","./getCachedPVData"],function(e,t,n,r,i){var s=r.config,o=i.getNodeInstanceCount,u=r.patching_directives,a=r.getIndexList,f=a(u),l=function(e,t,n,r,i){for(var s=0;s<f.length;s++){var o=f[s];if(n&&n.instructions[o]){var a=u[o].call(v,e,n.instructions[o],r,i);if(a){if(!a.directives_data&&!a.pvprsd)throw new Error("should be directives_data");return a.directives_data&&c(a,t,a.directives_data),a}}}},c=i.setStrucKey,h=function(){var n=Array.prototype.push,r=function(e){var t=[],n=[e],r=0;while(n.length){var i=n.shift(),s=i.nodeType;if(s==1){for(r=0;r<i.childNodes.length;r++)n.push(i.childNodes[r]);t.push(i)}else s==8&&t.push(i)}return t},i=0,u=function(e,n,r){e=t(e),e=e[0];if(!e)throw new Error("wrong node");this.onode=e,this.mod_root_node=null,this.patched_cache=null,this.parsed=!1,this.structure_data_as_root=null,this.structure_data=null,this.struc_store=n,this._id=++i,this.getSample=r,this.nodes=null,this.pstd_cache=null};(function(){var t=function(e,t,i,o,u,a,f){if(!t){o.instructions["pv-nest"]&&a.push({item:r(i,e,!1,f),data:o.instructions["pv-nest"]});var l=!1;for(var c=0;c<s.scope_g_list.length;c++){var h=s.scope_g_list[c];o.instructions[h]&&(l=!0,s.states_using_directives[h]&&n.apply(u,o.instructions[h].sfy_values))}if(l)return}for(var c=0;c<s.sud_list.length;c++){var p=s.sud_list[c];o.instructions[p]&&n.apply(u,o.instructions[p].sfy_values)}},r=function(n,r,i,s){var o={node_id:null,states:[],children:null,children_by_mn:null},u=[],a=v.parseEasy(n,!i&&n,r,s);for(var f=0;f<a.length;f+=3){var l=a[f],c=a[f+1],h=a[f+2];t(r,l,c,h,o.states,u,s)}o.states=e.getArrayNoDubs(o.states);if(u.length){var p=null,d=null;for(var f=0;f<u.length;f++){var m=u[f];m.data.for_model?(d||(d={}),e.setTargetField(d,[m.data.coll_name,m.data.for_model,m.data.space||"main"],m.item)):(p||(p={}),e.setTargetField(p,[m.data.coll_name,m.data.space||"main"],m.item))}o.children=p,o.children_by_mn=d}return o.node_id=n.pvprsd,o};u.prototype.getStructure=function(e){var t="structure_data"+(e?"":"_as_root");return this.pstd_cache||(this.pstd_cache={}),this.pstd_cache[t]||(this.pstd_cache[t]=r(this.onode,this.struc_store,e,this.getSample),this.parsed=!0),this.pstd_cache[t]}})();var a=function(e,t,n,r){var i=[e],s=0;while(i.length){var o=i.shift(),u=e===o,a=o.nodeType,f=null;a==1?f=d(o,t,n):a==8&&(f=p(o,t,n));var c=!u&&l(o,t,f,n,r);c&&i.unshift(c);if(a==1)for(s=0;s<o.childNodes.length;s++)i.push(o.childNodes[s])}return e},f=function(e,t,n){var i=e.cloneNode(!0),s=r(e),u=r(i);if(s.length!==u.length)throw new Error("something wrong");for(var a=0;a<s.length;a++)u[a].pvprsd=s[a].pvprsd,u[a].pvprsd_inst=o(s[a].pvprsd,t),u[a].pv_sample_id=n;return i};return u.prototype.getClone=function(e){if(!this.onode)return;if(e&&!e.key)throw new Error("opts should have uniq key");return e&&console.log("IMPLEMENT OPTIONS SUPPORT"),this.nodes||(this.nodes=v.parse(this.onode,this.struc_store,this.getSample,e)),e?(this.patched_cache||(this.patched_cache={}),this.patched_cache[e.key]||(this.patched_cache[e.key]=a(f(this.onode,this.struc_store,this._id),this.struc_store,this.getSample,e)),f(this.patched_cache[e.key],this.struc_store,this._id)):(this.mod_root_node||(this.mod_root_node=a(f(this.onode,this.struc_store,this._id),this.struc_store,this.getSample,e)),f(this.mod_root_node,this.struc_store,this._id))},u.prototype.clone=u.prototype.getClone,u}(),p=function(e,t,n){return i(e,t,!0,n,v)},d=function(e,t,n){return i(e,t,!1,n,v)},v={config:s,comment_directives_p:r.comment_directives_p,directives_p:r.directives_p,scope_generators_p:r.scope_generators_p,parse:function(e,t,n,r){var i=[],s=[e],o=0;while(s.length){var u=s.shift(),a=u.nodeType,f=null;a==1?(f=d(u,t,n),i.push(u,f)):a==8&&(f=p(u,t,n),i.push(u,f));if(a==1)for(o=0;o<u.childNodes.length;o++)s.push(u.childNodes[o])}return i},parseEasy:function(e,t,n,r){var i=[],s=[e,!0];while(s.length){var o=s.shift(),u=s.shift(),a=o.nodeType,f=null,c=o===e;if(a==1){var h=0,v=t===o;f=d(o,n,r);var m=!f.new_scope_generator||v;for(h=0;h<o.childNodes.length;h++)s.push(o.childNodes[h],u&&m);u&&i.push(v,o,f)}else a==8&&(f=p(o,n,r),u&&i.push(!1,o,f));var g=!c&&l(o,n,f,r,null);g&&s.unshift(g,u)}return i}};return v.PvSimpleSampler=h,v}),define("pv/PvTemplate",["spv","./StatementsAngularParser.min","jquery","./pvTemplate/parser"],function(e,t,n,r){var i=Array.prototype.push,s=e.addEvent,o=e.removeEvent,u=r.PvSimpleSampler,a=function(e){var t=[];for(var n in e){if(!e.hasOwnProperty(n))continue;t.push(!0,n,e[n])}return t},f=function(e){this.pv_types_collecting=!1,this.states_inited=!1,this.waypoints=null,this.stwat_index=null,this.all_chunks=[],this.root_node=e.node,this.root_node_raw="nodeType"in this.root_node?this.root_node:this.root_node[0],this.pv_repeat_context=null,e.pv_repeat_context&&(this.pv_repeat_context=e.pv_repeat_context),this.calls_flow=e.calls_flow||null,!this.calls_flow,this.calls_flow_index=this.calls_flow?{}:null,this.scope=null,e.scope&&(this.scope=e.scope),this.spec_states_props_list=null,e.spec_states&&(this.spec_states_props_list=a(e.spec_states)),e.callCallbacks&&(this.sendCallback=e.callCallbacks),this.pvTypesChange=e.pvTypesChange,this.pvTreeChange=e.pvTreeChange,this.struc_store=e.struc_store,this.ancs=null,this.pv_repeats=null,this.children_templates=null,this.data_limitations=e.data_limitations,this.states_watchers=[],this.stwat_index={},this.pv_types=null,this.pv_repeats_data=null,this.destroyers=null,this.getSample=e.getSample,this.pv_types_collecting=!0,this.parsePvDirectives(this.root_node,e.struc_store),(!t||!t.interpolateExpressions)&&console.log("cant parse statements"),this.scope&&this.setStates(this.scope),this.pv_types_collecting=!1,this.pv_types&&this._pvTypesChange()},l=function(){},c=function(e,t){var n=e.calls_flow_index[t];n&&(e.calls_flow_index[t]=null,n.abort())},h=function(e,t){e.calls_flow_index[t]=null},p=function(e,t){var r=this;h(r.context,r.w_cache_key);if(r.original_fv!=e){var i=r.context,s=r.old_nodes,o=r.repeat_data,u=r.field_name,a=r.valueIdent,c=r.keyIdent,p=r.comment_anchor,d=r.sampler,v=[];o.array=[],i.pv_types_collecting=!0,n(s).detach(),s.length=0,r.original_fv=e;var m=r.calculator(t),g,y="";i.pv_repeat_context&&(y=i.pv_repeat_context+".$."),y+=u;var b=document.createDocumentFragment();for(var w=0;w<m.length;w++){var E={};E[a]=m[w],c&&(E[c]=w),E.$index=w,E.$first=w===0,E.$last=w===m.length-1,E.$middle=!E.$first&&!E.$last;var S=d.getClone(),x=new f({node:S,pv_repeat_context:y,scope:E,callCallbacks:i.sendCallback,struc_store:i.struc_store,calls_flow:i.calls_flow});s.push(S),n(b).append(S),l(b),g=S,v.push(x),o.array.push(x)}n(p).after(b),i.pv_repeats||(i.pv_repeats={}),i.pv_repeats[y]=v,i.pv_types_collecting=!1,i._pvTypesChange()}},d=function(t,n,r){var i=this;c(i.context,i.w_cache_key);var s=e.getTargetField(t,i.field_name);if(i.original_fv!=s)if(n){var o=i.context.calls_flow.pushToFlow(p,this,[s,t],!1,!1,!1,r);i.context.calls_flow_index[i.w_cache_key]=o}else p.call(this,s,t)},v=function(t,n){var r=t.coll_name,i=t.space||"main";if(t.for_model){var s=[r,"by_model_name",i],o=e.getTargetField(n,s);o&&(o.index[t.for_model]=null)}else e.setTargetField(n,[r,"usual",i],null)},m=function(t,r){var i=t.coll_name,s=t.space||"main";if(t.for_model){var o=[i,"by_model_name",s],u=e.getTargetField(r,o);u||(u={index:{}},e.setTargetField(r,o,u)),u.first||(u.first=t,u.comment_anchor=document.createComment("collch anchor for: "+i+", "+s+" (by_model_name)"),n(t.node).before(u.comment_anchor)),t.original_node=t.node,n(t.node).detach(),u.index[t.for_model]=t}else e.setTargetField(r,[i,"usual",s],t)},g=function(e,t){this.type=e,this.data=t,this.dead=!1,this.handled=!1,this.destroyer=null},y=function(){var t={states_watcher:function(t,n){n.states_watchers=e.findAndRemoveItem(n.states_watchers,t.data)},ancs:function(e,t){if(!t.ancs)return;var n=e.data.anchor_name;t.ancs[n]=null},pv_type:function(t,n){if(!n.pv_types)return;n.pv_types=e.findAndRemoveItem(n.pv_types,t.data)},pv_event:function(e){e.destroyer()},pv_view:function(e,t){if(!t.children_templates)return;v(e.data,t.children_templates);if(e.data.destroyers)while(e.data.destroyers.length){var n=e.data.destroyers.pop();n()}},pv_repeat:function(t,n){if(!n.pv_repeats_data)return;n.pv_repeats_data=e.findAndRemoveItem(n.pv_repeats_data,t.data)}},r={states_watcher:function(e,t){t.states_watchers.push(e.data)},ancs:function(e,t){t.ancs||(t.ancs={});var r=e.data.anchor_name;if(t.ancs[r])throw new Error("anchors exists");t.ancs[r]=n(e.data.node)},pv_type:function(e,t){t.pv_types||(t.pv_types=[]),t.pv_types.push(e.data)},pv_event:function(e,t){e.destroyer=t.bindPVEvent(e.data.node,e.data.evdata)},pv_view:function(e,t){t.children_templates||(t.children_templates={}),m(e.data,t.children_templates)},pv_repeat:function(e,t){t.pv_repeats_data||(t.pv_repeats_data=[]),t.pv_repeats_data.push(e.data)}};return function(n,i,s){if(!n)return s&&[];var o=s&&[];for(var u=0;u<n.length;u++){var a=n[u];if(!a.dead)o.push(a);else{var f=t[a.type];f&&f(a,i)}!a.dead&&!a.handled&&(a.handled=!0,r[a.type](a,i))}return o}}();return e.Class.extendTo(f,{_pvTypesChange:function(){if(this.pv_types_collecting)return;this.pvTypesChange&&this.pvTypesChange.call(this,this.getTypedNodes())},destroy:function(){this.dead=!0;for(var e=0;e<this.all_chunks.length;e++)this.all_chunks[e].dead=!0;y(this.all_chunks,this,!1),this.all_chunks=null,this.stwat_index={};if(this.destroyers)while(this.destroyers.length){var t=this.destroyers.shift();t.call(this)}if(this.calls_flow_index)for(var n in this.calls_flow_index)this.calls_flow_index.hasOwnProperty(n)&&typeof this.calls_flow_index[n]=="function"&&(this.calls_flow_index[n].abort(),this.calls_flow_index[n]=null)},getTypedNodes:function(){var e=[],t=[this];while(t.length){var n=t.shift();n.pv_types&&n.pv_types.length&&e.push(n.pv_types);if(!n.pv_repeats_data)continue;for(var r=0;r<n.pv_repeats_data.length;r++)n.pv_repeats_data[r].array&&(t=t.concat(n.pv_repeats_data[r].array))}return e},scope_generators:{"pv-nest":function(e,t){if(typeof t.coll_name=="string"){var n={views:[],node:e,sampler:new u(e,this.struc_store,this.getSample),coll_name:t.coll_name,controller_name:t.controller_name,for_model:t.for_model,space:t.space,filterFn:t.filterFn,destroyers:null,onDie:function(e){n.destroyers||(n.destroyers=[]),n.destroyers.push(e)}};return new g("pv_view",n)}},"pv-repeat":function(e,t){if(e==this.root_node)return;var r=t.expression,i=t.valueIdent,s=t.keyIdent,o=t.calculator,a=t.sfy_values,f=document.createComment("pv-repeat anchor for: "+r);n(e).after(f).detach();var l={array:null},c;return[new g("pv_repeat",l),new g("states_watcher",{w_cache_key:e.pvprsd+"_"+e.pvprsd_inst+"*"+"pv-repeat",node:e,context:this,original_fv:c,old_nodes:[],repeat_data:l,comment_anchor:f,sampler:new u(e,this.struc_store,this.getSample),valueIdent:i,keyIdent:s,calculator:o,field_name:a[0],values:o.propsToWatch,sfy_values:a,checkFunc:d})]}},empty_state_obj:{},bindPVEvent:function(){var e=function(e,t,n){return function(){o(e,t,n)}};return function(t,n){var r=this,i=n.fn,o=n.event_name;n=null;var u=function(e){i.call(this,e,r)},a=e(t,o,u);return s(t,o,u),a}}(),callEventCallback:function(e,t,n){this.sendCallback({event:t,node:e,callback_name:n[0],callback_data:n,pv_repeat_context:this.pv_repeat_context,scope:this.scope})},checkChanges:function(t,n,r,s){if(this.dead)return;var o=[],u=0;for(u=0;u<t.length;u+=3){var a=t[u+1];this.stwat_index[a]&&i.apply(o,this.stwat_index[a])}o=e.getArrayNoDubs(o);var f=this.getStatesSumm(n);if(!this.states_inited){this.states_inited=!0;var l=e.arrayExclude(this.states_watchers,o);for(u=0;u<l.length;u++){l[u].checkFunc(f,r,s);if(this.dead)return}}for(u=0;u<o.length;u++){o[u].checkFunc(f,r,s);if(this.dead)return}},getStatesSumm:function(t){var n;if(this.spec_states_props_list){n=Object.create(t);for(var r=0;r<this.spec_states_props_list.length;r+=3){var i=this.spec_states_props_list[r+1],s=this.spec_states_props_list[r+2];n[i]=s}e.cloneObj(n,this.spec_states)}else n=t;return n},setStates:function(e){var t=this.getStatesSumm(e);for(var n=0;n<this.states_watchers.length;n++)this.states_watchers[n].checkFunc(t)},handleDirective:function(){var e={"pv-when-condition":function(e,t){if(t){var n=t.createBinding(e,this),r=function(){n.destroyer&&n.destroyer()},i=new g("states_watcher",n);return i.destroyer=r,i}},"pv-text":function(e,t){if(t){var n=t.createBinding(e,this);return new g("states_watcher",n)}},"pv-class":function(e,t){if(t){var n=t.createBinding(e,this);return new g("states_watcher",n)}},"pv-props":function(e,t){if(t){var n=[];for(var r=0;r<t.length;r++){var i=t[r].createBinding(e,this);n.push(new g("states_watcher",i))}return n}},"pv-anchor":function(e,t){var n=t;return new g("ancs",{anchor_name:n,node:e})},"pv-type":function(e,t){if(t){var n={node:e,marks:null},r=t.createBinding(e,this);return r.pv_type_data=n,r.checkFunc(this.empty_state_obj),[new g("states_watcher",r),new g("pv_type",n)]}},"pv-events":function(e,t){if(t){if(!this.sendCallback)throw new Error("provide the events callback handler to the Template init func");var n=[];for(var r=0;r<t.length;r++){var i=t[r];n.push(new g("pv_event",{node:e,evdata:i}))}return n}}};return function(t,n,r){var i=e[t];i||(console.log(t,n,r),console.log(e));var s=i.call(this,n,r);return s}}(),indexPvViews:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];m(r,t)}return t},parseAppended:function(e){return this.parsePvDirectives(e)},iterateBindingList:function(){var e=r.config,t=e.pseudo_list,n=e.scope_g_list,s=e.directives_names_list,o=e.comment_directives_names_list,u=function(e,t){return t&&(Array.isArray(t)?i.apply(e,t):e.push(t)),e};return function(e,r,i,a){var f=0,l;if(!e){for(f=0;f<t.length;f++){l=t[f];if(i.instructions[l]){var c=this.handleDirective(l,r,i.instructions[l]);u(a,c)}}for(f=0;f<n.length;f++){l=n[f];if(i.instructions[l]){var h=this.scope_generators[l].call(this,r,i.instructions[l]);u(a,h)}}}if(!i.new_scope_generator||e){for(f=0;f<s.length;f++){l=s[f];if(i.instructions[l]){var p=this.handleDirective(l,r,i.instructions[l]);u(a,p)}}for(f=0;f<o.length;f++){l=o[f];if(i.instructions[l]){var d=this.handleDirective(l,r,i.instructions[l]);u(a,d)}}}return a}}(),checkChunks:function(){this.all_chunks=y(this.all_chunks,this,!0),this.stwat_index=e.makeIndexByField(this.states_watchers,"sfy_values",!0)},parsePvDirectives:function(e){if(this.dead)return;var t=this.struc_store;e="nodeType"in e?e:e[0];var n=this.root_node_raw,i=r.parseEasy(e,n,t,this.getSample),s=[];for(var o=0;o<i.length;o+=3)this.iterateBindingList(i[o],i[o+1],i[o+2],s);if(this.dead)return;return this.all_chunks=this.all_chunks.concat(s),this.checkChunks(),s}}),f.SimplePVSampler=u,f.templator=function(e,t,n){function r(r,i,s,o,u){return new f({node:r[0]||r,spec_states:o,callCallbacks:i,pvTypesChange:s,struc_store:n,calls_flow:e,getSample:t,pvTreeChange:u})}function i(e){return new u(e,n,t)}return n=n||{},{template:r,sampler:i}},f}),define("pv/sync_sender",["spv"],function(e){return{root_model:null,sockets:{},streams_list:[],sockets_m_index:{},setRootModel:function(e){this.root_model=e},removeSyncStream:function(t){if(!this.sockets[t.id])return;this.sockets_m_index[t.id]=null,this.sockets[t.id]=null,this.streams_list=e.findAndRemoveItem(this.streams_list,t)},addSyncStream:function(e,t){this.sockets_m_index[t.id]={},this.sockets[t.id]=t,this.streams_list.push(t);var n=e.toSimpleStructure(this.sockets_m_index[t.id]);t.buildTree(n)},pushNesting:function(e,t,n,r,i){var s;for(var o=0;o<this.streams_list.length;o++){var u=this.streams_list[o],a=this.sockets_m_index[u.id];if(a[e._provoda_id]){if(n&&typeof s=="undefined"){if(n._provoda_id)s=n._provoda_id;else if(Array.isArray(n)){s=new Array(n.length);for(var f=0;f<n.length;f++)s[f]=n[f]._provoda_id}else console.warn("unparsed",n);s=="undefined"&&(s=null)}var l=e.toSimpleStructure(a);u.changeCollection(e._provoda_id,l,t,s)}}},pushStates:function(e,t){var n,r,i;for(var s=0;s<this.streams_list.length;s++){var o=this.streams_list[s];if(this.sockets_m_index[o.id][e._provoda_id]){if(!r)for(var u=2;u<t.length;u+=3){var a=t[u];a&&typeof a=="object"&&a._provoda_id&&(n=!0,i||(i=t.slice()),i[u]={_provoda_id:t[u]._provoda_id})}o.updateStates(e._provoda_id,n?i:t)}}}}}),define("pv/helpers",["spv"],function(e){function t(e){return e}function o(e){var t,n=e;while(!t&&n.parent_view){if(n.parent_view==e.root_view){t=n;break}n=n.parent_view}return t}function u(e){return o(e).mpx._provoda_id}var n=function(e,t,n,r,i){this.selector=e,this.state_name=t,this.full_name=r,this.zin_func=n,this.handler=i},r={},i={parent_count_regexp:/^\^+/gi,parent:function(e){if(!r[e]){var t=e.replace(this.parent_count_regexp,""),n=e.length-t.length;r[e]={rel_type:"parent",full_name:e,ancestors:n,state_name:t}}return r[e]},nesting:function(e){if(!r[e]){var i=e.slice(1),s=i.split(":"),o=s.pop(),u=s.pop(),a=s.pop();r[e]={rel_type:"nesting",full_name:e,nesting_name:o,state_name:u,zin_func:a||t,nwatch:new n(o.split("."),u,a,e)}}return r[e]},root:function(e){return r[e]||(r[e]={rel_type:"root",full_name:e,state_name:e.slice(1)}),r[e]}},s={emergency:!0};return{NestWatch:n,getRDep:function(){var t=e.memorize(function(t){return t.split(":")[1]});return function(e){var n=t(e);return function(e,t,r){r&&r.setStateDependence(n,e,!1),t&&t.setStateDependence(n,e,!0)}}}(),state:function(e,t){return e._lbr&&e._lbr.undetailed_states?e._lbr.undetailed_states[t]:e.states[t]},triggerDestroy:function(e){var t=e.evcompanion.getMatchedCallbacks("die");t.length&&e.evcompanion.triggerCallbacks(t,!1,s,"die")},wipeObj:function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]},markFlowSteps:function(e,t,n){for(var r=0;r<e.length;r++)e[r].p_space=t,e[r].p_index_key=n},getRightNestingName:function(e,t){return e.preview_nesting_source&&t=="preview_list"?t=e.preview_nesting_source:t==e.preview_mlist_name&&(t=e.main_list_name),t},getEncodedState:function(e){if(!r.hasOwnProperty(e)){var t=e.charAt(0);t=="^"?i.parent(e):t=="@"?i.nesting(e):t=="#"?i.root(e):r[e]=null}return r[e]},getReqMapsForState:function(e,t){if(!e)return;var n=[];for(var r=0;r<e.length;r++){var i=e[r][0];i.indexOf(t)!=-1&&n.push(r,e[r])}return n},getNetApiByDeclr:function(t,n,r){var i,s=t[0];return typeof s=="string"?i=e.getTargetField(r||n.app,s):typeof s=="function"&&(i=s.call(n)),i},getPropsPrefixChecker:function(e){return function(t){for(var n in t)if(t.hasOwnProperty(n)&&e(n))return!0}},getSTEVNameVIP:e.getPrefixingFunc("vip_state_change-"),getSTEVNameDefault:e.getPrefixingFunc("state_change-"),getSTEVNameLight:e.getPrefixingFunc("lgh_sch-"),getFullChilChEvName:e.getPrefixingFunc("child_change-"),getRemovedNestingItems:function(e,t){var n;if(Array.isArray(t))if(!e)n=t.slice(0);else{n=[];for(var r=0;r<t.length;r++){var i=t[r];e.indexOf(i)==-1&&n.push(i)}}else t&&e!=t&&(n=[t]);return n},oop_ext:{hndMotivationWrappper:function(e,t,n,r,i){e.p_space&&this.zdsv.removeFlowStep(e.p_space,e.p_index_key,e);if(this.isAliveFast&&!this.isAliveFast())return;var s=n.current_motivator;n.current_motivator=e;var o;this!=n&&(o=this.current_motivator,this.current_motivator=e),r?t.apply(n,r):t.call(n,i);if(n.current_motivator!=e)throw new Error("wrong motivator");n.current_motivator=s;if(this!=n){if(this.current_motivator!=e)throw new Error("wrong motivator");this.current_motivator=o}}},$v:{getBwlevView:o,getBwlevId:u,getViewLocationId:function(e,t,n){if(!t)throw new Error("no nesting_name");return e.view_id+":"+n+":"+t},createTemplate:function(t,n){return t._lbr.hndTriggerTPLevents||(t._lbr.hndTriggerTPLevents=function(n){var r=n.callback_data;for(var i=0;i<r.length;i++){var s=r[i];typeof s=="function"&&(r[i]=s(n.scope||t.states))}if(!r[0]&&r[1]){var o;e.startsWith(r[1],"#")?(o=t.root_view,r[1]=r[1].slice(1)):o=t;if(r[2]){var u=r[2].match(/\%(.*?)\%/);u&&(r[2]=e.getTargetField(n.node,u[1]))}r.shift(),o.handleTemplateRPC.apply(o,r)}else n.pv_repeat_context?t.tpl_r_events[n.pv_repeat_context][n.callback_name].call(t,n.event,n.node,n.scope):t.tpl_events[n.callback_name].call(t,n.event,n.node,r)}),t._lbr.hndPvTypeChange||(t._lbr.hndPvTypeChange=function(n){var r=this.waypoints,i=[],s=0;for(s=0;s<n.length;s++){if(!n[s])continue;i.push.apply(i,n[s])}var o=[];for(s=0;s<i.length;s++){var u=i[s];if(!u.marks)continue;(u.marks["hard-way-point"]||u.marks["way-point"])&&o.push(u)}var a=r&&e.arrayExclude(r,o);this.waypoints=o,t.updateTemplatedWaypoints(o,a)}),t._lbr.hndPvTreeChange||(t._lbr.hndPvTreeChange=function(){t.checkTplTreeChange()}),t.getTemplate(n,t._lbr.hndTriggerTPLevents,t._lbr.hndPvTypeChange,t._lbr.hndPvTreeChange)},matchByParent:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r;while(i.parent_view&&i.parent_bwlev!=i.root_view){if(i.parent_view==t)return r;i=i.parent_view}}},selecPoineertDeclr:function(){var e=[function(e,t){return e+"/"+t},function(e){return e},function(e,t){return"/"+t},function(){return""}];return function(t,n,r,i,s,o){for(var u=0;u<e.length;u++){var a=e[u](i,s);if(n[r]&&n[r][a]){var f=n[r][a];if(f){var l=t[f];if(!o&&!l)throw new Error("reffered dclr does not exist");return l}}}}}()}}}),define("pv/MDProxy",["spv","./helpers"],function(e,t){var n=function(t,n,r,i){this._provoda_id=t,this.views=null,this.views_index=null,this.states=n,this.vstates=null,this.md=i,this.nestings=e.cloneObj({},r)};return n.prototype={RPCLegacy:function(){this.md.RPCLegacy.apply(this.md,arguments)},setStates:function(){},updateStates:function(){},updateNesting:function(){},updateManyStates:function(e){this.vstates||(this.vstates={});var t=[];for(var n in e)this.vstates[n]=e[n],t.push(!0,n,e[n]);return this.sendStatesToViews(t),this},updateState:function(e,t,n){return this.vstates||(this.vstates={}),this.vstates[e]=t,this.sendStatesToViews([!0,e,t],n),this},state:function(e){return this.vstates&&this.vstates[e]},removeView:function(e){if(!this.views)return;var t=[];for(var n=0;n<this.views.length;n++)t[n]!==e&&t.push(t[n]);t.length!=this.views.length&&(this.views=t)},sendCollectionChange:function(e,n){var r=this.nestings[e];this.nestings[e]=n;if(!this.views)return;var i=t.getRemovedNestingItems(n,r);for(var s=0;s<this.views.length;s++)this.views[s].stackCollectionChange(e,n,r,i)},stackReceivedStates:function(e){if(!this.views)return;for(var t=0;t<this.views.length;t++)this.views[t].stackReceivedChanges(e)},sendStatesToViews:function(e,t){if(!this.views)return;for(var n=0;n<this.views.length;n++)this.views[n].receiveStatesChanges(e,t)},removeDeadViews:function(e,t){var n=0;if(e){var r=t&&this.views_index&&this.views_index[t],i=t?r&&[r]:this.views;if(i)for(n=0;n<i.length;n++)i[n].isAlive&&i[n].isAlive()}if(this.views){var s=[],o=[];for(n=0;n<this.views.length;n++)this.views[n].dead?s.push(this.views[n]):o.push(this.views[n]);o.length!=this.views.length&&(this.views=o);if(s.length)for(var u in this.views_index){var a=this.views_index[u];s.indexOf(a)!=-1&&(this.views_index[u]=null)}}return this},die:function(){this.killViews()},killViews:function(){var e=this.views;if(!e)return;for(var t=0;t<e.length;t++)e[t].die({skip_md_call:!0});return this.removeDeadViews(),this},collectViewsGarbadge:function(){if(!this.views)return;for(var e=0;e<this.views.length;e++)this.views[e].checkDeadChildren()},getViews:function(e,t){return this.removeDeadViews(t),e?[this.views_index&&this.views_index[e]]:this.views||[]},getView:function(e){this.removeDeadViews(!0,e);if(!e)throw new Error("complex_id");return this.views_index&&this.views_index[e]},addView:function(e,t){return this.removeDeadViews(!0,t),this.views||(this.views=[]),this.views.push(e),this.views_index||(this.views_index={}),this.views_index[t]=e,this},getRooConPresentation:function(e,t,n,r){var i=this.getViews(),s;if(!r)for(var o=0;o<i.length;o++){s=i[o];if(e.matchCildrenView(s,!1,"map_slice"))return s}for(var u=0;u<i.length;u++){s=i[u];var a=!1;t?a=s.getAncestorByRooViCon("all-sufficient-details",r):a=s.getAncestorByRooViCon("main",r);if(a)return n?a:s}}},n}),define("pv/views_proxies",["spv","./MDProxy"],function(e,t){var n=Array.prototype.push,r={},i=function(e,n){for(var r=0;r<e.length;r++){var i=e[r];n[i._provoda_id]=new t(i._provoda_id,i.states,i.children_models,i)}},s=function(e,t,r){if(!e.length)return;var s,o=[],u={};for(s=0;s<e.length;s++){var a=e[s]._provoda_id;!t[a]&&!u[a]&&(u[a]=!0,o.push(e[s]))}if(o.length){var f=[];for(s=0;s<o.length;s++)n.apply(f,o[s].getLinedStructure(t));i(f,r)}};return{spaces:{},spaces_list:[],addRootView:function(e,t){return this.addSpaceById(e.view_id,t)},removeRootView:function(e){return this.removeSpaceById(e.view_id)},getMPX:function(e,t){typeof e=="object"&&(e=e.view_id);var n=this.spaces[e].mpxes_index[t._provoda_id];return n},addSpaceById:function(e,t){if(!!this.spaces[e])throw new Error;this.spaces[e]={mpxes_index:{},ids_index:{}},this.spaces_list.push(this.spaces[e]);var n=t.getLinedStructure(this.spaces[e].ids_index);i(n,this.spaces[e].mpxes_index)},removeSpaceById:function(t){var n=this.spaces[t];if(!n)throw new Error;this.spaces[t]=null,this.spaces_list=e.arrayExclude(this.spaces_list,n)},pushNesting:function(t,n,r,i,o){var u,a=[];for(var f=0;f<this.spaces_list.length;f++){var l=this.spaces_list[f];if(l.ids_index[t._provoda_id]){if(!u){u=!0;if(r)if(r._provoda_id)a=[r];else if(Array.isArray(r))a=r;else{var c=e.getTargetField(r,"residents_struc.all_items");if(!c)throw new Error('you must provide parsable array in "residents_struc.all_items" prop');a=c}}s(a,l.ids_index,l.mpxes_index),l.mpxes_index[t._provoda_id].sendCollectionChange(n,r,i,o)}}},pushStates:function(e,t){for(var n=0;n<this.spaces_list.length;n++){var r=this.spaces_list[n];r.ids_index[e._provoda_id]&&r.mpxes_index[e._provoda_id].stackReceivedStates(t)}},killMD:function(e){for(var t=0;t<this.spaces_list.length;t++){var n=this.spaces_list[t];n.ids_index[e._provoda_id]&&n.mpxes_index[e._provoda_id].die()}}}}),define("pv/SyncReceiver",["./MDProxy"],function(e){var t=Array.prototype.slice,n=function(e,t){this.stream=t,this._provoda_id=e._provoda_id,this.children_models=e.children_models,this.map_level_num=e.map_level_num,this.map_parent=e.map_parent,this.model_name=e.model_name,this.mpx=e.mpx,this.states=e.states};n.prototype={getParentMapModel:function(){return this.map_parent},RealRemoteCall:function(e){this.stream.RPCLegacy(this._provoda_id,t.call(e))},RPCLegacy:function(){this.RealRemoteCall(arguments)}};var r=function(e,t){if(typeof t=="number")return e[t];if(Array.isArray(t)){var n=new Array(t.length);for(var r=0;r<t.length;r++)n[r]=e[t[r]];return n}return t},i=function(e){this.stream=e,this.md_proxs_index={},this.models_index={}};return i.prototype={buildTree:function(t){var i,s,o;for(i=0;i<t.length;i++)s=t[i],o=s._provoda_id,this.models_index[o]||(this.models_index[o]=new n(s,this.stream));for(i=0;i<t.length;i++){o=t[i]._provoda_id,s=this.models_index[o],s.map_parent=r(this.models_index,s.map_parent);for(var u in s.children_models)s.children_models[u]=r(this.models_index,s.children_models[u])}for(i=0;i<t.length;i++)s=t[i],o=s._provoda_id,this.md_proxs_index[o]||(this.md_proxs_index[o]=new e(s._provoda_id,s.states,s.children_models,this.models_index[o]),this.models_index[o].mpx=this.md_proxs_index[o]);return t.length&&this.models_index[t[0]._provoda_id]},actions:{buildtree:function(e){return this.buildTree(e.value)},update_states:function(e){var t=this.models_index[e._provoda_id],n=this.md_proxs_index[e._provoda_id];for(var r=0;r<e.value.length;r+=3){var i=e.value[r+1],s=e.value[r+2];t.states[i]=n.states[i]=s}this.md_proxs_index[e._provoda_id].stackReceivedStates(e.value)},update_nesting:function(e){e.struc&&this.buildTree(e.struc);var t=this.models_index[e._provoda_id],n=this.md_proxs_index[e._provoda_id],i=r(this.models_index,e.value);t.children_models[e.name]=i,n.sendCollectionChange(e.name,i)}}},i});var hexcase=0;define("hex_md5",function(e){return function(){var t,n;return t||e.hex_md5}}(this)),define("js/libs/morph_helpers",["spv"],function(e){var t=function(e){var t=e.split(/\/+/);if(t[1]=="userserve-ak.last.fm")return t[4].replace(/png$/,"jpg")},n=function(n){if(!n)return;var r,i;typeof n=="string"?r=n:r=e.getTargetField(n,"3.#text");if(r){if(r.indexOf("http://cdn.last.fm/flatness/catalogue/noimage")===0)return;return i=t(r),i?{lfm_id:i}:{url:r}}};return{num:function(e){return parseFloat(e)},lfm_image:n,seconds:function(e){return e*1e3},timestamp:function(e){return e*1e3},urlp:function(e){return"/"+e}}}),define("pv/FastEventor",["spv","hex_md5","./helpers","js/libs/morph_helpers"],function(e,t,n,r){return function(i){var s=function(){var t=function(t,n){var r=t.charAt(n.length);return(!r||r==".")&&e.startsWith(t,n)},n={};return function(r,i){n.hasOwnProperty(i)||(n[i]={});var s=n[i];return s.hasOwnProperty(r)||(s[r]=t(r,i)),s[r]}}(),o={},u={},a=function(e){return u[e]||(u[e]=e.split(".")),u[e]},f=function(e,t,n,r,i,s,o){this.short_name=e,this.namespace=t,this.cb=n,this.once=r,this.context=i,this.immediately=s,this.wrapper=o||null},l=function(t,n){var r,i,s;for(r=0;r<n.length;r++){i=n[r],s=e.getTargetField(t,i);if(s)break}return s},c={},h=function(e,r,i,s){var o=e[0],u=e[1],a=e[2].call(r,i),f=e[3],l=n.getNetApiByDeclr(e,r);if(!l.source_name)throw new Error("network_api must have source_name!");if(!l.errors_fields&&!l.checkResponse)throw new Error("provide a way to detect errors!");typeof o!="string"&&(o=l.api_name);if(typeof o!="string")throw new Error("network_api must have api_name!");var h=a[2]&&a[2].nocache;f||a[2]||(a[2]=s);var p;if(!f&&!h){var d=JSON.stringify([o,u,a]);p=t(d);if(c[p])return c[p]}var v=l[u].apply(l,a);return v.network_api=l,p&&(c[p]=v,v.always(function(){delete c[p]})),v},p=function(e){return function(t,n,r){if(!t.subscribes_cache)return;for(var i in t.subscribes_cache){if(!t.subscribes_cache[i])continue;s(n,i)&&(t.subscribes_cache[i]=e(t.subscribes_cache[i],r,n))}return t.subscribes_cache}},d=p(function(e,t){var n=e;return n.push(t),n}),v=p(function(t,n){var r=t.indexOf(n);if(r!=-1)return e.removeItem(t,r)}),m=p(function(){return null}),g=function(e){this.sputnik=e,this.subscribes=null,this.subscribes_cache=null,this.reg_fires=null,e.reg_fires&&(this.reg_fires=e.reg_fires),this.requests=null,this._requestsSortFunc=null,this.mapped_reqs=null,this.nesting_requests=null};return g.prototype={_pushCallbackToStack:function(e,t){this.subscribes||(this.subscribes={}),this.subscribes[e]||(this.subscribes[e]=[]),this.subscribes[e].push(t),d(this,t.namespace,t)},getPossibleRegfires:function(e){if(!this.reg_fires)return;if(this.reg_fires.cache&&this.reg_fires.cache[e])return this.reg_fires.cache[e];var t=a(e),n=[],r=0;if(this.reg_fires.by_namespace)for(r=t.length-1;r>-1;r--){var i=t.slice(0,r+1).join(".");this.reg_fires.by_namespace[i]&&n.push(this.reg_fires.by_namespace[i])}if(this.reg_fires.by_test)for(r=0;r<this.reg_fires.by_test.length;r++)this.reg_fires.by_test[r].test.call(this.sputnik,e)&&n.push(this.reg_fires.by_test[r]);return this.reg_fires.cache||(this.reg_fires.cache={}),this.reg_fires.cache[e]=n,n},hndUsualEvCallbacksWrapper:function(e,t,n,r,i){e.p_space&&this.zdsv.removeFlowStep(e.p_space,e.p_index_key,e),r?t.apply(n,r):t.call(n,i)},_addEventHandler:function(e,t,n,r,i,s,o,u,l){this.sputnik.convertEventName&&(e=this.sputnik.convertEventName(e));var c=!1,h=this,p=a(e),d=p[0];i&&this.off(e);var v=null,m=null,g=this.hndUsualEvCallbacksWrapper,y=this.getPossibleRegfires(e);y&&y.length&&(v=y[0].fn.call(this.sputnik,e,p),typeof v!="undefined"&&(c=!0,Array.isArray(v)||(m=v,v=null)));if(c){y[0].getWrapper&&(g=y[0].getWrapper.call(this.sputnik));if(!s){var b=n||h.sputnik;if(o===!1)m?t.call(b,m):t.apply(b,v);else{var w=this.sputnik._getCallsFlow().pushToFlow(t,b,v,m,g,this.sputnik,this.sputnik.current_motivator);y[0].handleFlowStep&&y[0].handleFlowStep.call(this.sputnik,w,y[0].getFSNamespace(e))}}}var E=new f(d,e,t,u,n,r,g);return(!u||!c)&&this._pushCallbackToStack(d,E),l?E:this.sputnik},once:function(e,t,n,r){return this._addEventHandler(e,t,n&&n.context||r,n&&n.immediately,n&&n.exlusive,n&&n.skip_reg,n&&n.soft_reg,!0,n&&n.easy_bind_control)},on:function(e,t,n,r){return this._addEventHandler(e,t,n&&n.context||r,n&&n.immediately,n&&n.exlusive,n&&n.skip_reg,n&&n.soft_reg,!1,n&&n.easy_bind_control)},off:function(t,n,r,i){this.sputnik.convertEventName&&(t=this.sputnik.convertEventName(t));var s=a(t)[0],o=this.subscribes&&this.subscribes[s];if(o)if(r){var u=o.indexOf(r);u!=-1&&(this.subscribes[s]=e.removeItem(o,u),v(this,r.namespace,r))}else{var f=[];if(n)for(var l=0;l<o.length;l++){var c=o[l];if(c.cb==n&&c.namespace==t)if(!i||c.context==i)continue;f.push(o[l])}else for(var l=0;l<o.length;l++){var c=o[l];if(c.namespace==t)if(!i||c.context==i)continue;f.push(o[l])}f.length!=this.subscribes[s].length&&(this.subscribes[s]=f,m(this,s))}return this.sputnik},getMatchedCallbacks:function(){var e=[],t=function(e,t){var n=[];for(var r=0;r<t.length;r++){var i=t[r].namespace,o=s(i,e);o&&n.push(t[r])}return n};return function(n){var r;this.sputnik.convertEventName?r=this.sputnik.convertEventName(n):r=n;var i=a(r)[0],s=this.subscribes&&this.subscribes[i];if(!s)return e;var o=this.subscribes_cache&&this.subscribes_cache[r];return o?o:(this.subscribes_cache||(this.subscribes_cache={}),this.subscribes_cache[r]=t(r,s))}}(),callEventCallback:function(e,t,n,r){if(!e.immediately||!!n&&!!n.force_async){var s=e.context||this.sputnik,o=this.sputnik,u=n&&n.emergency?i:this.sputnik._getCallsFlow();return u.pushToFlow(e.cb,s,t,r,e.wrapper,o,this.sputnik.current_motivator)}t?e.cb.apply(e.context||this.sputnik,t):e.cb.call(e.context||this.sputnik,r)},cleanOnceEvents:function(e){var t;this.sputnik.convertEventName?t=this.sputnik.convertEventName(e):t=e;var n=a(t)[0],r=this.subscribes&&this.subscribes[n];if(r){var i=[];for(var s=0;s<r.length;s++){var o=r[s];if(!o.cb)continue;i.push(r[s])}i.length!=this.subscribes[n].length&&(this.subscribes[n]=i,m(this,n))}},triggerCallbacks:function(e,t,n,r,i,s){var o=!1;for(var u=0;u<e.length;u++){var a=e[u];if(!a.cb)continue;var f=this.callEventCallback(a,t,n,i);f&&s&&s.push(f),a.once&&(o=!0,a.cb=null)}o&&this.cleanOnceEvents(r)},trigger:function(e){var t=!1,n=this.getMatchedCallbacks(e);if(n){var r=0,i=new Array(arguments.length-1);for(r=1;r<arguments.length;r++)i[r-1]=arguments[r];for(r=0;r<n.length;r++){var s=n[r];if(!s.cb)continue;this.callEventCallback(s,i,i&&i[i.length-1]),s.once&&(t=!0,s.cb=null)}}return t&&this.cleanOnceEvents(e),this},default_requests_space:"nav",getRequests:function(e){return e=e||this.default_requests_space,this.requests&&this.requests[e]},getQueued:function(t){var n=this.getRequests(t);return n&&e.filter(n,"queued")},addRequest:function(e,t){return this.addRequests([e],t),this.sputnik},addRequests:function(t,n){var r=n&&n.space||this.default_requests_space,i=0,s=null;if(n&&n.order)for(i=0;i<t.length;i++)s=t[i],e.setTargetField(s,this.sputnik.getReqsOrderField(),n.order),s.order=n.order;this.requests||(this.requests={}),this.requests[r]||(this.requests[r]=[]);var o=this.requests[r],u=function(t,n){n.always(function(){t.requests&&t.requests[r]&&(t.requests[r]=e.findAndRemoveItem(t.requests[r],n))})},a=[];for(i=0;i<t.length;i++){s=t[i];if(o.indexOf(s)!=-1)continue;n&&n.depend&&s&&s.addDepend(this.sputnik),o.push(s),u(this,s),a.push(s)}a.length&&((!n||!n.skip_sort)&&this.sortRequests(r),this.trigger("requests",a,r))},_getRequestsSortFunc:function(){if(!this._requestsSortFunc){var t=this.sputnik.getReqsOrderField();this._requestsSortFunc=e.getSortFunc([function(n){return typeof e.getTargetField(n,t)=="number"?!1:!0},t])}return this._requestsSortFunc},sortRequests:function(e){var t=this.requests&&this.requests[e||this.default_requests_space];if(!this.requests||!this.requests.length)return;return t.sort(this._getRequestsSortFunc())},getAllRequests:function(){var e;if(!this.requests)return e;for(var t in this.requests)this.requests[t].length&&(e||(e=[]),e.push.apply(e,this.requests[t]));return e},stopRequests:function(){var e=this.getAllRequests();while(e&&e.length){var t=e.pop();t&&(t.softAbort?t.softAbort(this.sputnik):t.abort&&t.abort(this.sputnik))}return n.wipeObj(this.requests),this},getModelImmediateRequests:function(e){var t=this.getQueued(e);return t&&t.reverse(),t},setPrio:function(e){var t=[],n=this.getModelImmediateRequests(e);n&&t.push(n);var r=this.sputnik.getRelativeRequestsGroups(e);r&&r.length&&t.push.apply(t,r);var i=function(e){e.setPrio()};t.reverse();for(var s=0;s<t.length;s++)t[s].forEach(i);return this.sputnik},requestState:function(e){var t=this.sputnik.state(e);if(t)return;var i,s,o,u=n.getReqMapsForState(this.sputnik.req_map,e),a;if(this.mapped_reqs)for(i=0;i<u.length;i+=2){s=this.mapped_reqs[u[i]];if(s&&(s.done||s.process)){a=!0;break}}if(a)return;var f=u[1],c=u[0];this.mapped_reqs||(this.mapped_reqs={}),this.mapped_reqs[c]||(this.mapped_reqs[c]={done:!1,error:!1,process:!1});var p=this.mapped_reqs[c];o=f[0],this.sputnik.updateManyStates(this.makeLoadingMarks(o,!0));var d=f[1],v=f[2],m=h(v,this.sputnik,{has_error:p.error},{nocache:p.error}),g=m.network_api;p.process=!0;var y=this;return m.always(function(){p.process=!1,y.sputnik.updateManyStates(y.makeLoadingMarks(o,!1))}).fail(function(){p.error=!0}).done(function(e){var t=g.errors_fields?l(e,g.errors_fields):g.checkResponse(e),n;if(t)p.error=!0;else{var i=d.call(y.sputnik,e,null,r);if(i){var s;if(Array.isArray(i)){if(i.length!=o.length)throw new Error("values array does not match states array");s={};for(n=0;n<o.length;n++)s[o[n]]=i[n]}else if(typeof i=="object"){for(n=0;n<o.length;n++)if(!i.hasOwnProperty(o[n]))throw new Error("object must have all props:"+o+", but does not have "+o[n]);s=i}y.sputnik.updateManyStates(s),p.error=!1,p.done=!0}else p.error=!0}}),this.addRequest(m),m},makeLoadingMarks:function(e,t){var n={};for(var r=0;r<e.length;r++)n[e[r]+"__loading"]=t;return n},requestNesting:function(e,t){if(!e)return;this.nesting_requests||(this.nesting_requests={}),this.nesting_requests[t]||(this.nesting_requests[t]={has_all_items:!1,last_page:0,error:!1,process:!1});var n=this.nesting_requests[t];if(n.process||n.has_all_items)return;var i=t==this.sputnik.main_list_name;this.sputnik.updateState("loading_nesting_"+t,!0),i&&this.sputnik.updateState("main_list_loading",!0);var s=e[0][2],u=e[0][0],a=e[0][1],f=e[1],c=!!a,p=this.sputnik.getPagingInfo(t),d={nocache:n.error};c&&(d.paging=p);var v=h(f,this.sputnik,{has_error:n.error,paging:p},d),m=v.network_api,g=m.source_name;n.process=!0;var y=this;return v.always(function(){n.process=!1,y.sputnik.updateState("loading_nesting_"+t,!1),i&&y.sputnik.updateState("main_list_loading",!1)}).fail(function(){n.error=!0}).done(function(e){var i=y.sputnik,f=m.errors_fields?l(e,m.errors_fields):m.checkResponse(e);if(f)n.error=!0;else{var h=u.call(i,e,i.head_props||o,r),d=typeof a=="function"&&a.call(i,e,p,r);if(!c)n.has_all_items=!0,i.updateState("all_data_loaded",!0);else{var v;d===!0?v=!0:d&&(d.hasOwnProperty("total_pages_num")&&d.hasOwnProperty("page_num")||d.hasOwnProperty("total"))?isNaN(d.total)?d.page_num<d.total_pages_num&&(v=!0):p.current_length+h.length<d.total&&d.total>p.page_limit&&(v=!0):v=h.length==i.page_limit,v||(n.has_all_items=!0,i.updateState("all_data_loaded",!0))}h=p.remainder?h.slice(p.remainder):h,i.nextTick(i.insertDataAsSubitems,[i,t,h,d,g],!0),i.loaded_nestings_items||(i.loaded_nestings_items={}),i.loaded_nestings_items[t]||(i.loaded_nestings_items[t]=0);var b=d===!0||d&&d.has_data_holes===!0;i.loaded_nestings_items[t]+=b?p.page_limit:h?h.length:0;if(s)for(var w=0;w<s.length;w++)i.nextTick(i.handleNetworkSideData,[i,g,s[w][0],s[w][1].call(i,e,p,r)],!0)}}),this.addRequest(v),v}},g}}),define("pv/Eventor",["spv","./FastEventor","./helpers"],function(e,t,n){return function(r){var i=t(r),s=e.inh(function(){},{naming:function(e){return function(){e(this)}},building:function(e){return function(n){e(n),n.evcompanion=new i(n)}},props:{_getCallsFlow:function(){return r},useMotivator:function(e,t,n){var r=e.current_motivator;n=n||this.current_motivator,e.current_motivator=n;var i=t.call(this,e);return e.current_motivator=r,i},nextLocalTick:function(e,t,r,i){return this._getCallsFlow().pushToFlow(e,this,t,!1,n.oop_ext.hndMotivationWrappper,this,r&&this.current_motivator,i)},nextTick:function(e,t,i){return r.pushToFlow(e,this,t,!t&&this,n.oop_ext.hndMotivationWrappper,this,i&&this.current_motivator)},once:function(e,t,n,r){return this.evcompanion.once(e,t,n,r)},on:function(e,t,n,r){return this.evcompanion.on(e,t,n,r)},off:function(e,t,n,r){return this.evcompanion.off(e,t,n,r)},trigger:function(){this.evcompanion.trigger.apply(this.evcompanion,arguments)},addRequest:function(){return this.evcompanion.addRequest.apply(this.evcompanion,arguments)},addRequests:function(){return this.evcompanion.addRequests.apply(this.evcompanion,arguments)},stopRequests:function(){return this.evcompanion.stopRequests.apply(this.evcompanion,arguments)},getRelativeRequestsGroups:function(){},getModelImmediateRequests:function(){return this.evcompanion.getModelImmediateRequests.apply(this.evcompanion,arguments)},setPrio:function(){return this.evcompanion.setPrio.apply(this.evcompanion,arguments)},requestState:function(){return this.evcompanion.requestState.apply(this.evcompanion,arguments)},requestNesting:function(){return this.evcompanion.requestNesting.apply(this.evcompanion,arguments)}}});return e.inh.legInit(s),s}}),define("pv/StatesLabour",["spv"],function(e){var t=function(e,t){this.flow_steps_stev=null,this.flow_steps_vip_stdch_ev=null,this.flow_steps_collch=null,this.flow_steps_stch=null,this.collecting_states_changing=!1,this.original_states={},this.states_changing_stack=[],this.all_i_cg=[],this.changed_states=[],this.total_ch=[],this.stch_states=t?{}:null,this.all_ch_compxs=e?[]:null};return t.prototype.abortFlowSteps=function(e,t,n){var r="flow_steps_"+e;if(!this[r])return;var i=this[r][t];if(!i)return;if(!n)while(i.length){var s=i.shift();s.abort()}else i.abort(),this[r][t]=null;return},t.prototype.createFlowStepsArray=function(e,t,n){var r="flow_steps_"+e;return this[r]||(this[r]={}),n?this[r][t]=n:this[r][t]||(this[r][t]=[]),this[r][t]},t.prototype.removeFlowStep=function(t,n,r){var i="flow_steps_"+t,s=this[i][n];Array.isArray(s)?e.findAndRemoveItem(s,r):s==r?this[i][n]=null:console.log("wrong motivator !?")},t}),define("pv/updateProxy",["./StatesLabour","./helpers","spv"],function(e,t,n){function o(n,i,s){if(n._lbr&&n._lbr.undetailed_states)return u(i,n,a),n;n.zdsv||(n.zdsv=new e(!!n.full_comlxs_index,n._has_stchs));var o=n.zdsv;o.states_changing_stack.push(i,s);if(o.collecting_states_changing)return n;o.collecting_states_changing=!0;var f=o.total_ch,l=o.original_states,p=o.all_i_cg,d=o.all_ch_compxs,v=o.changed_states;while(o.states_changing_stack.length){var m=o.states_changing_stack.shift(),g=o.states_changing_stack.shift();c(n,l,m,g,v),m=g=null;if(n.full_comlxs_index){var y=h(n,l,v);y.length&&r.apply(d,y);var b=y;while(b.length){var E=h(n,l,b);b=E,E.length&&r.apply(d,E),E=null}b=null}v.length&&r.apply(p,v),d&&d.length&&r.apply(p,d),w(p),u(p,n,x,o),p.length&&r.apply(f,p),t.wipeObj(l),p.length=v.length=0,d&&(d.length=0)}return w(f),u(f,n,N,o),n.sendStatesToMPX&&f.length?(n.sendStatesToMPX(f),f.length=0):f.length=0,o.collecting_states_changing=!1,n}function u(e,t,n,r){for(var i=0;i<e.length;i+=3)n(t,i,e[i+1],e[i+2],r)}function a(e,t,n,r){e._lbr.undetailed_states[n]=r}function f(e,t,n){var r=e.zdsv.stch_states[n];if(r!==t){e.zdsv.stch_states[n]=t;var s=e[i(n)]||e.state_change&&e.state_change[n];s(e,t,r)}}function l(e,t,n,r,s,o){var u=!s&&(e[i(n)]||e.state_change&&e.state_change[n]);if(!u)return;e.zdsv.abortFlowSteps("stch",n,!0);var a=e.zdsv.stch_states[n];if(a!==r){var l;u&&(typeof u=="function"?l=u:e.checkDepVP&&e.checkDepVP(u)&&(l=u.fn));if(l)if(!o){var c=e.nextLocalTick(f,[e,r,n],!0,l.finup);c.p_space="stch",c.p_index_key=n,e.zdsv.createFlowStepsArray("stch",n,c)}else f(e,r,n)}}function c(e,t,n,r,i){var s=i||[],o;for(o=0;o<n.length;o+=3)p(e,t,n[o+1],n[o+2],s);e.updateTemplatesStates&&e.updateTemplatesStates(n,r&&r.sync_tpl);for(o=0;o<n.length;o+=3)l(e,t,n[o+1],n[o+2],r&&r.skip_handler,r&&r.sync_tpl);return s}function h(e,t,n){return c(e,t,v(e,n))}function p(e,t,n,r,i){if(n){var s=e.states[n];s!==r&&(t.hasOwnProperty(n)||(t[n]=s),e.states[n]=r,i.push(!0,n,r))}}function d(e){if(!e.full_comlxs_list)return;var t=[];for(var n=0;n<e.full_comlxs_list.length;n++){var r=e.full_comlxs_list[n];t.push(!0,r.name,g(e,r))}return t}function v(e,t){return m(e,t)}function m(e,t){var n=[],r=[],i,s;for(i=0;i<t.length;i+=3){s=e.full_comlxs_index[t[i+1]];if(!s)continue;for(var o=0;o<s.length;o++)n.indexOf(s[o])==-1&&n.push(s[o])}for(i=0;i<n.length;i++)s=n[i],r.push(!0,s.name,g(e,s));return r}function g(e,t){var n=new Array(t.depends_on.length);for(var r=0;r<t.depends_on.length;r++)n[r]=e.state(t.depends_on[r]);return t.fn.apply(e,n)}function y(e,t,n,r,i,s){if(e[r]!==!0){var o=t.length-1-s*3;return t[o-1]=r,t[o]=i,e[r]=!0,!0}}function b(e,t,n){var r=0;for(var i=e.length-1;i>=0;i-=3)n(t,e,i,e[i-1],e[i],r)&&r++;return r}function w(e){var t={},n=b(e,t,y);n*=3;while(e.length!=n)e.shift();return e}function x(e,n,r,i,s){var o=t.getSTEVNameVIP(r);s.abortFlowSteps("vip_stdch_ev",r);var u=e.evcompanion.getMatchedCallbacks(o);if(u.length){var a=s.createFlowStepsArray("vip_stdch_ev",r),f=new E(r,i,s.original_states[r],e);e.evcompanion.triggerCallbacks(u,!1,!1,o,f,a),t.markFlowSteps(a,"vip_stdch_ev",r)}}function T(e,t,n,r,i,s,o){var u=new E(t,n,r,e);e.evcompanion.triggerCallbacks(i,!1,S,s,u,o)}function N(e,n,r,i,s){s.abortFlowSteps("stev",r);var o=e.states_links&&e.states_links[r];if(o)for(var u=0;u<o.length;u++){var a=o[u],f=e._getCallsFlow();f.pushToFlow(null,null,[a,i,s.original_states[r],e],a,a.state_handler,null,e.current_motivator)}var l=t.getSTEVNameDefault(r),c=t.getSTEVNameLight(r),h=e.evcompanion.getMatchedCallbacks(l),p=e.evcompanion.getMatchedCallbacks(c);if(p.length||h.length){var d=s.createFlowStepsArray("stev",r);p.length&&e.evcompanion.triggerCallbacks(p,!1,!1,c,i,d),h.length&&T(e,r,i,s.original_states[r],h,l,d),d&&t.markFlowSteps(d,"stev",r)}}var r=Array.prototype.push,i=n.getPrefixingFunc("stch-"),s=n.getPrefixingFunc("finup-"),E=function(e,t,n,r){this.type=e,this.value=t,this.old_value=n,this.target=r},S={force_async:!0};return o.update=function(e,t,n,r){if(e.hasComplexStateFn(t))throw new Error("you can't change complex state "+t);return o(e,[!0,t,n],r)},o.getComplexInitList=d,o}),define("pv/prsStCon",[],function(){return{toList:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},connect:{parent:function(e){var t=e.conndst_parent;if(!t)return;for(var n=0;n<t.length;n++){var r=t[n],i=r.ancestors,s=e;while(i)i--,s=s.getStrucParent();if(!s)throw new Error;e.wlch(s,r.state_name,r.full_name)}},nesting:function(e){var t=e.conndst_nesting;if(!t)return;if(!e.archivateChildrenStates)throw new Error("cant calculate nesting based complex states for view (only for models)");for(var n=0;n<t.length;n++){var r=t[n];r.state_name}},root:function(e){var t=e.conndst_root;if(!t)return;for(var n=0;n<t.length;n++){var r=t[n],i=e.getStrucRoot();if(!i)throw new Error;e.wlch(i,r.state_name,r.full_name)}}}}}),define("pv/StatesEmitter",["spv","./helpers","jquery","./updateProxy","./StatesLabour","./prsStCon"],function(e,t,n,r,i,s){return function(o){function d(o){var u=function(e,t){this.zdsv||(this.zdsv=new i(!!this.full_comlxs_index,this._has_stchs)),e.p_space="stev",e.p_index_key=t,this.zdsv.createFlowStepsArray("stev",t).push(e)},f=function(){var n=e.getDeprefixFunc("vip_state_change-");return{test:function(e){return!!n(e)},fn:function(e){var t=n(e);return{value:this.state(t),target:this}},getWrapper:function(){return t.oop_ext.hndMotivationWrappper},getFSNamespace:function(e){return n(e)},handleFlowStep:u}}(),c=function(){var n=e.getDeprefixFunc("state_change-");return{test:function(e){return!!n(e)},fn:function(e){var t=n(e);return{value:this.state(t),target:this}},getWrapper:function(){return t.oop_ext.hndMotivationWrappper},getFSNamespace:function(e){return n(e)},handleFlowStep:u}}(),h=function(){var n=e.getDeprefixFunc("lgh_sch-");return{test:function(e){return!!n(e)},fn:function(e){return this.state(n(e))},getWrapper:function(){return t.oop_ext.hndMotivationWrappper},getFSNamespace:function(e){return n(e)},handleFlowStep:u}}(),d=function(e,t){this.context=e,this.immediately=t},m=function(e,t){return e._state_updaters||(e._state_updaters={}),e._state_updaters.hasOwnProperty(t)||(e._state_updaters[t]=function(n){e.updateState(t,n)}),e._state_updaters[t]};o({onDie:function(e){this.on("die",e)},useInterface:function(e,t){var n=this._used_interfaces&&this._used_interfaces[e];if(t!==n){var r=this._unuse_interface_instr&&this._unuse_interface_instr[e];while(r&&r.length)r.shift()();this._used_interfaces&&(this._used_interfaces[e]=null);if(t){if(this._interfaces_to_states_index){var i=this._interfaces_to_states_index[e];if(i){this._unuse_interface_instr||(this._unuse_interface_instr={}),this._unuse_interface_instr[e]||(this._unuse_interface_instr[e]=[]);var s=this._unuse_interface_instr[e];for(var o=0;o<i.length;o++){var u=i[o],a=u.fn.call(null,t,m(this,u.state_name));if(typeof a!="function")throw new Error("you must provide event unbind func");s[o]=a}}}this._used_interfaces||(this._used_interfaces={}),this._used_interfaces[e]=t}}},"regfr-vipstev":f,"regfr-stev":c,"regfr-lightstev":h,getContextOptsI:function(){return this.conx_optsi||(this.conx_optsi=new d(this,!0)),this.conx_optsi},getContextOpts:function(){return this.conx_opts||(this.conx_opts=new d(this)),this.conx_opts},_bindLight:function(e,t,n,r){e.evcompanion._addEventHandler(t,n,this,r),this!=e&&this instanceof v&&this.onDie(function(){if(!e)return;e.off(t,n,!1,this),e=null,n=null})},lwch:function(e,n,r){this._bindLight(e,t.getSTEVNameLight(n),r)},wlch:function(e,n,r){var i=t.getSTEVNameLight(n),s=r||n,o=l(s);this._bindLight(e,i,o)},wch:function(e,n,r,i){var s,o=i?t.getSTEVNameVIP(n):t.getSTEVNameDefault(n);return typeof r=="function"?s=r:(r=r||n,s=a(r)),this._bindLight(e,o,s,i),this},onExtend:p,checkExpandableTree:function(e){var t,r,i,s=!0,o=[];while(this.base_skeleton&&s){s=!1;for(t=0;t<this.base_skeleton.length;t++){r=this.base_skeleton[t],i=this.base_tree_list[r.chunk_num];if(r.handled)continue;if(!r.parent||r.parent.handled)if(!i.needs_expand_state||i.needs_expand_state==e){r.handled=!0;if(i.sample_name)r.node=this.root_view.getSample(i.sample_name);else{if(!i.part_name)throw new Error("how to get node for this?!");r.node=this.requirePart(i.part_name)}s=!0,o.push(r)}}while(o.length){r=o.pop();if(r.parent&&r.parent.node){i=this.base_tree_list[r.chunk_num];var u=i.selector?n(r.parent.node).find(i.selector):n(r.parent.node);i.prepend?u.prepend(r.node):u.append(r.node),i.needs_expand_state&&i.parse_as_tplpart&&this.parseAppendedTPLPart(r.node)}else r.parent?console.log("cant append"):this.c=r.node}}!this.c&&this.base_skeleton[0].node&&(this.c=this.base_skeleton[0].node);if(e&&this.dclrs_expandable&&this.dclrs_expandable[e]){this._lbr.handled_expandable_dclrs||(this._lbr.handled_expandable_dclrs={});if(!this._lbr.handled_expandable_dclrs[e]){this._lbr.handled_expandable_dclrs[e]=!0;for(t=0;t<this.dclrs_expandable[e].length;t++)this.checkCollectionChange(this.dclrs_expandable[e][t]);this.checkChildrenModelsRendering(),this.requestAll()}}},collectBaseExtendStates:function(){var t=e.getDeprefixFunc("$ondemand-");return function(){var e=[],n={},r={};for(var i in this.dclrs_fpckgs)if(t(i)){var s=this.dclrs_fpckgs[i],o=!1;if(s.needs_expand_state){var u=s.needs_expand_state;n[u]||(n[u]=!0,e.push(u)),o||(r[u]||(r[u]=[]),r[u].push(t(i)))}}e.length&&(this.base_tree_expand_states=e,this.dclrs_expandable=r)}}()});var g={},y=function(e,n,r){g[r]||(g[r]=function(e){this.updateState(r,e&&e.value)}),e.on(t.getFullChilChEvName(n),g[r])};o({collectStatesConnectionsProps:function(){this.compx_nest_matches=[];var e={},n={},r={};for(var i=0;i<this.full_comlxs_list.length;i++){var o=this.full_comlxs_list[i];for(var u=0;u<o.depends_on.length;u++){var a=o.depends_on[u],f=t.getEncodedState(a);f&&(f.rel_type=="root"?r[a]||(r[a]=f):f.rel_type=="nesting"?n[a]||(n[a]=f,this.compx_nest_matches.push(f.nwatch)):f.rel_type=="parent"&&(e[a]||(e[a]=f)))}}this.conndst_parent=s.toList(e),this.conndst_nesting=s.toList(n),this.conndst_root=s.toList(r)},compx_check:{},collectCompxs:function(){var n=e.getDeprefixFunc("compx-"),r=t.getPropsPrefixChecker(n),i=function(e){return e},s=function(e,t){return{depends_on:t[0],fn:t[1],name:e}},o=function(e,t){var n=t instanceof Array?s(e,t):t;return n.name=e,n.fn||(n.fn=i),n},u=function(e){for(var t in this){var r=n(t);if(r){var i=this[t];if(!i)continue;var s=o(r,i);e[r]=s,this.full_comlxs_list.push(s)}}},a=function(e){for(var t in this.complex_states)if(!e[t]){var n=this.complex_states[t];if(!n)continue;var r=o(t,n);e[t]=r,this.full_comlxs_list.push(r)}};return function(e){var t=!1;this.hasOwnProperty("complex_states")?t=!0:t=r(e);if(!t)return;var n={};this.full_comlxs_list=[],this.full_comlxs_index={},u.call(this,n),a.call(this,n),this.compx_check=n;var i,s,o,f;for(i=0;i<this.full_comlxs_list.length;i++){o=this.full_comlxs_list[i];for(s=0;s<o.depends_on.length;s++)f=o.depends_on[s],this.full_comlxs_index[f]||(this.full_comlxs_index[f]=[]),this.full_comlxs_index[f].push(o)}this.collectStatesConnectionsProps()}}(),collectRegFires:function(){var n=e.getDeprefixFunc("regfr-",!0),r=t.getPropsPrefixChecker(n);return function(e){if(!r(e))return;var t;this.reg_fires={by_namespace:null,by_test:null,cache:null};for(t in this)if(n(t)){var i=this[t];i.event_name?(this.reg_fires.by_namespace||(this.reg_fires.by_namespace={}),this.reg_fires.by_namespace[i.event_name]=i):i.test&&(this.reg_fires.by_test||(this.reg_fires.by_test=[]),this.reg_fires.by_test.push(i))}}}(),collectStatesBinders:function(){var n=e.getDeprefixFunc("state-"),r=t.getPropsPrefixChecker(n);return function(t){if(!r(t))return;var i;this._interfaces_to_states_index={};var s=[];for(i in this){var o=n(i);if(!o)continue;var u=this[i];s.push({state_name:o,interface_name:u[0],fn:u[1]})}this._interfaces_to_states_index=e.makeIndexByField(s,"interface_name",!0)}}(),state:function(e){return this.states[e]}}),o({updateManyStates:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){if(this.hasComplexStateFn(n))throw new Error("you can't change complex state "+n);t.push(!0,n,e[n])}this._updateProxy(t)},updateState:function(e,t,n){if(this.hasComplexStateFn(e))throw new Error("you can't change complex state in this way");return this._updateProxy([!0,e,t],n)},setStateDependence:function(e,t,n){typeof t=="object"&&(t=t._provoda_id);var r=this.state(e)||{index:{},count:0};r.index[t]=n?!0:!1;var i=0;for(var s in r.index){if(!r.index.hasOwnProperty(s))continue;r.index[s]&&i++}this.updateState(e,{index:r.index,count:i})},hasComplexStateFn:function(e){return this.compx_check[e]},_updateProxy:function(e,t){r(this,e,t)}})}var u={},a=function(e){return u[e]||(u[e]=function(t){this.updateState(e,t.value)}),u[e]},f={},l=function(e){return f[e]||(f[e]=function(t){this.updateState(e,t)}),f[e]},c=function(e){var t,n=[],r=0,i=[null,e];while(i.length){var s=i.shift(),o=i.shift();o.parent=s,o.chunk_num=r;if(o.children_by_selector)for(t=o.children_by_selector.length-1;t>=0;t--)i.push(o,o.children_by_selector[t]);if(o.children_by_anchor)for(t=o.children_by_anchor.length-1;t>=0;t--)i.push(o,o.children_by_anchor[t]);n.push(o),r++}return n},h=[["hp_bound","--data--"],"data_by_urlname","data_by_hp","head_by_urlname","netdata_as_states"],p=function(t){this.collectStateChangeHandlers&&this.collectStateChangeHandlers(t);var n;this.collectCollectionChangeDeclarations&&(n=this.collectCollectionChangeDeclarations(t)),this.collectSelectorsOfCollchs&&this.collectSelectorsOfCollchs(t),this.collectStatesBinders(t),this.collectCompxs(t),this.collectRegFires(t);if(this.hasOwnProperty("st_nest_matches")||this.hasOwnProperty("compx_nest_matches"))this.nest_match=(this.st_nest_matches||[]).concat(this.compx_nest_matches||[]);var r;t.hasOwnProperty("base_tree")&&(r=!0,this.base_tree_list=c(t.base_tree)),(n||r)&&this.collectBaseExtendStates(),this.collectNestingsDeclarations&&this.collectNestingsDeclarations(t),this.changeDataMorphDeclarations&&this.changeDataMorphDeclarations(t),this.changeChildrenViewsDeclarations&&this.changeChildrenViewsDeclarations(t);for(var i=0;i<h.length;i++){var s=h[i],o=Array.isArray(s)?s[0]:s,u=Array.isArray(s)&&s[1];if(t.hasOwnProperty(o)&&typeof this[o]!="function"&&this[o]!==!0){var a={props_map:this[o]};u&&(a.source=u),this[o]=e.mmap(a)}}},v=e.inh(o,{naming:function(e){return function(){e(this)}},building:function(e){return function(n){e(n),n.conx_optsi=null,n.conx_opts=null,n.zdsv=null,n.current_motivator=n.current_motivator||null,n._state_updaters=null,n._used_interfaces=null,n._unuse_interface_instr=null,n.states={}}},onExtend:function(e,t,n){p.call(e,t,n)},props:d});return e.inh.legInit(v),v}}),define("pv/FlowStep",[],function(){var e=function(e,t,n,r,i,s,o,u,a){this.aborted=!1,this.p_space="",this.p_index_key="",this.num=e,this.fn=t,this.context=n,this.args=r,this.arg=i||null,this.cb_wrapper=s||null,this.real_context=o,this.finup=!!a||null,this.complex_order=u&&u.complex_order.slice()||[],this.complex_order.push(this.num);if(!this.fn&&!this.cb_wrapper)throw new Error("how to handle this step!?")};return e.prototype.abort=function(){this.aborted=!0,this.num=null,this.fn=null,this.context=null,this.args=null,this.arg=null,this.cb_wrapper=null,this.real_context=null},e.prototype.call=function(){this.cb_wrapper?this.cb_wrapper.call(this.real_context,this,this.fn,this.context,this.args,this.arg):this.args?this.args.length>1?this.fn.apply(this.context,this.args):this.fn.call(this.context,this.args[0]):this.fn.call(this.context,this.arg)},e}),define("pv/CallbacksFlow",["./FlowStep","spv"],function(e,t){var n=function(e,t){if(e.aborted&&t.aborted)return;if(e.aborted)return-1;if(t.aborted)return 1;if(!e.finup||!t.finup){if(e.finup)return 1;if(t.finup)return-1}var n;n=Math.max(e.complex_order.length,t.complex_order.length);for(var r=0;r<n;r++){var i=e.complex_order[r],s=t.complex_order[r];if(typeof i=="undefined"&&typeof s=="undefined")return;if(typeof i=="undefined")return-1;if(typeof s=="undefined")return 1;if(i>s)return 1;if(i<s)return-1}},r=function(e){return e.setImmediate||function(){var t={func:null,next:null},n=t,r=Math.random(),i=function(e){if(e.data!=r)return;t=t.next;var n=t.func;t.func=null,n()};return e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),e.postMessage?function(t){if(!e||e.closed)return;n=n.next={func:t,next:null},e.postMessage(r,"*")}:function(e){setTimeout(e,0)}}()},i=function(e){var t;if(e.requestAnimationFrame)t=e.requestAnimationFrame;else{var n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!t;++r)t=e[n[r]+"RequestAnimationFrame"]}return t&&function(n){return t.call(e,n)}},s=function(e,t,n){this.flow=[],this.busy=null,this.iteration_time=n||250,this.iteration_delayed=null,this.flow_steps_counter=1,this.flow_steps_collating_invalidated=null;var s=this;this.hndIterateCallbacksFlow=function(){s.iterateCallbacksFlow()};var o=t&&i(e);if(o)this.pushIteration=function(e){return o(e)};else{var u=r(e);this.pushIteration=function(e){return u(e)}}};return s.prototype={iterateCallbacksFlow:function(){var e=Date.now()+this.iteration_time;this.iteration_delayed=!1,this.callbacks_busy=!0;while(this.flow.length){if(Date.now()>e){this.pushIteration(this.hndIterateCallbacksFlow);break}var t;typeof this.flow_steps_collating_invalidated=="number"&&(t=this.flow[0],this.flow_steps_collating_invalidated<=t.complex_order[0]&&(this.flow_steps_collating_invalidated=null,this.flow.sort(n))),t=this.flow.shift(),t.aborted||t.call()}this.flow.length||(this.callbacks_busy=!1)},checkCallbacksFlow:function(){!this.iteration_delayed&&!this.callbacks_busy&&(this.pushIteration(this.hndIterateCallbacksFlow),this.iteration_delayed=!0)},pushToFlow:function(r,i,s,o,u,a,f,l){var c=new e(++this.flow_steps_counter,r,i,s,o,u,a,f,l);if(f){var h=this.flow[this.flow.length-1],p=h&&n(h,c);if(p===1){var d=-1;for(var v=0;v<this.flow.length;v++){var m=this.flow[v],g=n(m,c);if(g!=-1)break;d=v}t.insertItem(this.flow,c,d+1)}else this.flow.push(c)}else this.flow.push(c);return this.checkCallbacksFlow(),c}},s}),define("pv/provoda.initDeclaredNestings",[],function(){var e=function(e,t){var n=e.getNesting(t);if(!n)return;if(Array.isArray(n))for(var r=0;r<n.length;r++){var i=n[r];i.preloadStart&&i.preloadStart()}else n.preloadStart&&n.preloadStart()},t=function(t,n,r){t.on("lgh_sch-"+n,function(n){n&&e(t,r)})},n=function(e,t,n,r){var i;if(n.states){i="";for(var s=0;s<n.clean_string_parts.length;s++){i+=n.clean_string_parts[s];var o=n.states[s];o&&(i+=t._provoda_id&&e.encodeURLPart(t.state(o)||"")||"null")}}else i=n.full_usable_string;return e.routePathByModels(i,n.from_root?e.start_page:t,r)},r=/\[\:.+?\]/gi,i={},s=function(e){if(!i[e]){var t=e.charAt(0)=="#",n=t?e.slice(1):e,s=n.split(r),o=n.match(r);if(o)for(var u=0;u<o.length;u++)o[u]=o[u].slice(2,o[u].length-1);i[e]={from_root:t,clean_string_parts:s,states:o,full_usable_string:n}}return i[e]},o=function(e,t,r,i){var o=s(r);return n(e,t,o,i)},u=function(e,t){return typeof t=="function"?e.initSi(t):o(e.app,e,t)},a=function(e,t){var n;if(Array.isArray(t)){n=new Array(t);for(var r=0;r<t.length;r++)n[r]=u(e,t[r])}else n=u(e,t);return n},f=function(n,r){var i=r.preload&&(typeof r.preload=="string"?r.preload:"mp_has_focus");if(r.init_state_name){var s=function(t){t&&(this.updateNesting(r.nesting_name,a(this,r.subpages_names_list)),i&&this.state(i)&&e(this,r.nesting_name),n.off("lgh_sch-"+r.init_state_name,s))};n.on("lgh_sch-"+r.init_state_name,s)}else n.updateNesting(r.nesting_name,a(n,r.subpages_names_list));r.preload&&t(n,i,r.nesting_name)},l=function(e){for(var t=0;t<e.nestings_declarations.length;t++)f(e,e.nestings_declarations[t])};return l.getConstrByPath=function(e,t,n){return o(e,t,n,!0)},l}),define("pv/Model",["spv","./StatesLabour","./helpers","./MDProxy","./provoda.initDeclaredNestings","./prsStCon","./updateProxy"],function(e,t,n,r,i,s,o){return function(u,a,f,l){function M(){}var c=Array.prototype.push,h=o.getComplexInitList,p=function(e,t){var n={};if(e.controls_list.length)for(var r=0;r<e.controls_list.length;r++){var i=e.controls_list[r],s=e.items_list[r];t.length&&t.indexOf(s)!=-1?n[s._provoda_id||s.view_id]=i:s.evcompanion.off(i.namespace,i.cb,i)}return n},d=function(t){var n=this.current_motivator;this.current_motivator=this.current_motivator,t=e.toRealArray(t);var r=p(this,t);this.items_list=t,this.controls_list.length=0,this.controls_list.length=t.length;for(var i=0;i<t.length;i++){var s=t[i],o=s.current_motivator;s.current_motivator=this.current_motivator;var u=s._provoda_id||s.view_id;r.hasOwnProperty(u)?this.controls_list[i]=r[u]:this.controls_list[i]=s.evcompanion._addEventHandler(this.event_name,this.event_callback,this,!1,!1,!0,!1,!1,!0),s.current_motivator=o}this.current_motivator=n},v=function(e,t,n){this.items_list=null,this.md=t,this.controls_list=[],this.event_name=e,this.callback=n,this.current_motivator=null};v.prototype={event_callback:function(e){var t=this.md.current_motivator;this.md.current_motivator=this.current_motivator,this.callback.call(this.md,{target:this.md,item:e&&e.target,value:e&&e.value,items:this.items_list}),this.md.current_motivator=t},setItemsReal:d,setItems:function(t){this.setItemsReal(t&&e.toRealArray(t)),this.event_callback()}};var m=function(e){return e},g=function(e){return!!e.every(b)},y=function(e){return!!e.some(b)},b=function(e){return e},w=function(e,t,n,r){this.items_list=null,this.controls_list=[],this.current_motivator=null,this.md=n,this.result_state_name=t,this.state_name=e,this.event_name="lgh_sch-"+this.state_name;var i=r;i?typeof i=="function"?this.calculate_result=i:i=="some"?this.calculate_result=y:i=="every"?this.calculate_result=g:i=="one"&&(this.calculate_result=m):this.calculate_result=y};w.prototype={event_callback:function(){this.getItemsValues()},setResult:function(e){var t=this.md.current_motivator;this.md.current_motivator=this.current_motivator,this.md.updateState(this.result_state_name,e),this.md.current_motivator=t},getItemsValues:function(){if(this.calculate_result==m){var e=this.items_list[0],t=e&&e.state(this.state_name);this.setResult(t)}else{var n=new Array(this.items_list.length);for(var r=0;r<this.items_list.length;r++)n[r]=this.items_list[r].state(this.state_name);this.setResult(this.calculate_result.call(this,n))}},setItemsReal:d,setItems:function(t){this.setItemsReal(t&&e.toRealArray(t)),this.event_callback()}};var E=function(e,n){this.zdsv||(this.zdsv=new t(!!this.full_comlxs_index,this._has_stchs)),e.p_space="collch",e.p_index_key=n,this.zdsv.createFlowStepsArray("collch",n).push(e)},S=function(){return this.md},x={},T=function(e){this.map_parent=e,this.app=e.app},N=function(e){var t=e._provoda_id;return x[t]||(x[t]=new T(e)),x[t]},C=function(e,t){if(typeof t[0]=="string")e.api_names.push(t[0]);else{var n=t[0].call();if(!n.source_name)throw new Error("no source_name");e.sources_names.push(n.source_name)}},k=function(t,n){if(!n.api_names_converted){n.api_names_converted=!0;for(var r=0;r<n.api_names.length;r++){var i=n.api_names[r],s;typeof i=="string"?s=e.getTargetField(t.app,i):typeof i=="function"&&(s=i.call(t));if(!s.source_name)throw new Error("network_api must have source_name!");n.sources_names.push(s.source_name)}}},L=e.memorize(function(t){if(t.indexOf("@")==-1)return!1;var n=t.split("@");return{state:n[0],selector:n[1].split(".")}}),A=function(){function b(e,t,n){return(e||"")+"-"+(t||"")+"-"+(n||"")}function w(e){return function(n,i,s,o,u){r(u);var a=u.md,f=a.current_motivator;a.current_motivator=n;var l=u.one_item_mode?u.state_name?[u.one_item]:u.one_item:u.items;e(a,l,u,o,n,i,s),a.current_motivator=f}}var t=0,r=function(e){if(!e.items_changed)return;e.items_changed=!1,e.items&&(e.items.length=0);if(e.one_item_mode)return e;e.items||(e.items=[]);for(var t in e.items_index){if(!e.items_index[t])continue;e.items.push(e.items_index[t])}return e},u=n.state,f=o.update,l=e.memorize(function(e){return function(t){return u(t,e)}}),c=function(e){return function(t){return e(l(t))}},h=function(t){return e.memorize(c(t))},p=h(function(e){return function(t){return t&&t.map(e)}}),d=h(function(e){return function(t){return t.some(e)}}),v=h(function(e){return function(t){return t.every(e)}}),m=h(function(e){return function(t){return t[0]&&e(t[0])}}),g=function(e){return Array.isArray(e)?e.slice(0):e},y=e.memorize(function(e,t){if(!e)return g;if(!t)return p(e);switch(t){case"one":return m(e);case"some":return d(e);case"every":return v(e);default:throw new Error("unknow zip func "+t)}},function(e,t){return(e||"")+"-"+(t||"")}),E=w(function(t,n,r){var i=r.callback;i(t,null,null,{items:n,item:null})}),S=e.memorize(function(e,t,n){var r=y(t,n);return w(function(n,i){f(n,e,i&&r(i))})},b),x=w(function(t,n,r,i){if(!i.length)return;var s=r.callback;s(t,i[1],i[2],{items:n,item:i[3]})}),T=function(e,n){this.num=++t,this.selector=n.selector;var r=n.full_name;this.md=e,this.state_name=n.state_name,this.items_changed=!1,this.items_index=null,this.items=null,this.one_item=null,this.one_item_mode=!1,this.state_handler=n.state_handler,this.zip_name=n.zin_func,this.distance=0,this.callback=n.handler;var i=r&&S(r,this.state_name,this.zip_name);this.state_handler=this.state_name?r?i:x:null,this.handler=r?i:E,!r,!this.handler,this.nwatch=n};return function(t,n,r,o,u){t&&t.app&&(this.app=t.app),this.app||(this.app=null),t&&t.map_parent&&(this.map_parent=t.map_parent),this.map_parent||(this.map_parent=null),this._super(),this.req_order_field=null,this.states_links=null,this._provoda_id=O++,a[this._provoda_id]=this,this.children_models=null,this._network_source=this._network_source||null,this.md_replacer=null,this.mpx=null,this.init_states=this.init_states||null;if(u||n&&n.states)this.init_states||(this.init_states={}),e.cloneObj(this.init_states,u),n&&n.states&&e.cloneObj(this.init_states,n.states);this.head=null,this.map_parent&&this.map_parent.head&&(this.head||(this.head={}),e.cloneObj(this.head,this.map_parent.head)),n&&n.head&&(this.head||(this.head={}),e.cloneObj(this.head,n.head));if(this.network_data_as_states&&n&&n.network_states){this.init_states||(this.init_states={}),e.cloneObj(this.init_states,n.network_states);if(this.net_head){this.head||(this.head={});for(var f=0;f<this.net_head.length;f++){var l=this.net_head[f];this.head[l]=n.network_states[l]}}}this.head&&(this.init_states||(this.init_states={}),e.cloneObj(this.init_states,this.head)),s.connect.parent(this),s.connect.root(this),s.connect.nesting(this),this.nestings_declarations&&this.nextTick(function(e){i(e)}),this.nes_match_index=null;if(this.nest_match)for(var f=0;f<this.nest_match.length;f++)this.addNestWatch(new T(this,this.nest_match[f]),0);return this.manual_states_init||this.initStates(),this}}(),O=1;return u.extendTo(M,function(s){function g(e,t,n,r){if(e.nes_match_index&&e.nes_match_index[t]){var i=e.nes_match_index[t];if(Array.isArray(r))for(var s=0;s<r.length;s++){if(!r[s])continue;d(r[s],i)}else r&&d(n,i,!0);if(Array.isArray(n))for(var s=0;s<n.length;s++){if(!n[s])continue;m(n[s],i)}else n&&m(n,i,!0)}}function y(e,t){if(e.nes_match_index&&e.nes_match_index[t]){var n=e.nes_match_index[t],r=[];for(var i=0;i<n.length;i++){var s=n[i].nwatch;s.items_changed&&r.push(s)}return r.length&&r}}s({getNonComplexStatesList:function(t){if(!this.hasComplexStateFn(t))return t;var n=[];for(var r=0;r<this.compx_check[t].depends_on.length;r++){var i=this.compx_check[t].depends_on[r];if(i==t)continue;n.push(this.getNonComplexStatesList(i))}return e.collapseAll.apply(null,n)},getNestingSource:function(e,t){e=n.getRightNestingName(this,e);var r=this["nest_req-"+e],i=r&&n.getNetApiByDeclr(r[1],this,t);return i&&i.source_name},getStateSources:function(e,t){var r=n.getEncodedState(e);if(r&&r.rel_type=="nesting")return this.getNestingSource(r.nesting_name,t);var i=n.getReqMapsForState(this.req_map,e);if(i){var s=new Array(i.length/2);for(var o=0;o<i.length;o+=2){var u=i[o+1],a=n.getNetApiByDeclr(u[2],this,t);s[o/2]=a.source_name}return s}},collectStateChangeHandlers:function(){var t=e.getDeprefixFunc("stch-"),r=n.getPropsPrefixChecker(t),i=n.NestWatch;return function(e){var n=!1;if(e.state_change||r(e))n=!0;if(!n)return;var s={};for(var o in this.state_change)s[o]=this.state_change[o];for(var u in this)if(t(u)){var a=t(u);s[a]=this[u]}this.st_nest_matches=[];for(var f in s){if(!s[f])continue;var l=L(f);if(!l)continue;this.st_nest_matches.push(new i(l.selector,l.state,null,null,s[f]))}this._has_stchs=!0}}(),collectNestingsDeclarations:function(){var t=e.getDeprefixFunc("nest-"),r=n.getPropsPrefixChecker(t);return function(e){var n=r(e),i=this.hasOwnProperty("nest"),s,o,u;if(n||i){var a=[],f={};if(n)for(s in this)t(s)&&(u=t(s),o=this[s],f[u]=!0,a.push({nesting_name:u,subpages_names_list:o[0],preload:o[1],init_state_name:o[2]}));if(i)for(u in this.nest){if(f[u])continue;o=this.nest[u],f[u]=!0,a.push({nesting_name:u,subpages_names_list:o[0],preload:o[1],init_state_name:o[2]})}this.nestings_declarations=a}}}(),changeDataMorphDeclarations:function(){var t=e.getDeprefixFunc("nest_req-",!0),r=n.getPropsPrefixChecker(t);return function(n){var i,s,o=!1;if(n.hasOwnProperty("req_map")){this.netsources_of_states={api_names:[],api_names_converted:!1,sources_names:[]},o=!0;for(i=0;i<n.req_map.length;i++)s=n.req_map[i][1],typeof s!="function"&&(n.req_map[i][1]=e.mmap(s)),C(this.netsources_of_states,n.req_map[i][2])}var u=r(n);if(u){this.has_reqnest_decls=!0,this.netsources_of_nestings={api_names:[],api_names_converted:!1,sources_names:[]},o=!0;for(var a in n)if(n.hasOwnProperty(a)&&t(a)){s=n[a],typeof s[0][0]!="function"&&(s[0][0]=e.mmap(s[0][0])),s[0][1]&&s[0][1]!==!0&&typeof s[0][1]!="function"&&(s[0][1]=e.mmap(s[0][1]));var f=s[0][2];if(f)for(i=0;i<f.length;i++){var l=f[i];typeof l[1]!="function"&&(l[1]=e.mmap(l[1]))}C(this.netsources_of_nestings,s[1])}}o&&(this.netsources_of_all={nestings:this.netsources_of_nestings,states:this.netsources_of_states})}}(),getNetworkSources:function(){if(!this.netsources_of_all)return;return this.netsources_of_all.done||(this.netsources_of_all.done=!0,this.netsources_of_all.full_list=[],this.netsources_of_all.nestings&&(k(this,this.netsources_of_all.nestings),c.apply(this.netsources_of_all.full_list,this.netsources_of_all.nestings.sources_names)),this.netsources_of_all.states&&(k(this,this.netsources_of_all.states),c.apply(this.netsources_of_all.full_list,this.netsources_of_all.states.sources_names))),this.netsources_of_all.full_list},"regfr-childchev":function(){var t=e.getDeprefixFunc("child_change-");return{test:function(e){return t(e)},fn:function(e){var n=t(e),r=this.getNesting(n);if(r)return{value:r,target:this,nesting_name:n}},getWrapper:function(){return n.oop_ext.hndMotivationWrappper},getFSNamespace:function(e){return t(e)},handleFlowStep:E}}(),getStrucRoot:function(){return this.app},getStrucParent:function(){return this.map_parent},getSiOpts:function(){return N(this)},initSi:function(e,t,n){var r=new e,i=this.getSiOpts();return this.useMotivator(r,function(e){e.init(i,t,n)}),r},init:A,removeNestWatch:function(t,n){if(t.selector.length==n){if(!t.items_index)return;t.items_index[this._provoda_id]=null,t.items_changed=!0,t.one_item_mode&&t.one_item==this&&(t.one_item=null),this.states_links&&this.states_links[t.state_name]&&(this.states_links[t.state_name]=e.findAndRemoveItem(this.states_links[t.state_name],t))}else{var r=t.selector[n];this.nes_match_index&&this.nes_match_index[r]&&(this.nes_match_index[r]=e.findAndRemoveItem(this.nes_match_index[r],t))}},addNestWatch:function(){var e=function(e,t,n){this.holder_id=n,this.nwatch=e,this.skip=t};return function(t,n){this.nes_match_handeled||(this.nes_match_handeled={});if(!!this.nes_match_handeled[t.num])return;this.nes_match_handeled[t.num]=!0;if(t.selector.length==n)t.items_index||(t.items_index={}),t.items_index[this._provoda_id]=this,t.items_changed=!0,t.one_item_mode&&(t.one_item=this),this.states_links||(this.states_links={}),this.states_links[t.state_name]||(this.states_links[t.state_name]=[]),this.states_links[t.state_name].push(t);else{this.nes_match_index||(this.nes_match_index={});var r=t.selector[n];this.nes_match_index[r]||(this.nes_match_index[r]=[]),this.nes_match_index[r].push(new e(t,n));if(this.children_models)for(var r in this.children_models)g(this,r,this.children_models[r])}}}(),mapStates:function(t,n,r){if(r&&typeof r=="boolean"){if(this.init_states===!1)throw new Error("states inited already, you can't init now");this.init_states||(this.init_states={}),r=this.init_states}return e.mapProps(t,n,r)},initState:function(e,t){if(this.init_states===!1)throw new Error("states inited already, you can't init now");if(this.hasComplexStateFn(e))throw new Error("you can't change complex state "+e);this.init_states||(this.init_states={}),this.init_states[e]=t},initStates:function(t){if(this.init_states===!1)throw new Error("states inited already, you can't init now");t&&(this.init_states||(this.init_states={}),e.cloneObj(this.init_states,t));var n=h(this)||this.init_states&&[];if(this.init_states)for(var r in this.init_states){if(!this.init_states.hasOwnProperty(r))continue;if(this.hasComplexStateFn(r))throw new Error("you can't change complex state "+r);n.push(!0,r,this.init_states[r])}n&&n.length&&o(this,n),this.init_states=!1},network_data_as_states:!0,onExtend:function(){var t=/initStates/gi,n=A;return e.precall(u.prototype.onExtend,function(e,r){e.init&&e.init!==n&&(this.hasOwnProperty("network_data_as_states")||(this.network_data_as_states=!1),e.init.toString().search(t)!=-1&&(this.manual_states_init=!0))})}(),getConstrByPathTemplate:function(e,t){return i.getConstrByPath(e,this,t)},connectMPX:function(){return this.mpx||(this.mpx=new r(this._provoda_id,this.states,this.children_models,this)),this.mpx},getReqsOrderField:function(){return this.req_order_field||(this.req_order_field=["mdata","m",this._provoda_id,"order"]),this.req_order_field},getMDReplacer:function(){if(!this.md_replacer){var e=function(){};e.prototype.md=this,e.prototype.getMD=S,this.md_replacer=new e,this.md_replacer._provoda_id=this._provoda_id}return this.md_replacer},RPCLegacy:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();this.rpc_legacy&&this.rpc_legacy[t]?this.rpc_legacy[t].apply(this,e):this[t].apply(this,e)},die:function(){return this.stopRequests(),f.killMD(this),n.triggerDestroy(this),a[this._provoda_id]=null,this}});var p=function(e){this.setItems(e.value,e.target.current_motivator)},d=function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];i.nwatch.one_item_mode=!!n,e.removeNestWatch(i.nwatch,i.skip+1)}},m=function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];i.nwatch.one_item_mode=!!n,e.addNestWatch(i.nwatch,i.skip+1)}};s({watchChildrenStates:function(e,t,r){var i=new v(n.getSTEVNameDefault(t),this,r);this.on(n.getFullChilChEvName(e),p,null,i)},archivateChildrenStates:function(e,t,r,i){var s=new w(t,i||t,this,r);this.on(n.getFullChilChEvName(e),p,null,s)},getRelativeRequestsGroups:function(t,n){var r=[],i=[],s=0,o=null;for(var u in this.children_models){o=this.children_models[u];if(!o)continue;Array.isArray(o)?r.push.apply(r,o):r.push(o)}var a=e.getArrayNoDubs(r);if(n)return a;for(s=0;s<a.length;s++){var f=a[s].getModelImmediateRequests(t);f&&f.length&&i.push(f)}return i},getNesting:function(e){return this.children_models&&this.children_models[e]},updateNesting:function(r,i,s,o){if(r.indexOf(".")!=-1)throw new Error('remove "." (dot) from name');var u=this.zdsv;u&&u.abortFlowSteps("collch",r),Array.isArray(i)&&(i=i.slice(0)),this.children_models||(this.children_models={});var a=this.children_models[r];this.children_models[r]=i;if(a&&i){var f=Array.isArray(a),l=Array.isArray(i);if(f!=l)throw new Error("nest type must be stable")}var c=n.getRemovedNestingItems(i,a);g(this,r,i,c);var h=y(this,r),p=this._getCallsFlow();if(h)for(var d=0;d<h.length;d++){var v=h[d];p.pushToFlow(null,null,null,v,v.handler,null,this.current_motivator)}var m=n.getFullChilChEvName(r),b=this.evcompanion.getMatchedCallbacks(m);if(b.length){this.zdsv||(this.zdsv=new t(!!this.full_comlxs_index,this._has_stchs)),u=this.zdsv;var w=u.createFlowStepsArray("collch",r),E={value:null,old_value:null,target:null,nesting_name:r};typeof s=="object"&&e.cloneObj(E,s),E.value=i,E.old_value=a,E.target=this,this.evcompanion.triggerCallbacks(b,!1,!1,m,E,w),n.markFlowSteps(w,"collch",r)}return(!s||!s.skip_report)&&this.sendCollectionChange(r,i,a,c),this},sendCollectionChange:function(e,t,n,r){l.pushNesting(this,e,t,n,r),f.pushNesting(this,e,t,n,r),this.mpx&&this.mpx.sendCollectionChange(e,t,n,r)},sendStatesToMPX:function(e){var t=e.slice();l.pushStates(this,t),f.pushStates(this,t),this.mpx&&this.mpx.stackReceivedStates(t)}});var b;(function(){var t=function(e,t,n,r){if(!e)return;var i=e._provoda_id;if(typeof i=="undefined")return;return!t[i]&&!n[i]&&(n[i]=!0,r.push(e)),i};b=function(n,r){r=r||{},n=n||{};var i=[],s=[this];while(s.length){var o=s.shift(),u=!n[o._provoda_id];u&&(n[o._provoda_id]=!0),t(o.map_parent,n,r,s);for(var a in o.states)t(o.states[a],n,r,s);for(var f in o.children_models){var l=o.children_models[f];if(l)if(l._provoda_id)t(l,n,r,s);else{var c;if(Array.isArray(l))c=l;else{c=e.getTargetField(l,"residents_struc.all_items");if(!c)throw new Error('you must provide parsable array in "residents_struc.all_items" prop')}for(var h=0;h<c.length;h++)t(c[h],n,r,s)}}u&&i.push(o)}return i}})();var x;(function(){var t=function(e,t,n,r){var i=e._provoda_id;return!t[i]&&!n[i]&&(n[i]=!0,r.push(e)),i};x=function(n,r){n=n||{};var i={},s=[this];r=r||[];while(s.length){var o=s.shift(),u=!n[o._provoda_id];u&&(n[o._provoda_id]=!0);var a={_provoda_id:o._provoda_id,model_name:o.model_name,states:e.cloneObj({},o.states),map_parent:o.map_parent&&t(o.map_parent,n,i,s),children_models:{},map_level_num:o.map_level_num,mpx:null};for(var f in a.states){var l=a.states[f];l&&l._provoda_id&&(a.states[f]={_provoda_id:t(l,n,i,s)})}for(var c in o.children_models){var h=o.children_models[c];if(h)if(h._provoda_id)a.children_models[c]=t(h,n,i,s);else{var p=new Array(h.length);for(var d=0;d<h.length;d++)p[d]=t(h[d],n,i,s);a.children_models[c]=p}}u&&r.push(a)}return r}})(),s({getLinedStructure:b,toSimpleStructure:x})}),M}}),define("pv/View",["spv","./helpers","jquery","./updateProxy","./prsStCon"],function(e,t,n,r,i){var s=r.update,o=t.$v;return function(u,a,f){function y(){}var l=Array.prototype.push,c=function(){},h=function(e){var t=new Array(e.length);for(var n=0;n<e.length;n++)t[n]={handled:!1,node:null,parent:e[n].parent&&t[e[n].parent.chunk_num]||null,chunk_num:e[n].chunk_num};return t},p=function(){this.has_details=null,this._detailed=null,this.dettree_incomplete=null,this.detltree_depth=null,this._states_set_processing=null,this._collections_set_processing=null,this.dclrs_fpckgs_is_clonned=!1,this.innesting_pos_current=null,this.innest_prev_view=null,this.innest_next_view=null,this.demensions_key_start=null,this.handled_expandable_dclrs=null,this._anchor=null,this.detached=null,this.hndTriggerTPLevents=null,this.hndPvTypeChange=null,this.hndPvTreeChange=null,this.marked_as_dead=null,this.undetailed_states={},this.undetailed_children_models={}},d=function(e){if(!e.value)return;this.checkExpandableTree(e.type)},v=function(e,t,n){return a.pushToFlow(e,t,n)},m=1,g=0;return u.extendTo(y,{init:function(n,r){this._lbr=new p,this.req_order_field=null,this.tpl=null,this.c=null,this.dead=null,this.pv_view_node=null,this.dclrs_fpckgs=this.dclrs_fpckgs,this.base_skeleton=null,this.nesting_space=n.nesting_space,this.nesting_name=n.nesting_name,this.base_tree_list&&(this.base_skeleton=h(this.base_tree_list)),this.view_id=m++,this.parent_view=null,n.parent_view&&(this.parent_view=n.parent_view),this.root_view=null,n.root_view&&(this.root_view=n.root_view),this.opts=null,r&&(this.opts=r),this._super(),this.children=[],this.children_models={},this.view_parts=null;if(this.parent_view&&!n.location_name)throw new Error("give me location name!");this.location_name=n.location_name;if(!n.mpx)throw new Error("give me model!");this.mpx=n.mpx,this.proxies_space=n.proxies_space||null,this.way_points=null,this.dom_related_props=null,this.dom_rp&&(this.dom_related_props=[]),e.cloneObj(this._lbr.undetailed_states,this.mpx.states),e.cloneObj(this._lbr.undetailed_states,this.mpx.vstates),e.cloneObj(this._lbr.undetailed_children_models,this.mpx.nestings);if(this.base_tree_expand_states)for(var s=0;s<this.base_tree_expand_states.length;s++)this.on(t.getSTEVNameDefault(this.base_tree_expand_states[s]),d);return i.connect.parent(this),i.connect.root(this),this},handleTemplateRPC:function(e){if(arguments.length===1){var t=o.getBwlevView(this),n=t&&t.mpx._provoda_id;this.RPCLegacy(e,n)}else this.RPCLegacy.apply(this,arguments)},requestPage:function(){var e=o.getBwlevView(this),t=this.mpx._provoda_id;e.RPCLegacy("requestPage",t)},tpl_events:{requestPage:function(){this.requestPage()},followTo:function(){var e=o.getBwlevView(this),t=this.mpx._provoda_id;e.RPCLegacy("followTo",t)}},onExtend:e.precall(u.prototype.onExtend,function(t,n){t.tpl_events&&(this.tpl_events={},e.cloneObj(this.tpl_events,n.tpl_events),e.cloneObj(this.tpl_events,t.tpl_events)),t.tpl_r_events&&(this.tpl_r_events={},e.cloneObj(this.tpl_r_events,n.tpl_r_events),e.cloneObj(this.tpl_r_events,t.tpl_r_events))}),"stch-map_slice_view_sources":function(e,t){if(t&&e.parent_view.parent_view==e.root_view&&e.parent_view.nesting_name=="map_slice"){var n=[];t[0]&&n.push(t[0]),l.apply(n,t[1][e.nesting_space]),s(e,"view_sources",n)}},_getCallsFlow:function(){return this.root_view&&this.root_view._getCallsFlow!=this._getCallsFlow&&this.root_view._getCallsFlow()||a},getStrucRoot:function(){return this.root_view},getStrucParent:function(){return this.parent_view},getNesting:function(e){return this.children_models[e]},getWindow:function(){return e.getDefaultView(this.d||this.getC()[0].ownerDocument)},demensions_cache:{},checkDemensionsKeyStart:function(){if(!this._lbr.demensions_key_start){var e=[],t=this;while(t.parent_view)e.push(t.location_name),t=t.parent_view;e.reverse(),this._lbr.demensions_key_start=e.join(" ")}},getBoxDemensionKey:function(){var e=new Array(arguments.length);for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return this.checkDemensionsKeyStart(),this._lbr.demensions_key_start.concat(e.join("-"))},getBoxDemensionByKey:function(e,t){return typeof this.demensions_cache[t]=="undefined"&&(this.demensions_cache[t]=e.call(this)),this.demensions_cache[t]},getBoxDemension:function(e){var t=new Array(arguments.length-1);for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.getBoxDemensionKey.apply(this,t);return this.getBoxDemensionByKey(e,r)},getReqsOrderField:function(){return this.req_order_field||(this.req_order_field=["mdata","v",this.view_id,"order"]),this.req_order_field},getStoredMpx:function(e){return e.stream?e.mpx:f.getMPX(this.root_view.proxies_space,e)},RPCLegacy:function(){this.mpx.RPCLegacy.apply(this.mpx,arguments)},children_views:{},canUseWaypoints:function(){return!0},canUseDeepWaypoints:function(){return!0},getWaypoints:function(e){if(!e)throw new Error("you must apply result array");this.canUseWaypoints()&&this.way_points&&l.apply(e,this.way_points)},getAllWaypoints:function(e){if(!e)throw new Error("you must apply result array");this.getWaypoints(e),this.getDeepWaypoints(e)},getDeepWaypoints:function(e){if(!e)throw new Error("you must apply result array");if(this.canUseWaypoints()&&this.canUseDeepWaypoints())for(var t=0;t<this.children.length;t++){var n=this.children[t];n.getAllWaypoints(e)}},addWayPoint:function(e,t){var n={node:e,canUse:t&&t.canUse,simple_check:t&&t.simple_check,view:this,wpid:++g};return!t||!t.simple_check&&!t.canUse,this.way_points||(this.way_points=[]),this.way_points.push(n),n},hasWaypoint:function(t){if(!this.way_points)return;var n=e.filter(this.way_points,"node");return n.indexOf(t)!=-1},removeWaypoint:function(e){if(!this.way_points)return;var t=[];for(var n=0;n<this.way_points.length;n++){var r=this.way_points[n];r.node!=e?t.push(r):r.removed=!0}this.way_points=t},getTemplate:function(e,t,n,r){return this.root_view.pvtemplate(e,t,n,!1,r)},parseAppendedTPLPart:function(e){this.tpl.parseAppended(e),this.tpl.setStates(this.states)},createTemplate:function(e){var t=e||this.c;if(!t)throw new Error("cant create template");var n=o.createTemplate(this,t);return e||(this.tpl=n),n},addTemplatedWaypoint:function(e){if(!this.hasWaypoint(e.node)){var t;e.marks["hard-way-point"]?t="hard-way-point":e.marks["way-point"]&&(t="way-point"),this.addWayPoint(e.node,{canUse:function(){return!!e.marks&&!!e.marks[t]},simple_check:t=="hard-way-point"})}},updateTemplatedWaypoints:function(t,n){if(!this.isAlive())return;var r=0;if(n){var i=e.filter(n,"node");for(r=0;r<i.length;r++)this.removeWaypoint(i[r])}for(r=0;r<t.length;r++)this.addTemplatedWaypoint(t[r]);t.length},connectChildrenModels:function(){var e=this._lbr.undetailed_children_models;this._lbr.undetailed_children_models=null,this.setMdChildren(e)},connectStates:function(){var e=this._lbr.undetailed_states;this._lbr.undetailed_states=null,this._setStates(e)},useBase:function(e){this.c=e,this.createTemplate(),this.bindBase&&this.bindBase()},createDetails:function(){this.pv_view_node?this.useBase(this.pv_view_node):this.base_skeleton?(this.checkExpandableTree(),this.c&&this.useBase(this.c),this.expandBase&&this.expandBase()):this.createBase&&this.createBase()},requestDetailesCreating:function(){this._lbr.has_details||(this._lbr.has_details=!0,this.createDetails())},requestDetailes:function(){this.requestDetailesCreating(),this._lbr._detailed=!0,this.manual_states_connect||(this.connectChildrenModels(),this.connectStates()),this.appendCon()},appendCon:function(){if(this.skip_anchor_appending)return;var e=this.getC(),t=this._lbr._anchor;e&&t&&t.parentNode?(n(t).after(e),this._lbr._anchor=null,n(t).detach(),this.setVisState("con_appended",!0)):e&&e.parent()[0]&&this.setVisState("con_appended",!0)},getFreeCV:function(e,t,n){var r=this.getMdChild(e);if(r){var i=this.getFreeChildView({by_model_name:!1,nesting_name:e,nesting_space:t},r,n);return i}throw new Error("there is no "+e+" child model")},getAFreeCV:function(e,t,n){var r=this.getFreeCV(e,t,n);if(r){var i=r.getA();if(i)return i;throw new Error("there is no anchor for view of "+e+" child model")}},getAncestorByRooViCon:function(e,t){var n,r=this;t&&(r=r.parent_view);while(!n&&r){if(r==this.root_view)break;if(r.parent_view==this.root_view&&this.root_view.matchCildrenView(r,e,"map_slice")){n=r;break}r=r.parent_view}return n},findMpxViewInChildren:function(e,t,n){t=t||"main";var r,i=e.getViews(),s=[];for(r=0;r<this.children.length;r++){var o=this.children[r];if(o.nesting_space!=t)continue;if(n&&o.nesting_name!=n)continue;s.push(o)}for(r=0;r<i.length;r++)if(s.indexOf(i[r])!=-1)return i[r]},matchCildrenView:function(e,t,n){t=t||"main";for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i!=e)continue;if(t&&i.nesting_space!=t)continue;if(n&&i.nesting_name!=n)continue;return!0}return!1},getFreeChildView:function(t,n,r){var i=this.getStoredMpx(n),s=t.nesting_name,u=t.nesting_space||"main",a=o.getViewLocationId(this,t.nesting_name,u),f=i.getView(a);if(f)return!1;var l,c=t.controller_name;if(c){l=this.root_view.controllers&&this.root_view.controllers[c];if(!l)throw new Error("controller `"+c+"` should be defined in root_view.controllers")}else t.by_model_name?l=this.children_views_by_mn&&(this.children_views_by_mn[t.nesting_name][n.model_name]||this.children_views_by_mn[t.nesting_name].$default):l=this.children_views[t.nesting_name];var h;typeof l=="function"&&u=="main"?h=l:l&&(h=l[u]),!h&&t.sampleController&&(h=t.sampleController);if(!h)throw new Error("there is no View for "+t.nesting_name);f=new h;if(this.used_data_structure){var p=t.by_model_name?["children_by_mn",s,n.model_name,u]:["children",s,u],d=this.used_data_structure.constr_children&&e.getTargetField(this.used_data_structure.constr_children,p);d||(d=this.used_data_structure.tree_children&&e.getTargetField(this.used_data_structure.tree_children,p)),!d,f.used_data_structure=d}return f.init({mpx:i,parent_view:this,root_view:this.root_view,location_name:s+"-"+u,nesting_space:u,nesting_name:s},r),i.addView(f,a),this.addChildView(f,s),f},getRelativeRequestsGroups:function(e){var t=[],n=[],r=[this],i=0,s=null;while(r.length){s=r.shift();for(i=0;i<s.children.length;i++)r.push(s.children[i]),t.push(s.children[i])}for(i=0;i<t.length;i++){var o=t[i].getModelImmediateRequests(e);o&&o.length&&n.push(o)}return n},addChildView:function(e){this.children.push.call(this.children,e)},getChildViewsByMpx:function(e,t){var n=[],r=e.getViews(),i=0;for(i=0;i<this.children.length;i++){var s=this.children[i];r.indexOf(s)!=-1&&(!t||s.nesting_name==t)&&n.push(s)}return n},removeChildViewsByMd:function(t,n){var r=this.getChildViewsByMpx(t,n),i=0;for(i=0;i<r.length;i++)r[i].die();this.children=e.arrayExclude(this.children,r)},getDeepChildren:function(t){var n=[],r=[];t=e.toRealArray(t),r.push(this);while(r.length){var i=r.shift();for(var s=0;s<i.children.length;s++){var o=i.children[s];n.indexOf(o)==-1&&t.indexOf(o)==-1&&(r.push(o),n.push(o))}}return n},checkDeadChildren:function(){var e=0,t=[];for(e=0;e<this.children.length;e++)this.children[e].dead||t.push(this.children[e]);t.length!=this.children.length&&(this.children=t)},markAsDead:function(e){var r=0;this.proxies_space&&f.removeSpaceById(this.proxies_space),v(this.remove,this,[this.getC(),this._lbr._anchor]),this.dead=!0,this.stopRequests(),t.triggerDestroy(this),e||this.mpx.removeDeadViews(),this.c=null;if(this.base_skeleton){for(r=0;r<this.base_skeleton.length;r++)n(this.base_skeleton[r].node);this.base_skeleton=null}this._lbr._anchor=null,this.tpl&&(this.tpl.destroy(),this.tpl=null);if(this.tpls){for(r=0;r<this.tpls.length;r++)this.tpls[r].destroy();this.tpls=null}this.way_points=null,this.wp_box&&(this.wp_box=null),this.pv_view_node&&(this.pv_view_node=null);if(this.dom_related_props)for(r=0;r<this.dom_related_props.length;r++)this[this.dom_related_props[r]]=null;var i=this.children;this.children=[];for(r=0;r<i.length;r++)i[r].markAsDead();this.view_parts=null},remove:function(e,t){e||(e=this.getC()),e&&e.remove(),t||(t=this._lbr._anchor),t&&n(t).remove()},die:function(e){return this._lbr.marked_as_dead||(n(this.getC()).remove(),this.markAsDead(e&&e.skip_md_call),this._lbr.marked_as_dead=!0),this},getT:function(){return this.c||this.pv_view_node||n(this.getA())},getC:function(){return this.c},getA:function(){return this._lbr._anchor||(this._lbr._anchor=document.createComment(""))},requestAll:function(){return this.requestDeepDetLevels()},__tickDetRequest:function(){if(!this.isAlive())return;this._lbr.dettree_incomplete=this.requestDetalizationLevel(this._lbr.detltree_depth),this._lbr.detltree_depth++,this._lbr.dettree_incomplete&&this.nextLocalTick(this.__tickDetRequest)},requestDeepDetLevels:function(){return this._lbr._states_set_processing||this._lbr._collections_set_processing?this:(this._lbr.detltree_depth=1,this._lbr.dettree_incomplete=!0,this.nextLocalTick(this.__tickDetRequest),this)},softRequestChildrenDetLev:function(e){if(this._lbr._states_set_processing||this._lbr._collections_set_processing)return this;this.requestChildrenDetLev(e)},requestChildrenDetLev:function(e){var t=!1;if(this.children.length&&e===0)return!0;for(var n=0;n<this.children.length;n++){var r=this.children[n].requestDetalizationLevel(e);t=t||r}return t},requestDetalizationLevel:function(e){return this._lbr._detailed||this.requestDetailes(),this.requestChildrenDetLev(e-1)},getCNode:function(e){return(e=this.getC())&&(typeof e.length!="undefined"?e[0]:e)},isAliveFast:function(){return!this.dead},isAlive:function(t){if(this.dead)return!1;if(this.getC()){var n=this.getCNode();return!n||t&&t===n.ownerDocument||!e.getDefaultView(n.ownerDocument)?(this.markAsDead(),!1):!0}return!0},_setStates:function(e){this._lbr._states_set_processing=!0,this.states={};var t=[];for(var n in e)t.push(!0,n,e[n]);return this._updateProxy(t),this._lbr._states_set_processing=null,this},updateTemplatesStates:function(e,t){var n=0;this.tpl&&this.tpl.checkChanges(e,this.states,!t,!t&&this.current_motivator);if(this.tpls)for(n=0;n<this.tpls.length;n++)this.tpls[n].checkChanges(e,this.states,!t,!t&&this.current_motivator)},requireAllParts:function(){for(var e in this.parts_builder)this.requirePart(e);return this},getPart:function(e){return this.view_parts&&this.view_parts[e]},collectStateChangeHandlers:function(){var n=e.getDeprefixFunc("stch-"),r=t.getPropsPrefixChecker(n);return function(e){var t=!1,i;this.hasOwnProperty("state_change")?t=!0:t=r(e);if(!t)return;this._has_stchs=!0;var s={},o=[];this.stch_hs_list=[];for(i in this)if(n(i)){var u=n(i);s[u]=!0,o.push({name:u,item:this[i]}),this.stch_hs_list.push(u)}if(this.state_change)for(i in this.state_change)s[i]||(s[i]=!0,o.push({name:i,item:this.state_change[i]}),this.stch_hs_list.push(i));this.stch_hs=o}}(),requirePart:function(e){if(!this.isAlive())return n();if(this.view_parts&&this.view_parts[e])return this.view_parts[e];this.view_parts||(this.view_parts={});var t=this.parts_builder[e],r=typeof t=="string"?this.root_view.getSample(t):t.call(this);this.view_parts[e]=r;if(!this.view_parts[e])throw new Error('"return" me some build result please');for(var i=0;i<this.stch_hs.length;i++){var s=this.stch_hs[i];this.states.hasOwnProperty(s.name)&&typeof s.item!="function"&&this.checkDepVP(s.item,e)&&s.item.fn.call(this,this.states[s.name])}return this.view_parts[e]},checkDepVP:function(e,t){var n;if(t&&e.dep_vp.indexOf(t)==-1)return!1;for(var r=0;r<e.dep_vp.length;r++){var i=e.dep_vp[r];if(!this.view_parts||!this.view_parts[i]){n=!1;break}n=!0}return n},stackReceivedChanges:function(){return function(){if(!this.isAlive())return;var e=new Array(arguments.length);for(var t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift(this),this.nextTick(r,e)}}(),receiveStatesChanges:function(e,t){if(!this.isAlive())return;r(this,e,t)},overrideStateSilently:function(e,t){r(this,[!0,e,t],{skip_handler:!0})},promiseStateUpdate:function(e,t){r(this,[!0,e,t])},setVisState:function(e,t){r(this,[!0,"vis_"+e,t])},checkChildrenModelsRendering:function(){var t=e.cloneObj(!1,this.children_models);this.setMdChildren(t)},setMdChildren:function(e){this._lbr._collections_set_processing=!0;for(var t in e)this.collectionChange(this,t,e[t]);this._lbr._collections_set_processing=null},getMdChild:function(e){return this.children_models[e]},pvserv:{simple:{},bymodel:{}},checkCollchItemAgainstPvViewByModelName:function(){var e=function(e,t){var r=this.pv_v_data.index[e.model_name];if(!r)return;var i=this.view.getFreeChildView({by_model_name:!0,controller_name:r.controller_name,nesting_name:this.nesname,nesting_space:this.space_name,sampleController:y},e);if(i)return t||(t=r.sampler.getClone()),i.pv_view_node=n(t),r.node=null,r.views.push(i.view_id),r.last_node=t,i},t=function(e){n(this.pv_v_data.comment_anchor).after(e)};return function(n,r,i,s){var o=[];for(var u=0;u<r.length;u++){var a=r[u];a.model_name&&s.index[a.model_name]&&o.push(a)}this.appendCollection(i,{view:this,nesname:n,pv_v_data:s,space_name:i,getFreeView:e,appendDirectly:t},!1,n,o)}}(),checkCollchItemAgainstPvView:function(){var e=function(e,t,n){if(this.pv_view.node)if(!n||n.indexOf(e)!=-1)return this.getFreeView(e,this.pv_view.node)},t=function(e,t){var r=this.pv_view,i=this.view.getFreeChildView({by_model_name:!1,controller_name:r.controller_name,nesting_name:this.nesname,nesting_space:this.space_name,sampleController:y},e);if(i)return t||(t=r.sampler.getClone()),i.pv_view_node=n(t),r.node=null,r.views.push(i.view_id),r.last_node=t,r.onDie(function(){i.die()}),i},r=function(e){n(this.pv_view.comment_anchor).after(e)};return function(i,s,o,u){u.comment_anchor||(u.comment_anchor=document.createComment("collch anchor for: "+i+", "+o),n(u.node).before(u.comment_anchor)),u.node&&(n(u.node).detach(),u.node=null);var a=u.filterFn?u.filterFn(s):s;this.appendCollection(o,{view:this,pv_view:u,nesname:i,space_name:o,getView:u.node&&e,appendDirectly:r,getFreeView:t},!1,i,a)}}(),checkCollectionChange:function(t){if(!this.dclrs_fpckgs)throw new Error("there is no declarations");if(!this.dclrs_fpckgs["$ondemand-"+t])throw new Error('there is no "$ondemand-" declaration for: '+t);if(this.dclrs_fpckgs.hasOwnProperty(t))throw new Error('constant declaration exist for nesting named "'+t+'"');if(!this._lbr.dclrs_fpckgs_is_clonned){this._lbr.dclrs_fpckgs_is_clonned=!0;var n={};e.cloneObj(n,this.dclrs_fpckgs),this.dclrs_fpckgs=n}this.dclrs_fpckgs[t]=this.dclrs_fpckgs["$ondemand-"+t],this.children_models[t]&&this.collectionChange(this,t,this.children_models[t])},tpl_children_prefix:"tpl.children_templates.",stackCollectionChange:function(){var e=new Array(arguments.length);for(var t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift(this),this.nextTick(this.collectionChange,e)},checkTplTreeChange:function(){var e=[];for(var t in this.states)e.push(!0,t,this.states[e]);this.updateTemplatesStates(e);for(var n in this.children_models)this.pvCollectionChange(n,this.children_models[n])},pvCollectionChange:function(t,n,r){var i=e.getTargetField(this,this.tpl_children_prefix+t);if(!i&&this.tpls)for(var s=0;s<this.tpls.length;s++){i=e.getTargetField(this.tpls[s],["children_templates",t]);if(i)break}var o;if(i){var u,a=e.toRealArray(n);if(r&&r.length){for(u in i.usual)this.removeViewsByMds(r,t,u);for(u in i.by_model_name)this.removeViewsByMds(r,t,u)}for(u in i.usual){o=i.usual[u];if(!o)continue;this.checkCollchItemAgainstPvView(t,a,u,i.usual[u])}for(u in i.by_model_name){o=i.by_model_name[u];if(!o)continue;this.checkCollchItemAgainstPvViewByModelName(t,a,u,o)}this.requestAll()}},collectionChange:function(e,t,n,r,i){if(!e.isAlive())return;if(e._lbr.undetailed_children_models)return e._lbr.undetailed_children_models[t]=n,e;var s=e.children_models[t];e.children_models[t]=n,e.pvCollectionChange(t,n,i);var u=e.dclrs_fpckgs&&e.dclrs_fpckgs.hasOwnProperty(t)&&e.dclrs_fpckgs[t];if(typeof u=="function")e.callCollectionChangeDeclaration(u,t,n,s,i);else if(e.dclrs_selectors&&e.dclrs_selectors.hasOwnProperty(t))if(Array.isArray(n))for(var a=0;a<n.length;a++){var f=n[a],l=o.selecPoineertDeclr(e.dclrs_fpckgs,e.dclrs_selectors,t,f.model_name,e.nesting_space);throw l||(l=u),new Error("WHAT TO DO WITH old_value?")}else{var l=o.selecPoineertDeclr(e.dclrs_fpckgs,e.dclrs_selectors,t,n.model_name,e.nesting_space);l||(l=u),e.callCollectionChangeDeclaration(l,t,n,s,i)}else u&&e.callCollectionChangeDeclaration(u,t,n,s,i);return e.checkDeadChildren(),e},removeViewsByMds:function(e,t,n){if(!e)return;var r=o.getViewLocationId(this,t,n||"main");for(var i=0;i<e.length;i++){var s=this.getStoredMpx(e[i]).getView(r);s&&s.die()}},changeChildrenViewsDeclarations:function(e){var t,n;if(e.children_views)for(t in this.children_views)n=this.children_views[t],typeof n=="function"&&(this.children_views[t]={main:n});if(e.children_views_by_mn)for(t in this.children_views_by_mn)for(var r in this.children_views_by_mn[t])n=this.children_views_by_mn[t][r],typeof n=="function"&&(this.children_views_by_mn[t][r]={main:n})},collectSelectorsOfCollchs:function(){var n=e.memorize(function(e){var t=e.split("/"),n=t[1],r=t[2],i=0;n&&(i+=2),r&&(i+=1);var s="";return n&&(s+=n),r&&(s+="/"+r),{nesting_name:t[0],model_name:t[1]||null,parent_space_name:t[2]||null,prio:i,key:s}}),r=e.getDeprefixFunc("sel-coll-"),i=t.getPropsPrefixChecker(r);return function(e){var t=i(e);if(!t)return;var s;this.dclrs_selectors={};for(s in this)if(r(s)){var o=this[s],u=r(s),a=n(u);this.dclrs_selectors.hasOwnProperty(a.nesting_name)||(this.dclrs_selectors[a.nesting_name]={}),this.dclrs_selectors[a.nesting_name][a.key]=o}return!0}}(),collectCollectionChangeDeclarations:function(){var n=function(e){var t=e.by_model_name,n=e.space!="main"&&e.space,r=e.is_wrapper_parent,i=e.needs_expand_state;if(t||n||r||i)return{by_model_name:t,space:n,is_wrapper_parent:r,needs_expand_state:i}},r=function(e){typeof e=="string"&&(e={place:e});var t=e.needs_expand_state;t&&typeof t!="string"&&(t="can_expand");var r=e.is_wrapper_parent&&e.is_wrapper_parent.match(/^\^+/gi),i={place:e.place,by_model_name:e.by_model_name,space:e.space||"main",strict:e.strict,is_wrapper_parent:r&&r[0].length,opts:e.opts,needs_expand_state:t||null,not_request:e.not_request,limit:e.limit,solving:null},s=n(i);return s&&(i.solving=s),i},i=e.getDeprefixFunc("collch-"),s=t.getPropsPrefixChecker(i);return function(e){var t=s(e);if(!t)return;var n;this.dclrs_fpckgs={};for(n in this)if(i(n)){var o=this[n],u=i(n);if(typeof o=="function")this.dclrs_fpckgs[u]=o;else{if(Array.isArray(o))throw new Error("do not support arrays anymore");this.dclrs_fpckgs[u]=r(o)}}return!0}}(),callCollectionChangeDeclaration:function(t,n,r,i,s){if(typeof t=="function")t.call(this,n,r,i,s);else{var o=e.toRealArray(r),u;t.limit?u=Math.min(t.limit,o.length):u=o.length;var a=o.slice(0,u),f=t;if(typeof f.place=="string"){var l=e.getTargetField(this,f.place);if(!l)throw new Error('wrong place declaration: "'+f.place+'"')}var c=f.opts;this.removeViewsByMds(s,n,f.space),typeof f.place=="function"||!f.place?(this.simpleAppendNestingViews(f,c,n,a),t.not_request||this.requestAll()):this.appendNestingViews(f,c,n,a,t.not_request)}},simpleAppendNestingViews:function(e,t,n,r){for(var i=0;i<r.length;i++){var s=r[i],o;if(e.is_wrapper_parent){o=s;for(var u=0;u<e.is_wrapper_parent;u++)s=s.getParentMapModel()}this.appendFVAncorByVN({md:s,original_md:o,by_model_name:e.by_model_name,name:n,opts:typeof t=="function"?t.call(this,s,o):t,place:e.place,space:e.space,strict:e.strict})}},getPrevView:function(e,t,n,r){var i=t-1;if(i>=e.length||i<0)return;for(;i>=0;i--){var s=this.getStoredMpx(e[i]).getView(n),o=s&&!s._lbr.detached&&s.getT();if(o)return r?s:o}},getNextView:function(e,t,n,r){var i=t+1;if(i>=e.length||i<0)return;for(;i<e.length;i++){var s=this.getStoredMpx(e[i]).getView(n),o=s&&!s._lbr.detached&&s.getT();if(o)return r?s:o}},appen_ne_vws:{appendDirectly:function(e){this.place.append(e)},getFreeView:function(e){return this.view.getFreeChildView({by_model_name:this.by_model_name,nesting_name:this.nesname,nesting_space:this.space},e,typeof this.view_opts=="function"?this.view_opts.call(this.view,e):this.view_opts)}},appendNestingViews:function(t,n,r,i,s){var o;typeof t.place=="string"?o=e.getTargetField(this,t.place):typeof t.place=="function",i=i&&i.map(function(e){for(var n=0;n<t.is_wrapper_parent;n++)e=e.getParentMapModel();return e}),this.appendCollection(t.space,{view:this,place:o,nesname:r,space:t.space,by_model_name:t.by_model_name,view_opts:n,appendDirectly:this.appen_ne_vws.appendDirectly,getFreeView:this.appen_ne_vws.getFreeView},n,r,i,s)},coll_r_prio_prefix:"coll-prio-",getRendOrderedNesting:function(e,t){var n=this[this.coll_r_prio_prefix+e];return n&&n.call(this,t)},appendCollection:function(e,t,n,r,i,u){var a=o.getViewLocationId(this,r,e||"main"),f=this.getRendOrderedNesting(r,i);f?this.appendOrderedCollection(e,t,n,i,u,f):this.appendOrderedCollection(e,t,n,i,u);var l=0;for(var c=0;c<i.length;c++){var h=this.getStoredMpx(i[c]).getView(a);if(h){h._lbr.innesting_pos_current=l;var p=l===0,d=l===i.length-1;s(h,"$index",l),s(h,"$first",p),s(h,"$last",d),s(h,"$middle",!p&&!d),l++}}},createDOMComplect:function(e,t,n,r){var i=n.view_id+"_"+r;if(!e[i]){var s={fragt:document.createDocumentFragment(),view:n,type:r};e[i]=s,t.push(i)}return e[i]},appendOrderedCollection:function(e,t,r,i,s,u){if(!this.isAlive())return;var a=null,f=null,l=0,h=null,p=null,d=o.getViewLocationId(this,t.nesname,e||"main"),v=[],m;while(!m&&u&&u.length){m=u&&u.shift(),m&&m.length==i&&i.length&&(m=null);if(m){var g=!1;for(l=0;l<m.length;l++)this.getStoredMpx(m[l]).getView(d)&&(g=!0);g||(m=null)}}for(l=0;l<i.length;l++){a=i[l],f=this.getStoredMpx(a).getView(d);if(f){h=this.getPrevView(i,l,d,!0);if(h){var y=f.getT(),b=h.getT();if(!y.prev().is(b)){var w=y[0]&&y[0].parentNode;w&&w.removeChild(y[0]),f.setVisState("con_appended",!1),f._lbr.detached=!0,v.push(f)}}}}var E=[],S=[],x={};if(t.getView)for(l=0;l<i.length;l++)t.getView(i[l],e,m);for(l=0;l<i.length;l++){a=i[l],f=this.getStoredMpx(a).getView(d);if(f&&!f._lbr.detached)continue;if(!f&&m&&m.indexOf(a)==-1)continue;h=this.getPrevView(i,l,d,!0),h&&h.state("vis_con_appended")?E.push(a,this.createDOMComplect(x,S,h,"after")):(p=this.getNextView(i,l,d,!0),p&&p.state("vis_con_appended")?E.push(a,this.createDOMComplect(x,S,p,"before")):E.push(a,this.createDOMComplect(x,S,!1,"direct")))}var T=new Array(E.length/2);for(l=0;l<E.length;l+=2){a=E[l];var N=E[l+1];f=this.getStoredMpx(a).getView(d),f||(f=t.getFreeView(a)),T[l/2]=f,f.skip_anchor_appending=!0;var C=n(N.fragt);C.append(f.getT()),c(C)}if(!this._lbr._collections_set_processing){for(l=i.length-1;l>=0;l--)f=this.getStoredMpx(i[l]).getView(d),f&&f.requestDetailesCreating();s||this.requestAll()}for(l=0;l<S.length;l++){var N=x[S[l]];N.type=="after"?N.view.getT().after(N.fragt):N.type=="before"?N.view.getT().before(N.fragt):N.type=="direct"&&t.appendDirectly(N.fragt)}for(l=0;l<v.length;l++)v[l]._lbr.detached=null;m&&m.length&&this.nextLocalTick(this.appendOrderedCollection,[e,t,r,i,s,u]);for(l=0;l<i.length;l++)f=this.getStoredMpx(i[l]).getView(d),f&&(f._lbr.innest_prev_view=this.getPrevView(i,l,d,!0),f._lbr.innest_next_view=this.getNextView(i,l,d,!0));for(l=0;l<T.length;l++)a=T[l],a.skip_anchor_appending=null,a.appendCon();return x},appendFVAncorByVN:function(e){var t=this.getFreeChildView({by_model_name:e.by_model_name,nesting_name:e.name,nesting_space:e.space},e.md,e.opts),n=e.place;if(n&&typeof e.place=="function"&&(e.strict||t)&&n){n=e.place.call(this,e.md,t,e.original_md);if(!n&&typeof n!="boolean")throw new Error("give me place");n.append(t.getA()),c(n)}},parts_builder:{}}),y}}),define("pv",["spv","./StatementsAngularParser.min","./PvTemplate","./sync_sender","./MDProxy","./helpers","./views_proxies","./SyncReceiver","./Eventor","./StatesEmitter","./CallbacksFlow","./Model","./View","./updateProxy"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){"use strict";var d,v,m=p.update,g=function(){},y={},b=new l(window),w=a(b),E=f(w);return v=d={CallbacksFlow:l,hp:s,$v:s.$v,getRDep:s.getRDep,utils:{isDepend:function(e){return e&&!!e.count}},initWebApp:function(e,t){var n=Date.now(),r=d.views_proxies;r.addSpaceById(n,e);var i=r.getMPX(n,e);(function(){var e=new t;i.addView(e,"root"),e.init({mpx:i,proxies_space:n},{d:window.document}),e.requestAll(),e=null})()},getModelById:function(e){return y[e]},prototypes:{},setTplFilterGetFn:function(e){t.getFilterFn=e},MDProxy:i,sync_s:r,SyncR:u,Eventor:w,StatesEmitter:E,Model:c(E,y,o,r),HModel:function(){},View:h(E,b,o),views_proxies:o,addPrototype:function(e,t){if(!!this.prototypes[e])throw new Error("Already has such prototype");this.prototypes[e]=t},extendFromTo:function(e,t,n){if(!this.prototypes[e])throw new Error("there is no prototype "+e+" in my store");return t.extendTo(n,this.prototypes[e]),n},getOCF:function(e,t){return function(){return this[e]?this:(this[e]=!0,t.apply(this,arguments),this)}},updateNesting:function(e,t,n,r,i){e.updateNesting(t,n,r,i)},mpx:{update:function(e,t,n,r){e.updateState(t,n,r)}},update:p.update,state:s.state,behavior:function(e,t,n){var r=t||v.Model,i=n||function(){};return r.extendTo(i,e),i},dom:{template:n},create:function(t,n,r,i,s){var o=t||v.Model,u=new o;return u.init((s||i)&&{app:s||i.app,map_parent:i},null,null,null,n),r&&(r.interfaces&&e.forEachKey(r.interfaces,function(e,t,n){n.useInterface(t,e)},u),r.nestings&&e.forEachKey(r.nestings,function(e,t,n){n.updateNesting(t,e)},u)),u.init_states&&u.initStates(),u}},d.Controller=d.View,d.Model.extendTo(d.HModel,{network_data_as_states:!0,init:function(e){this.app||(this.app=null),this.sub_pages=null,this.map_parent||(this.map_parent=null),this.pmd_switch=null;if(!this.skip_map_init){if(this.sub_pa||this.subPager)this.sub_pages={};if(!e||!e.map_parent)if(!this.zero_map_level)throw new Error("who is your map parent model?")}var t=this.map_parent||e.map_parent;this.map_level_num=null,this.zero_map_level?this.map_level_num=-1:t&&(this.map_level_num=t.map_level_num+1),this._super.apply(this,arguments)},_hndOnPMDSwitch:function(e){this.checkPMDSwiched(e.value)},setPmdSwitcher:function(e){this.pmd_switch=e,e.on("state_change-vswitched",this._hndOnPMDSwitch,this.getContextOptsI())},"stch-vswitched":function(e,t,n){if(t){var r=v.getModelById(t);m(r,"pmd_vswitched",!0)}if(n){var i=v.getModelById(n);m(i,"pmd_vswitched",!1)}},switchPmd:function(e){var t;typeof e=="boolean"?t=e:t=!this.state("pmd_vswitched");var n=this.pmd_switch||this.pmd_switch_is_parent&&this.map_parent;t?this.state("pmd_vswitched")||m(n,"vswitched",this._provoda_id):this.state("pmd_vswitched")&&m(n,"vswitched",!1)},checkPMDSwiched:function(e){m(this,"pmd_vswitched",e==this._provoda_id)}}),d.BaseRootView=function(){},d.View.extendTo(d.BaseRootView,{_getCallsFlow:function(){return this.calls_flow},init:function(t,n){return this.calls_flow=new d.CallbacksFlow(e.getDefaultView(n.d),!n.usual_flow,250),this._super.apply(this,arguments)},remove:function(){this.calls_flow=null}}),typeof window=="object"&&typeof window.document=="object"&&(window.provoda=d),d}),define("pv/provoda",function(){}),define("js/libs/navi",["spv"],function(e){var t=!!window.history&&!!window.history.pushState,n=/^\#/,r=function(r){t?e.addEvent(window,"popstate",function(e){if(!e.state){var t=decodeURI(location.hash).replace(n,"");typeof r=="function"&&r({newURL:t})}else typeof r=="function"&&r({newURL:e.state.uniq_url})}):"onhashchange"in window?function(){var t=decodeURI(location.hash).replace(n,"");e.addEvent(window,"hashchange",function(e){e=e||window.Event;var i=decodeURI(location.hash).replace(n,"");i!=t&&(typeof r=="function"&&r({newURL:i}),t=i)})}():function(){var e=decodeURI(location.hash).replace(n,"");setInterval(function(){var t=decodeURI(location.hash).replace(n,"");t!=e&&(typeof r=="function"&&r({newURL:t}),e=t)},150)}()},i;return function(){var e=null,n=function(){if(e===null){var t;location.href.indexOf("#")>-1?t=location.href.slice(0,location.href.indexOf("#")):t=location.href,e=t}return e},s=function(e,t){e=""+e;if(t)while(e.length<t)e=0+e;return e},o=/\ ?\$...$/,u=[],a=null;i={disallow_native_history:!1,counter:Math.round(Math.random()*parseInt("zzz",36)),states_index:{},fake_current_url:"",init:function(e){this.hashChangeRecover=e;var t=this;r(function(){t.hashchangeHandler.apply(t,arguments)})},getUniqId:function(){var e=(e=(this.counter++).toString(36))&&s(e.substring(e.length-3,e.length),3);return e},setFakeURL:function(e){this.fake_current_url!=e&&(this.fake_current_url=e),a=this.findHistory(e)},getFakeURL:function(){return this.fake_current_url},getURLData:function(e){var t=e.match(o),n=t&&t[0],r=e.replace(o,""),i=e+(n||" $"+this.getUniqId());return{clear_url:r,uniq_url:i}},_saveHistory:function(e,r,i){var s=this.getURLData(this.fake_current_url),o;if(i){var f=this.getURLData(i);o=s.clear_url==f.clear_url}var l=this.getURLData(e);if(s.clear_url!=l.clear_url||o)if(!this.states_index[l.uniq_url]){this.setFakeURL(l.uniq_url);var c={url:l.clear_url,data:r,num:0};this.states_index[l.uniq_url]=c;if(!o)c.num=u.length,u[c.num]=c,this.disallow_native_history||(t?window.history.pushState({uniq_url:l.uniq_url},"",n()+"#"+l.clear_url):location.assign(n()+"#"+l.uniq_url));else{var h=a&&a.num;typeof h!="number"&&(h=u.length),u.length=h+1,u[h]=c,this.disallow_native_history||(t?window.history.replaceState({uniq_url:l.uniq_url},"",n()+"#"+l.clear_url):location.replace(n()+"#"+l.uniq_url))}a=c}},set:function(e,t){this._saveHistory(decodeURI(e),t)},replace:function(e,t,n){this._saveHistory(decodeURI(t),n,decodeURI(e))},findHistory:function(e){return this.states_index[e]},hashchangeHandler:function(e,t){e.newURL!=decodeURI(this.getFakeURL())&&(this.setFakeURL(e.newURL),this.hashChangeRecover(e,t))},trickyBack:function(){return a?(this.hashChangeRecover({}),!0):!1}}}(),i}),define("js/libs/BrowseMap",["pv","spv"],function(e,t){function f(e){return{md:e[0],distance:e.length}}function g(){}function k(e){var t=e.getNesting("pioneer");e.map.addChange({type:"move-view",bwlev:e.getMDReplacer(),target:t.getMDReplacer(),value:!0})}function L(e){if(!P(e))return;var t=e.getNesting("pioneer");e.map.addChange({type:"zoom-out",bwlev:e.getMDReplacer(),target:t.getMDReplacer()})}function A(t){var n=t.getNesting("pioneer");t.map.addChange({type:"destroy",bwlev:t.getMDReplacer(),target:n.getMDReplacer()}),t.getNesting("pioneer").trigger("mpl-detach"),e.update(t,"mpl_attached",!1)}function O(e){var t=e.map,n=t.isCollectingChanges();n||t.startChangesCollecting();var r=t.startChangesGrouping("zoom-out",!0);t.sliceDeepUntil(e.state("map_level_num")),r&&t.finishChangesGrouping("zoom-out"),n||t.finishChangesCollecting()}function M(e,t){var n=e.startChangesGrouping("zoom-in",!0);k(t),e.current_level_num=t.state("map_level_num"),n&&e.finishChangesGrouping("zoom-in")}function _(e){return O(e)}function D(t){var n=t.getNesting("pioneer");t.closed=!0,e.update(n,"mp_freezed",!0)}function P(e){return e.state("mp_show")}function H(e){return!!e.map&&!e.closed}function B(e){return e&&(P(e)||!H(e))}var n=e.state,r=t.inh(e.Eventor,{naming:function(e){return function(n){e(this,n)}},building:function(e){return function(n,r){e(n),n.changes_group=null,n.grouping_changes=null,n.collecting_changes=null,n.current_level_num=null,n.nav_tree=null,n.onNavTitleChange=null,n.onNavUrlChange=null,n.levels=[];if(!r)throw new Error("give me 0 index level (start screen)");n.mainLevelResident=r,n.cha_counter=0,n.chans_coll=[],n.residents=[]}},props:{isGroupingChanges:function(){return this.grouping_changes},startChangesGrouping:function(e,t){if(!this.grouping_changes)return this.changes_group={name:e,changes:[]},this.grouping_changes=!0,!0;if(!t)throw new Error("already grouping")},finishChangesGrouping:function(e){if(!this.grouping_changes)throw new Error("none to finish");this.grouping_changes=!1,this.emitChangesGroup(e)},emitChangesGroup:function(e){if(this.changes_group.name!=e)throw new Error("wrong changes group name");this.changes_group.changes.length&&(this.chans_coll.push(this.changes_group),this.changes_group=null,this.isCollectingChanges()||this.emitChanges())},addChangeToGroup:function(e){if(this.grouping_changes)this.changes_group.changes.push(e);else{var t=this.chans_coll[this.chans_coll.length-1];if(!t||!!t.name)throw new Error("unknow changes");t.changes.push(e)}},isCollectingChanges:function(){return!!this.collecting_changes},startChangesCollecting:function(e,t){if(!this.collecting_changes)return this.collecting_changes=t||{},!0;if(!e)throw new Error("already collecting")},finishChangesCollecting:function(){if(!this.collecting_changes)throw new Error("none to finish");var e=this.collecting_changes;this.collecting_changes=!1,this.emitChanges(e)},addChange:function(e){this.addChangeToGroup(e),this.collecting_changes||this.emitChanges()},zipChanges:function(){var e,t,n=[];for(var r=0;r<this.chans_coll.length;r++)e&&(!t||e.name!=t.name)&&(t=e),e=this.chans_coll[r],t&&e.name==t.name?(t.changes=t.changes.concat(e.changes),t.zipped=!0):n.push(e);n.length<this.chans_coll.length&&(this.chans_coll=n)},emitChanges:function(e){e=e||{};if(this.chans_coll.length){this.zipChanges();var n=t.filter(this.chans_coll,"changes"),r=[];for(var i=0;i<n.length;i++)r=r.concat(n[i]);var s=t.filter(r,"type","move-view");for(var o=0;o<s.length;o++){var u=s[o];o==s.length-1&&this.updateNav(u.bwlev.getMD(),e)}var a=this.getCurrentLevel();this.trigger("changes",{array:this.chans_coll,changes_number:this.cha_counter},a.rtree.slice().reverse(),a.ptree.slice().reverse()),this.chans_coll=[],this.chans_coll.changes_number=++this.cha_counter}},makeMainLevel:function(){return this.startChangesGrouping("zoom-in"),this.setLevelPartActive(this.getFreeLevel(-1,!1,this.mainLevelResident)),this.finishChangesGrouping("zoom-in"),this},getCurrentLevel:function(){return this.getLevel(this.getActiveLevelNum())},getCurrentResident:function(){return this.getCurrentLevel().getNesting("pioneer")},getLevel:function(e){return this.levels[e]?this.levels[e].free||this.levels[e].freezed:!1},getActiveLevelNum:function(){return this.current_level_num},setLevelPartActive:function(e){k(e),this.current_level_num=e.state("map_level_num")},_goDeeper:function(e,t){t||(t=d(e.map_parent,this));var n=e.map_parent,r,i;if(t)i=t.state("map_level_num")+1;else{if(typeof e.map_level_num!="number")throw new Error("md must have `map_level_num`");i=e.map_level_num}var s=t;if(!s&&n)throw new Error("`md.lev` prop dissalowed");r=this.getFreeLevel(i,s,e);var o=this.startChangesGrouping("zoom-in");return this.setLevelPartActive(r),o&&this.finishChangesGrouping("zoom-in"),r},createLevel:function(t,n,r){var i=y(r,n,t);return i.map=this,e.update(i,"mpl_attached",!0),i},getFreeLevel:function(e,t,n){this.levels[e]||(this.levels[e]={});var r=this.levels[e];return r.free&&r.free!=r.freezed?r.free:(r.free=this.createLevel(e,t,n),r.free)},freezeMapOfLevel:function(e){var t,n=!1,r=Math.min(e,this.levels.length-1);this.startChangesGrouping("freezing");for(t=r;t>=0;t--){var i=this.levels[t];i&&(i.free&&i.free!=i.freezed&&(i.freezed&&(A(i.freezed),i.freezed.closed=!1,i.freezed=null),i.freezed=i.free,D(i.freezed),n=!0),i.free=null)}if(r+1<this.levels.length-1)for(t=r+1;t<this.levels.length;t++){var s=this.levels[t];s.freezed&&(s.freezed.closed=!1,A(s.freezed),s.freezed=null)}return this.finishChangesGrouping("freezing"),n},hideFreeLevel:function(e,t){e.free&&e.free!=t&&(A(e.free),e.free=null)},hideLevel:function(e,t,n){e&&(n||e.freezed&&e.freezed!=t&&L(e.freezed),this.hideFreeLevel(e,t))},updateNav:function(){var t=function(t,n){return e.update(t,"mp_stack",n),e.update(t.getNesting("pioneer"),"mp_stack",n),this};return function(e,n){var r=e.ptree,i=r[r.length-1],s=r.length-1;t(e,!1);var o=r[1];o?(t(o,"top"),t(i,!0)):t(i,!1);for(var u=2;u<s;u++)t(r[u],u+1===s?"bottom":"middle");this.setNavTree(e.ptree,n)}}(),setNavTree:function(e,t){var n=this.nav_tree;this.nav_tree=e;var r=this.setCurrentURL(e,n,t),i=this.setCurrentNav(e[0].rtree,n&&n[0].rtree,t);if(r){var s=this.getCurrentLevel();this.trigger("nav-change",{url:r.nv||"",md:s&&s.getNesting("pioneer"),map_level:s})}this.trigger("map-tree-change",e[0].rtree,n&&n[0].rtree)},getTitleNav:function(e){return e&&e.slice(0,2)},setCurrentNav:function(e,t){var n=this;this.onNavTitleChange||(this.onNavTitleChange=function(){var e=n.getTitleNav(n.nav_tree[0].rtree),t=e.indexOf(this);t!=-1&&n.refreshTitle(t)}),t=this.getTitleNav(t);var r;if(t)for(r=0;r<t.length;r++)t[r].offTitleChange(this.onNavTitleChange);e=this.getTitleNav(e);for(r=0;r<e.length;r++)e[r].onTitleChange(this.onNavTitleChange);return this.setTitle(this.joinNavTitle(e))},setTitle:function(e){var t=this;return b(this,"cur_title",e,function(e,n){t.trigger("title-change",e,n)})},joinNavTitle:function(e){var t=[];for(var n=0;n<e.length;n++)e[n].getTitle&&t.push(e[n].getTitle());return t.join(" ← ")},refreshTitle:function(){return this.setTitle(this.joinNavTitle(this.getTitleNav(this.nav_tree[0].rtree))),this},setCurrentURL:function(e,t,n){var r=e[0].rtree,i=t&&t[0].rtree,s=this;this.onNavUrlChange||(this.onNavUrlChange=function(){var e=s.nav_tree[0].rtree,t=e.indexOf(this);t!=-1&&s.replaceURL(t)});var o;if(i)for(o=0;o<i.length;o++)i[o].off("state_change-url_part",this.onNavUrlChange);for(o=0;o<r.length;o++)r[o].on("state_change-url_part",this.onNavUrlChange,{skip_reg:!0});return this.setURL(this.joinNavURL(e),!1,n)},joinNavURL:function(){var e=function(e){var t="";for(var n=e.length-1;n>=0;n--){var r=e[n],i=r.state("url_part");t+=i||""}return t};return function(t){var n="",r=o(t[0]),i=r.pop();n+=e(i);for(var s=r.length-1;s>=0;s--){var u=r[s].length;n+="#",u>1&&(n+=u+":"),n+=e(r[s])}return n}}(),setURL:function(e,t,n){n=n||{};var r=this;return b(this,"cur_url",e,function(e,i){n.skip_url_change||r.trigger("url-change",e,i||"",r.getCurrentLevel(),t||n.replace_url);var s=r.getCurrentLevel();r.trigger("every-url-change",{url:e,map_level:s,md:s&&s.getNesting("pioneer")},null,t)})},replaceURL:function(){return this.setURL(this.joinNavURL(this.nav_tree),!0),this},sliceDeepUntil:function(e){var t=this.getCurrentLevel(),n;if(e<this.levels.length)for(var r=this.levels.length-1;r>e;r--)this.hideLevel(this.levels[r]);n=this.getLevel(e),n&&n!=t&&this.setLevelPartActive(n)},clearCurrent:function(){var e=this.getActiveLevelNum();if(e!=-1)for(var t=e;t>=0;t--)this.hideLevel(this.levels[t])},startNewBrowse:function(){var e=this.startChangesGrouping("zoom-out",!0);this.clearCurrent(),this.setLevelPartActive(this.getLevel(-1)),e&&this.finishChangesGrouping("zoom-out")}}}),i={same_model_matches:1,big_steps:4},s=function(e,t){return e.map_parent&&e.map_parent.getNesting("pioneer")!=t.map_parent},o=function(e){var t=[],n=[t],r=e,i=r.getNesting("pioneer");while(r)t.push(i),s(r,i)&&(t=[],n.push(t)),r=r.map_parent,i=r&&r.getNesting("pioneer");return n},u=function(e,t,n){var r=-1,i=0,o=0,u=e,a=u.getNesting("pioneer");while(u){if(a.model_name==t&&r!=o){r=o,i++;if(i==n)break}s(u,a)&&o++,u=u.map_parent,a=u&&u.getNesting("pioneer")}return i==n?r:-1},a=function(e){var t=1,n=e,r=n.getNesting("pioneer");while(n)s(n,r)&&t++,n=n.map_parent,r=n&&n.getNesting("pioneer");return t},l=function(e,t){var n=e.getNesting("pioneer"),r=n!=t.map_parent,i=a(e),s=i+(r?1:0),l=u(e,t.model_name,3);if(s>3||l!=-1){var c=3+(r?-1:0),h=l==-1?Infinity:l+1,p=Math.min(c,h),d=o(e),v=d.slice(0,p);return v.map(f).reverse()}return!1},c=function(e,t,n){var i=e.isCollectingChanges();i||e.startChangesCollecting();var s=l(t,n);if(s){e.startNewBrowse();var o=r.showInterest(e,s);e._goDeeper(n,o)}else{var u=p(t,n);B(u)?h(e,n,u):(h(e,t.getNesting("pioneer"),t),e._goDeeper(n,t))}i||e.finishChangesCollecting()},h=function(e,t,n,r){t.map_level_num==-1&&(n=e.getLevel(-1));var i=e.isCollectingChanges();i||e.startChangesCollecting();var s=!1;if(!n||!P(n)){var o;n?o=n.map_parent.getNesting("pioneer"):o=t.map_parent,s=h(e,o,n&&n.map_parent,!0)}var u=null;if(s||s===!1){s&&(n||(n=p(s,t)),(!n||!P(n))&&_(s));if(t.state("has_no_access"))t.switchPmd();else if(B(n))r||_(n),H(n)||M(e,n),u=n;else{if(!t.model_name)throw new Error("model must have model_name prop");u=e._goDeeper(t,n&&n.map_parent)}}return i||e.finishChangesCollecting(),u},p=function(e,t){return e.children_bwlevs[t._provoda_id]},d=function(e,t){if(!e.map_parent){if(t.mainLevelResident!=e)throw new Error("root map_parent must be `map.mainLevelResident`");return t.levels[-1].free}var n=d(e.map_parent,t);return p(n,e)},v=function(e,t){var n=e;while(n){var r=n.getNesting("pioneer"),i=t;while(i){if(r==i)return n;i=t.map_parent}n=n.map_parent}},m=function(e,t){var n=e.getNesting("pioneer"),r,i=[],s=t;while(s){if(n==s){r=!0;break}i.push(s),s=s.map_parent}if(!r)throw new Error("trying to get path for unconnected parts");return i.reverse()};r.getConnectedBwlev=function(e,t){var n=v(e,t),r=m(n,t),i=n;for(var s=0;s<r.length;s++)i=p(n,t);return i},r.getBwlevFromParentBwlev=p,e.Model.extendTo(g,{init:function(e,t,n,r,i){this._super.apply(this,arguments),this.children_bwlevs={},this.model_name=i.model_name;if(!this.model_name)throw new Error("must have model name");this.ptree=[this],this.rtree=[i.pioneer],this.map_parent&&(this.ptree=this.ptree.concat(this.map_parent.ptree),this.rtree=this.rtree.concat(this.map_parent.rtree))},getParentMapModel:function(){return this.map_parent},showOnMap:function(){h(this.map,this.getNesting("pioneer"),this)},requestPage:function(t){var n=e.getModelById(t),r=this.getNesting("pioneer"),i,s=n,o=[];while(s.map_parent){o.push(s);if(s.map_parent==r){i=!0;break}s=s.map_parent}o=o.reverse();if(!i)n.requestPage();else{var u=n.app.map,a=u.isCollectingChanges();a||u.startChangesCollecting(),h(u,r,this);var f=this;for(var l=0;l<o.length;l++){if(!f)continue;var c=o[l];c.state("has_no_access")?(f=null,c.switchPmd()):f=u._goDeeper(c,f)}a||u.finishChangesCollecting()}},zoomOut:function(){var e=this.getNesting("pioneer");(e.state("mp_stack")||e.state("mp_show"))&&O(this)},followTo:function(t){var n=e.getModelById(t);n.getRelativeModel&&(n=n.getRelativeModel()),c(this.map,this,n)},"stch-mpl_attached":function(r,i){var s=r.getNesting("pioneer"),o=n(s,"bmpl_attached");o=o?t.cloneObj({},o):{},o[r._provoda_id]=i,e.update(s,"bmpl_attached",o),e.update(s,"mpl_attached",t.countKeys(o,!0))}});var y=function(t,n,r){var i=n&&n.children_bwlevs,s=t._provoda_id,o;return!i||!i[s]?(o=e.create(g,{map_level_num:r,model_name:t.model_name,pioneer:t},{nestings:{pioneer:t}},n),i&&(i[s]=o)):o=i[s],o},b=function(e,t,n,r){if(e[t]!=n){var i=e[t];return e[t]=n,r&&r(n,i),{nv:n,ov:i}}},w=function(e,t){var n=e;for(var r=1;r<t;r++)n=n.map_parent;return n};r.showInterest=function(e,t){var n=t.shift(),r=e.isCollectingChanges();r||e.startChangesCollecting();var i=h(n.md.app.map,n.md);for(var s=0;s<t.length;s++){var o=t[s],u=o.distance;if(!u)throw new Error("must be distance: 1 or more");while(u){var a=w(t[s].md,u);i=e._goDeeper(a,i),u--}}return r||e.finishChangesCollecting(),i};var E=/(\#(?:\d*\:)?)/gi;r.getUserInterest=function(e,t){var n=e.split(E),i=[];while(n.length){var s=n.pop(),o=n.pop(),u=o&&o.slice(1,o.length-1);i.push({md:r.routePathByModels(t,s),distance:u||1})}return i.reverse()},r.routePathByModels=function(e,t,n){var r=t.replace(/^\//,"").replace(/([^\/])\+/g,"$1 ").split("/"),i=e,s=i,o=null;for(var u=0;u<r.length;u++){if(i.sub_pages_routes&&i.sub_pages_routes[r[u]]){o||(o=[]),o.push(r[u]);continue}var a;o?a=[].concat(o,[r[u]]).join("/"):a=r[u],o=null;if(n){var f=i.getSPIConstr(a);if(!f)throw new Error("you must use supported path");i=f.prototype,s=f}else{var l=i.getSPI(a);if(!l)break;i=l,s=l}}return s},r.Model=function(){};var S=function(e,t){var n=e["sub_pa-"+t]||e.sub_pa[t],r=t.split(":");return[{url_part:"/"+t,nav_title:n.title||n.getTitle&&n.getTitle.call(e)},{simple_name:t,name_spaced:r[1]}]},x=function(e,n){var r={},i=e.data_by_hp===!0?e.head_props:e.sub_pa_params,s=[i,n&&n[0]];for(var o=0;o<s.length;o++){if(!s[o])continue;t.cloneObj(r,s[o])}return r},T=function(e,t,n){return typeof n=="function"?n:t.getConstrByPathTemplate(e,n)},N=function(t,n,r){r=e.hp.getRightNestingName(n,r);if(n["nest_rqc-"+r]){var i=n["nest_rqc-"+r];if(Array.isArray(i)){if(!i.constrs_array){var s=[],o=i[1];for(var u in o){if(!o.hasOwnProperty(u))continue;s.push(o[u])}i.constrs_array=s}return i.constrs_array}return i}if(n["nest_posb-"+r])return n["nest_posb-"+r];if(n["nest-"+r]){var a=n["nest-"+r],f=a[0];if(Array.isArray(f)){var s=[];for(var l=0;l<f.length;l++)s.push(T(t,n,f[l]));return s}return T(t,n,f)}};r.getNestingConstr=N;var C=function(e,n,r){var i=[],s,o=r.merged_states,u=new Array(o.length);for(s=0;s<o.length;s++)u[s]=n.getNonComplexStatesList(o[s]);u=t.collapseAll.apply(null,u);for(s=0;s<u.length;s++){var a=u[s],f=n.getStateSources(a,e);f&&i.push(f)}i=t.collapseAll.apply(null,i);var l=[],c;for(c in r.m_children.children_by_mn)l.push(c);for(c in r.m_children.children)l.push(c);l=t.collapseAll(l);var h=[];for(s=0;s<l.length;s++){var p=n.getNestingSource(l[s],e);p&&h.push(p)}var d=[];for(c in r.m_children.children){var v=N(e,n,c);for(var m in r.m_children.children[c]){var g;if(!v)continue;if(Array.isArray(v)){g=[];for(s=0;s<v.length;s++){var y=C(e,v[s].prototype,r.m_children.children[c][m]);y.length&&(g=g.concat(y))}}else g=C(e,v.prototype,r.m_children.children[c][m]);g&&(d=d.concat(g))}}var b=i.concat(h);return d.length&&(b=b.concat(d)),t.collapseAll(b)};return r.getStrucSources=function(e,t){var n={};for(var r in t)n[r]=C(e.app,e,t[r]);return n},e.HModel.extendTo(r.Model,{network_data_as_states:!0,init:function(n,r){this.skip_map_init||r&&(r.url_part&&this.initState("url_part",r.url_part),r.nav_title&&this.initState("nav_title",r.nav_title)),this._super.apply(this,arguments),this.lists_list=null,this.head_props=this.head_props||null;if(this.hp_bound&&!r)throw new Error("pass data arg!");if(this.head_props)console.log("already has head_props");else if(this.hp_bound){var i={"--data--":null};this.map_parent.sub_pa_params&&t.cloneObj(i,this.map_parent.sub_pa_params),i["--data--"]=r,this.head_props=this.hp_bound(i)}n=n||{},this.data_by_hp&&typeof this.data_by_hp=="function"&&(this.sub_pa_params=this.data_by_hp(r)),this.allow_data_init&&this.updateManyStates(r),this.preview_nesting_source&&this.on("child_change-"+this.preview_nesting_source,function(t){e.updateNesting(this,"preview_list",t.value)})},preview_nesting_source:"lists_list",getSPIConstr:function(e){var t=this["sub_pa-"+e]||this.sub_pa&&this.sub_pa[e];if(t)return t.constr;if(this.subPager){var n=this.getSPC(decodeURIComponent(e),e);return Array.isArray(n)?n[0]:n}},getSPI:function(e){var n;this.sub_pages&&this.sub_pages[e]&&(n=this.sub_pages[e]);var r;if(!n){var i=this["sub_pa-"+e]||this.sub_pa&&this.sub_pa[e];if(i){var s=i.constr,o=S(this,e),u=x(this,o),a=s.prototype.data_by_urlname,f=s.prototype.head_by_urlname,l=a&&a(o[1]),c=f&&f(o[1]);c&&(u.head=c),t.cloneObj(u,l),r=[this.getSiOpts(),u],n=new s,this.sub_pages[e]=n}else if(this.subPager){var h=this.subPager(decodeURIComponent(e),e);Array.isArray(h)?(n=h[0],r=[this.getSiOpts(),h[1]]):n=h}n&&r&&this.useMotivator(n,function(e){e.init.apply(e,r)})}return n},preloadNestings:function(e){for(var t=0;t<e.length;t++){var n=this.getNesting(e[t]);n&&n.preloadStart()}},requestPage:function(){this.showOnMap()},showOnMap:function(){h(this.app.map,this)},getParentMapModel:function(){return this.map_parent},mlmDie:function(){return},hideOnMap:function(){e.update(this,"mp_show",!1)},setFullUrl:function(t){e.update(this,"mp_full_url ",t)},getTitle:function(){return this.state("nav_title")},onTitleChange:function(e){return this.on("vip_state_change-nav_title",e,{skip_reg:!0,immediately:!0})},offTitleChange:function(e){return this.off("vip_state_change-nav_title",e)},getURL:function(){return""}}),r.freeze=function(t){H(t)&&t.map.freezeMapOfLevel(t.state("map_level_num"))},r}),define("js/modules/aReq",["jquery"],function(e){var t;(function(){var e=0;t=function(t){var n="jspc_"+ ++e;return window[n]=t,n}})();var n="async"in document.createElement("script"),r=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,i=function(i){if(i.dataType!="jsonp")return e.ajax(i);if(r&&i.thisOriginAllowed)return i.dataType="json",i.crossDomain=!0,i.afterChange&&i.afterChange(i),e.ajax(i);var s,o,u,a,f=e.Deferred(),l=function(){s&&(delete s.src,b()),o&&delete o.src,u&&window[u]&&(window[u]=e.noop())},c={abort:function(){this.aborted=!0,l()}};f.promise(c);var h=i.timeout||e.ajaxSettings&&e.ajaxSettings.timeout;h&&(a=setTimeout(function(){f.reject()},h));var p={};e.extend(p,i.data||{});var d=i.callback||"callback";!i.jsonpCallback&&!p[d]&&(u=t(function(e){a&&clearTimeout(a),f.resolve(e)}),p[d]=u);var v=e.param(p),m=(i.url||"")+(v?"?"+v:""),g,y=function(){o=document.createElement("script"),o.async=!0,o.onload=function(){},o.onerror=function(){f.reject()},o.src=m,document.documentElement.firstChild.insertBefore(o,document.documentElement.firstChild.firstChild)},b=function(){s.onload=null,s.onerror=null};if(n)y();else if(i.resourceCachingAvailable){s=document.createElement("img");var w=function(){g||(g=!0,y())};s.src=m,s.complete?setTimeout(w,0):(s.onload=w,s.onerror=w)}else y();return c};return i}),define("js/modules/wrapRequest",["jquery"],function(e){return function(t,n,r){r=r||{};var i=e.Deferred();r.abort=function(){this.aborted=!0,i.reject("abort"),this.queued&&this.queued.abort(),this.xhr&&this.xhr.abort()},i.promise(r),n.nocache=n.nocache||!n.cache_ajax;var s;if(!n.nocache){s=n.cache_ajax.get(n.cache_namespace,n.cache_key,function(e){i.resolve(e)});if(s)return r.cache_used=!0,{defer:i,complex:r}}if(!s){var o=function(e){n.responseFn&&(e=n.responseFn(e),arguments[0]=e),i.resolve.apply(i,arguments);if(!n.not_save_cache&&n.cache_ajax){var t=n.checkResponse&&n.checkResponse(e);t||n.cache_ajax.set(n.cache_namespace,n.cache_key,e,n.cache_timeout)}},u=function(){if(r.aborted)return;if(!n.manualSend){var s;n.nocache||(s=n.cache_ajax.get(n.cache_namespace,n.cache_key,function(e){i.resolve(e)}));if(!s){var u;n.requestFn?u=n.requestFn(t):u=e.ajax(t),r.xhr=u,u.fail(function(){i.reject.apply(i,arguments)}).done(o),i.notify&&i.notify("just-requested")}}else n.manualSend(function(e){i.resolve(e)})};n.queue?r.queued=n.queue.add(u,n.not_init_queue):u()}return{defer:i,complex:r}}}),define("js/modules/net_apis",["spv","./aReq","hex_md5","./wrapRequest"],function(e,t,n,r){"use strict";var i=function(){};e.Class.extendTo(i,{init:function(e){this.cache_ajax=e.cache_ajax,this.queue=e.queue,this.crossdomain=e.crossdomain},thisOriginAllowed:!0,source_name:"google.com",cache_namespace:"goog_sc",get:function(i,s,o){if(!i)throw new Error("wrong query");var u={cx:"001069742470440223270:t1xni-63__0",v:"1.0",rsz:1,q:i};o=o||{},o.cache_key=o.cache_key||n("https://ajax.googleapis.com/ajax/services/search/web"+e.stringifyParams(u));var a=r({url:"https://ajax.googleapis.com/ajax/services/search/web",type:"GET",dataType:this.crossdomain?"json":"jsonp",data:u,timeout:2e4,context:o.context},{cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue});return a.complex}});var s=function(){};e.Class.extendTo(s,{init:function(e){this.cache_ajax=e.cache_ajax,this.queue=e.queue,this.crossdomain=e.crossdomain,this.key=e.key,this.secret=e.secret},errors_fields:["error"],source_name:"discogs.com",cache_namespace:"discogs",get:function(i,s,o){if(!i)throw new Error("wrong path");o=o||{},s=s||{},o&&o.paging&&(s.per_page=o.paging.page_limit,s.page=o.paging.next_page),o.cache_key=o.cache_key||n("https://api.discogs.com"+i+e.stringifyParams(s)),this.key&&(s.key=this.key),this.secret&&(s.secret=this.secret);var u=r({url:"https://api.discogs.com"+i,type:"GET",dataType:this.crossdomain?"json":"jsonp",data:s,timeout:2e4,resourceCachingAvailable:!0,afterChange:function(e){e.dataType=="json"&&(e.headers=null)},thisOriginAllowed:!1,context:o.context},{cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue,responseFn:function(e){return e.meta&&e.data&&(e=e.data),e}});return u.complex}});var o=function(){};e.Class.extendTo(o,{init:function(e){this.cache_ajax=e.cache_ajax,this.queue=e.queue,this.crossdomain=e.crossdomain},errors_fields:["error"],thisOriginAllowed:!0,source_name:"mixcloud.com",cache_namespace:"mixcloud",get:function(i,s,o){if(!i)throw new Error("wrong path");o=o||{},s=s||{},o&&o.paging&&(o.paging.limit=o.paging.page_limit,o.paging.offset=(o.paging.next_page-1)*o.paging.page_limit),o.cache_key=o.cache_key||n("https://api.mixcloud.com/"+i+e.stringifyParams(s));var u=r({url:"https://api.mixcloud.com/"+i,type:"GET",dataType:this.crossdomain?"json":"jsonp",data:s,timeout:2e4,resourceCachingAvailable:!0,afterChange:function(e){e.dataType=="json"&&(e.headers=null)},thisOriginAllowed:this.thisOriginAllowed,context:o.context},{cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue});return u.complex}});var u=function(){};return e.Class.extendTo(u,{init:function(e){this.cache_ajax=e.cache_ajax,this.queue=e.queue,this.xhr2=e.xhr2,this.crossdomain=e.crossdomain,this.can_send=this.xhr2||this.crossdomain},checkResponse:function(e){return!e.version},source_name:"hypem.com",cache_namespace:"hypem",get:function(t,i,s){if(!t)throw new Error("wrong path");var o="http://hypem.com"+t;s=s||{},s.cache_key=s.cache_key||n(o+e.stringifyParams(i));var u=r({url:o,type:"GET",dataType:"json",data:i,timeout:2e4,headers:null,thisOriginAllowed:!0,afterChange:function(e){e.dataType=="json"&&(e.headers=null)},context:s.context},{cache_ajax:this.cache_ajax,nocache:s.nocache,cache_key:s.cache_key,cache_timeout:s.cache_timeout,cache_namespace:this.cache_namespace,queue:this.queue});return u.complex}}),{GoogleSoundcloud:i,DiscogsApi:s,MixcloudApi:o,HypemApi:u}}),define("js/models/PlayRequest",["pv"],function(e){function i(){}var t=e.update,n=function(e,t){if(t===!0)e.map_parent.setWaitingNextSong(e.map_parent,e);else if(t)return t},r=function(e){return e.finup=!0,e};return e.Model.extendTo(i,{"compx-play_inited":[["play_inited","resolved"],function(e,t){return e||t}],"compx-possible_song":[["active","play_inited","next_song","@wanted_song","wanted_file","song_of_wanted_file"],function(e,t,n,r,i,s){return e&&(t&&n?n:i?s:r)}],"stch-possible_song":r(function(e,n,r){e.updateNesting("possible_song",n),r&&t(r,"want_to_play",!1),n&&t(n,"want_to_play",!0),n&&n.makeSongPlayalbe(!0)}),"compx-song_files_ready":[["@one:files_search:possible_song"],function(e){return e}],"compx-expected_song":[["wanted_file","possible_song"],function(e,t){return e&&e.mo||t}],"compx-playable_mopla":[["no_wait","song_files_ready","@one:mf_cor_current_mopla:possible_song","@one:can_play:possible_song.mf_cor"],function(e,t,n,r){if(e)return n;if(!t||!r)return;if(!t.exsrc_incomplete&&(t.search_complete||t.have_best_tracks))return n}],"stch-playable_mopla":r(function(e,t){if(t){var n=e.getNesting("possible_song");n.play()}}),"compx-timer":[["need_timer_for"],function(e){if(e)return setTimeout(function(){e.play()},2e4)}],"stch-timer":function(e,t,n){n&&clearTimeout(n)},"compx-need_timer_for":[["song_files_ready","current_song"],function(e,t){if(!e)return;var n=this.getNesting("possible_song");if(n==t)return;if(!n.canPlay())return;if(!!e.exsrc_incomplete||!e.search_complete&&!e.have_best_tracks)return n}],switchSong:function(t){e.update(this,"next_song",t)},playNext:function(){var t=this.state("current_song");if(t.state("rept-song"))t.play(),e.update(this,"next_song",t);else{var r=n(t,t.map_parent.switchTo(t,!0,!0));this.switchSong(r)}},"compx-no_wait":[["possible_song","song_of_wanted_file"],function(e,t){return e===t}],"compx-song_of_wanted_file":[["wanted_file"],function(e){return e&&e.mo}],"stch-song_of_wanted_file":function(e,t){e.updateNesting("song_of_wanted_file",t)}}),i}),define("js/models/SongFileModel",["pv","app_serv","spv","./PlayRequest"],function(e,t,n,r){var i=t.app_env,s=function(e){return e.finup=!0,e},o=e.state,u=e.update,a=function(){};e.Model.extendTo(a,{model_name:"file-torrent",init:function(e,t,n){this._super.apply(this,arguments),this.sr_item=n.file,this.updateManyStates({full_title:this.sr_item.title,torrent_link:this.sr_item.torrent_link})},setPlayer:function(){return this},activate:function(){return this},deactivate:function(){return this},download:function(){window.btapp?btapp.add.torrent(this.sr_item.torrent_link):i.openURL(this.sr_item.torrent_link),e.update(this,"download-pressed",!0)}});var f=e.utils.isDepend,l=0,c=function(){};return e.Model.extendTo(c,{model_name:"file-http",init:function(e,t,n){this._super.apply(this,arguments),this.mo=this.map_parent.map_parent;if(n.file){var r=n.file;for(var i in r)typeof r[i]!="function"&&typeof r[i]!="object"&&(this[i]=r[i]);this.parent=r}return this.uid="song-file-"+l++,this.createTextStates(),this.setPlayer(this.app.p),this},requestPlay:function(t){this.map_parent.selectMopla(this);var n=e.getModelById(t),i=e.create(r,{wanted_file:this},{nestings:{bwlev:n}},n,this.app);this.player&&this.player.requestPlay(i)},switchPlay:function(e){this.state("selected")?this.state("play")=="play"?this.pause():this.requestPlay(e):this.requestPlay(e)},createTextStates:function(){var e={};e.title=this.getTitle(),this.from&&(e.source_name=this.from),this.description&&(e.description=this.description),this.duration&&(e.duration=this.duration),this.updateManyStates(e)},"compx-visible_duration":[["duration","loaded_duration"],function(e,t){return e||t}],"compx-play_position":[["visible_duration","playing_progress"],function(e,t){return Math.round(e*t)}],getNiceSeconds:function(e){if(typeof e=="number"){var t=Math.round(e/1e3);if(t){var r=t%60;return n.zerofyString(Math.floor(t/60),2)+":"+n.zerofyString(r,2)}}},"compx-visible_duration_text":[["visible_duration"],function(e){return this.getNiceSeconds(e)}],"compx-play_position_text":[["play_position"],function(e){return this.getNiceSeconds(e)}],"compx-load_file":[["file_to_load-for-player_song","file_to_load-for-preload_current_file"],function(e,t){return f(e)||f(t)}],"stch-load_file":s(function(e,t){t?e.load():e.removeCache()}),getTitle:function(){var e=[];return this.artist&&e.push(this.artist),this.track&&e.push(this.track),e.join(" - ")},events:{finish:function(){var t=this==this.mo.mopla&&this.mo;e.update(this,"play",!1)},play:function(){var t=this==this.mo.mopla&&this.mo;t&&(t.start_time||(t.start_time=(Date.now()/1e3).toFixed(0))),e.update(this,"play","play")},playing:function(t){var n=t.position/t.duration;e.update(this,"playing_progress",n),e.update(this,"loaded_duration",t.duration)},buffering:function(t){e.update(this,"buffering_progress",!!t)},loading:function(t){var n;t.loaded&&t.total?n=t.loaded/t.total:t.duration&&t.fetched&&(n=t.fetched/t.duration),n&&e.update(this,"loading_progress",n)},pause:function(){var t=this==this.mo.mopla&&this.mo;e.update(this,"play",!1)},stop:function(){var t=this==this.mo.mopla&&this.mo;e.update(this,"play",!1)},error:function(){var n=new Date;e.update(this,"error",n),this.parent&&(this.parent.error=n);var r=this;t.getInternetConnectionStatus(function(e){if(e){var t=r.state("playing_progress");t?setTimeout(function(){r.state("playing_progress")==t&&r.failPlaying()},3500):r.failPlaying()}})}},failPlaying:function(){var e=o(this,"unavailable")||0,t=e+1;u(this,"unavailable",t),this.parent&&(this.parent.unavailable=t),this.trigger("unavailable")},setPlayer:function(e){return e&&(this.player=e,e.attachSong(this)),this},_createSound:function(){this.sound||(this.sound=!!this.player.create(this))},play:function(){if(this.player){if(this.mo.state("forbidden_by_copyrh"))return;this._createSound();if(this.sound)return this.player.play(this),!0}},removeCache:function(){this.unloadOutBox&&this.unloadOutBox(),this.player.remove(this),this.sound=null},stop:function(){this.player&&(this.pause(),this.setPosition(0,!1,!0),this.removeCache(),e.update(this,"play",!1),e.update(this,"loading_progress",0),e.update(this,"playing_progress",0),this.sound=null)},pause:function(){this.player&&this.player.pause(this)},setVolumeByFactor:function(e){this.setVolumeByFactor(!1,e)},setVolume:function(e,t){this.player&&this.player.setVolume(this,e,t)},getDuration:function(){return this.duration||this.state("loaded_duration")},setPositionByFactor:function(e){this.setPosition(!1,e)},setPosition:function(e,t,n){this.player&&(this.player.setPosition(this,e,t),n||this.mo.posistionChangeInMopla(this))},load:function(){this.player&&(this.loadOutBox&&this.loadOutBox(),this._createSound(),this.sound&&this.player.load(this))},activate:function(){e.update(this,"selected",!0)},deactivate:function(){e.update(this,"selected",!1)},markAsPlaying:function(){},unmarkAsPlaying:function(){}}),c.FileInTorrent=a,c}),define("js/libs/Mp3Search",["pv","spv","../models/SongFileModel"],function(e,t,n){var r=function(e,t){var n=e.slice(0,80),r={};if(!n)return r;var i=!t||t.search(/^\d+?\s?\S*?\s/)===0;if(i){var s=n.match(/\s?[\—\-\—\–]\s/gi);s&&s.length>1&&(n=n.replace(/^\d+[\s\.\—\-\—\–\_\|\+\(\)\*\&\!\?\@\,\\\/\❤\♡\'\"\[\]]*\s?/,""))}var o=n.split(/\s?[\—\-\—\–]\s/),u=n.match(/([\s\S]*?)\s?[\—\-\—\–]\s/);if(o&&o.length>1)if(o[0]==t)r.artist=u[1],r.track=n.replace(u[0],"");else if(o[o.length-1]==t){var a=n.match(/\s?[\—\-\—\–]\s([\s\S]*?)$/);a&&a[1]&&(r.artist=a[1],r.track=n.replace(a[0],""))}if(!r.artist){var f=n.match(/by[\s]+?(.+)/);t&&f&&f[1]&&f[1]==t?(r.artist=t,r.track=n.replace(f[0],"")):o&&o.length>1?(r.artist=u[1],r.track=n.replace(u[0],"")):t&&f&&(r.artist=t,r.track=n.replace(f[0],""))}return r},i=function(){};t.Class.extendTo(i,{init:function(e,t){},match:function(){this.trim_index||(this.trim_index={});for(var e=0;e<this.match_order.length;e++){var t=this.match_order[e].call(this,this.under_consideration,this.query);if(typeof t=="number"){if(t!==0)while(t>=10)t/=10;this.match_index=e*10+t*1;break}}typeof this.match_index!="number"&&(this.match_index=-1),this.trim_index=null},toQueryString:function(e){return(e.artist||"")+(e.track?" - "+e.track:"")},valueOf:function(){return this.match_index},hardTrim:function(e,n){var r;return this.trim_index[e]||(r=t.hardTrim(e),this.trim_index[e]=r),r=this.trim_index[e],n?r.length>=n?r:e:r}});var s=function(e,t){this.trim_index=null,this.under_consideration=e,this.query=t,this.query_string=this.toQueryString(this.query),this.match_order=[this.matchers.full,this.matchers.almost,this.matchers.anyGood,this.matchers.byWordsInTrackField,this.matchers.byWordsInFullTitle,this.matchers.inDescription],this.match()};i.extendTo(s,{matchers:{full:function(e,t){return e.artist==t.artist&&(!t.track||e.track==t.track)&&0},almost:function(e,t){if(t.artist&&e.artist&&this.hardTrim(t.artist).length>=3&&(!t.track||this.hardTrim(t.track).length>=3))return this.hardTrim(t.artist)==this.hardTrim(e.artist)&&(!t.track||this.hardTrim(t.track)==this.hardTrim(e.track))&&0},anyGood:function(e,t){var n=this.hardTrim((e.artist||"")+" "+(e.track||""),3);if(t.q){if(n.indexOf(this.hardTrim(t.q,3))!=-1)return 0}else{var r=this.hardTrim(t.artist,3),i=e.artist&&r&&this.hardTrim(e.artist,3).indexOf(r)!=-1;if(!t.track){if(i)return 0}else{var s=this.hardTrim(t.track,3),o=e.track&&s&&this.hardTrim(e.track,3).indexOf(s)!=-1;if(i&&o)return 0;this.artist_in_full_title=r&&n.indexOf(r)!=-1;var u=e.track&&s&&n.indexOf(s)!=-1;if(this.artist_in_full_title&&u)return 5}}},byWordsInTrackField:function(e,n){if(this.artist_in_full_title&&n.track){var r=t.matchWords(this.hardTrim(e.track,3),this.hardTrim(n.track,3));if(r.forward)return 0;if(r.any)return 5}},byWordsInFullTitle:function(e,n){if(this.artist_in_full_title&&n.q||n.track){var r=this.hardTrim((e.artist||"")+" "+(e.track||""),3),i=n.q||(n.artist||"")+" - "+(n.track||""),s=t.matchWords(r,this.hardTrim(i,3));if(s.forward)return 0;if(s.any)return 5}},inDescription:function(e,t){if(e.description){if(!t.track)return;var n=this.hardTrim(e.description,3);if(!n)return!1;var i=this.hardTrim(t.artist,3),o=this.hardTrim(t.track,3),u=e.description.split(/\n/);if(u.length>1)for(var a=0;a<u.length;a++){if(!u[a]||!u[a].replace(/\s/gi,""))continue;var f=r(u[a],t.artist);if(!f.artist)continue;var l=new s(f,t);if(l!=-1)return l*1}else{var c=e.artist&&i&&n.indexOf(i)!=-1,h=e.track&&o&&n.indexOf(o)!=-1;if(c&&h)return 9}}}}});var o=function(){};e.Model.extendTo(o,{init:function(t,n){this._super(),this.app=t.app;var r=n.search_name;this.wch(this.app,"settings-files_sources",function(t){e.update(this,"settings",t.value&&t.value[r])}),this.updateManyStates(n)},"compx-disable_search":[["settings"],function(e){return e&&e.disable_search}],"compx-wait_before_playing":[["settings"],function(e){return e&&e.wait_before_playing}],changeSetting:function(e,n){var r=this.app.settings.files_sources;r=r?t.cloneObj({},r):{},t.setTargetField(r,[this.state("search_name"),e],n),r[this.state("search_name")]=t.cloneObj({},r[this.state("search_name")]),this.app.setSetting("files_sources",r)},changeTune:function(e,t){this.changeSetting(e,t)}});var u=function(e){return(e.artist||"")+(e.track?" - "+e.track:"")},a=function(e,t,n,r){var i=u(t);return e.query_match_index=e.query_match_index||{},e.query_match_index[i]&&!r?e.query_match_index[i]:(e.query_match_index[i.replace(/\./gi,"")]=n?new n(e,t)*1:new s(e,t)*1,e.query_match_index[i])},f=function(e,n){var r=u(n);return t.getTargetField(e,["query_match_index",r.replace(/\./gi,"")])},l=function(e,t){var n=[];if(!e)return n;for(var r=0;r<e.length;r++){var i=e[r],s=a(i,t);s!=-1&&n.push(i)}return n},c=function(){};e.Model.extendTo(c,{init:function(t,n,r){this.map_parent=t.map_parent,this._super(),this.mp3_search=t.mp3_search,this.search_name=r,this.search_eng=this.mp3_search.getSearchByName(r),this.msq=n.msq,this.query_string=n.query_string,this.updateManyStates({dmca_url:this.search_eng&&this.search_eng.dmca_url,search_name:r}),this.tuner=this.mp3_search.getSourceTuner(r),this.wch(this.tuner,"disable_search",function(t){e.update(this,"disable_search",t.value)}),this.wch(this.tuner,"wait_before_playing")},switchTunerVisibility:function(){var t=this.getNesting("vis_tuner");e.updateNesting(this,"vis_tuner",t?null:this.tuner)},startSearch:function(e){e=e||{};if((!this.state("search_complete")||this.state("search_fail"))&&!this.state("search_progress"))return this.makeRequest(this.msq,{only_cache:e.only_cache,nocache:e.nocache})},addFile:function(t){var n=[],r=this.state("injected_files")||[];n=n.concat(r),n.push(t),e.update(this,"injected_files",n)},getFiles:function(e){var n=this.state("files-list");return n&&n.length?e?t.filter(n,"media_type",e):n:[]},complex_states:{request_required:[["disable_search","^must_load"],function(e,t){return!e&&t}],"files-list":[["search_result","injected_files"],function(e,t){var n=[];return e&&e.length&&(n=n.concat(e)),t&&t.length&&(n=n.concat(t)),n.length&&this.mp3_search.sortMusicFilesArray(n,this.msq),!!n.length&&n}],has_mp3_files:[["files-list"],function(e){if(!e)return;for(var t=0;t<e.length;t++)if(e[t].media_type=="mp3")return!0}],has_best_files:[["files-list"],function(e){if(!e)return;var n="query_match_index."+u(this.msq).replace(/\./gi,""),r=t.filter(e,n,function(e){if(e!==-1&&e<20)return!0});return!!r.length}],has_files:[["files-list"],function(e){return e&&!!e.length}],has_any_data:[["has_files","search_complete"],function(e,t){return!!e||!!t}]},"stch-request_required":function(e,t){t&&e.startSearch()},makeRequest:function(n,r){if(!this.search_eng||r.only_cache||this.state("has_request"))return;var i=this,s,o=new t.Depdc(!0);o.abort=function(){s&&s.abort()},s=this.search_eng.findAudio(n,{nocache:r.nocache,bindRelation:this.map_parent.bindRelation}).progress(function(){e.update(i,"search_progress",!0)}).done(function(t){t instanceof Error?i.updateManyStates({search_result:null,search_fail:!0,search_progress:!1,has_request:!1,search_complete:!0}):t instanceof e.Model?(e.update(i,"search_fail",!1),i.wlch(t,"@items","search_result"),i.lwch(t,"query_complete",function(e){e&&i.updateManyStates({search_complete:!0,search_progress:!1,has_request:!1})})):i.updateManyStates({search_result:l(t,n),search_fail:!1,search_progress:!1,has_request:!1,search_complete:!0})}).fail(function(){i.updateManyStates({search_fail:!0,search_progress:!1,has_request:!1,search_complete:!0})});var u;return s&&(o.queued=s.queued,s.promise(o),u=o,this.addRequest(o)),e.update(this,"has_request",!0),u}});var h=e.utils.isDepend,p=e.state,d=e.updateNesting,v=function(e,t){return function(n,r,i,s){var o=[];for(var u=0;u<s.items.length;u++)t(s.items[u])&&o.push(s.items[u]);d(n,e,o)}},m=function(){};e.Model.extendTo(m,{init:function(e,t){this._super(),this.sources={},this.sources_list=[],this.checked_files={},this.mp3_search=e.mp3_search,this.msq=t.msq,this.query_string=t.query_string,this.createRelationsBinder(),this.mp3_search.on("list-changed",this.hndListChange,{soft_reg:!1,context:this}),this.wch(this.mp3_search,"big_files_list",this.hndBigFilesList),this.nextTick(function(e){e.startSearch({only_cache:!0})})},"stch-disable_search@sources_list":v("available_sources",function(e){return!p(e,"disable_search")}),"stch-wait_before_playing@sources_list":v("expected_sources",function(e){return p(e,"wait_before_playing")}),"compx-has_request":[["@some:has_request:available_sources"]],"compx-search_progress":[["@some:search_progress:available_sources"]],"compx-search_complete":[["@every:search_complete:available_sources"]],"compx-has_files":[["@some:has_files:available_sources"]],"compx-has_mp3_files":[["@some:has_mp3_files:available_sources"]],"compx-has_best_files":[["@some:has_best_files:available_sources"]],"compx-exsrc_has_request":[["@some:has_request:expected_sources"]],"compx-exsrc_search_complete":[["@every:search_complete:expected_sources"]],"compx-must_load":[["investg_to_load-for-song_need"],function(e){return h(e)}],"stch-must_load":function(e,t){t&&e.startSearch()},createRelationsBinder:function(){var e=this;this.bindRelation=function(t){e.wch(e,"must_load",t)}},hndBigFilesList:function(e){var t=e&&e.value||[];for(var n=0;n<t.length;n++)this.delayFileCheck(t[n])},hndListChange:function(t){var n=this;for(var r=0;r<t.length;r++){var i=t[r].name;this.sources[i]||(this.sources[i]=this.bindSource(i,{msq:this.msq,query_string:this.query_string},this.mp3_search),this.sources_list.push(this.sources[i]))}this.sources_list.sort(function(e,t){return n.byBestSearchIndex(e,t,n.mp3_search.searches_pr)}),e.updateNesting(this,"sources_list",this.sources_list)},addFbS:function(t){var n=this;this.sources[t]||(this.sources[t]=this.bindSource(t,{msq:this.msq,query_string:this.query_string},this.mp3_search),this.sources_list.push(n.sources[t]),this.sources_list.sort(function(e,t){return n.byBestSearchIndex(e,t,n.mp3_search.searches_pr)}),e.updateNesting(this,"sources_list",this.sources_list))},bindSource:function(e,t,n){var r=new c;this.useMotivator(r,function(){r.init({map_parent:this,mp3_search:n},t,e)});var i=this;return r.on("requests",function(e){i.addRequests(e)}),r},complex_states:{exsrc_incomplete:[["exsrc_has_request","exsrc_search_complete"],function(e,t){return e&&!t}],"legacy-files-search":[["has_best_files","has_files","has_mp3_files","search_complete","exsrc_incomplete"],function(e,t,n,r,i){return{have_best_tracks:e,have_tracks:t,have_mp3_tracks:n,exsrc_incomplete:i,search_complete:r}}],search_ready_to_use:[["has_best_files","search_complete"],function(e,t){return e||t}]},startSearch:function(e){return;var t,n},byBestSearchIndex:function(e,t,n){if(e&&t){var r=n[e.search_name],i=n[t.search_name];return typeof r=="undefined"&&(r=-1e3),typeof i=="undefined"&&(i=-1e3),r<i?1:r>i?-1:0}return 0},delayFileCheck:function(e){e.artist==this.msq.artist&&this.nextTick(function(t){t.checkFile(e)})},checkFile:function(e){var n=e.from,r=e._id||e.link,i=t.getTargetField(this.checked_files,[n,r]);if(!i){this.checked_files[n]=this.checked_files[n]||{},this.checked_files[n][r]=!0;var s=this.mp3_search.setFileQMI(e,this.msq);s!==-1&&s<20&&this.addFile(e,n)}},addFile:function(e,t){this.addFbS(t),this.sources[t].addFile(e)}});var g=function(e,t,n){var r=/(^\s*)|(\s*$)/g;if(!e.length)return!1;for(var i=n||0,s=e.length;i<s;i++)if(e[i].artist.replace(r,"")==t.artist.replace(r,"")&&e[i].track.replace(r,"")==t.track.replace(r,"")&&e[i].duration==t.duration)return!0},y=function(e,n){var r={},i=function(e){if(e&&e>n)return!0};for(var s in e.qmi_index){var o=t.filter(t.filter(e.qmi_index[s],"duration",i),"duration"),u=0;for(var a=0;a<o.length;a++)u+=o[a];u&&(r[s]=u/o.length)}return r},b=window.Mp3Search=function(t,n){this.init(),this.app=t.app,this.se_list=[],this.searches_pr=n||{},this.tools_by_name={},e.update(this,"tools_by_name",this.tools_by_name),this.investgs={},this.investgs_by_artist={},this.files_ids={},this.pushed_files_by_artist={},this.tuners={},this.on("list-changed",function(t){var n={};if(t)for(var r=0;r<t.length;r++){var i=t[r];i.disabled||(n[i.name]=!0)}e.update(this,"tools_by_name",n)})};return b.getSongFileModel=function(e){return e.initSi(n,null,{file:this})},b.getSFM=function(e,t){return t.getSongFileModel?t.getSongFileModel(e):e.initSi(n,null,{file:t})},b.setFileQMI=a,b.getFileQMI=f,b.hasMusicCopy=g,b.guessArtist=r,b.QueryMatchIndex=i,e.Model.extendTo(b,{"regfr-listchange":{event_name:"list-changed",fn:function(){if(this.se_list.length)return[this.se_list]}},getSourceTuner:function(e){if(!this.tuners[e]){var t=new o;t.init({app:this.app},{search_name:e}),this.tuners[e]=t}return this.tuners[e]},getQueryString:u,sortMusicFilesArray:function(e,n,r){var i=this.searches_pr,s=u(n);r=r||3e4;var o=["query_match_index",s.replace(/\./gi,"")];e.qmi_index=t.makeIndexByField(e,o);var a=y(e,r);e.sort(function(e,n){return t.sortByRules(e,n,[function(e){var n=t.getTargetField(e,o);return n===-1?Infinity:n},{field:function(e){return e.from&&i.hasOwnProperty(e.from)?i[e.from]:-1e3},reverse:!0},function(e){var n=a[t.getTargetField(e,o)];return n?e.duration&&e.duration>r?Math.abs(n-e.duration):n*1e3:Infinity}])})},getFileQMI:f,setFileQMI:a,getFilesInvestg:function(e,t){var n=e.q||u(e),r=this.investgs[n];if(!r){r=new m,this.useMotivator(r,function(){r.init({mp3_search:this},{msq:e,query_string:n})},t),this.investgs[n]=r;if(e.artist){var i=e.artist.toLowerCase();this.investgs_by_artist[i]=this.investgs_by_artist[i]||[],this.investgs_by_artist[i].push(r)}}return r},newSearchInit:function(e,t){this.tools_by_name[e]=t,this.trigger("list-changed",this.se_list),this.trigger("new-search",t,e)},getMasterSlaveSearch:function(e){var t={exist_slave:!1,exist_alone_master:!1,exitst_master_of_slave:!1},n,r,i;for(n=0;n<this.se_list.length;n++){var s=this.se_list[n];if(!s.disabled&&s.name==e&&s.slave&&!t.exist_slave){t.exist_slave=s;break}}for(n=0;n<this.se_list.length;n++){var s=this.se_list[n];!s.disabled&&s.name==e&&(s.slave||(t.exist_slave?t.exist_slave.preferred==s?t.exitst_master_of_slave=s:t.exist_alone_master=s:t.exist_alone_master=s))}return t},addFileToInvestg:function(e,t){var n=this.setFileQMI(e,t);if(n!=-1){var r=this.getFilesInvestg(t);r.addFile(e,e.from)}},pushSomeResults:function(t){var n=[];for(var r=0;r<t.length;r++){var i=t[r],s=i.from+"_"+(i._id||i.link);this.files_ids[s]||(this.files_ids[s]=!0,n.push(i))}var o=this.state("big_files_list ")||[];o=o.concat(n),e.update(this,"big_files_list ",o)},haveSearch:function(e){var t=this.getMasterSlaveSearch(e);return!!t.exist_slave||!!t.exitst_master_of_slave||!!t.exist_alone_master},isNoMasterOfSlave:function(e){var t=this.getMasterSlaveSearch(e);return!!t.exist_slave&&!t.exitst_master_of_slave},addSearch:function(e,t){this.spaces=this.spaces||{};var n=this.spaces;n[e]=t},getSearchByName:function(e){return this.tools_by_name[e]},add:function(e,t){var n=this.getMasterSlaveSearch(e.name);if(n.exist_slave){if(t||!n.exitst_master_of_slave)n.exist_slave.preferred&&(n.exist_slave.preferred.disabled=!0),this.se_list.push(e),n.exist_slave.preferred=e,this.newSearchInit(e.name,e)}else n.exist_alone_master?t&&(n.exist_alone_master.disabled=!0,this.se_list.push(e),this.newSearchInit(e.name,e)):(this.se_list.push(e),this.newSearchInit(e.name,e))},remove:function(e){var n=this.se_list;this.se_list=t.arrayExclude(this.se_list,e),n.length!=this.se_list&&this.trigger("list-changed",this.se_list)}}),b}),define("js/common-libs/htmlencoding",[],function(){"use strict";function s(t,r){var i=e[r];!i&&r[0]==="#"&&(r[1]==="x"||r[1]==="X"?i=parseInt(r.substring(2),16):i=parseInt(r.substring(1),10),isNaN(i)&&(i=undefined));var s;return i||n[r]&&(s=n[r]),i?String.fromCharCode(i):s||t}function u(e){var n=t[e];return n?n:e}var e={nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",Agrave:"192",Aacute:"193",Acirc:"194",Atilde:"195",Auml:"196",Aring:"197",AElig:"198",Ccedil:"199",Egrave:"200",Eacute:"201",Ecirc:"202",Euml:"203",Igrave:"204",Iacute:"205",Icirc:"206",Iuml:"207",ETH:"208",Ntilde:"209",Ograve:"210",Oacute:"211",Ocirc:"212",Otilde:"213",Ouml:"214",times:"215",Oslash:"216",Ugrave:"217",Uacute:"218",Ucirc:"219",Uuml:"220",Yacute:"221",THORN:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",255:"yuml"},t={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt"},n={amp:"&",quot:'"',lt:"<",gt:">"},r=/&([#a-z0-9]+);/gi,i=/[&"<>]/g,o=function(t){return t&&(t=t.replace(r,s)),t||""},a=function(t){return t&&(t=t.replace(i,u)),t||""};return{encode:a,decode:o}}),define("js/libs/ScApi",["spv","js/modules/aReq","js/modules/wrapRequest","hex_md5","js/common-libs/htmlencoding","js/libs/Mp3Search"],function(e,t,n,r,i,s){var o=function(e,t,n,r){this.queue=t,this.key=e,this.crossdomain=n,this.cache_ajax=r};o.prototype={errors_fields:[],constructor:o,source_name:"soundcloud.com",cache_namespace:"soundcloud_api",thisOriginAllowed:!0,get:function(i,s,o){if(i){o=o||{},s=s||{},o&&o.paging&&(s.limit=o.paging.page_limit,s.offset=o.paging.page_limit*(o.paging.next_page-1)),s.consumer_key=this.key,o.cache_key=o.cache_key||r("http://api.soundcloud.com/"+i+e.stringifyParams(s));var u=n({url:"http://api.soundcloud.com/"+i+".json",type:"GET",dataType:this.crossdomain?"json":"jsonp",data:s,timeout:2e4,resourceCachingAvailable:!0,afterChange:function(e){e.dataType=="json"&&(e.headers=null)},thisOriginAllowed:this.thisOriginAllowed,context:o.context},{cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue});return u.complex}}};var u=function(e){this.sc_api=e.api,this.mp3_search=e.mp3_search};return u.prototype={constructor:u,name:"soundcloud",description:"soundcloud.com",slave:!1,s:{name:"soundcloud",key:0,type:"mp3"},dmca_url:"http://soundcloud.com/pages/dmca_policy",preferred:null,makeSongFile:function(e){return this.makeSong(e)},makeSong:function(e,t){var n=e.title,r;if(n){var o=s.guessArtist(n,t&&t.artist);r={artist:i.decode(o.artist||e.user.permalink||""),track:i.decode(o.track||n),duration:e.duration,link:(e.download_url||e.stream_url)+"?consumer_key="+this.sc_api.key,from:"soundcloud",real_title:e.title,page_link:e.permalink_url.replace(/^http\:/,"https:"),description:i.decode(e.description)||!1,downloadable:e.downloadable,_id:e.id,type:"mp3",media_type:"mp3"}}return r},findAudio:function(e,t){var n=this,r=e.q?e.q:(e.artist||"")+(e.track?" - "+e.track:"");t=t||{},t.cache_key=t.cache_key||r;var i={filter:"streamable,downloadable",limit:30,q:r},o=this.sc_api.get("tracks",i,t),u=o.done,a;return o.done=function(t){return u.call(this,function(r){if(!a){var i=[];if(r&&r.length)for(var o=0;o<r.length;o++){if(!r[o])continue;var u=n.makeSong(r[o],e);u&&(s.hasMusicCopy(i,u)||i.push(u))}a=i}t(a,"mp3")}),this},o}},o.ScMusicSearch=u,o}),define("js/modules/torrent_searches",["spv","js/modules/aReq","js/modules/wrapRequest","hex_md5","jquery","js/common-libs/htmlencoding","js/models/SongFileModel"],function(e,t,n,r,i,s,o){var u=function(e){e.initSi(o.FileInTorrent,null,{file:this})},a=function(e){var t=document.createElement("div");return t.innerHTML=e,i(t).text()},f=function(e){this.mp3_search=e.mp3_search,this.cache_ajax=e.cache_ajax};f.prototype={constructor:f,cache_namespace:"isohunt",name:"torrents",s:{name:"Isohunt torrents",key:0,type:"torrent"},send:function(e,t){if(e){t=t||{},t.cache_key=t.cache_key||r("zzzzzzz"+e);var i=n({url:"http://ca.isohunt.com/js/json.php",type:"GET",dataType:"json",data:{ihq:e},timeout:2e4,context:t.context},{cache_ajax:this.cache_ajax,nocache:t.nocache,cache_key:t.cache_key,cache_timeout:t.cache_timeout,cache_namespace:this.cache_namespace,queue:this.queue});return i.complex}},findAudio:function(e,t){var n=this,r=e.q?e.q:(e.artist||"")+(e.track?" - "+e.track:"");t=t||{},t.cache_key=t.cache_key||r;var i=this.send(r,t),s,o=i.done;return i.done=function(t){return o.call(this,function(r){if(!s){s=[];if(r.items&&r.items.list)for(var i=0;i<Math.min(r.items.list.length,10);i++)n.wrapItem(s,r.items.list[i],e)}t(s,"torrent")}),this},i},url_regexp:/torrent\_details\/(\d*)\//,wrapItem:function(e,t,n){e.push({isohunt_id:t.guid,title:a(t.title),media_type:"torrent",torrent_link:"http://isohunt.com/download/"+t.guid,query:n,getSongFileModel:u})}};var l=function(e){this.mp3_search=e.mp3_search,this.cache_ajax=e.cache_ajax,this.queue=e.queue};l.prototype={cache_namespace:"btdigg",name:"torrents",s:{name:"Btdigg torrents",key:0,type:"torrent"},send:function(e,i){var s=this;if(e){i=i||{},i.cache_key=i.cache_key||r("zzzzzzz"+e);var o=n({url:"http://btdigg.org/search?info_hash",type:"GET",dataType:"text",data:{q:e},timeout:2e4,context:i.context},{cache_ajax:this.cache_ajax,nocache:i.nocache,cache_key:i.cache_key,cache_timeout:i.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue});return o.complex}},findAudio:function(e,t){var n=this,r=e.q?e.q:(e.artist||"")+(e.track?" - "+e.track:"");t=t||{},t.cache_key=t.cache_key||r;var s=this.send('"'+e.artist+'"'+" "+'"'+e.track+'"'+" mp3",t),o,u=s.done;return s.done=function(t){return u.call(this,function(r){if(!o){o=[];var s=document.createElement("html");s.innerHTML=r.replace(/src\=/gi,"none="),i(s).find(".torrent_name").each(function(){n.wrapItem(o,this,e)})}t(o,"torrent")}),this},s},wrapItem:function(e,t,n){var r=i(t),s=r.parent().parent().parent().parent(),o,a=s.find("a[href]"),f;for(f=0;f<a.length;f++){var l=a[f].href;if(l.indexOf("magnet:")===0){o=l;break}}if(!o)return;e.push({torrent_link:o,title:r.text(),query:n,media_type:"torrent",models:{},getSongFileModel:u})}};var c=function(e){this.crossdomain=e.crossdomain,this.mp3_search=e.mp3_search,this.cache_ajax=e.cache_ajax};return c.prototype={constructor:c,cache_namespace:"google_isohunt",name:"torrents",s:{name:"Google/Isohunt torrents",key:0,type:"torrent"},send:function(e,i){var s=this;if(e){i=i||{},i.cache_key=i.cache_key||r("zzzzzzz"+e);var o=n({url:"https://ajax.googleapis.com/ajax/services/search/web",type:"GET",dataType:this.crossdomain?"json":"jsonp",data:{cx:"001069742470440223270:ftotl-vgnbs",v:"1.0",q:e},timeout:2e4,context:i.context},{cache_ajax:this.cache_ajax,nocache:i.nocache,cache_key:i.cache_key,cache_timeout:i.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue});return o.complex}},findAudio:function(e,t){var n=this,r=e.q?e.q:(e.artist||"")+(e.track?" - "+e.track:"");t=t||{},t.cache_key=t.cache_key||r;var i=this.send("allintext:("+r+".mp3"+")",t),s,o=i.done;return i.done=function(t){return o.call(this,function(r){if(!s){s=[];for(var i=0;i<r.responseData.results.length;i++)n.wrapItem(s,r.responseData.results[i],e)}t(s,"torrent")}),this},i},url_regexp:/torrent\_details\/(\d*)\//,wrapItem:function(e,t,n){var r=t&&t.url&&t.url.match(this.url_regexp);r&&r[1]&&(e.push(t),t.isohunt_id=r[1],t.torrent_link="http://isohunt.com/download/"+t.isohunt_id,t.query=n,t.media_type="torrent",t.title=t.titleNoFormatting=s.decode(t.titleNoFormatting),t.models={},t.getSongFileModel=u)}},{isohuntTorrentSearch:f,googleTorrentSearch:c,BtdiggTorrentSearch:l}}),define("js/libs/FuncsStack",[],function(){"use strict";var e=function(){},t=function(e,t,n,r){this.stack=e,this.func=t,this.func_result=null,this.done=n,this.data=null,this.qf=null,this.aborted=null,r&&(this.data=r),this.completePart=n};t.prototype.destroy=function(){this.stack=null,this.func=null,this.done=e,this.completePart=e,this.fail=e,this.data=null,this.qf=null},t.prototype.abort=function(){this.destroy(),this.aborted=!0};var n=function(e,t){this.chained=null,this.arr=[];var n=this;t&&(this.initAtom=t),this.done=e?function(){this.stack===n.arr&&e.call(n,this,arguments)}:function(){if(this.stack===n.arr){if(this.atom_completed)throw new Error("executing second time!");if(n.arr[0]!==this)throw new Error("wrong stack, func must be in [0]");this.atom_completed=!0,n.arr.shift(),n.arr[0]?n.goAhead(n.arr[0],arguments):n.waitNext(arguments)}}};return n.prototype={constructor:n,next:function(e,n){var r=this,i=new t(this.arr,e,this.done,n);return this.initAtom&&this.initAtom(i),this.arr.push(i),this.want_start&&this.arr[0]===i&&setTimeout(function(){r.goAhead(i,r.wait_next)},0),this},waitNext:function(e){this.wait_next=e},goAhead:function(e,t){this.wait_next=null,e.func_result=e.func.apply(e,t)},start:function(){return this.want_start||(this.arr[0]?this.goAhead(this.arr[0],arguments):this.waitNext(arguments),this.want_start=!0),this},reset:function(){return this.arr=[],this},getArr:function(){return this.arr}},n.chain=function(e){var t=new n;for(var r=0;r<e.length;r++)t.next(e[r]);return t.start(function(){}),t},n}),define("js/libs/FuncsQueue",["./FuncsStack"],function(e){"use strict";var t,n=function(e,t){this.q=e,this.atom=t,this.aborted=null};return n.prototype={constructor:n,abort:function(){if(this.aborted)return;this.aborted=!0,this.atom.complete||this.atom.abort(),this.q=null,this.atom=null,this.pr=null},setPrio:function(){this.q&&(this.pr=this.q.getTopPrio()+1)},removePr:function(){this.pr=null}},t=function(t){var r=this,i=t.time,s=i[0],o=i[1],u=i[2];t.resortQueue&&(this.resortQueue=t.resortQueue),t.reverse_default_prio&&(this.reverse_default_prio=!0);var a=function(e,t){r.goAhead(e)},f=function(e){e.qf=new n(r,e)};this.fstack=new e(a,f),s&&(this.small_delay=s),o&&(this.big_delay=o),u&&(this.big_delay_interval=u);if(!o||!u)this.nobigdelay=!0;this.using_stat=[],t.init&&t.init.call(this)},t.prototype={constructor:t,removePrioMarks:function(){var e=this.fstack.getArr();for(var t=0;t<e.length;t++){if(e[t].aborted)continue;e[t].qf.removePr()}this.valid_sort=!1},getTopPrio:function(){var e=[],t=this.fstack.getArr();for(var n=0;n<t.length;n++){if(t[n].aborted)continue;var r=t[n].qf.pr;typeof r=="number"&&e.push(r)}return e.length?Math.max.apply(Math,e):0},goAhead:function(e){var t=this,n=t.getInterval(e);n?setTimeout(function(){t.selectNext(e)},n):t.selectNext(e)},getInterval:function(){var e,t=this.using_stat.length-1,n=!this.nobigdelay&&t>1&&t%this.big_delay_interval===0;if(n){var r=Date.now()-this.using_stat[t-(this.big_delay_interval+1)],i=this.small_delay*this.big_delay_interval+this.big_delay;r&&r>i?e=Math.max(0,this.big_delay-(r-i)):e=this.big_delay}else{var s=this.using_stat[t]||0;if(!s)e=0;else{var o=Date.now()-s,u=this.small_delay-o;u>0?e=u:e=0}}return e},add:function(e,t){var n=this,r=this.fstack.getArr();t=t||r.length!==0,this.fstack.next(function(){this.complete=!0;var t=this;e(),n.using_stat.push(Date.now()),t.done(r)});var i=r[r.length-1].qf;return t||this.init(),this.valid_sort=!1,i},init:function(e){return!e&&this.fstack.getArr().inited?this.fstack.getArr():(this.fstack.getArr().inited=!0,this.goAhead(),this)},selectNext:function(){this.valid_sort||(this.resortQueue&&this.resortQueue.call(null,this),this.valid_sort=!0);var e,t,n=this.fstack.getArr(),r=[],i=0,s=null,o=null;for(e=0;e<n.length;e++)t=n[e],!t.complete&&!t.aborted&&r.push(t);for(e=0;e<r.length;e++)t=r[e],t.qf.pr&&t.qf.pr>i&&(i=t.qf.pr,s=t);s||(this.reverse_default_prio?o=r[r.length-1]:o=r[0]);var u=s||o;return u?(u.func(),u.func):(this.reset(),!1)},reset:function(){return this.fstack.reset(),this}},t}),define("js/libs/LastfmAPI",["jquery","spv","app_serv","js/modules/aReq","js/modules/wrapRequest","hex_md5"],function(e,t,n,r,i,s){"use strict";var o=function(){};return t.Class.extendTo(o,{errors_fields:["error"],source_name:"last.fm",init:function(t,n,r,i,s,o,u){this.apikey=t,this.stGet=r,this.stSet=i,this.s=n,this.cache_ajax=s,this.crossdomain=o;if(!o){var a=document.createElement("div");e(a).css("display","none"),e(document).ready(function(){e(document.body).append(a)});var f=document.createElement("iframe");f.width="30",f.height="30";var l=document.createElement("form");l.method="POST",l.action=this.api_path,a.appendChild(l),this.post_serv={name:"lfmpost",i:f,c:0,f:l,post:function(t,n){e(this.f).empty();for(var r in t){var i=document.createElement("input");i.type="hidden",i.name=r,i.value=t[r],this.f.appendChild(i)}var s=this.i.cloneNode(!0);this.f.target=s.name=s.id=this.name+ ++this.c,a.appendChild(s),this.f.submit(),n&&n({})}}}u&&(this.queue=u),this.stGet&&(this.sk=this.stGet("lfmsk")||!1,this.username=this.stGet("lfm_user_name")||!1)},api_path:"https://ws.audioscrobbler.com/2.0/",cache_namespace:"lastfm",thisOriginAllowed:!0,get:function(e,t,n){return this.send(e,t,n)},post:function(e,t,n){return this.send(e,t,n,!0)},send:function(e,n,o,u){var a=this,f=new t.Depdc(!0);if(!e)throw new Error("no method");o=o||{},n=n||{},o.nocache=o.nocache||u;var l=u&&!this.crossdomain,c=n&&(n.sk||n.token)||e=="auth.getToken"?!0:!1;n.method=e,n.api_key=this.apikey,n.format=n.format||(l?"":"json"),l&&delete n.format,o&&o.paging&&(n.limit=o.paging.page_limit,n.page=o.paging.next_page);var h=s(t.stringifyParams(n,["format","callback"])+this.s);if(c||!o.nocache)n.api_sig=h;o.cache_key=o.cache_key||h;var p={cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return r.apply(this,arguments)},not_save_cache:u,responseFn:function(t){return!u&&a.checkMethodResponse&&a.checkMethodResponse(e,n,t),t},queue:this.queue};l&&(p.manualSend=function(e){a.post_serv.post(n,e)});var d=i({url:this.api_path,global:!1,type:u?"POST":"GET",dataType:this.crossdomain?"json":"jsonp",data:n,resourceCachingAvailable:!0,thisOriginAllowed:this.thisOriginAllowed,context:o.context},p,f);return d.complex}}),o}),define("js/libs/LastfmAPIExtended",["./LastfmAPI","spv","app_serv"],function(e,t,n){"use strict";var r=function(){};return e.extendTo(r,{init:function(){this._super.apply(this,arguments),this.music=this.stGet&&this.stGet("lfm_scrobble_music")||[];var e=this},nowplay:function(e,t){var n=this;if(!n.sk)return!1;n.post("track.updateNowPlaying",{sk:n.sk,artist:e.artist,track:e.track,album:e.album,duration:t||""})},submit:function(e,t,n){var r=this;this.music.push({artist:e.artist,track:e.track,album:e.album||"",duration:t||"",timestamp:n});if(this.sk){var i={sk:this.sk};for(var s=0,o=this.music.length;s<o;s++){var u=r.music;i["artist["+s+"]"]=u[s].artist,i["track["+s+"]"]=u[s].track,u[s].album&&(i["album["+s+"]"]=u[s].album),i["timestamp["+s+"]"]=u[s].timestamp,u[s].duration&&(i["duration["+s+"]"]=u[s].duration)}r.post("track.scrobble",i).done(function(){r.music=[],r.stSet("lfm_scrobble_music","")})}else r.stSet("lfm_scrobble_music",this.music);return n}}),r}),define("js/models/AppModelBase",["pv","spv","../libs/BrowseMap"],function(e,t,n){var r={},i=function(){};return e.Model.extendTo(i,{init:function(){this._super(),this.navigation=[],this.current_mp_md=null,this.on("child_change-current_mp_md",function(e){e.target&&this.resortQueue()}),this.views_strucs={}},initMapTree:function(t,r,i){return e.updateNesting(this,"navigation",[t]),e.updateNesting(this,"start_page",t),this.map=new n(this.start_page),this.map.on("changes",function(e,t,n){this.animateMapChanges(e,t,n)},this.getContextOptsI()).on("map-tree-change",function(e){this.changeNavTree(e)},this.getContextOptsI()).on("title-change",function(e){this.setDocTitle(e)},this.getContextOptsI()).on("url-change",function(e,t,n,s){r&&(s?i.replace(t,e,n):i.set(e,n))},this.getContextOptsI()),this.map},setDocTitle:function(t){e.update(this,"doc_title",t)},getBMapTravelFunc:function(e,t){return function(){return t.collectChanges(e,arguments)}},changeNavTree:function(e){this.nav_tree=e,this.matchNav&&this.matchNav()},showStartPage:function(){this.map.startNewBrowse()},animationMark:function(t,n){for(var r=0;r<t.length;r++)e.update(t[r].getMD(),"map_animating",n)},animateMapChanges:function(){var n=function(e,t){if(r[t._provoda_id])return;r[t._provoda_id]=!0,e.pushVDS(t)},i={"zoom-in":function(e){var t;for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.type=="move-view"&&r.value){t=r;break}}return t},"zoom-out":function(e){var t;for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.type=="zoom-out"||r.type=="move-view"){t=r;break}}return t}},s=function(n,r,i){var s=r.state("bmp_show");s=s&&t.cloneObj({},s)||{};var o=n.state("map_level_num");s[o]=i,e.update(r,"bmp_show",s)},o={"move-view":function(t){var r=t.target.getMD(),i=t.bwlev.getMD();n(r.app,r);var o=t.target.getMD().getParentMapModel(),u=t.bwlev.getMD().getParentMapModel();o&&(e.update(u,"mp_has_focus",!1),e.update(o,"mp_has_focus",!1)),e.update(r,"mp_show",t.value),e.update(i,"mp_show",t.value),s(i,r,t.value)},"zoom-out":function(t){var n=t.target.getMD(),r=t.bwlev.getMD();e.update(r,"mp_show",!1),e.update(n,"mp_show",!1),s(r,n,!1)},destroy:function(t){var n=t.target.getMD(),r=t.bwlev.getMD();n.mlmDie(),e.update(n,"mp_show",!1),e.update(r,"mp_show",!1),s(r,n,!1)}};return function(n,r,s){var u,a,f=t.filter(n.array,"changes");f=Array.prototype.concat.apply(Array.prototype,f);for(u=0;u<f.length;u++){var l=f[u],c=o[l.type];c&&c.call(null,l)}for(u=n.array.length-1;u>=0;u--){var h=n.array[u];if(i[h.name]){var p=i[h.name].call(null,h.changes);a=p;break}}e.updateNesting(this,"navigation",s);if(a){this.current_mp_md&&e.update(this.current_mp_md,"mp_has_focus",!1);var d=this.current_mp_md=a.target.getMD();e.update(d,"mp_has_focus",!0),e.update(a.bwlev.getMD(),"mp_has_focus",!0),e.update(this,"show_search_form",!!d.state("needs_search_from")),e.update(this,"full_page_need",!!d.full_page_need),e.updateNesting(this,"current_mp_md",d),e.updateNesting(this,"current_mp_bwlev",a.bwlev.getMD())}a&&(n.target=a&&a.target,n.bwlev=a&&a.bwlev);var v;if(r){var m=r.concat(s);v={items:r,bwlevs:s,all_items:m,mp_show_states:[]};for(u=0;u<r.length;u++)v.mp_show_states.push(r[u].state("mp_show"))}e.updateNesting(this,"map_slice",{residents_struc:v,transaction:n})}}(),collectChanges:function(e,t,n){var r=this.map.isCollectingChanges();r||this.map.startChangesCollecting(n);var i=e.apply(this,t);return r||this.map.finishChangesCollecting(),i},resortQueue:function(e){if(e)e.removePrioMarks();else for(var t=0;t<this.all_queues.length;t++)this.all_queues[t].removePrioMarks();var n=this.getNesting("current_mp_md");n&&(n.checkRequestsPriority?n.checkRequestsPriority():n.setPrio&&n.setPrio()),this.checkActingRequestsPriority()},routePathByModels:function(e,t,r){return n.routePathByModels(t||this.start_page,e,r)},pushVDS:function(){var r="m_children.children.map_slice.main.m_children.children_by_mn.pioneer",i="m_children.children_by_mn.pioneer",s=t.memorize(function(s,o,u){var a,f=s.model_name,l=o.collch_dclrs,c=o.collch_selectors,h=e.$v.selecPoineertDeclr(l,c,"map_slice",f,"main",!0);if(h){var p="m_children.children.map_slice."+(h.space||"main"),d=t.getTargetField(o,p),v=d.collch_dclrs,m=d.collch_selectors,g=h.is_wrapper_parent?s.map_parent.model_name:f,y=e.$v.selecPoineertDeclr(v,m,"pioneer",g,h.space||"main",!0),b=t.getTargetField(d,i);a=t.getTargetField(b,[g,y.space])||t.getTargetField(b,["$default",y.space]);if(h.is_wrapper_parent){var w=a.m_children.children,E=s.constructor;for(var S in w){var x=n.getNestingConstr(u,s.map_parent,S);if(x)if(Array.isArray(x)){if(x.indexOf(E)!=-1){a=w[S];break}}else if(x==E){a=w[S];break}}}}else{var T=t.getTargetField(o,r).$default;a=t.getTargetField(o,r)[f]||T}return n.getStrucSources(s,a)},function(e){return e.constr_id});return function(t){if(!this.used_data_structure)return;var n=s(t,this.used_data_structure);e.update(t,"map_slice_view_sources",[t._network_source,n])}}(),knowViewingDataStructure:function(e,t){this.used_data_structure||(this.used_data_structure=t);for(var n=0;n<this.map.residents.length;n++){var r=this.map.residents[n];this.pushVDS(r)}}}),i}),define("js/models/LoadableListBase",["js/libs/BrowseMap","spv","pv"],function(e,t,n){var r=n.update,i=function(){};return e.Model.extendTo(i,{hndSPlOnFocus:function(e){e.value&&this.preloadStart()},hndSPlOnLoadAllowing:function(e){e.value&&this.state("mp_has_focus")&&this.preloadStart()},hndCheckPreviews:function(e){e.skip_report||n.updateNesting(this,this.preview_mlist_name,e.value)},bindStaCons:function(){this.wch(this,"mp_has_focus",this.hndSPlOnFocus),this.on("state_change-more_load_available",this.hndSPlOnLoadAllowing),this.manual_previews||this.on("child_change-"+this.main_list_name,this.hndCheckPreviews)},init:function(e,t,r){this._super.apply(this,arguments),this.excess_data_items=null,this.loaded_nestings_items=null,this.loadable_lists=null,n.updateNesting(this,this.main_list_name,[]);var i=!!this["nest_req-"+this.main_list_name];i&&n.update(this,"has_data_loader",!0),this.bindStaCons(),r&&r.subitems&&r.subitems[this.main_list_name]&&this.nextTick(this.insertDataAsSubitems,[this,this.main_list_name,r.subitems[this.main_list_name],null,r.subitems_source_name&&r.subitems_source_name[this.main_list_name]],!0)},"compx-list_loading":{depends_on:["main_list_loading","preview_loading","id_searching"],fn:function(e,t,n){return e||t||n}},"compx-can_load_data":[["has_data_loader","loader_disallowed","has_no_access"],function(e,t,n){return e&&!t&&!n}],"compx-can_load_more":[["can_load_data","all_data_loaded"],function(e,t){return e&&!t}],"compx-more_load_available":{depends_on:["can_load_more","list_loading"],fn:function(e,t){return e&&!t}},handleNetworkSideData:function(e,t,n,r){e.app.handleNetworkSideData(t,n,r,e)},main_list_name:"lists_list",preview_mlist_name:"preview_list",preview_nesting_source:null,getMainListChangeOpts:function(){},page_limit:30,getPagingInfo:function(e){var t=this.page_limit||this.map_parent.page_limit,n=this.getLength(e),r=Math.floor(n/t),i=n%t,s=r+1;return{current_length:n,has_pages:r,page_limit:t,remainder:i,next_page:s}},preloadStart:function(){this.loadStart()},getLength:function(e){return e=e||this.main_list_name,this.loaded_nestings_items&&this.loaded_nestings_items[e]||0},loadStart:function(){this.state("more_load_available")&&!this.getLength()&&this.requestMoreData()},requestMoreData:function(e){e=e||this.main_list_name,this["nest_req-"+e]&&this.requestNesting(this["nest_req-"+e],e)},insertDataAsSubitems:function(e,t,n,i,s){var o=[];if(n&&n.length){var u=e.getMainListChangeOpts(),a=e["nest_rq_split-"+t];for(var f=0;f<n.length;f++){var l=a&&a(n[f],e.getNestingSource(t,e.app)),c=l?l[0]:n[f],h=l&&l[1];if(e.isDataItemValid&&!e.isDataItemValid(c))continue;var p=e.addItemToDatalist(c,!0,h,t);s&&p&&p._network_source===null&&(p._network_source=s),o.push(p)}e.dataListChange(u,o,t)}r(e,t+"$length",e.getLength(t))},getRelativeRequestsGroups:function(e){var n=this.getNesting(this.main_list_name);if(!n||!n.length)return;n=n.slice();var r=this._super(e,!0);r&&(n=n.concat(r));var i=t.getArrayNoDubs(n),s=[];for(var o=0;o<i.length;o++){var u=i[o].getModelImmediateRequests(e);u&&u.length&&s.push(u)}return s},dataListChange:function(e,t,r){r=r||this.main_list_name;var i=this.loadable_lists&&this.loadable_lists[r];this.beforeReportChange&&(i=this.beforeReportChange(i,t),this.loadable_lists||(this.loadable_lists={}),this.loadable_lists[r]=i),n.updateNesting(this,r,i,e)},compareItemWithObj:function(e,n){if(!this.items_comparing_props)return;for(var r=0;r<this.items_comparing_props.length;r++){var i=this.items_comparing_props[r],s=t.getTargetField(e,i[0]),o=t.getTargetField(n,i[1]);if(s!==o)return!1}return!0},compareItemsWithObj:function(e,t,n){for(var r=0;r<e.length;r++)if(this.compareItemWithObj(e[r],t,n))return e[r]},addItemToDatalist:function(e,t,n,r){return this.addDataItem(e,t,r,n)},addDataItem:function(e,r,i,s){i=i||this.main_list_name,this.loadable_lists||(this.loadable_lists={}),this.loadable_lists[i]||(this.loadable_lists[i]=[]);var o,u=this.loadable_lists[i],a=!r&&this.getMainListChangeOpts(),f=this.excess_data_items&&this.excess_data_items[i];if(f&&f.length){var l=this.compareItemsWithObj(f,e);l?(o=l,u=t.arrayExclude(u,f),f=t.arrayExclude(f,l),u.push(l),u=u.concat(f)):(u=t.arrayExclude(u,f),u.push(o=this.makeItemByData(e,s,i)),u=u.concat(f)),this.excess_data_items[i]=f}else u.push(o=this.makeItemByData(e,s,i));return this.loadable_lists[i]=u,r||(this.beforeReportChange&&(u=this.beforeReportChange(u,[o]),this.loadable_lists[i]=u),n.updateNesting(this,i,u,a)),o},getMainlist:function(){return this.loadable_lists||(this.loadable_lists={}),this.loadable_lists[this.main_list_name]||(this.loadable_lists[this.main_list_name]=[]),this.loadable_lists[this.main_list_name]},makeItemByData:function(e,n,r){var i=this["nest_rqc-"+r];if(i){if(Array.isArray(i)){var s=i[0],o=t.getTargetField(e,s);i=i[1][o]}var u=i.prototype.netdata_as_states,a=i.prototype.network_data_as_states,f;return a?u?f={network_states:u(e)}:f={network_states:e}:f=e,this.initSi(i,f,n)}if(this.subitemConstr){var l=new this.subitemConstr;return l.init({map_parent:this,app:this.app},e,n),l}if(this.makeDataItem)return this.makeDataItem(e,n);throw new Error("cant make item")},findMustBePresentDataItem:function(e,t){t=t||this.main_list_name;var n=this.compareItemsWithObj(this.getNesting(t),e);return n||this.injectExcessDataItem(e,t)},injectExcessDataItem:function(e,t){t=t||this.main_list_name;if(this.isDataInjValid&&!this.isDataInjValid(e))return;var r=this.loadable_lists&&this.loadable_lists[t]||[],i=this.getMainListChangeOpts(),s=this.makeItemByData(e,!1,t);return this.cant_find_dli_pos?r.unshift(s):(this.excess_data_items||(this.excess_data_items={}),this.excess_data_items[t]||(this.excess_data_items[t]=[]),this.excess_data_items[t].push(s),r.push(s)),this.beforeReportChange&&(r=this.beforeReportChange(r,[s])),this.loadable_lists||(this.loadable_lists={}),this.loadable_lists[t]=r,n.updateNesting(this,t,r,i),s},authInit:function(){var e=this;this.map_parent&&(this.switchPmd(!1),this.map_parent.on("state_change-mp_has_focus",function(t){t.value||e.switchPmd(!1)}))},requestPage:function(){this.state("has_no_access")?(this.map_parent.zoomOut(),this.switchPmd()):(this.loadStart(),this.showOnMap())}}),i}),define("js/models/LoadableList",["./LoadableListBase","spv","js/libs/Mp3Search","pv"],function(e,t,n,r){var i=/^\s|\s$/gi,s=function(){};e.extendTo(s,{});var o=function(){};return s.extendTo(o,{model_name:"tagslist",main_list_name:"tags_list",addTag:function(e,t){var n=this.getMainlist();n.push(e),t||r.update(this,this.main_list_name,[].concat(n))},dataListChange:function(){var e=this.getMainlist();r.update(this,this.main_list_name,[].concat(e))},addItemToDatalist:function(e,t){this.addTag(e,t)},"compx-simple_tags_list":{depends_on:["tags_list","preview_list"],fn:function(e,t){return e||t}},setPreview:function(e){r.update(this,"preview_list",e)},showTag:function(e){this.app.show_tag(e)}}),s.TagsList=o,s}),define("js/models/comd",["pv","spv","app_serv","js/libs/morph_helpers"],function(e,t,n,r){var i=n.localize,s=e.update,o=t.inh(e.Eventor,{naming:function(e){return function(n,r){e(this,n,r)}},building:function(e){return function(n,r,i){e(n),n.glob_store=r,n.store_name=i}},props:{markAsReaded:function(e){var t=this.glob_store.set(this.store_name,e);t&&this.trigger("read",e)},getReadedMessages:function(){return this.glob_store.get(this.store_name)}}}),u=function(e,t){this.sset=e,this.sget=t,this.store=this.sget()||{},this.cm_store={}};t.Class.extendTo(u,{set:function(e,t){this.store[e]=this.store[e]||[];if(this.store[e].indexOf(t)==-1)return this.store[e].push(t),this.sset(this.store),!0},get:function(e){return this.store[e]||[]},getStore:function(e){return this.cm_store[e]||(this.cm_store[e]=new o(this,e))}});var a=function(){};e.Model.extendTo(a,{init:function(t,n){this._super.apply(this,arguments);var r=this;if(!this.cant_hide_notify){if(!n.notf)throw new Error('you must apply "notf"');this.notf=n.notf,this.notf.on("read",function(t){t==r.notify_name&&e.update(r,"notify_readed",!0)}),n.notify_readed&&e.update(r,"notify_readed",!0)}},cant_hide_notify:!0,notify_name:"vk_audio_auth"});var f=function(){};e.Model.extendTo(f,{init:function(){this._super(),this.images_by_source={},this.all_images=[]},addImage:function(e,t){!this.images_by_source[t]&&e&&(this.images_by_source[t]=e,this.all_images.push({data:e,source:t}),this.checkImages())},checkImages:function(){var n=t.filter(this.all_images,"data.lfm_id",function(e){return!!e});this.state("best_image")||n.length&&e.update(this,"best_image",n[0].data),this.state("just_image")||n.not.length&&e.update(this,"just_image",n.not[0].data)}});var l=function(){};f.extendTo(l,{init:function(e,t){this._super(),this.artmd=e,this.artist=t.artist,this.track=t.track,this.wch(e,"image-to-use","artist_image")},complex_states:{"image-to-use":{depends_on:["best_image","just_image","artist_image"],fn:function(e,t,n){return e||t||n}}}});var c=function(){};f.extendTo(c,{init:function(e){this._super(),this.artist_name=e},complex_states:{"image-to-use":{depends_on:["best_image","just_image"],fn:function(e,t){return e||t}}}});var h=function(){};e.Eventor.extendTo(h,{init:function(){this._super(),this.art_models={},this.track_models={},this.unknown_methods={}},convertEventName:function(e){return e.toLowerCase().replace(/^\s+|\s+$/,"")},getImageRewrap:function(e){if(!e.array&&!e.item)return;return this.getImageWrap(e.array||e.item)},getImageWrap:r.lfm_image,setArtistImage:function(e,t,n){this.getArtistImagesModel(e).addImage(this.getImageWrap(t),n)},setTrackImage:function(e,t,n){this.getTrackImagesModel(e).addImage(this.getImageWrap(t),n)},setImage:function(e,t){if(!e.artist)throw new Error("give me artist name");if(!t)throw new Error("give me source")},getTrackImagesModel:function(e){if(!e.artist||!e.track)throw new Error("give me full track info");e=t.cloneObj({},e),e.artist=this.convertEventName(e.artist),e.track=this.convertEventName(e.track);var n=e.artist+" - "+e.track;if(!this.track_models[n]){var r=new l;r.init(this.getArtistImagesModel(e.artist),e),this.track_models[n]=r}return this.track_models[n]},getArtistImagesModel:function(e){if(!e)throw new Error("give me artist name");e=this.convertEventName(e);if(!this.art_models[e]){var t=new c;t.init(e),this.art_models[e]=t}return this.art_models[e]},checkLfmData:function(e,t,n){this.resp_handlers[e]?this.resp_handlers[e].call(this,t,e,n):this.unknown_methods[e]=!0},resp_handlers:{"artist.getInfo":function(e,n){var r=t.getTargetField(e,"artist.name");if(r){var i=t.getTargetField(e,"artist.image");this.setArtistImage(r,i,n)}var s=t.toRealArray(t.getTargetField(e,"artist.similar.artist"));for(var o=0;o<s.length;o++){var u=s[o];if(!u.image)continue;this.setArtistImage(u.name,u.image,n+".similar")}},"artist.getSimilar":function(e,n){var r=t.toRealArray(t.getTargetField(e,"similarartists.artist"));for(var i=0;i<r.length;i++){var s=r[i];if(!s.image)continue;this.setArtistImage(s.name,s.image,n)}},"geo.getMetroUniqueTrackChart":function(e,n){var r=t.toRealArray(t.getTargetField(e,"toptracks.track"));for(var i=0;i<r.length;i++){var s=r[i];this.setTrackImage({artist:s.artist.name,track:s.name},s.image,n)}},"album.getInfo":function(e,n){var r=t.getTargetField(e,"album.image"),i=t.toRealArray(t.getTargetField(e,"album.track"));for(var s=0;s<i.length;s++){var o=i[s];this.setTrackImage({artist:o.artist.name,track:o.name},r,n)}},"playlist.fetch":function(e,n){var r=t.toRealArray(t.getTargetField(e,"playlist.trackList.track"));for(var i=0;i<r.length;i++){var s=r[i];this.setTrackImage({artist:s.creator,track:s.title},s.image,n)}},"user.getLovedTracks":function(e,n){var r=t.toRealArray(t.getTargetField(e,"lovedtracks.track"));for(var i=0;i<r.length;i++){var s=r[i];this.setTrackImage({artist:s.artist.name,track:s.name},s.image,n)}},"user.getRecommendedArtists":function(e,n){var r=t.toRealArray(t.getTargetField(e,"recommendations.artist"));for(var i=0;i<r.length;i++){var s=r[i];if(!s.image)continue;this.setArtistImage(s.name,s.image,n)}},"track.search":function(e,n){var r=t.toRealArray(t.getTargetField(e,"results.trackmatches.track"));for(var i=0;i<r.length;i++){var s=r[i];this.setTrackImage({artist:s.artist,track:s.name},s.image,n)}},"artist.search":function(e,n){var r=t.toRealArray(t.getTargetField(e,"results.artistmatches.artist"));for(var i=0;i<r.length;i++){var s=r[i];if(!s.image)continue;this.setArtistImage(s.name,s.image,n)}},"artist.getTopTracks":function(e,n,r){r=r||t.toRealArray(t.getTargetField(e,"toptracks.track"));for(var i=0;i<r.length;i++){var s=r[i];this.setTrackImage({artist:s.artist.name,track:s.name},s.image,n)}},"tag.getTopArtists":function(e,n,r){r=r||t.toRealArray(t.getTargetField(e,"topartists.artist"));for(var i=0;i<r.length;i++){var s=r[i];if(!s.image)continue;this.setArtistImage(s.name,s.image,n)}},"tag.getWeeklyArtistChart":function(e,n,r){r=r||t.toRealArray(t.getTargetField(e,"weeklyartistchart.artist"));for(var i=0;i<r.length;i++){var s=r[i];if(!s.image)continue;this.setArtistImage(s.name,s.image,n)}}}});var p=function(){};e.Model.extendTo(p,{init:function(){this._super.apply(this,arguments),this.context_parts={},this.active_part=null},hideAll:function(){this.active_part&&(e.update(this,"active_part",!1),this.active_part.deacivate(),this.active_part=null)},hide:function(e){this.context_parts[e]===this.active_part&&this.hideAll()},addPart:function(t){if(!this.context_parts[t.model_name]){this.context_parts[t.model_name]=t;var n=this.getNesting("context_parts")||[];n.push(t),e.updateNesting(this,"context_parts",n)}},getAllParts:function(){return this.context_parts},switchPart:function(t){this.context_parts[t]&&this.context_parts[t]!=this.active_part?(this.active_part&&this.active_part.deacivate(),this.active_part=this.context_parts[t],e.update(this,"active_part",t),this.active_part.acivate()):this.hideAll()}});var d=function(){};e.Model.extendTo(d,{switchView:function(){this.actionsrow.switchPart(this.model_name)},hide:function(){this.actionsrow.hide(this.model_name)},deacivate:function(){e.update(this,"active_view",!1)},acivate:function(){e.update(this,"active_view",!0)}});var v=function(){};return e.Model.extendTo(v,{model_name:"auth_block_vk",access_desc:null,init:function(t,n,r){this._super.apply(this,arguments);var i=this;this.auth=r&&r.auth||this.map_parent&&this.map_parent.nestings_opts&&this.map_parent.nestings_opts.auth||t.auth||this.app.vk_auth,this.pmd=r&&r.pmd||this.map_parent&&this.map_parent.nestings_opts&&this.map_parent.nestings_opts.pmd||t.pmd,this.updateNesting("auth",this.auth);var o;r&&(r.open_opts&&(this.open_opts=r.open_opts,this.open_opts.settings_bits&&(o=this.open_opts.settings_bits)),r.notf&&(this.notf=r.notf,this.notf.on("read",function(t){t=="vk_audio_auth "&&e.update(i,"notify_readed",!0)}),r.notify_readed&&e.update(i,"notify_readed",!0),e.update(this,"has_notify_closer",!0))),n?this.setRequestDesc(n.desc):this.setRequestDesc(this.access_desc),this.auth.deep_sanbdox&&e.update(i,"deep_sandbox",!0),s(this,"target_bits",o),this.auth&&this.auth.data_wait?this.waitData():this.auth.on("data_wait",function(){i.waitData()})},"compx-has_session":[["@one:has_token:auth","target_bits","@one:settings_bits:auth"],function(e,t,n){if(e)return!0;if(typeof t!="undefined"&&n!="undefined")return(n&t)*1}],removeNotifyMark:function(){this.notf.markAsReaded("vk_audio_auth ")},bindAuthReady:function(e,t){this.auth.bindAuthReady(e,t,this.open_opts&&this.open_opts.settings_bits)},waitData:function(){e.update(this,"data_wait",!0)},notWaitData:function(){e.update(this,"data_wait",!1)},setRequestDesc:function(t){e.update(this,"request_description",t?t+" "+i("vk-auth-invitation"):"")},useCode:function(e){this.bindAuthCallback&&this.bindAuthCallback(),this.auth.setToken(e)},requestAuth:function(e){this.beforeRequest&&this.beforeRequest(),this.auth.requestAuth(e||this.open_opts)},switchView:function(){e.update(this,"active",!this.state("active"))}}),{GMessagesStore:u,LastFMArtistImagesSelector:h,PartsSwitcher:p,BaseCRow:d,VkLoginB:v}}),define("cache_ajax",[],function(){"use strict";var e={storage:{},get:function(e,t,n){var r=this,i=(i=r.storage["c_"+e+"_"+t])&&i.v;if(i){if(i!==new Object(i)&&typeof i=="string")try{i=JSON.parse(i)}catch(s){}return n&&setTimeout(function(){n(i)},30),!0}return!1},set:function(e,t,n,r){n={v:n,t:Date.now()+(r||18e6)},this.storage["c_"+e+"_"+t]=n}};return setInterval(function(){var t=Date.now();for(var n in e.storage){var r=e.storage[n].t;r<t&&delete e.storage[n]}},3e4),e}),define("js/models/YoutubeVideo",["js/libs/BrowseMap","app_serv","pv"],function(e,t,n){var r=n.update,i=t.app_env,s=function(){};return e.Model.extendTo(s,{model_name:"youtube_video",init:function(e,t){this._super.apply(this,arguments),this.mo=this.map_parent.mo,this.map_parent=this.map_parent.map_parent,r(this,"yt_id",t.yt_id),r(this,"cant_show",t.cant_show),r(this,"previews",t.previews),r(this,"nav_title",t.title),r(this,"url_part","/youtube/"+t.yt_id)},"stch-mp_has_focus":function(e,t){t&&(e.app.trackEvent("Navigation","youtube video"),e.map_parent.pause())},"compx-triple":[["previews"],function(e){if(e&&e.start&&e.middle&&e.end)return[e.start,e.middle,e.end]}],full_page_need:!0,requestVideo:function(){var e=this.state("cant_show"),t="http://www.youtube.com/watch?v="+this.state("yt_id");!e&&!i.tizen_app?this.showOnMap():i.openURL(t)}}),s}),define("js/models/MfCor",["pv","spv","app_serv","cache_ajax","js/modules/aReq","js/libs/Mp3Search","./comd","./YoutubeVideo","./LoadableList"],function(e,t,n,r,i,s,o,u,a){var f=n.localize,l=function(){};o.VkLoginB.extendTo(l,{init:function(e){this._super(e,{desc:f("to-find-and-play")+" "+f("music-files-from-vk")},{open_opts:{settings_bits:8},auth:e.map_parent.app.vk_auth,notf:e.map_parent.sf_notf,notify_readed:e.map_parent.vk_ntf_readed})}});var c=function(e,t){this.init(),this.messages={},this.banned_messages=t||[],this.name=e};e.Model.extendTo(c,{addMessage:function(e){!this.messages[e]&&this.banned_messages.indexOf(e)==-1&&(this.messages[e]=!0,this.recount())},banMessage:function(e){this.removeMessage(e),this.banned_messages.push(e)},removeMessage:function(e){this.messages[e]&&(delete this.messages[e],this.recount())},recount:function(){var t=0;for(var n in this.messages)++t;e.update(this,"counter",t)}});var h=function(t,n){this.init(),this.start_file=n.file,this.mo=t.mo,this.mf_cor=t.mf_cor,this.moplas_list=null,this.source_name=n.source_name,this.search_source=null;var r;this.start_file?(this.moplas_list=[],r=this.mf_cor.getSFM(this.start_file),this.moplas_list.push(r),e.updateNesting(this,"moplas_list",this.moplas_list),e.update(this,"has_start_file",!0)):(this.search_source=n.search_source,this.wch(this.search_source,"files-list",this.hndFilesListCh),e.updateNesting(this,"pioneer",n.search_source)),this.on("child_change-moplas_list",function(t){if(t.value){var n=t.value.slice(0,5),r=t.value.slice(5);e.updateNesting(this,"moplas_list_start",n),e.updateNesting(this,"moplas_list_end",r)}})};e.Model.extendTo(h,{flchwp_opts:{exlusive:!0},hndFilesListCh:function(t){var n=t.value;if(!n)return;var r=[];e.update(this,"overstock",n.length>this.overstock_limit);var i;for(var s=0;s<n.length;s++)i=this.mf_cor.getSFM(n[s]),e.update(i,"overstock",s+1>this.overstock_limit),r.push(i);e.updateNesting(this,"moplas_list",r),e.update(this,"list_length",r.length),this.moplas_list=r},toggleOverstocked:function(){e.update(this,"show_overstocked",!this.state("show_overstocked"))},overstock_limit:5,hasManyFiles:function(){return this.sem_part&&this.sem_part.t&&this.sem_part.t.length>1},getFiles:function(e){return this.search_source.getFiles(e)}});var p=0,d={vk:"https://vk.com","pleer.com":"http://pleer.com",soundcloud:"https://soundcloud.com","btdigg-torrents":"http://btdigg.org/"},v=function(){};return a.extendTo(v,{hndTrackNameCh:function(t){t.value&&(this.files_investg=this.mo.mp3_search.getFilesInvestg({artist:this.mo.artist,track:this.mo.track},this.current_motivator),this.bindInvestgChanges(),this.mo.bindFilesSearchChanges(this.files_investg),this.last_search_opts&&(this.files_investg.startSearch(this.last_search_opts),this.last_search_opts=null),e.update(this,"files_investg",this.files_investg))},"compx-play":[["@one:play:used_mopla"]],"stch-used_mopla":function(e,t){e.updateNesting("used_mopla",t)},init:function(t,n,r){this._super.apply(this,arguments),this.files_investg=null,this.last_search_opts=null,this.file=null,this.notifier=null,this.sf_notf=null,this.vk_ntf_readed=null,this.player=null,this.vk_auth_rqb=null,this.sfs_models={},this.omo=r,this.mo=this.map_parent,this.files_models={},this.complects={},this.initNotifier();if(r.file){this.file=r.file;var i=new h({mf_cor:this,mo:this.mo},{file:this.file,source_name:"vk"});this.addMFComplect(i,this.file.from),this.updateDefaultMopla(),e.updateNesting(this,"sorted_completcs",[i])}else this.mo.on("vip_state_change-track",this.hndTrackNameCh,{immediately:!0,soft_reg:!1,context:this});this.wlch(this.mo.mp3_search,"tools_by_name"),this.on("child_change-sorted_completcs",function(){e.updateNesting(this,"vk_source",this.complects.vk&&this.complects.vk.search_source)}),this.intMessages()},"compx-is_important":[["^is_important"]],"compx-has_any_vk_results":[["@some:has_any_data:vk_source"],function(e){return!!e}],"compx-has_vk_tool":[["tools_by_name"],function(e){return!!e&&!!e.vk}],"compx-needs_vk_auth":[["has_vk_tool","has_any_vk_results"],function(e,t){return!e&&!t}],"stch-needs_vk_auth":function(t,n){n?t.notifier.addMessage("vk_audio_auth "):t.notifier.removeMessage("vk_audio_auth ");if(!n){var r=t.getNesting("vk_auth");r&&(e.updateNesting(t,"vk_auth",null),r.die())}},"nest-vk_auth":[l,!1,"needs_vk_auth"],getSFM:function(e){return e.hasOwnProperty("file_id")||(e.file_id=++p),this.sfs_models[e.file_id]||(this.sfs_models[e.file_id]=s.getSFM(this,e)),this.sfs_models[e.file_id]},"compx-has_files":[["@some:list_length:sorted_completcs"],function(e){return e}],"compx-almost_loaded":[["@loading_progress:current_mopla"],function(e){return e&&e[0]>.8}],"stch-is_important":function(e,t){t&&e.requestMoreData("yt_videos")},"nest_rqc-yt_videos":u,"nest_req-yt_videos":[[function(){var e=/default.jpg$/,t=["start","middle","end"],n=function(n){if(e.test(n)){var r={};for(var i=0;i<t.length;i++){var s=t[i],o=i+1+".jpg";r[s]=n.replace(e,o)}return r}return{"default":n}};return function(e){var t=e&&e.items;if(t&&t.length){var r=[];for(var i=0;i<Math.min(t.length,3);i++){var s=t[i];r.push({yt_id:s.id.videoId,title:s.snippet.title,cant_show:!0,previews:n(s.snippet.thumbnails.default.url)})}return r}return[]}}()],[function(){return{api_name:"youtube_d",source_name:"youtube.com",get:function(e){var t={key:"AIzaSyBvg9b_rzQJJ3ubhS1TeipHpOTqsVnShj4",part:"id,snippet",type:"video",maxResults:3,q:e};return i({url:"https://www.googleapis.com/youtube/v3/search",dataType:"jsonp",data:t,resourceCachingAvailable:!0,thisOriginAllowed:!0})},errors_fields:[]}},"get",function(){return[this.mo.artist+" - "+this.mo.track]}]],complex_states:{must_be_expandable:{depends_on:["has_files","needs_vk_auth","few_sources","cant_play_music"],fn:function(e,t,n,r){return!!(e||t||n||r)}},user_preferred:{depends_on:["selected_mopla_to_use","almost_selected_mopla"],fn:function(e,t){return e||t}},can_play:[["mopla_to_use"],function(e){return!!e}],mopla_to_use:{depends_on:["user_preferred","default_mopla"],fn:function(e,t){return e||t}},has_available_tracks:{depends_on:["mopla_to_use"],fn:function(e){return!!e}},current_mopla:{depends_on:["used_mopla","mopla_to_use"],fn:function(e,t){return e||t}},mopla_to_preload:{depends_on:["search_ready","^player_song","^preload_current_file","current_mopla"],fn:function(e,t,n,r){return e&&(t||n)&&r}}},"stch-unavailable@sorted_completcs.moplas_list":function(e,t,n,r){t&&e.checkMoplas(r.item)},state_change:{selected_mopla:function(){},current_mopla:function(t,n,r){r&&(r.stop(),r.deactivate()),n&&n.activate(),e.updateNesting(t,"current_mopla",n)}},"compx-current_source":[["current_mopla","default_mopla"],function(e,t){var n=e||t;return n&&{source_name:n.from,source_link:n.page_link||d[n.from]}}],"compx-$relation:file_to_load-for-player_song":[["search_ready","current_mopla","^player_song"],function(e,t,n){return e&&n&&t}],"compx-$relation:file_to_load-for-preload_current_file":[["search_ready","current_mopla","^preload_current_file"],function(e,t,n){return e&&n&&t}],"compx-$relation:investg_to_load-for-song_need":[["^need_files","files_investg"],function(e,t){return e&&t}],"stch-$relation:investg_to_load-for-song_need":e.getRDep("$relation:investg_to_load-for-song_need"),"stch-$relation:file_to_load-for-player_song":e.getRDep("$relation:file_to_load-for-player_song"),"stch-$relation:file_to_load-for-preload_current_file":e.getRDep("$relation:file_to_load-for-preload_current_file"),isSearchAllowed:function(){return!this.file},initNotifier:function(){this.notifier=new c,e.updateNesting(this,"notifier",this.notifier),this.sf_notf=this.app.notf.getStore("song-files");var t=this.sf_notf.getReadedMessages();for(var n=0;n<t.length;n++)this.notifier.banMessage(t[n]),t[n]=="vk_audio_auth "&&(this.vk_ntf_readed=!0);this.bindMessagesRecieving()},intMessages:function(){this.player=this.mo.player,this.player.on("core-fail",this.hndPCoreFail,this.getContextOpts()).on("core-ready",this.hndPCoreReady,this.getContextOpts())},hndPCoreFail:function(){e.update(this,"cant_play_music",!0),this.notifier.addMessage("player-fail")},hndPCoreReady:function(){e.update(this,"cant_play_music",!1),this.notifier.banMessage("player-fail")},getCurrentMopla:function(){return this.state("current_mopla")},showOnMap:function(){this.mo.showOnMap(),e.update(this,"want_more_songs",!0)},switchMoreSongsView:function(){this.state("want_more_songs")?e.update(this,"want_more_songs",!1):e.update(this,"want_more_songs",!0)},markMessagesReaded:function(){this.sf_notf.markAsReaded("vk_audio_auth ")},hndNtfRead:function(e){this.notifier.banMessage(e)},bindMessagesRecieving:function(){this.sf_notf.on("read",this.hndNtfRead,this.getContextOpts())},collapseExpanders:function(){e.update(this,"want_more_songs",!1)},addMFComplect:function(e,t){this.complects[t]=e},hndFilesListCh:function(e){e.value&&this.updateDefaultMopla()},bindSource:function(e){var t=e.search_name;if(!this.complects[t]){var n=new h({mf_cor:this,mo:this.mo},{search_source:e,source_name:t});this.addMFComplect(n,t),this.wch(e,"files-list",this.hndFilesListCh)}},startSearch:function(e){this.files_investg?this.files_investg.startSearch(e):this.last_search_opts=e},hndSourcesList:function(t){var n=new Array(t.value.length||0);for(var r=0;r<t.value.length;r++){var i=t.value[r];this.bindSource(i),n[r]=this.complects[i.search_name]}e.updateNesting(this,"sorted_completcs",n),e.update(this,"few_sources",t.value.length>1)},bindInvestgChanges:function(){var e=this.files_investg;if(!e)return;this.wch(e,"search_ready_to_use","search_ready"),e.on("child_change-sources_list",this.hndSourcesList,this.getContextOpts())},checkMoplas:function(t){var n;this.state("used_mopla")==t&&(e.update(this,"used_mopla",!1),n=!0),this.state("default_mopla")==t&&this.updateDefaultMopla();if(this.state("user_preferred")==t){e.update(this,"selected_mopla_to_use",!1);var r=this.state("selected_mopla").from,i=this.getFilteredFiles(r,function(e){if(e.from==r&&!e.unavailable)return!0});i=i&&i[0],i?e.update(this,"almost_selected_mopla",this.getSFM(i)):e.update(this,"almost_selected_mopla",!1)}n&&this.trigger("error",this.canPlay())},updateDefaultMopla:function(){var t=this.getFilteredFiles(!1,function(e){if(!e.unavailable)return!0});t=t&&t[0],t?e.update(this,"default_mopla",this.getSFM(t)):e.update(this,"default_mopla",!1)},setVolume:function(e,t){var n=this.state("current_mopla");n&&n.setVolume(e,t)},stop:function(){var e=this.state("current_mopla");e&&e.stop()},switchPlay:function(){this.state("play")?this.pause():this.play()},pause:function(){var e=this.state("current_mopla");e&&e.pause()},selectMopla:function(t){this.updateManyStates({selected_mopla_to_use:t,selected_mopla:t});var n=this.state("mopla_to_use");if(n)return this.state("used_mopla")!=n&&e.update(this,"used_mopla",!1),!0},playSelectedByUser:function(e){this.selectMopla(e)&&this.play()},play:function(){if(this.mo.state("forbidden_by_copyrh"))return;var t=this.state("used_mopla");if(t)t.state("play")||(this.trigger("before-mf-play",t),t.play());else{var n=this.state("mopla_to_use");n&&(e.update(this,"used_mopla",n),this.trigger("before-mf-play",n),n.play())}},raw:function(){return!!this.omo&&!!this.omo.raw},isHaveAnyResultsFrom:function(e){var t=this.complects[e];return t&&t.search_source&&t.search_source.state("search_complete")},song:function(){if(this.raw())return this.getSFM(this.omo);if(this.sem){var e=this.sem.getAllSongTracks("mp3");return!!e&&this.getSFM(e[0].t[0])}return!1},getVKFile:function(){var e=this.state("current_mopla");if(e&&e.from=="vk")return e;var t=this.getFilteredFiles("vk");return t&&t[0]},getFilteredFiles:function(e,t,n){n=n||"mp3";var r=[],i=[];if(this.file)r.push(this.file);else if(e){var s=this.complects[e];s&&(r=r.concat(s.getFiles(n)))}else{var o=this.getNesting("sorted_completcs");for(var u=0;u<o.length;u++)r=r.concat(o[u].getFiles(n));this.mo.mp3_search.sortMusicFilesArray(r,this.files_investg.msq)}if(t){for(var u=0;u<r.length;u++){var a=r[u];t(a)&&i.push(a)}return i}return r},compoundFiles:function(e,t){var n=[],r=[],i=this.file?[{t:[this.file]}]:this.sem.getAllSongTracks(t||"mp3");for(var s=0;s<i.length;s++)r.push.apply(r,i[s].t);if(e){for(var s=0;s<r.length;s++){var o=r[s];e(o)&&n.push(o)}return n}return r},canPlay:function(){return!!this.state("mopla_to_use")}}),v}),define("js/LfmAuth",["pv","spv","app_serv","hex_md5"],function(e,t,n,r){var i=n.localize,s=e.update,o=function(){};e.Model.extendTo(o,{model_name:"auth_block_lfm",init:function(e,t,n){this._super.apply(this,arguments);var r=this;this.auth=n&&n.auth||this.map_parent&&this.map_parent.nestings_opts&&this.map_parent.nestings_opts.auth||e.auth||this.app.lfm_auth,this.pmd=n&&n.pmd||this.map_parent&&this.map_parent.nestings_opts&&this.map_parent.nestings_opts.pmd||e.pmd,this.updateNesting("auth",this.auth);var i=t&&t.desc||this.map_parent&&this.map_parent.access_desc||this.access_desc;return this.setRequestDesc(i),this.auth.deep_sanbdox&&s(r,"deep_sandbox",!0),this.auth&&this.auth.data_wait?this.waitData():this.auth.on("data_wait",function(){r.waitData()}),this},access_desc:i("to-get-access"),"compx-has_session":[["@one:session:auth"]],triggerSession:function(){s(this,"has_session",!0)},waitData:function(){s(this,"data_wait",!0)},notWaitData:function(){s(this,"data_wait",!1)},setRequestDesc:function(e){s(this,"request_description",e?e+" "+i("lfm-auth-invitation"):"")},useCode:function(e){this.bindAuthCallback&&this.bindAuthCallback(),this.auth.setToken(e)},requestAuth:function(e){this.beforeRequest&&this.beforeRequest(),this.auth.requestAuth(e)},switchView:function(){s(this,"active",!this.state("active"))}});var u=function(){};o.extendTo(u,{init:function(){this._super.apply(this,arguments),this.wch(su,"settings-lfm-scrobbling","scrobbling"),this.setRequestDesc(i("lastfm-scrobble-access")),s(this,"active",!0)},beforeRequest:function(){this.bindAuthCallback()},bindAuthCallback:function(){var e=this;this.auth.once("session.input_click",function(){su.setSetting("lfm-scrobbling",!0)},{exlusive:!0})},setScrobbling:function(e){s(this,"scrobbling",e),su.setSetting("lfm-scrobbling",e)}});var a=e.Model.extendTo(function(){},{init:function(e,t,n){this._super(e),this.api=t.lfm,this.opts=n||{},this.has_session=!!this.api.sk,this.deep_sanbdox=!!n.deep_sanbdox,s(this,"session",!!this.has_session)},requestAuth:function(e){this.authInit(e||{});return},login:function(e,t){this.api.sk=e.session.key,this.api.username=e.session.name,this.api.stSet("lfm_user_name",e.session.name,!0),this.api.stSet("lfmsk",this.api.sk,!0),t&&t()},getInitAuthData:function(){var e={};e.link="http://www.last.fm/api/auth/?api_key="+this.api.apikey;var t=this.opts.callback_url;return this.opts.deep_sanbdox||(e.bridgekey=r(Math.random()+"bridgekey"+Math.random()),t+="?key="+e.bridgekey),e.link+="&cb="+encodeURIComponent(t),e},waitData:function(){this.trigger("data_wait"),this.data_wait=!0},createAuthFrame:function(e){if(this.lfm_auth_inited)return!1;var n=this,r=this.auth_frame=document.createElement("iframe");t.addEvent(window,"message",function(t){var r=n.auth_frame&&n.auth_frame.contentWindow;if(t.source!=r)return;t.data=="lastfm_bridge_ready:"?t.source.postMessage("add_keys:"+e,"*"):t.data.indexOf("lastfm_token:")===0&&(n.setToken(t.data.replace("lastfm_token:","")),console.log("got token!!!!"),console.log(t.data.replace("lastfm_token:","")))}),r.className="serv-container",r.src=this.opts.bridge_url,document.body.appendChild(r),this.lfm_auth_inited=!0},setAuthBridgeKey:function(e){this.lfm_auth_inited?this.auth_frame.contentWindow.postMessage("add_keys:"+e,"*"):this.createAuthFrame(e)},authInit:function(e){var t=this.getInitAuthData();t.bridgekey&&this.setAuthBridgeKey(t.bridgekey),e.not_open||(this.trigger("want-open-url",t.link,t),this.waitData());return},setToken:function(e){this.newtoken=e,this.try_to_login()},get_lfm_token:function(){var e=this;this.api.get("auth.getToken",!1,{nocache:!0}).done(function(t){e.newtoken=t.token})},try_to_login:function(e){var t=this;t.newtoken&&t.api.get("auth.getSession",{token:t.newtoken}).done(function(n){n.error?console.log("error while granting lfm scrobble access"):(t.login(n,e),s(t,"session",!0),t.trigger("session"),t.has_session=!0,t.trigger("api-full-ready"),console.log("lfm scrobble access granted"))})}});return a.LfmLogin=o,a.LfmScrobble=u,a}),define("js/modules/lfmhelp",["spv","jquery","cache_ajax"],function(e,t,n){var r=function(t,n){var r=[],i=t.results.artistmatches.artist||!1;i=i&&e.toRealArray(i,"name");for(var s=0;s<i.length;s++)r.push({artist:i[s].name,image:i[s].image&&i[s].image[1]["#text"].replace("/serve/64/","/serve/64s/")});return r},i=function(t,n){var r=[],i=t.results.trackmatches.track||!1;i=i&&e.toRealArray(i,"name");for(var s=0;s<i.length;s++)r.push({artist:i[s].artist,track:i[s].name,image:i[s].image&&i[s].image[1]["#text"].replace("/serve/64/","/serve/64s/")});return r},s=function(t,n){var r=[],i=t.results.tagmatches.tag||!1;i=i&&e.toRealArray(i,"name");for(var s=0;s<i.length;s++)r.push({tag:i[s].name});return r},o=function(t,n){var r=[],i=t.results.albummatches.album||!1;i=i&&e.toRealArray(i,"name");for(var s=0;s<i.length;s++)r.push({artist:i[s].artist,image:i[s].image&&i[s].image[1]["#text"].replace("/serve/64/","/serve/64s/"),album:i[s].name});return r},u=function(t,n,r,i,s,o){i.loading(),i.addRequest(su.lfm.get(t,e.cloneObj({limit:15},n)).done(function(e){if(!i.doesNeed(r))return;i.loaded(),e=e&&s(e,i.resItem,t),e.length?(i.appendResults(e),i.renderSuggests(!0,!o)):i.renderSuggests(!0,!o)}).fail(function(){if(!i.doesNeed(r))return;i.loaded()}))},a=function(n){var r=e.filter(n.response.docs,"restype",6);t.each(r,function(e,t){r[e]={artist:t.artist,image:t.image?"http://userserve-ak.last.fm/serve/34s/"+t.image:!1}});var i=e.filter(n.response.docs,"restype",9);t.each(i,function(e,t){i[e]={artist:t.artist,track:t.track,image:t.image?"http://userserve-ak.last.fm/serve/34s/"+t.image:!1,duration:t.duration}});var s=e.filter(n.response.docs,"restype",32);t.each(s,function(e,t){s[e]={tag:t.tag}});var o=e.filter(n.response.docs,"restype",8);return t.each(o,function(e,t){o[e]={artist:t.artist,album:t.album,image:t.image?"http://userserve-ak.last.fm/serve/34s/"+t.image:!1,resid:t.resid}}),{artists:r,tracks:i,tags:s,albums:o}},f=function(e,t,n){if(n.doesNeed(t)){var r=n.g("section-artist"),i=n.g("section-track"),s=n.g("section-tag"),o=n.g("section-album");e=a(e),r.appendResults(e.artists),r.renderSuggests(),i.appendResults(e.tracks),i.renderSuggests(),s.appendResults(e.tags),s.renderSuggests(),o.appendResults(e.albums),o.renderSuggests()}},l=e.debounce(function(e,r,i,s){var o=t.ajax({url:"http://www.last.fm/search/autocomplete",global:!1,type:"GET",timeout:15e3,headers:{"X-Requested-With":"XMLHttpRequest"},dataType:"json",data:{q:e,force:1},error:function(){},success:function(e){n.set("lfm_fs",i,e),r&&r(e)},complete:function(t){s.loaded(e)}})},400);return{parseArtistsResults:r,parseTracksResults:i,parseTagsResults:s,parseAlbumsResults:o,getLastfmSuggests:u,parseFastSuggests:a,fast_suggestion:f,get_fast_suggests:l}}),define("js/lastfm_data",[],function(){"use strict";var e=["80s","90s","acoustic","alternative","alternative rock","ambient","black metal","blues","british","chillout","classical","classic rock","country","dance","death metal","electronic","electronica","emo","experimental","favorites","female vocalists","folk","hardcore","hard rock","heavy metal","hip-hop","hip hop","indie","indie rock","industrial","instrumental","japanese","jazz","metal","metalcore","pop","progressive metal","progressive rock","punk","punk rock","rap","reggae","rock","seen live","singer-songwriter","soul","soundtrack","thrash metal","trance","trip-hop","instrumental hip-hop"],t={Australia:["Melbourne","Adelaide","Sydney"],Austria:["Linz","Graz","Vienna","Salzburg","Innsbruck"],Belarus:["Minsk"],Belgium:["Liège","Brussels","Antwerp","Charleroi","Ghent"],Brazil:["Belém","Curitiba","Brasília","Belo Horizonte","Salvador","Fortaleza","Rio de Janeiro","Recife","Manaus","Porto Alegre","São Paulo"],Canada:["Toronto","Quebec","Montreal","Ottawa","Halifax","Vancouver","Edmonton","Saskatoon","Calgary","Winnipeg"],Chile:["Santiago","Valparaíso"],China:["Changsha","Chongqing","Guangzhou","Shanghai","Tianjin","Beijing"],Colombia:["Bogotá"],Denmark:["Copenhagen"],Finland:["Helsinki"],France:["Montpellier","Nancy","Grenoble","Toulouse","Rennes","Nantes","Nice","Bordeaux","Lille","Marseille","Strasbourg","Lyon","Metz","Paris","Clermont-Ferrand"],Germany:["Rostock","Dresden","Frankfurt","Bremen","Cologne","Munich","Berlin","Stuttgart","Magdeburg","Hamburg"],"Hong Kong":["Hong Kong"],Ireland:["Dublin","Belfast"],Italy:["Turin","Florence","Milan","Rome","Bologna","Bari","Naples","Genoa","Palermo"],Japan:["Niigata","Saitama","Fukuoka","Kyoto","Sapporo","Shizuoka","Nagoya","Tokyo","Hiroshima","Sendai","Kobe","Osaka"],Mexico:["Tijuana","Mexico City","Guadalajara","Ciudad Juárez","Mexicali","Puebla","Monterrey","Villahermosa","Mérida"],Netherlands:["Amsterdam"],"New Zealand":["Wellington","Auckland","Christchurch"],Norway:["Bergen","Oslo"],Poland:["Katowice","Wrocław","Cracow","Warsaw","Szczecin","Gdańsk","Poznań","Łódź"],Portugal:["Porto","Matosinhos","Coimbra","Vila Nova de Gaia","Setúbal","Faro","Évora","Braga","Aveiro","Bragança","Lisbon"],"Russian Federation":["Moscow","Penza","Ufa","Ekaterinburg","Ryazan","Saint Petersburg"],Spain:["Salamanca","Oviedo","Gijón","Alicante","Murcia","Barcelona","Bilbao","Madrid","Granada","Burgos","A Coruña","Seville","Zaragoza","Valencia"],Sweden:["Uppsala","Västerås","Stockholm","Linköping","Gothenburg","Malmö","Umeå"],Switzerland:["Winterthur","Fribourg","Geneva","Zurich","Basel","Lucerne","St. Gallen","Lausanne","Berne"],Taiwan:["Taipei"],Turkey:["Antalya","Adana","Istanbul","Ankara","İzmir","Bursa"],Ukraine:["Kyiv","Odesa"],"United Kingdom":["London","Cardiff","Newport","Bristol","Birmingham","Brighton","Liverpool","Southampton","Leeds","Plymouth","Aberdeen","Exeter","Manchester","Newcastle","Glasgow","Edinburgh","Nottingham"],"United States":["Orlando","Tampa","El Paso","Milwaukee","West Palm Beach","Denver","Little Rock","Memphis","Dallas","Atlanta","San Diego","Houston","San Francisco","Sacramento","New Orleans","Pensacola","Jacksonville","San Jose","Austin","Boston","New York","Miami","Phoenix","Cleveland","Los Angeles","Pittsburgh","Washington DC","Baltimore","Nashville","Columbus","Minneapolis","Virginia Beach","Richmond","Detroit","Chicago","St Louis","Indianapolis","Louisville","Cincinnati","Syracuse","Rochester","Buffalo","Wichita","Seattle","Portland","Las Vegas","Philadelphia"]};return{toptags:e,"сountries":t}}),define("js/models/Investigation",["pv","spv"],function(e,t){"use strict";e.addPrototype("Investigation",{model_name:"invstg",init:function(t){this._super.apply(this,arguments),this.names={},this.enter_items=!1,this.setInactiveAll(),e.update(this,"url_part",this.getURL()),this.on("child_change-section",function(e){this.names={};if(e.value)for(var t=0;t<e.value.length;t++)this.names[e.value[t].model_name]=e.value[t];this.changeQuery(this.q,!0)})},addCallback:function(e,t){this.on(e,t)},changeResultsCounter:function(){var e=0,t=this.getNesting("section")||[];for(var n=0;n<t.length;n++)e+=t[n].r.length;this.trigger("resultsChanged",e)},doEverythingForQuery:function(){this.searchf.call(this)},g:function(e){return this.names[e]},_changeActiveStatus:function(e,t){t=t&&this.g(t);var n=this.getNesting("section")||[];for(var r=0;r<n.length;r++){var i=n[r];(!t||i!=t)&&!e?i.setActive():i.setInactive()}},doesNeed:function(e){return e==this.q},loading:function(){this.trigger("stateChange","loading")},loaded:function(e){(!e||this.doesNeed(e))&&this.trigger("stateChange","complete")},remarkStyles:function(){var e=0,t=this.getNesting("section")||[];for(var n=0;n<t.length;n++){var r=t[n];r.nos||r.markOdd(!r.state("active")||++e%2!=0)}},setActiveAll:function(e){this._changeActiveStatus(!1,e)},setInactiveAll:function(e){this._changeActiveStatus(!0,e)},bindItemsView:function(){var e=this.getAllItems(!0);e=t.filter(e,"binvstg",!0).not;var n=this,r=function(){n.setItemForEnter(this)};for(var i=0;i<e.length;i++)e[i].on("view",r).binvstg=!0},refreshEnterItems:function(){var e=this.getAllItems();for(var t=0;t<e.length;t++){var n=e[t];n.serial_number=t}this.enter_items=e,this.setItemForEnter(e[this.selected_inum||0])},pressEnter:function(){this.enter_item&&this.enter_item.view()},setItemForEnter:function(e){this.enter_item!=e&&(this.enter_item&&(this.enter_item.setInactive(),delete this.enter_item),e&&(this.enter_item=e,this.enter_item.setActive()))},selectEnterItemAbove:function(){var e=this.enter_item&&this.enter_item.serial_number||0,t=(e?e:this.enter_items.length)-1,n=this.enter_items[t];this.setItemForEnter(n),this.selected_inum=t},selectEnterItemBelow:function(){var e=this.enter_item&&this.enter_item.serial_number||0,t=e+1<this.enter_items.length?e+1:0,n=this.enter_items[t];this.setItemForEnter(n),this.selected_inum=t},getAllItems:function(e){var t=[],n=this.getNesting("section")||[];for(var r=0;r<n.length;r++){var i=n[r],s=i.getItems(e);s.length&&(t=t.concat(s))}return t},changeQuery:function(t,n){if(this.q!=t||n){this.stopRequests(),this.getTitleString&&e.update(this,"nav_title",this.getTitleString(t)),this.loaded(),this.setItemForEnter();var r=this.getNesting("section")||[];for(var i=0;i<r.length;i++)r[i].changeQuery(t);this.q=t,delete this.selected_inum,e.update(this,"query",t),this.changeResultsCounter(),this.doEverythingForQuery(),e.update(this,"url_part",this.getURL())}},query_regexp:/\ ?\%query\%\ ?/}),e.addPrototype("BaseSectionButton",{setText:function(t){e.update(this,"button_text",t)},show:function(){e.update(this,"disabled",!1)},hide:function(){e.update(this,"disabled",!0),this.setInactive()}}),e.addPrototype("BaseSuggest",{setActive:function(){e.update(this,"active",!0)},setInactive:function(){e.update(this,"active",!1)},getTitle:function(){return this.valueOf()},view:function(){this.onView&&this.onView(),this.trigger("view")}});var n=function(e,t,n){e&&(this.query=e),t&&this.append(t,n)};return n.prototype=[],t.cloneObj(n.prototype,{setQuery:function(e){this.query=e},doesContain:t.doesContain,add:function(e,t){return this.doesContain(e,t)==-1?(e.q=this.query,this.push(e)):!1},append:function(e,t){for(var n=0;n<e.length;n++)this.add(e[n],t)}}),e.addPrototype("SearchSection",{init:function(e){this._super.apply(this,arguments),this.app=e&&e.app,this.map_parent=e&&e.map_parent,this.edges_list=[],this.rendering_list=[];var t=e.map_parent;e=null,this.on("items-change",function(e){t.refreshEnterItems(),e&&t.changeResultsCounter(),t.bindItemsView()}).on("state_change-active",function(){t.remarkStyles()}).on("requests",function(e){t.addRequests(e)},{immediately:!0})},appendResults:function(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=new this.resItem(e[i]);s.invstg=this.invstg,r.push(s)}return this.r.append(r),t&&this.renderSuggests(n),this},setActive:function(){e.update(this,"active",!0)},setInactive:function(){e.update(this,"active",!1)},loading:function(){e.update(this,"loading",!0)},loaded:function(){e.update(this,"loading",!1)},markOdd:function(t){e.update(this,"odd_section",!t)},getItems:function(e){var t=[].concat(this.rendering_list);return!e&&this.button&&!this.button.state("disabled")&&t.push(this.button),t},hideButton:function(){this.button&&this.button.hide()},showButton:function(){this.button&&this.button.show()},setButtonText:function(e,t){this.button&&this.getButtonText&&this.button.setText(this.getButtonText(e,t))},doesNeed:function(e){return e==(this.r&&this.r.query)},changeQuery:function(t){return!t&&!this.no_results_text&&this.setInactive(),this.loaded(),this.removeOldResults(),e.update(this,"no_results_text",!1),this.r=new n(t),this.rendering_list=[],this.edges_list=[],e.update(this,"query",t),this.setButtonText(!1,t),this.showButton(),this.trigger("items-change"),this},removeOldResults:function(){for(var t=0;t<this.rendering_list.length;t++)this.rendering_list[t].die();e.updateNesting(this,"rendering_list",[])},renderSuggests:function(t,n){var r=n&&!this.edges_list.length,i=this.edges_list&&this.edges_list[this.edges_list.length-1],s=i||0,o=r&&Math.min(this.r.length,s+5)||this.r.length;if(this.r.length){for(var u=s;u<o;u++)this.rendering_list.push(this.r[u]);this.edges_list.push(o)}else t&&(this.no_results_text?(e.update(this,"no_results_text",this.no_results_text),this.hideButton()):this.setInactive());for(var u=0;u<this.edges_list.length;u++){var a=this.rendering_list[this.edges_list[u]];a&&e.update(a,"bordered",!0)}return e.update(this,"no_more_results",t),e.update(this,"preview",n),e.updateNesting(this,"rendering_list",this.rendering_list),e.update(this,"changed",new Date),this.setButtonText(!!this.r.length,this.r.query),this.trigger("items-change",this.r.length),this}}),{testdata:!0}}),define("js/models/invstg",["pv","js/modules/lfmhelp","app_serv","spv","cache_ajax","hex_md5","js/lastfm_data","js/libs/BrowseMap","./Investigation"],function(e,t,n,r,i,s,o,u,a){var f=n.localize,l,c,h,p=function(){return t.parseArtistsResults.apply(this,arguments)},d=function(){return t.parseTracksResults.apply(this,arguments)},v=t.parseTagsResults,m=t.parseAlbumsResults,g=function(){};e.extendFromTo("BaseSuggest",e.Model,g);var y;y=function(){this.init()},e.extendFromTo("BaseSectionButton",g,y),c=function(){},e.extendFromTo("SearchSection",e.Model,c);var b=function(e){this.init(),this.artist=e.artist,this.image=e.image,this.text_title=this.getTitle(),this.updateManyStates({artist:e.artist,image:e.image,text_title:this.text_title})};g.extendTo(b,{valueOf:function(){return this.artist},onView:function(){su.showArtcardPage(this.artist,this.invstg),su.trackEvent("Music search",this.q,"artist: "+this.artist)}});var w=function(e){this.init(),this.pl=e.playlist,this.text_title=this.getTitle(),this.updateManyStates({text_title:this.text_title})};g.extendTo(w,{valueOf:function(){return this.pl.state("nav_title")},onView:function(){this.pl.showOnMap()}});var E=function(){};c.extendTo(E,{no_results_text:f("nothing-found"),init:function(){this._super.apply(this,arguments);if(this.loadMore){var t=this;this.button=(new y).on("view",function(){this.hide(),t.loadMore()}).on("state_change-disabled",function(){t.trigger("items-change")},{skip_reg:!0}),this.setButtonText(),e.updateNesting(this,"button",this.button)}}});var S=function(){};c.extendTo(S,{model_name:"section-playlist",init:function(){this._super.apply(this,arguments),e.update(this,"section_title",f("playlists"))},resItem:w});var x=function(){};E.extendTo(x,{model_name:"section-artist",init:function(){this._super.apply(this,arguments),e.update(this,"section_title",f("Artists","Artists"))},getButtonText:function(e,t){return e?f("fine-more","find more")+" «"+t+"» "+f("oartists","artists"):f("to-search","Search ")+(t?"«"+t+"» ":"")+f("in-artists","in artists")},loadMore:function(){var e=this.r.query;e&&t.getLastfmSuggests("artist.search",{artist:e},e,this,p,!0)},resItem:b});var T=function(t){this.init(),this.artist=t.artist,this.track=t.track,this.image=t.image,e.update(this,"artist",t.artist),e.update(this,"track",t.track),this.image&&e.update(this,"image",t.image);if(t.duration){this.duration=t.duration;var n=parseInt(this.duration,10),r=n%60;n=Math.round(n/60)+":"+(r<10?"0"+r:r),e.update(this,"duration_text",n)}this.text_title=this.getTitle(),e.update(this,"text_title",this.text_title)};g.extendTo(T,{valueOf:function(){return this.artist+" - "+this.track},onView:function(){su.showArtistTopTracks(this.artist,this.invstg,{artist:this.artist,track:this.track}),seesu.trackEvent("Music search",this.q,"track: "+this.artist+" - "+this.track)}});var N=function(){};E.extendTo(N,{model_name:"section-track",init:function(){this._super.apply(this,arguments),e.update(this,"section_title",f("Tracks","Tracks"))},getButtonText:function(e,t){return e?f("fine-more","find more")+" «"+t+"» "+f("otracks","tracks"):f("to-search","Search ")+(t?"«"+t+"» ":"")+f("in-tracks","in tracks")},loadMore:function(){var e=this.r.query;e&&t.getLastfmSuggests("track.search",{track:e},e,this,d,!0)},resItem:T});var C=function(e){this.init(),this.tag=e.tag,e.image&&(this.image=e.image),this.text_title=this.getTitle(),this.updateManyStates({tag:e.tag,image:e.image,text_title:this.text_title})};g.extendTo(C,{valueOf:function(){return this.tag},onView:function(){su.show_tag(this.tag,this.invstg),seesu.trackEvent("Music search",this.q,"tag: "+this.tag)}});var k=function(){};E.extendTo(k,{model_name:"section-tag",init:function(){this._super.apply(this,arguments),e.update(this,"section_title",f("Tags"))},getButtonText:function(e,t){return e?f("fine-more","find more")+" «"+t+"» "+f("otags","tags"):f("to-search","Search ")+(t?"«"+t+"» ":"")+f("in-tags","in tags")},loadMore:function(){var e=this.r.query;e&&t.getLastfmSuggests("tag.search",{tag:e},e,this,v,!0)},resItem:C});var L=function(t){this.init(),this.artist=t.artist,this.name=t.album,e.update(this,"artist",t.artist),e.update(this,"name",t.album),t.image&&(this.image=t.image,e.update(this,"image",t.image)),t.resid&&(this.aid=t.resid),this.text_title=this.getTitle(),this.updateManyStates({text_title:this.text_title})};g.extendTo(L,{valueOf:function(){return"( "+this.artist+" ) "+this.name},onView:function(){su.showArtistAlbum({album_artist:this.artist,album_name:this.name,album_id:this.aid},this.invstg),seesu.trackEvent("Music search",this.q,"album: "+this.text_title)}});var A=function(){};return E.extendTo(A,{model_name:"section-album",init:function(){this._super.apply(this,arguments),e.update(this,"section_title",f("Albums","Albums"))},getButtonText:function(e,t){return e?f("fine-more","find more")+" «"+t+"» "+f("oalbums","albums"):f("to-search","Search ")+(t?"«"+t+"» ":"")+f("in-albums","in albums")},loadMore:function(){var e=this.r.query;e&&t.getLastfmSuggests("album.search",{album:e},e,this,m,!0)},resItem:L}),l=function(){},e.extendFromTo("Investigation",u.Model,l),h=function(){},l.extendTo(h,{"compx-focused":[["focused","mp_has_focus"],function(e,t){return e||t}],"compx-mp_detailed":[["mp_detailed","mp_show","focused","mp_has_focus"],function(e,t,n,r){return e||t&&n&&!r}],"nest-section":[[S,x,A,k,N]],setItemForEnter:function(){},complex_states:{needs_search_from:{depends_on:["mp_detailed"],fn:function(e){return!e}}},key_name_nav:{Enter:function(){this.pressEnter()},Up:function(){this.selectEnterItemAbove()},Down:function(){this.selectEnterItemBelow()}},getURL:function(){return"?q="+encodeURIComponent(this.q||"")},searchf:function(){var e=seesu.gena.playlists,t=[],n,i,s;if(":playlists".match(r.getStringPattern(this.q))){this.setInactiveAll("section-playlist"),n=this.g("section-playlist"),n.setActive(),n.changeQuery(this.q),s=su.getPlaylists();if(s.length)for(i=0;i<s.length;i++)t.push({playlist:s[i]});n.appendResults(t),n.renderSuggests(!0)}else if(!this.q.match(/^:/)){this.setActiveAll("section-playlist"),s=su.getPlaylists(this.q);if(s.length)for(i=0;i<s.length;i++)t.push({playlist:s[i]});t.length&&(n=this.g("section-playlist"),n&&(n.setActive(),n.appendResults(t),n.renderSuggests(!0))),this.searchOffline(this.q),this.searchNetwork(this.q)}},searchOffline:r.debounce(function(e){var t=this.g("section-tag"),n=this.searchTags(e);n.length&&(t.appendResults(n),t.renderSuggests(n))},150),searchTags:function(e){var t=[],n=r.searchInArray(o.toptags,e);for(var i=0;i<n.length;i++)t.push({tag:n[i]});return t},searchNetwork:n.app_env.cross_domain_allowed&&!1?function(e){var n=this;this.loading();var r=s(e),o=i.get("lfm_fs",r,function(r){n.loaded(),t.fast_suggestion(r,e,n)});if(!o){var u=[this.g("section-artist"),this.g("section-track"),this.g("section-tag"),this.g("section-album")];for(var a=0;a<u.length;a++){var f=u[a];f&&f.loading()}t.get_fast_suggests(e,function(r){for(var i=0;i<u.length;i++){var s=u[i];s&&s.loaded()}t.fast_suggestion(r,e,n)},r,this)}}:r.debounce(function(e){t.getLastfmSuggests("artist.search",{artist:e},e,this.g("section-artist"),p),t.getLastfmSuggests("track.search",{track:e},e,this.g("section-track"),d),t.getLastfmSuggests("tag.search",{tag:e},e,this.g("section-tag"),v),t.getLastfmSuggests("album.search",{album:e},e,this.g("section-album"),m)},400),getTitleString:function(e){var t=f("Search-resuls");if(e)return t.replace(this.query_regexp," «"+e+"» ").replace(/^\ |\ $/gi,"");var n=t.replace(this.query_regexp,""),r=n.charAt(0).toLocaleUpperCase();return r+n.slice(1)}}),{Investigation:l,BaseSuggest:g,baseSectionButton:y,SearchSection:c,SearchPage:h}}),define("js/models/song/SongActPlaylisting",["../invstg","../comd","pv"],function(e,t,n){var r,i=function(e){this.init(),this.pl=e.playlist,this.mo=e.mo,this.rpl=e.rpl,this.text_title=this.getTitle(),n.update(this,"text_title",this.text_title)};e.BaseSuggest.extendTo(i,{valueOf:function(){return this.pl.state("nav_title")},onView:function(){this.pl.add(this.mo),this.rpl.hide()}});var s=function(){};e.SearchSection.extendTo(s,{resItem:i,model_name:"section-playlist"});var o=function(){};return e.Investigation.extendTo(o,{skip_map_init:!0,"nest-section":[[s]],init:function(){this._super.apply(this,arguments),this.rpl=this.map_parent,this.mo=this.rpl.mo},searchf:function(){var e=[],t=this.g("section-playlist");if(!t)return;t.setActive(),t.changeQuery(this.q);var n=this.app.getPlaylists(this.q);if(n.length)for(var r=0;r<n.length;r++)e.push({playlist:n[r],mo:this.mo,rpl:this.rpl});t.appendResults(e,!0,!0)}}),r=function(){},t.BaseCRow.extendTo(r,{init:function(){this._super.apply(this,arguments),this.actionsrow=this.map_parent,this.mo=this.map_parent.map_parent,this.app.gena.on("child_change-lists_list",this.checkFullMatch,this.getContextOpts())},"nest-searcher":[o],model_name:"row-playlist-add",search:function(e){n.update(this,"query",e);var t=this.getNesting("searcher");t&&t.changeQuery(e),this.checkFullMatch()},checkFullMatch:function(){var e=this.state("query");n.update(this,"has_full_match",e&&!!this.app.gena.matchTitleStrictly(e))},findAddPlaylist:function(){var e=this.state("query");e&&this.app.gena.findAddPlaylist(e,this.mo),this.hide(),n.update(this,"query",""),this.getNesting("searcher").changeQuery(""),this.checkFullMatch()}}),r}),define("js/models/song/SongActTaging",["js/LfmAuth","app_serv","../comd","spv","pv"],function(e,t,n,r,i){var s=t.localize,o=function(){};e.LfmLogin.extendTo(o,{init:function(){this._super.apply(this,arguments),this.mo=this.map_parent.mo,i.update(this,"active",!0),this.wch(this.pmd,"active_view"),this.wch(this.app.getArtcard(this.mo.state("artist")).getTagsModel(),"simple_tags_list","artist_tags"),this.on("state_change-canload_personal",function(e){e.value&&this.requestState("personal_tags")}),this.wch(this,"petags",function(e){e.value&&e.value.length&&!this.state("user_tags_string")&&i.update(this,"user_tags_string",e.value.join(", "))})},access_desc:s("lastfm-tagging-access"),comma_regx:/\s*\,\s*/,comma_regx_end:/\s*\,\s*$/,"compx-possible_tags":{depends_on:["user_tags_string"],fn:function(e){return e?(e&&r.getExistingItems(e.trim().split(this.comma_regx))).slice(0,10)||[]:[]}},"compx-petags":{depends_on:["personal_tags"],fn:function(e){return r.filter(e,"name")}},"compx-petags_result":{depends_on:["petags","petags_fixed"],fn:function(e,t){return t||e}},"compx-tags_toadd":{depends_on:["petags_result","possible_tags"],fn:function(e,t){return r.arrayExclude(t,e)}},"compx-tags_toremove":{depends_on:["petags_result","possible_tags"],fn:function(e,t){return r.arrayExclude(e,t)}},"compx-has_changes":{depends_on:["tags_toadd","tags_toremove"],fn:function(e,t){return!!(e&&e.length||t&&t.length)}},"compx-canload_personal":{depends_on:["#lfm_userid","active_view"],fn:r.hasEveryArgs},saveTagsChanges:function(){var e=this,t=this.state("tags_toremove");t&&t.length&&t.forEach(function(t){var n=e.app.lfm.post("track.removeTag",{sk:e.app.lfm.sk,artist:e.mo.state("artist"),track:e.mo.state("track"),tag:t}).done(function(){var n=e.state("petags_result")||[];n=r.arrayExclude(n,t),i.update(e,"petags_fixed",n)});e.addRequest(n)});var n=this.state("tags_toadd");if(n&&n.length){var s=e.app.lfm.post("track.addTags",{sk:e.app.lfm.sk,artist:e.mo.state("artist"),track:e.mo.state("track"),tags:n.join(",")}).done(function(){var t=e.state("petags_result");t?t=t.slice():t=[],t.push.apply(t,n),i.update(e,"petags_fixed",t)});e.addRequest(s)}},addTag:function(e){var t=this.state("possible_tags");if(!t||t.indexOf(e)==-1){var n=this.state("user_tags_string")||"";t&&t.length&&(n+=", "),n+=e,i.update(this,"user_tags_string",n)}},changeTags:function(e){i.update(this,"user_tags_string",e)},"stch-active_view":function(e,t){t&&e.requestState("toptags")},req_map:[[["toptags"],function(e){return[r.toRealArray(r.getTargetField(e,"toptags.tag"))]},["lfm","get",function(){return["track.getTopTags",{artist:this.mo.state("artist"),track:this.mo.state("track")}]}]],[["personal_tags"],function(e){return[r.toRealArray(r.getTargetField(e,"tags.tag"))]},["lfm","get",function(){return["track.getTags",{artist:this.mo.state("artist"),track:this.mo.state("track"),user:this.state("#lfm_userid")},{nocache:!0}]}]]]});var u=function(){};return n.BaseCRow.extendTo(u,{"nest-lfm_tagsong":[o],init:function(){var e=this;this._super.apply(this,arguments),this.nestings_opts={auth:this.app.lfm_auth,pmd:this},this.actionsrow=this.map_parent,this.mo=this.map_parent.map_parent;var t=null,n=function(){e.hide()};this.on("child_change-lfm_tagsong",function(e){t&&t.off("tagged-success",n),e.value&&e.value.on("tagged-success",n),t=e.value})},model_name:"row-tag"}),u}),define("js/models/song/SongActSharing",["pv","spv","app_serv","../invstg","../comd","js/LfmAuth"],function(e,t,n,r,i,s){var o=n.localize,u=n.app_env,a=e.state,f=function(e){var t=e.user;this.init(),this.mo=e.mo,this.row=e.row,this.user_id=t.id,this.photo=t.photo,this.online=this.online,this.text_title=t.first_name+" "+t.last_name,this.updateManyStates({photo:t.photo,text_title:this.text_title})};r.BaseSuggest.extendTo(f,{valueOf:function(){return this.user_id},onView:function(){this.mo.postToVKWall(this.user_id),this.row.hide()}});var l=function(){};i.VkLoginB.extendTo(l,{init:function(e){this._super(e,{desc:u.vkontakte?o("to-find-vk-friends"):o("to-post-and-find-vk")},{open_opts:{settings_bits:2},auth:e.map_parent.app.vk_auth})}});var c=function(){};r.SearchSection.extendTo(c,{resItem:f,model_name:"section-vk-users","compx-can_searchf_vkopt":[["vk_opts"],function(e){return(e&2)*1}],"compx-can_post_to_own_wall":[["vk_env","has_vk_api"],function(e,t){return e||t}],"compx-can_search_friends":[["vk_env","has_vk_api","can_searchf_vkopt"],function(e,t,n){return e?!!n:!!t}],"compx-needs_vk_auth":[["can_search_friends"],function(e){return!e}],"nest-vk_auth":[l,!1,"needs_vk_auth"],init:function(){this._super.apply(this,arguments),this.mo=this.map_parent.mo,this.rpl=this.map_parent.map_parent,this.updateManyStates({vk_env:!!u.vkontakte,has_vk_api:!!this.app.vk_api,vk_opts:!!u.vkontakte&&this.app._url.api_settings});var t=this;this.app.on("vk-api",function(n){e.update(t,"has_vk_api",!!n)}),u.vkontakte&&this.app.vk_auth.on("settings-change",function(n){e.update(t,"vk_opts",n)});var n=this.app.s.getInfo("vk");n?n.photo&&e.update(this,"own_photo",n.photo):this.app.s.once("info-change.vk",function(n){n.photo&&e.update(t,"own_photo",n.photo)})},"stch-can_search_friends":function(e,t){t&&e.searchByQuery(a(e,"query"))},searchByQuery:function(e){this.changeQuery(e);var t=this;this.app.once("vk-friends.share-row",function(e){t.handleVKFriendsSearch(e)},{exlusive:!0}).getVKFriends()},handleVKFriendsSearch:function(e){var n=this.state("query"),r=n?t.searchInArray(e,n,["first_name","last_name"]):e;if(r.length){r=r.concat();for(var i=0;i<r.length;i++)r[i]={mo:this.mo,user:r[i],row:this.rpl}}this.appendResults(r,!0)},postToVKWall:function(){this.mo.postToVKWall()}});var h=function(e){this.init();var t=e.user;this.app=e.app,this.mo=e.mo,this.row=e.row,this.userid=t.state("userid"),this.text_title=this.userid,this.updateManyStates({selected_image:t.state("selected_image"),text_title:this.text_title})};r.BaseSuggest.extendTo(h,{valueOf:function(){return this.userid},onView:function(){var e=this;this.mo.shareWithLFMUser(this.userid),e.row.hide()}});var p=function(){};r.SearchSection.extendTo(p,{init:function(){this._super.apply(this,arguments),this.mo=this.map_parent.mo,this.rpl=this.map_parent.map_parent,this.lfm_friends=this.app.routePathByModels("/users/me/lfm:friends"),this.lfm_friends.on("child_change-list_items",function(t){e.updateNesting(this,"friends",t.value),this.changeQuery(""),this.searchByQuery(this.state("query"))},this.getContextOpts()),this.wch(this,"can_share",function(e){e.value&&(this.lfm_friends.preloadStart(),this.searchLFMFriends())})},searchByQuery:function(e){this.changeQuery(e),this.searchLFMFriends()},"compx-can_share":{depends_on:["^^active_view","#lfm_userid"],fn:function(e,t){return t&&e}},searchLFMFriends:function(){var e=this.getNesting("friends")||[],n=this.state("query");if(!this.state("can_share"))return;var r=n?t.searchInArray(e,n,["states.userid","states.realname"]):e;if(r.length){r=r.concat();for(var i=0;i<r.length;i++)r[i]={mo:this.mo,user:r[i],row:this.rpl}}this.appendResults(r,!0)},resItem:h,model_name:"section-lfm-friends"});var d=function(e){this.init();var t=e.user;this.app=e.app,this.mo=e.mo,this.row=e.row,this.userid=t.name,this.text_title=this.userid,this.updateManyStates({selected_image:this.app.art_images.getImageWrap(t.image),text_title:this.text_title})};r.BaseSuggest.extendTo(d,{valueOf:function(){return this.userid},onView:function(){var e=this;this.mo.shareWithLFMUser(this.userid),e.row.hide()}});var v=function(){};r.SearchSection.extendTo(v,{init:function(){this._super.apply(this,arguments),this.mo=this.map_parent.mo,this.rpl=this.map_parent.map_parent,this.wch(this,"can_share",function(e){e.value&&this.searchLFMFriends()})},searchByQuery:function(e){this.changeQuery(e),this.searchOneUser()},"compx-can_share":{depends_on:["^^active_view","#lfm_userid"],fn:function(e,t){return t&&e}},searchOneUser:t.debounce(function(){var e=this,t=this.state("query");if(!t)return;if(!this.state("can_share"))return;this.loading(),this.addRequest(this.app.lfm.get("user.getInfo",{user:t}).done(function(n){if(!e.doesNeed(t))return;e.loaded();var r=[];n.user&&n.user.name&&r.push({mo:e.mo,row:e.rpl,app:e.app,user:n.user}),e.appendResults(r,!0)}).fail(function(){if(!e.doesNeed(t))return;e.loaded()}))},200),searchLFMFriends:function(){var e=this.getNesting("friends")||[],n=this.state("query"),r=n?t.searchInArray(e,n,["states.userid","states.realname"]):e;if(r.length){r=r.concat();for(var i=0;i<r.length;i++)r[i]={mo:this.mo,user:r[i],row:this.rpl}}this.appendResults(r,!0)},resItem:d,model_name:"section-lfm-user"});var m=function(){};s.LfmLogin.extendTo(m,{access_desc:o("lastfm-sharing-access")});var g=function(){};r.Investigation.extendTo(g,{skip_map_init:!0,"nest-lfm_auth":[m],"nest-section":[[c,p,v]],init:function(){this._super.apply(this,arguments),this.mo=this.map_parent.mo,this.nestings_opts={auth:this.app.lfm_auth,pmd:this}},searchf:function(){var e=this.q,t=this;["section-vk-users","section-lfm-friends","section-lfm-user"].forEach(function(n){var r=t.g(n);if(!r)return;r.setActive(),r.searchByQuery(e)})}});var y=function(){};return i.BaseCRow.extendTo(y,{init:function(){this._super.apply(this,arguments),this.actionsrow=this.map_parent,this.mo=this.map_parent.map_parent,this.wch(this.mo,"url_part",this.hndUpdateShareURL),this.search("")},"nest-searcher":[g],hndUpdateShareURL:function(){e.update(this,"share_url",this.mo.getShareUrl())},search:function(t){e.update(this,"query",t);var n=this.getNesting("searcher");n&&n.changeQuery(t)},model_name:"row-share"}),y}),define("js/models/song/SongActionsRow",["pv","spv","app_serv","../comd","js/LfmAuth","./SongActPlaylisting","./SongActTaging","./SongActSharing"],function(e,t,n,r,i,s,o,u){var a=n.localize,f=function(){};i.LfmLogin.extendTo(f,{init:function(){this._super.apply(this,arguments),this.song=this.map_parent.mo,e.update(this,"active",!0)},access_desc:a("lastfm-loveit-access"),beforeRequest:function(){this.bindAuthCallback()},bindAuthCallback:function(){var e=this;this.auth.once("session.input_click",function(){e.makeLove()},{exlusive:!0})},makeLove:function(){if(this.app.lfm.sk){var t=this;e.update(this,"wait_love_done",!0),this.app.lfm.post("Track.love",{sk:this.app.lfm.sk,artist:this.song.artist,track:this.song.track}).always(function(){e.update(t,"wait_love_done",!1),t.trigger("love-success")}),this.app.trackEvent("song actions","love")}}});var l=function(){};r.BaseCRow.extendTo(l,{"nest-lfm_loveit":[f,!1,"active_view"],init:function(){var e=this;this._super.apply(this,arguments),this.actionsrow=this.map_parent,this.mo=this.map_parent.map_parent,this.nestings_opts={auth:this.app.lfm_auth,pmd:this};var t=null,n=function(){e.hide()};this.on("child_change-lfm_loveit",function(e){t&&t.off("love-success",n),e.value&&e.value.on("love-success",n),t=e.value})},model_name:"row-love"});var c=function(){};r.BaseCRow.extendTo(c,{"nest-lfm_scrobble":[i.LfmScrobble],init:function(){this._super.apply(this,arguments),this.nestings_opts={auth:this.app.lfm_auth,pmd:this},this.actionsrow=this.map_parent},model_name:"row-lastfm"});var h=function(){};r.BaseCRow.extendTo(h,{model_name:"row-pl-shuffle",init:function(){this._super.apply(this,arguments),this.actionsrow=this.map_parent,this.wch(this.app,"settings-pl-shuffle",function(t){e.update(this,"pl_shuffle",t.value),e.update(this.actionsrow.mo,"pl-shuffle",t.value)})},switchSetting:function(t){e.update(this,"pl_shuffle",t),su.setSetting("pl-shuffle",t)}});var p=function(){};r.BaseCRow.extendTo(p,{model_name:"row-repeat-song",init:function(){this._super.apply(this,arguments),this.actionsrow=this.map_parent,this.wch(this.app,"settings-rept-song",function(t){e.update(this,"rept_song",t.value),e.update(this.actionsrow.mo,"rept-song",t.value)})},switchSetting:function(t){e.update(this,"rept_song",t),su.setSetting("rept-song",t)}});var d=[c,p,h,s,u,l,o],v={};d.forEach(function(e){v[e.prototype.model_name]=e});var m=function(){};return r.PartsSwitcher.extendTo(m,{"nest_posb-context_parts":d,init:function(){this._super.apply(this,arguments),this.mo=this.map_parent,e.update(this,"active_part",!1),this.inited_parts={},this.nextTick(this.initHeavyPart),this.wch(this.map_parent,"mp_show",this.hndSongHide)},hndSongHide:function(e){e.value||this.hideAll()},initHeavyPart:function(e){e.wch(e.app,"settings-volume",function(t){if(!t.value)return;e.setVolumeState(t.value)})},switchPart:function(e){this.initPart(e),this._super(e)},initPart:function(e){if(e&&!this.inited_parts[e]){var t=this.initSi(v[e]);this.inited_parts[e]=!0,this.addPart(t)}},setVolumeState:function(t){if(!t)return;e.update(this,"volume",t[0]/t[1])},sendVolume:function(e){this.app.setSetting("volume",e)},setVolume:function(t){if(!t)return;e.update(this,"volume",t[0]/t[1]),this.sendVolume(t)}}),m}),define("js/models/song/SongBase",["pv","spv","jquery","./../PlayRequest"],function(e,t,n,r){"use strict";var i=0,s=e.utils.isDepend,o=function(e,t){t===!0?e.map_parent.setWaitingNextSong(e.map_parent,e):t&&t.play()};return e.addPrototype("SongBase",{model_name:"song",init:function(e,n){this._super.apply(this,arguments),this.neighbour_for=null,this.marked_prev_song=null,this.marked_next_song=null,this.ready_to_preload=null,this.track=null,this.rtn_request=null,this.playable_info=null,this.mp3_search=e.app.mp3_search,this.player=e.app.player,this.uid=++i,n.track&&(n.track=n.track.trim()),t.cloneObj(this,n,!1,["artist","track"]),this.omo=n,this.initState("no_track_title",!1),n.artist&&this.initState("artist",n.artist&&n.artist.trim()),n.track&&this.initState("track",n.track),this.initState("playlist_type",this.map_parent.playlist_type),this.initState("url_part",this.getURL()),this.on("requests",this.hndRequestsPrio,this.getContextOptsI()),this.states_was_twisted=!1},hndRequestsPrio:function(){this.map_parent.checkRequestsPriority()},"stch-needs_states_connecting":function(e){e.states_was_twisted||e.twistStates&&(e.twistStates(),e.states_was_twisted=!0)},"stch-mf_cor_current_mopla":function(e,t){e.updateNesting("current_mopla",t)},complex_states:{needs_states_connecting:[["^active_use"]],mf_cor_current_mopla:[["@one:current_mopla:mf_cor"]],file_almost_loaded:[["@every:almost_loaded:mf_cor"]],one_artist_playlist:{depends_on:["playlist_type"],fn:function(e){return e=="artist"}},selected_image:{depends_on:["lfm_image","ext_lfm_image","image_url","album_image"],fn:function(e,t,n,r){return r||e||n||t}},song_title:{depends_on:["artist","track"],fn:function(e,t){return this.getFullName(e,t)}},nav_short_title:{depends_on:["artist","track"],fn:function(e,t){return this.getFullName(e,t,!0)}},nav_title:{depends_on:["artist","track"],fn:function(e,t){return this.getFullName(e,t)}},is_important:{depends_on:["mp_show","player_song","want_to_play"],fn:function(e,t,n){if(e)return"mp_show";if(t)return"player_song";if(n)return"want_to_play"}},"can-use-as-neighbour":{depends_on:["has_none_files_to_play","forbidden_by_copyrh"],fn:function(e,t){return t?!1:e?!1:!0}},has_none_files_to_play:{depends_on:["mf_cor","search_complete","no_track_title","mf_cor_has_available_tracks"],fn:function(e,t,n,r){if(e&&!r){if(!e.isSearchAllowed())return!0;if(t)return!0}return n?!0:!1}},"$relation:next_preload_song-for-loaded_player_song":[["player_song","related_next_preload_song","file_almost_loaded"],function(e,t,n){return e&&n&&t}],"$relation:next_preload_song-for-mp_show":[["mp_show","related_next_preload_song"],function(e,t){return e&&t}],"$relation:next_preload_song-for-player_song":[["player_song","related_next_preload_song"],function(e,t){return e&&t}],"$relation:next_preload_song-for-very_wanted_play":[["want_to_play","related_next_preload_song","^want_be_played","mf_cor_has_available_tracks"],function(e,t,n,r){return!r&&e&&n&&t}],need_files:[["mp_show","want_to_play","next_preload_song-for-mp_show","next_preload_song-for-player_song","next_preload_song-for-very_wanted_play"],function(e,t,n,r,i){return e||t||s(n)||s(r)||s(i)}],preload_current_file:[["next_preload_song-for-loaded_player_song"],function(e){return s(e)}],load_current_file:[["player_song"],function(e){return!!e}]},"stch-$relation:next_preload_song-for-mp_show":e.getRDep("$relation:next_preload_song-for-mp_show"),"stch-$relation:next_preload_song-for-player_song":e.getRDep("$relation:next_preload_song-for-player_song"),"stch-$relation:next_preload_song-for-very_wanted_play":e.getRDep("$relation:next_preload_song-for-very_wanted_play"),"stch-$relation:next_preload_song-for-loaded_player_song":e.getRDep("$relation:next_preload_song-for-loaded_player_song"),canUseAsNeighbour:function(){return this.state("can-use-as-neighbour")},state_change:{mp_show:function(e,t){t?(e.prepareForPlaying(),e.requestState("album_name")):e.removeMarksFromNeighbours()}},requestPlay:function(t){var n=e.getModelById(t),i=e.create(r,null,{nestings:{song:this,wanted_song:this,bwlev:n}},n,this.app);this.player&&this.player.requestPlay(i),this.makeSongPlayalbe(!0)},wantSong:function(){this.player&&this.player.wantSong(this),this.makeSongPlayalbe(!0)},prepareForPlaying:function(){this.makeSongPlayalbe(!0)},simplify:function(){return t.cloneObj({},this,!1,["track","artist"])},mlmDie:function(){},getFullName:function(e,t,n){var r="";return this.artist?this.track?n&&this.map_parent&&this.map_parent.info&&this.map_parent.info.artist==this.artist?r=this.track:r=this.artist+" - "+this.track:r=this.artist:this.track&&(r=this.track),r||"no title"},playNext:function(e){this.state("rept-song")?this.play():o(this,this.map_parent.switchTo(this,!0,e))},playPrev:function(){o(this,this.map_parent.switchTo(this))},canPlay:function(){return this.getMFCore().canPlay()},setVolume:function(e,t){this.getMFCore().setVolume(e,t)},stop:function(){this.getMFCore().stop()},switchPlay:function(){this.getMFCore().switchPlay()},pause:function(){this.getMFCore().pause()},play:function(e){if(this.state("forbidden_by_copyrh"))return;this.getMFCore().play(e)},markAs:function(t,n){this.neighbour_for||(this.neighbour_for=n,e.update(this,"marked_as",t))},unmark:function(t){this.neighbour_for==t&&(this.neighbour_for=null,e.update(this,"marked_as",!1))},wasMarkedAsPrev:function(){return this.state("marked_as")&&this.state("marked_as")=="prev"},wasMarkedAsNext:function(){return this.state("marked_as")&&this.state("marked_as")=="next"},addMarksToNeighbours:function(){if(!this.marked_prev_song||this.marked_prev_song!=this.prev_song)this.marked_prev_song,this.prev_song&&(this.marked_prev_song=this.prev_song);if(!this.marked_next_song||this.marked_next_song!=this.next_song)this.marked_next_song,this.next_song&&(this.marked_next_song=this.next_song);this.map_parent.checkShowedNeighboursMarks()},removeMarksFromNeighbours:function(){this.marked_prev_song&&(this.marked_prev_song=null),this.marked_next_song&&(this.marked_next_song=null),this.map_parent.checkShowedNeighboursMarks()},isImportant:function(){return this.state("is_important")},hasNextSong:function(){return!!this.next_song},setSongName:function(e,t,n,r){e=e&&e.trim(),this.track=e,this.updateManyStates({track:e,url_part:this.getURL()})},req_map:[[["album_name","album_image","listeners","playcount","duration","top_tags"],{source:"track",props_map:{album_name:"album.title",album_image:["lfm_image","album.image"],listeners:["num","listeners"],playcount:["num","playcount"],duration:["num","duration"]},parts_map:{top_tags:{is_array:!0,source:"toptags.tag",props_map:"name"}}},["lfm","get",function(){return["track.getInfo",{artist:this.state("artist"),track:this.state("track")}]}]]],getRandomTrackName:function(r,i,s){e.update(this,"track_name_loading",!0);var o=this;if(!this.track&&!this.rtn_request){var u=[],a=!!this.mp3_search.getSearchByName("vk"),f=n.Deferred(),l,c,h;u.push(f),this.addRequest(this.app.lfm.get("artist.getTopTracks",{artist:this.artist,limit:30,page:1}).done(function(e){var n=t.toRealArray(t.getTargetField(e,"toptracks.track")),r=[];for(var i=0;i<n.length;i++){var s=n[i];r.push({artist:s.artist.name,track:s.name})}f.resolve(r)}).fail(function(){f.resolve()}),{space:"acting"});if(!a){l=n.Deferred(),c=n.Deferred(),h=n.Deferred(),u.push(l),this.addRequest(this.app.lfm.get("artist.getPodcast",{artist:this.artist}).done(function(e){var n=t.toRealArray(t.getTargetField(e,"rss.channel.item")),r=[],i=[];for(var s=0;s<n.length;s++){var u=n[s],a=decodeURI(u.link),f=a.split("/"),c=f[f.length-1];r.push({artist:o.artist,track:c}),i.push(o.app.createLFMFile(o.artist,c,a))}o.mp3_search.pushSomeResults(i),l.resolve(r)}).fail(function(){l.resolve()}),{space:"acting"});var p=function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=e[r],s=o.mp3_search.getFileQMI(i,{artist:o.artist});s!=-1&&i.artist&&i.artist.toLowerCase()==o.artist.toLowerCase()&&s<20&&n.push(i)}o.mp3_search.pushSomeResults(e),t.resolve(n)};u.push(c);var d=this.mp3_search.getSearchByName("soundcloud");d?this.addRequest(d.findAudio({artist:this.artist}).done(function(e){p(e,c)}).fail(function(){c.resolve()}),{space:"acting"}):c.resolve(),u.push(h);var v=this.mp3_search.getSearchByName("exfm");v?this.addRequest(v.findAudio({artist:this.artist}).done(function(e){p(e,h)}).fail(function(){h.resolve()}),{space:"acting"}):h.resolve()}var m=Math.round(Math.random()),g=this.rtn_request=n.when.apply(n.when,u).done(function(n,u,f,l){if(o.track)return;n=n&&n.length&&n;var c=function(t){if(t&&t.length){var n=t[Math.floor(Math.random()*t.length)];o.setSongName(n.track,r,i,s)}else e.update(o,"no_track_title",!0)};if(!a){var h=[];u&&u.length&&(h=h.concat(u)),f&&f.length&&(h=h.concat(f)),l&&l.length&&(h=h.concat(l));var p=t.makeIndexByField(h,"track"),d=[],v;for(v in p)d.push({artist:o.artist,track:v});if(m)d.length?c(d):c(n);else{var g=t.makeIndexByField(n,"track"),y=[];for(v in g)p[v]&&y.push({artist:o.artist,track:v});y.length?c(y):d.length?c(d):c(n)}}else c(n)}).always(function(){e.update(o,"track_name_loading",!1),o.rtn_request==g&&delete o.rtn_request,o.checkChangesSinceFS()})}},investg_rq_opts:{depend:!0,space:"acting"},hndInvestgReqs:function(e){this.addRequests(e,this.investg_rq_opts)},"stch-playable":function(e,t){t&&e.map_parent.markAsPlayable()},"compx-search_complete":[["@one:search_complete:investg"]],"compx-playable":[["@one:has_mp3_files:investg","@one:has_available_tracks:mf_cor"],function(e,t){return e||t}],"compx-files_search":[["@one:legacy-files-search:investg","@one:has_available_tracks:mf_cor"],function(e,t){return e||t&&{search_complete:!0,have_best_tracks:!0,have_mp3_tracks:!0,have_tracks:!0}}],"compx-searching_files":[["@one:has_request:investg"]],"stch-files_search":function(e,t){e.checkChangesSinceFS(t)},bindFilesSearchChanges:function(e){this.updateNesting("investg",e),e.on("requests",this.hndInvestgReqs,this.getContextOptsI())},isSearchAllowed:function(){return this.getMFCore()&&this.getMFCore().isSearchAllowed()},makeSongPlayalbe:function(e,t,n){!this.track&&e&&this.getRandomTrackName&&this.getRandomTrackName(e,t,n)},checkRequestsPriority:function(){this.map_parent.checkRequestsPriority()},getActingPriorityModels:function(){var e=[];return this.next_song?e.push(this.next_song):this.map_parent.state("has_data_loader")?e.push(this.map_parent):this.next_preload_song&&e.push(this.next_preload_song),e.push(this),e},checkChangesSinceFS:function(e){this.map_parent.checkChangesSinceFS(this,e)},view:function(e,t){this.state("mp_show")||this.trigger("view",e,t)},valueOf:function(){return(this.artist?this.artist+" - ":"")+this.track},isPossibleNeighbour:function(e){return this.isNeighbour(e)||e==this.next_preload_song},isNeighbour:function(e){return e==this.prev_song||e==this.next_song},setPlayableInfo:function(e){return this.playable_info=e,this},posistionChangeInMopla:function(e){this.getCurrentMopla()==e&&(this.submitPlayed(!0),this.submitNowPlaying(),this.start_time||(this.start_time=(Date.now()/1e3).toFixed(0)))},getCurrentMopla:function(){return this.getMFCore().getCurrentMopla()},showArtcardPage:function(e){this.app.showArtcardPage(e||this.artist),this.app.trackEvent("Artist navigation","art card",e||this.artist)},showArtistSimilarArtists:function(){this.app.showArtistSimilarArtists(this.artist),this.app.trackEvent("Artist navigation","similar artists to",this.artist)}}),{}}),define("js/models/Song",["pv","spv","app_serv","js/libs/BrowseMap","./MfCor","./song/SongActionsRow","./song/SongBase"],function(e,t,n,r,i,s,o){var u=["[","]","(",")"];u.forEach(function(e,n){u[n]={regexp:new RegExp(t.escapeRegExp(e),"gi"),str:window.escape(e)}});var a={url:"i/album_placeholder.png"},f=n.app_env,l,c=function(){};return e.extendFromTo("SongBase",r.Model,c),l=function(){},c.extendTo(l,{"nest-songcard":["#tracks/[:artist],[:track]",!1,"can_load_songcard"],"compx-$relation:songcard-for-active_song":[["can_load_songcard","@songcard"],function(e,t){return e&&t}],"stch-$relation:songcard-for-active_song":e.getRDep("$relation:songcard-for-active_song"),"stch-can_load_baseinfo":function(e,t){if(t){var n=e.getNesting("artist");if(n){var r=n.requestState("bio");r&&e.addRequest(r)}else console.warn("no nested artcard")}},"stch-can_load_images":function(e,t){if(t){var n=e.getNesting("artist");if(n){var r=n.requestState("profile_image");r&&e.addRequest(r)}else console.warn("no nested artcard")}},init:function(e,t){var n=t.artist;t.artist=t.artist||" ",this._super.apply(this,arguments),this.mf_cor=null,this.mopla=null,this.start_time=null,this.last_scrobble=null;var r;t.image_url&&this.initState("image_url",{url:t.image_url}),t.lfm_img?r=t.lfm_img:t.lfm_image&&(r=this.app.art_images.getImageWrap(t.lfm_image.array||t.lfm_image.item));var i;t.album_image&&this.initState("album_image",t.album_image),t.album_name&&this.initState("album_name",t.album_name);if(r)this.initState("lfm_image",r);else if(n){var s=!0;this.init_states.track?i=this.app.art_images.getTrackImagesModel({artist:this.init_states.artist,track:this.init_states.track}):i=this.app.art_images.getArtistImagesModel(this.init_states.artist),this.wch(i,"image-to-use","ext_lfm_image"),s=!1}this.initStates()},twistStates:function(){this.initHeavyPart()},"compx-forbidden_by_copyrh":[["#forbidden_by_copyrh","#white_of_copyrh","artist","track"],function(e,t,n,r){if(n){var i=(t||e)&&n.toLowerCase();if(t)return!t[i];if(e)return r?e[i]===!0?!0:e[i]&&e[i][r.toLowerCase()]:e[i]===!0}}],"compx-has_full_title":{depends_on:["artist","track"],fn:function(e,t){return e&&t}},"compx-available_images":[["artist_images","album_image"],function(e,t){var n=[];return t?n.push(t):n.push(a),e&&n.push.apply(n,e),n}],"compx-can_load_songcard":{depends_on:["can_expand","has_full_title"],fn:function(e,t){return e&&t}},"compx-can_load_baseinfo":{depends_on:["can_expand","has_nested_artist"],fn:function(e,t){return e&&t}},"compx-can_load_images":{depends_on:["artist","can_expand","has_nested_artist"],fn:function(e,t,n){return e&&t&&n}},"compx-can_expand":[["files_search","marked_as","mp_show"],function(e,t,n){return t&&e&&e.search_complete?!0:n?!0:!1}],"nest-actionsrow":[s,!1,"mp_show"],getMFCore:function(){return this.initHeavyPart(),this.mf_cor},initHeavyPart:e.getOCF("izheavy",function(){var t=this.omo;t.side_file&&!t.side_file.link&&(t.side_file=null),t.side_file&&(this.mp3_search.addFileToInvestg(t.side_file,t.side_file),t.side_file=null),t.file&&!t.file.link&&(t.file=null),this.mf_cor=this.initSi(i,null,t),this.mf_cor.on("before-mf-play",this.hndMfcBeforePlay,this.getContextOptsI()).on("error",this.hndMfcError,this.getContextOpts()),e.updateNesting(this,"mf_cor",this.mf_cor),e.update(this,"mf_cor",this.mf_cor)}),"compx-mf_cor_has_available_tracks":[["@some:has_available_tracks:mf_cor"]],"compx-play":[["@one:play:current_mopla"]],hndMfcBeforePlay:function(e){this.player.changeNowPlaying(this,e.state("play")),this.mopla=e},hndMfcError:function(e){this.player.trigger("song-play-error",this,e)},getShareUrl:function(){return this.artist&&this.track?"http://seesu.me/o#/catalog/"+(this.app.encodeURLPart(this.artist)+"/_/"+this.app.encodeURLPart(this.track)).replace(/\'/gi,"%27"):""},mlmDie:function(){this.hideOnMap()},getURL:function(){var e="";return this.map_parent.playlist_artist&&this.map_parent.playlist_artist==this.artist?e+="/"+this.app.encodeURLPart(this.track):e+="/"+this.app.encodeURLPart(this.artist)+","+this.app.encodeURLPart(this.track||""),e},shareWithLFMUser:function(e){var t=this.state("artist"),n=this.state("track");if(!t||!n)return;var r=this.getShareUrl();u.forEach(function(e){r=r.replace(e.regexp,e.str)});var i=this.app.lfm.post("track.share",{sk:this.app.lfm.sk,artist:t,track:n,recipient:e,message:r});return this.addRequest(i),i},postToVKWall:function(e){var n={},r=this.getMFCore().getVKFile();e&&(n.owner_id=e),r&&(n.attachments="audio"+r._id),n.message=this.state("nav_title")+" \n"+this.getShareUrl(),n.attachments;if(window.VK)VK.api("wall.post",n,function(){});else{for(var i in n)n[i]=encodeURIComponent(n[i]);f.openURL("http://seesu.me/vk/share.html?"+t.stringifyParams({app_id:this.app.vkappid},!1,"=","&")+"#?"+t.stringifyParams(n,!1,"=","&"))}seesu.trackEvent("song actions","vk share");return},submitPlayed:function(e){var t=this.start_time,n=this.last_scrobble,r=(Date.now()/1e3).toFixed(0),i=Math.round(this.getCurrentMopla().getDuration()/1e3)||"";if(!i&&!e||(r-t)/i>.33&&!n||(r-n)/i>.6)this.start_time=!1,this.last_scrobble=r,delete this.start_time,this.app.settings["lfm-scrobbling"]&&this.app.lfm.submit({artist:this.artist,track:this.track,album:this.state("album_name")},i,r),this.app.s.loggedIn()&&this.app.s.api("track.scrobble",{client:this.app.env.app_type,status:"finished",duration:i,artist:this.artist,title:this.track,timestamp:r})},submitNowPlaying:t.debounce(function(){var e=this.getCurrentMopla();if(!e)return;var t=Math.round(e.getDuration()/1e3)||"";this.app.settings["lfm-scrobbling"]&&this.app.lfm.nowplay({artist:this.artist,track:this.track,album:this.state("album_name")},t),this.app.s.loggedIn()&&this.app.s.api("track.scrobble",{client:this.app.env.app_type,status:"playing",duration:t,artist:this.artist,title:this.track,timestamp:(Date.now()/1e3).toFixed(0)})},200),"compx-artist_images":[["@available_images:artist"],function(e){return e&&e[0]}],"compx-has_nested_artist":[["@artist"],function(e){return!!e}],"compx-load_artcard":[["needs_states_connecting","artist","is_important"],function(e,t,n){return e&&(t||n)}],"nest-artist":["#catalog/[:artist]",!1,"load_artcard"]}),l}),define("js/models/SongsListBase",["pv","spv"],function(e,t){"use strict";return e.addPrototype("SongsListBase",t.coe(function(n){var r={},i=function(e){return r[e]||(r[e]=e.replace("vis_neig_","")),r[e]},s=function(t){var n=i(t.nesting_name),r="cur_"+t.nesting_name;t.value!=this[r]&&(this[r]&&e.update(this[r],"marked_as",!1),this[r]=t.value,t.value&&e.update(t.value,"marked_as",n))},o=function(e){var t=+(new Date);for(var n=0;n<e.getMainlist().length;n++)e.getMainlist()[n].setPlayableInfo({packsearch:t,last_in_collection:n==e.getMainlist().length-1});return e},u=function(e,t){t&&t.isImportant();var n=S(e),r=x(e,n),i=T(e,r);n&&!n.hasNextSong()&&w(e,n,!1,!1),r&&!r.hasNextSong()&&w(e,r,!1,!1),i&&r!=i&&!i.hasNextSong()&&w(e,i,!1,!1),e.state("want_be_played")&&e.getMainlist()&&e.getMainlist()[0].wantSong()},a=function(e){e.skip_report||(o(this),this.makePlayable(),this.nextTick(u,[this,e.last_usable_song]))},f=function(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]}},l=f(function(e){return e&&e.state("want_to_play")}),c=f(function(e){return e&&e.state("mp_show")}),h=f(function(e){return e&&e.state("player_song")}),p=function(e,t){var n=x(e,t),r=T(e,t),i=S(e,t);n&&w(e,n,t),r&&n!=r&&w(e,r,t),i&&i!=r&&i!=n&&w(e,i,t)},d=function(){var e=function(e){return e};return function(n){return n&&t.filter(n,"is_important",e)}}(),v=function(e,t){e.state("pl-shuffle")&&b(t,{next_preload_song:null}),w(e,t)},m=function(e,t){e.waiting_next=t,e.player.setWaitingPlaylist(e)},g=function(e,t,n){var r={},i;if(n)for(var s in n)n[s]&&(r[s]=null);var o=e.getMainlist().indexOf(t);if(!n||n.prev_song)for(i=o-1;i>=0;i--)if(e.getMainlist()[i].canUseAsNeighbour()){r.prev_song=e.getMainlist()[i];break}var u=e.state("pl-shuffle");if(!n||n.next_song)for(i=o+1;i<e.getMainlist().length;i++)if(e.getMainlist()[i].canUseAsNeighbour()){r.next_song=e.getMainlist()[i],u||(r.next_preload_song=r.next_song);break}if(u&&!t.next_preload_song&&(!n||n.next_preload_song)){var a=e.getMainlist(),f=[];for(i=0;i<a.length;i++)a[i].canUseAsNeighbour()&&f.push(a[i]);r.next_preload_song=f[Math.round(Math.random()*f.length)]}if((!n||n.next_preload_song)&&!r.next_preload_song)for(i=0;i<o;i++)if(e.getMainlist()[i].canUseAsNeighbour()){r.next_preload_song=e.getMainlist()[i];break}return r},y=function(e,n){var r,i={},s={next_song:e.next_song,prev_song:e.prev_song,next_preload_song:e.next_preload_song},o,u;if(n){for(r in s)i[r]=s[r]==n,s[r]==n&&(u=u||!0);u?(n.canUseAsNeighbour(),n.canUseAsNeighbour()||(o=g(this,e,i))):n.canUseAsNeighbour()&&(o=g(this,e))}else{for(r in s)s[r]&&!s[r].canUseAsNeighbour()&&(i[r]=!0,u=u||!0);u?o=g(this,e,i):o=g(this,e)}var a=t.cloneObj({},s);return o&&t.cloneObj(a,o),t.getDiffObj(s,a)},b=function(e,n){t.cloneObj(e,n);var r={};for(var i in n)r["related_"+i]=n[i];e.updateManyStates(r)},w=function(e,t,n,r){var i=y.call(e,t,n);b(t,i),r=r||!!t.state("mp_show");var s=!!t.state("player_song"),o=t.state("want_to_play");r&&(t.addMarksToNeighbours(),t.prev_song&&!t.prev_song.track&&t.prev_song.getRandomTrackName()),(r||s)&&t.next_preload_song&&t.next_preload_song.makeSongPlayalbe(!0),e.state("want_be_played")&&o&&!t.canPlay()&&t.next_preload_song&&(m(e,t),t.next_preload_song.makeSongPlayalbe(!0));if(r||s||o)t.hasNextSong()||e.requestMoreData()},E=function(e){for(var t=e.getMainlist().length-1;t>=0;t--){var n=e.getMainlist()[t];if(n.canUseAsNeighbour())return n}},S=function(e,t){return e.idx_wplay_song!=t&&e.idx_wplay_song},x=function(e,t){return e.idx_show_song!=t&&e.idx_show_song},T=function(e,t){return e.idx_player_song!=t&&e.idx_player_song};n({model_name:"playlist","compx-active_use":[["mp_show","want_be_played"],function(e,t){return e||t}],"stch-pl-shuffle":function(e){p(e)},"stch-want_to_play@songs-list":function(e,t,n,r){if(!r.item){var i=l(r.items);e.idx_wplay_song=i}else t?e.idx_wplay_song=r.item:e.idx_wplay_song==r.item&&(e.idx_wplay_song=null)},"stch-player_song@songs-list":function(t,n,r,i){if(!i.item){var s=h(i.items);t.idx_player_song=s}else n?t.idx_player_song=i.item:t.idx_player_song==i.item&&(t.idx_player_song=null);e.updateNesting(t,"last_played_song",t.idx_player_song||t.getNesting("last_played_song")),e.update(t,"last_played_song_start",Date.now())},"stch-can-use-as-neighbour@songs-list":function(e,t,n,r){if(!r.item)return;p(e,r.item)},"stch-is_important@songs-list":function(e,t,n,r){if(!r.item){var i=d(r.items);if(i)for(var s=0;s<i.length;s++)v(e,i[s])}else r.item.isImportant()&&v(e,r.item)},"stch-mp_show@songs-list":function(e,t,n,r){if(!r.item){var i=c(r.items);e.idx_show_song=i}else t?e.idx_show_song=r.item:e.idx_show_song==r.item&&(e.idx_show_song=null);e.checkShowedNeighboursMarks()},bindStaCons:function(){this._super(),this.on("child_change-"+this.main_list_name,a),this.on("child_change-vis_neig_prev",s),this.on("child_change-vis_neig_next",s)},init:function(e){this._super.apply(this,arguments),this.idx_wplay_song=null,this.idx_show_song=null,this.idx_player_song=null,this.vis_neig_next=null,this.vis_neig_prev=null,this.app=e.app,this.player=this.app.p,this.mp3_search=this.app.mp3_search,e.pmd&&(this.pmd=e.pmd)},checkShowedNeighboursMarks:function(){e.updateNesting(this,"vis_neig_prev",this.idx_show_song&&this.idx_show_song.marked_prev_song||null),e.updateNesting(this,"vis_neig_next",this.idx_show_song&&this.idx_show_song.marked_next_song||null)},main_list_name:"songs-list",add:function(e){var n=t.cloneObj({},e,!1,["track","artist","file"]);return this.addDataItem(n)},isDataItemValid:function(e){return!!e.artist&&!!e.artist.trim()},isDataInjValid:function(e){if(!e.track&&!e.artist)return;return!0},items_comparing_props:[["artist","artist"],["track","track"]],getMainListChangeOpts:function(){return{last_usable_song:E(this)}},die:function(){this.hideOnMap(),this._super();for(var e=this.getMainlist().length-1;e>=0;e--)this.getMainlist()[e].die()},simplify:function(){var e=this.getMainlist(),n=new Array(e&&e.length);for(var r=0;r<e.length;r++)n[r]=e[r].simplify();return t.cloneObj({length:n.length,playlist_title:this.state("nav_title")||""},n)},markAsPlayable:function(){e.update(this,"can_play",!0)},makePlayable:function(e){for(var t=0;t<this.getMainlist().length;t++){var n=this.getMainlist()[t],r=n.playable_info||{};n.makeSongPlayalbe(r.full_allowing||e,r.packsearch,r.last_in_collection)}},checkChangesSinceFS:function(){this.player.waiting_playlist&&this==this.player.waiting_playlist?this.waiting_next&&(this.waiting_next.next_preload_song?this.waiting_next.next_preload_song.canPlay()&&this.waiting_next.next_preload_song.wantSong():(this.waiting_next=null,this.player.waiting_playlist=null)):this.waiting_next=null},wantListPlaying:function(){this.player.removeCurrentWantedSong(),e.update(this,"want_be_played",!0),this.getMainlist()[0]?this.getMainlist()[0].wantSong():this.requestMoreData();var t=this;this.player.once("now_playing-signal",function(){e.update(t,"want_be_played",!1)})},setWaitingNextSong:m,switchTo:function(e,t){var n=[];for(var r=0;r<this.getMainlist().length;r++){var i=this.getMainlist()[r].canPlay();i&&n.push(this.getMainlist()[r])}var s=n.indexOf(e),o=n.length||0;if(n.length>1){var u=!1;if(t){var a=e.next_preload_song,f=!this.state("dont_rept_pl"),l=this.state("pl-shuffle");if(a){var c=this.getMainlist().indexOf(e),h=this.getMainlist().indexOf(a);if(l||f||h>c){a.canPlay()||a.makeSongPlayalbe(!0);if(!a.canPlay())return!0;u=a}}else{if(this.state("can_load_more"))return!0;s==o-1?f&&(u=n[0]):u=n[s+1]}}else s===0?u=n[o-1]:u=n[s-1];return u}if(n[0])return n[0]},checkNavRequestsPriority:function(){var e,t=[],n=this.waiting_next,r=x(this),i=T(this),s=function(e,t){if(e.indexOf(t)==-1)return e.push(t),!0};r&&(s(t,r),r.next_song?s(t,r.next_song):this.state("can_load_more")&&s(t,this),r.prev_song&&s(t,r.prev_song)),i&&(s(t,i),i.next_song&&s(t,i.next_song)),n&&(s(t,n),n.next_song&&s(t,n.next_song)),s(t,this),t.reverse();for(e=0;e<t.length;e++)t[e].setPrio()},checkRequestsPriority:function(){this.checkNavRequestsPriority()},getSPC:!0,subPager:function(e,t){var n=this.app.getCommaParts(t),r=n[1]?n[0]:this.playlist_artist;return this.findMustBePresentDataItem({artist:r,track:n[1]?n[1]:n[0]})},requestLastPlayedSong:function(){this.getNesting("last_played_song").requestPage()}})})),{}}),define("js/models/SongsList",["pv","app_serv","./LoadableList","./comd","./Song","./SongsListBase","spv"],function(e,t,n,r,i,s,o){"use strict";var u=t.localize,a=t.app_env,f=function(e){this.result=this.header+"\n";for(var t=0;t<e.length;t++)this.result+=this.preline+":"+(e[t].duration||"-1")+","+e[t].artist_name+" - "+e[t].track_title+"\n"+e[t].mp3link+"\n";this.data_uri=this.request_header+escape(this.result)};f.prototype={header:"#EXTM3U",preline:"#EXTINF",request_header:"data:audio/x-mpegurl; filename=seesu_playlist.m3u; charset=utf-8,"};var l=function(){};r.PartsSwitcher.extendTo(l,{"nest_posb-context_parts":[h,c],init:function(){this._super.apply(this,arguments),this.pl=this.map_parent,e.update(this,"active_part",!1),this.addPart(new h(this,this.pl)),this.addPart(new c(this,this.pl))},"compx-loader_disallowing_desc":[["^loader_disallowing_desc"],function(e){return e}]});var c=function(e){this.init(e)};r.BaseCRow.extendTo(c,{init:function(e){this.actionsrow=e,this._super(),this.wch(su,"settings-dont-rept-pl","dont_rept_pl")},setDnRp:function(t){e.update(this,"dont_rept_pl",t),su.setSetting("dont-rept-pl",t)},model_name:"row-pl-settings"});var h=function(e){this.init(e)};r.BaseCRow.extendTo(h,{init:function(e){this.actionsrow=e,this._super()},makePlayable:function(){this.actionsrow.pl.makePlayable(!0),su.trackEvent("Controls","make playable all tracks in playlist")},makeExternalPlaylist:function(){this.actionsrow.pl.makeExternalPlaylist(),su.trackEvent("Controls","make *.m3u")},model_name:"row-multiatcs"});var p=function(){};e.extendFromTo("SongsListBase",n,p);var d=function(){};p.extendTo(d,{"nest-plarow":[l],bindStaCons:o.precall(p.prototype.bindStaCons,function(){this.wch(this.app,"settings-dont-rept-pl","dont_rept_pl"),this.wch(this.app,"settings-pl-shuffle","pl-shuffle")}),"nest_rqc-songs-list":i,makeExternalPlaylist:function(){var e=this.getMainlist();if(!e.length)return!1;var t=[];for(var n=0;n<e.length;n++){var r=e[n].getMFCore().getFilteredFiles(),i=r&&r[0];i&&t.push({track_title:i.track,artist_name:i.artist,duration:i.duration,mp3link:i.link})}t.length&&(this.current_external_playlist=new f(t),this.current_external_playlist.result&&a.openURL("http://seesu.me/generated_files/seesu_playlist.m3u?mime=m3u&content="+escape(this.current_external_playlist.result)))}});var v=function(){};return d.extendTo(v,{init:function(){this._super.apply(this,arguments),this.can_use=this.app.hypem.can_send,e.update(this,"browser_can_load",this.can_use),e.update(this,"possible_loader_disallowing",u("Hypem-cant-load"))},page_limit:20,"compx-loader_disallowing_desc":{depends_on:["loader_disallowed","possible_loader_disallowing"],fn:function(e,t){if(e)return t}},"compx-loader_disallowed":{depends_on:["browser_can_load"],fn:function(e){return!e}}}),d.HypemPlaylist=v,d}),define("js/models/AppModel",["./AppModelBase","spv","app_serv","./SongsList","pv","../libs/BrowseMap"],function(e,t,n,r,i,s){var o=n.localize,u=function(){};return e.extendTo(u,{init:function(){this._super();for(var e in this.bmap_travel)this[e]=this.getBMapTravelFunc(this.bmap_travel[e],this);return this},checkUserInput:function(e){e.ext_search_query&&this.search(e.ext_search_query);var t;this.p&&this.p.c_song&&(this.showNowPlaying(!0),t=!0),t&&(e.state_recovered=!0),!t&&!e.ext_search_query&&this.trigger("handle-location"),i.update(this.start_page,"can_expand",!0)},infoGen:function(e,t,n){e&&(t.prev&&(t.str+=", "),t.str+=n.replace("%s",e),t.prev||(t.prev=!0))},nowPlaying:function(e){i.update(this,"now_playing",e.getTitle()),this.current_playing=e,this.matchNav(),this.updatePlayedListsHistory(e)},matchNav:function(){this.current_playing&&i.update(this,"viewing_playing",this.nav_tree.indexOf(this.current_playing)!=-1)},updatePlayedListsHistory:function(e){var n=this.getNesting("played_playlists");n?n=n.slice():n=[];var r=n.indexOf(e.map_parent);r==-1?n.unshift(e.map_parent):(t.removeItem(n,r),n.unshift(e.map_parent)),i.updateNesting(this,"played_playlists",n),i.update(this,"played_playlists_length",n.length)},playing:function(){i.update(this,"playing",!0)},notPlaying:function(){i.update(this,"playing",!1)},createSonglist:function(e,t){var n=new r;return n.init({app:this,map_parent:e},t),n},keyNav:function(e){var t=this.map.getCurMapL().getNesting("pioneer");if(t.key_name_nav){var n=t.key_name_nav[e];n.call(t)}},bmap_travel:{showArtcardPage:function(e){var t=this.getArtcard(e);return t.showOnMap(),t},showArtistAlbum:function(e,t){var n=this.showArtcardPage(e.album_artist,t),r=n.showAlbum(e);return r},showNowPlaying:function(e){var t=this.p.resolved,n=t.getNesting("bwlev"),r=s.getConnectedBwlev(n,this.p.c_song.map_parent);r.followTo(this.p.c_song._provoda_id),e||this.trackEvent("Navigation","now playing")},showResultsPage:function(e){var t,n=this.search_el,r=!n||!n.state("mp_has_focus")||n.state("mp_detailed");if(r){var i=this.createSearchPage(),s=this;i.on("state_change-mp_show",function(e){e.value&&(s.search_el=this)},{immediately:!0}),i.showOnMap(),t=i}else t=this.search_el;var o=t;return o.changeQuery(e),o},showLastfmUser:function(e){var t=this.getLastfmUser(e);return t.showOnMap(),t},show_tag:function(e){var t=this.routePathByModels("tags/"+e);return t.showOnMap(),t},showTopTacks:function(e,t){var n=this.showArtcardPage(e),r=n.showTopTacks(t);return r},showArtistTopTracks:function(e,t,n){var r=this.showArtcardPage(e,t),i=n&&n.track,s=r.showTopTacks(i);return s},showArtistSimilarArtists:function(e){var t=this.showArtcardPage(e,this.start_page);return t.showSimilarArtists()}},getVkUser:function(e){return this.start_page.getSPI("users/vk:"+encodeURIComponent(e),!0)},getLastfmUser:function(e){return this.start_page.getSPI("users/lfm:"+encodeURIComponent(e),!0)},getSongcard:function(e,t){return!e||!t?!1:this.start_page.getSPI("tracks/"+this.joinCommaParts([e,t]),!0)},getArtcard:function(e){return this.start_page.getSPI("catalog/"+encodeURIComponent(e),!0)},search:function(e){var t=this.state("search_query");e!=t&&(e?this.showResultsPage(e):this.showStartPage()),i.update(this,"search_query",e)},"stch-search_request_freshness":function(e){var t=e.state("search_query");t&&e.showResultsPage(t)},refreshSearchRequest:function(e){i.update(this,"search_request_freshness",e)},checkActingRequestsPriority:function(){var e=[],t=[],n,r=this.p&&this.p.wanted_song,i=function(e,t){e.indexOf(t)==-1&&e.push(t)};r&&i(t,r);var s=[this.p&&this.p.waiting_next,this.getNesting("current_mp_md"),this.p&&this.p.c_song];for(n=0;n<s.length;n++){var o=s[n];if(o)if(o.getActingPriorityModels){var u=o.getActingPriorityModels();u.length&&(e=e.concat(u))}else e.push(o)}for(n=0;n<e.length;n++)i(t,e[n]);t.reverse();for(n=0;n<t.length;n++)t[n].setPrio("acting")}}),u}),define("js/modules/declr_parsers",["spv","js/libs/Mp3Search","js/common-libs/htmlencoding"],function(e,t,n){var r=function(e){var t=[];for(var n in e)n==parseInt(n,10)&&e[n]&&t.push(e[n]);return t},i=/^\s+|\s+$/gi,s=function(e){var n=[];for(var r=0;r<e.length;r++){var s=e[r],o={artist:s.artist,track:s.title};o.artist||(o=t.guessArtist(s.title)),o.image_url=s.thumb_url,o.artist=o.artist&&o.artist.replace(i,""),n.push(o),o.artist||(console.log("there is no needed attributes"),console.log(s))}return n},o=20;return{hypem:{tracks:[function(e,t,n){var i=r(e);return s(i,t,n)},!0]},lfm:{getUsers:function(e,t,n){return[{is_array:!0,source:e+".user",props_map:{userid:"name",realname:null,country:null,age:["num","age"],gender:null,playcount:["num","playcount"],playlists:["num","playlists"],lfm_img:["lfm_image","image"],registered:["timestamp","registered"],scrobblesource:null,recenttrack:null}},!t&&this.getPaging(n||e)]},getPaging:function(e){return{source:e+".@attr",props_map:{page_num:["num","page"],items_per_page:["num","perPage"],total_pages_num:["num","totalPages"],total:["num","total"]}}},getTracks:function(e,t,n){return[{is_array:!0,source:e+".track",props_map:{artist:"artist.name",track:"name",lfm_img:["lfm_image","image"]}},!t&&this.getPaging(n||e)]},getArtists:function(e,t,n){return[{is_array:!0,source:e+".artist",props_map:{artist_name:"name",artist:"name",lfm_img:["lfm_image","image"]}},!t&&this.getPaging(n||e)]},getAlbums:function(e,t,n){return[{is_array:!0,source:e+".album",props_map:{album_artist:"artist.name",album_name:"name",playcount:["num","playcount"],lfm_img:["lfm_image","image"],original_artist:"#artist"}},!t&&this.getPaging(n||e)]}},exfm:{tracks_no_paging:[{is_array:!0,source:"songs",props_map:{artist:"artist",track:"title"}},!1,[["files",{is_array:!0,source:"songs",props_map:{artist:"artist",track:"title",link:"url"}}]]]},soundcloud:{tracksFn:function(e){var r=[],i=this.artcard_artist;for(var s=0;s<e.length;s++){var o=e[s],u=t.guessArtist(o.title,i);if(!u||!u.artist)this.allow_artist_guessing?u={artist:i,track:o.title}:u={artist:o.user.username,track:o.title};u.track=n.decode(u.track),u.image_url=o.artwork_url,u.file=this.app.mp3_search.getSearchByName("soundcloud").makeSongFile(o),r.push(u)}return r}},vk:{getTracksFn:function(t){return function(r){var i=this.app.mp3_search.getSearchByName("vk"),s=[],o=e.getTargetField(r,t);for(var u=0;u<o.length;u++){var a=o[u];s.push({artist:n.decode(a.artist),track:n.decode(a.title),file:i.makeSongFile(a)})}return s}}}}}),define("js/models/ArtCard",["spv","pv","app_serv","js/libs/FuncsStack","js/libs/BrowseMap","./LoadableList","./SongsList","js/common-libs/htmlencoding","js/libs/Mp3Search","js/modules/declr_parsers"],function(e,t,n,r,i,s,o,u,a,f){var l=n.localize,c=function(){},h,p,d=function(){};o.extendTo(d,{init:function(e,n){this._super(e,!1),this.playlist_artist=this.album_artist=n.album_artist,this.album_name=n.album_name,this.original_artist=n.original_artist,this.updateManyStates({album_artist:this.playlist_artist,album_name:this.album_name,original_artist:this.original_artist,nav_title:"("+n.album_artist+") "+n.album_name,url_part:"/"+this.getAlbumURL()}),this.playlist_type="album",n.lfm_image&&t.update(this,"lfm_image",this.app.art_images.getImageWrap(n.lfm_image.array)),n.lfm_img&&t.update(this,"lfm_img",n.lfm_img)},"compx-can_hide_artist_name":{depends_on:["album_artist","original_artist"],fn:function(e,t){return e==t}},"compx-selected_image":{depends_on:["lfm_img","lfm_image","profile_image"],fn:function(e,t,n){return n||e||t}},getURLPart:function(e,t){return e.album_artist==e.original_artist?t.encodeURLPart(e.album_name):t.encodeURLPart(e.album_artist)+","+t.encodeURLPart(e.album_name)},getAlbumURL:function(){return this.getURLPart({original_artist:this.original_artist,album_artist:this.playlist_artist,album_name:this.album_name},this.app)},"nest_req-songs-list":[[{is_array:!0,source:"album.tracks.track",props_map:{artist:"artist.name",track:"name",album_image:["lfm_image","^album.image"],album_name:"^album.name"}}],["lfm","get",function(){return["album.getInfo",{artist:this.playlist_artist,album:this.album_name}]}]]});var v=function(){};s.TagsList.extendTo(v,{"compx-preview_loading":[["^tags_list__loading"],function(e){return e}],"compx-preview_list":[["^tags_list"],function(e){return e}],"nest_req-tags_list":[[{is_array:!0,source:"toptags.tag",props_map:{count:null,name:null}}],["lfm","get",function(){return["artist.getTopTags",{artist:this.head.artist_name}]}]]}),p=function(){},s.extendTo(p,{model_name:"albslist",main_list_name:"albums_list","nest_rqc-albums_list":d,items_comparing_props:[["album_artist","album_artist"],["album_name","album_name"],["original_artist","original_artist"]]});var m=function(){};o.extendTo(m,{init:function(e,t){this._super(e,!1),this.playlist_artist=this.album_artist=t.artist,this.album_name=t.title,this.album_id=t.id,this.release_type=t.type;var n=t.thumb&&t.thumb.replace("api.discogs.com","s.pixogs.com").replace("s.pixogs.com/images/","s.pixogs.com/image/");this.updateManyStates({album_artist:this.playlist_artist,album_name:this.album_name,album_year:t.year,image_url:n&&{url:n},nav_title:"("+this.album_artist+") "+this.album_name,url_part:"/"+this.album_id})},"compx-can_hide_artist_name":{depends_on:["album_artist","original_artist"],fn:function(e,t){return e==t}},"compx-selected_image":{depends_on:["lfm_image","profile_image","image_url"],fn:function(e,t,n){return t||e||n}},getAlbumURL:function(){return""},"nest_req-songs-list":[[function(t){var n=this,r=function(e){var t="";if(!e)return t;for(var n=0;n<e.length;n++)t+=e[n].name||"",e[n].join&&(t+=" "+e[n].join+" ");return t},i=e.toRealArray(e.getTargetField(t,"tracklist")),s=[],o=r(t.artists),u=n.state("image_url");u=u&&u.url;for(var a=0;a<i.length;a++){var f=i[a],l={artist:r(f.artists)||o,track:f.title,album_image:u&&{url:u},album_name:n.album_name};s.push(l)}return s}],["discogs","get",function(){var e;return this.release_type=="master"?e="/masters/":e="/releases/",[e+this.album_id,{}]}]]});var g=function(){};p.extendTo(g,{"stch-should_load":function(e,t){t&&e.preloadStart()},"stch-mp_show":function(e,t){t&&e.map_parent.requestState("discogs_id")},"compx-should_load":[["^mp_has_focus","mp_show","artist_id"],function(e,t,n){return n&&(t||e)}],"compx-possible_loader_disallowing":[["possible_loader_disallowing"],function(){return l("no-dgs-id")}],"compx-profile_searching":[["^discogs_id_searching"]],"compx-artist_id":[["^discogs_id"]],"compx-loader_disallowing_desc":{depends_on:["profile_searching","loader_disallowed","possible_loader_disallowing"],fn:function(e,t,n){if(t&&!e)return n}},"compx-loader_disallowed":{depends_on:["artist_id"],fn:function(e){return!e}},page_limit:50,manual_previews:!1,"nest_rqc-albums_list":m,"nest_req-albums_list":[[function(t){return e.toRealArray(e.getTargetField(t,"releases"))},{source:"pagination",props_map:{page_num:["num","page"],items_per_page:["num","per_page"],total_pages_num:["num","pages"],total:["num","items"]}}],["discogs","get",function(){var e=this.state("artist_id");return["/artists/"+e+"/releases",null]}]]});var y=function(){};p.extendTo(y,{page_limit:50,"nest_req-albums_list":[f.lfm.getAlbums("topalbums"),["lfm","get",function(){return["artist.getTopAlbums",{artist:this.head.artist_name}]}]],getSPC:!0,subPager:function(e,t){var n=this.app.getCommaParts(t),r=n[1]?n[0]:this.head.artist_name;return this.findMustBePresentDataItem({original_artist:this.head.artist_name,album_artist:r,album_name:n[1]?n[1]:n[0]})}});var b=function(){};o.HypemPlaylist.extendTo(b,{send_params:{},"nest_req-songs-list":[f.hypem.tracks,["hypem","get",function(e){var t="/playlist/search/"+this.head.artist_name+"/json/"+e.paging.next_page+"/data.js";return[t,this.send_params]}]]});var w=function(){};o.HypemPlaylist.extendTo(w,{send_params:{sortby:"favorite"},"nest_req-songs-list":[f.hypem.tracks,["hypem","get",function(e){var t="/playlist/search/"+this.head.artist_name+"/json/"+e.paging.next_page+"/data.js";return[t,this.send_params]}]]});var E=function(){};o.HypemPlaylist.extendTo(E,{send_params:{sortby:"blogged"},"nest_req-songs-list":[f.hypem.tracks,["hypem","get",function(e){var t="/playlist/search/"+this.head.artist_name+"/json/"+e.paging.next_page+"/data.js";return[t,this.send_params]}]]});var S=function(){};o.extendTo(S,{init:function(){this._super.apply(this,arguments),this.wch(this.map_parent,"sc_profile_searching","profile_searching",!0),this.wch(this.map_parent,"soundcloud_profile","artist_id",!0)},"compx-id_searching":[["profile_searching"],function(e){return e}],"compx-possible_loader_disallowing":[["^no_soundcloud_profile","artist_id","^soundcloud_profile"],function(e,t){if(e)return l("no-soundcloud-profile");if(!t)return l("Sc-profile-not-found")}],"compx-loader_disallowing_desc":{depends_on:["profile_searching","loader_disallowed","possible_loader_disallowing"],fn:function(e,t,n){if(t&&!e)return n}},"compx-loader_disallowed":{depends_on:["artist_id"],fn:function(e){return!e}}});var x=function(){};S.extendTo(x,{"nest_req-songs-list":[[f.soundcloud.tracksFn,!0],["sc_api","get",function(){var e=this.state("artist_id");return["users/"+e+"/favorites",null]}]]});var T=function(){};S.extendTo(T,{"nest_req-songs-list":[[f.soundcloud.tracksFn,!0],["sc_api","get",function(){var e=this.state("artist_id");return["users/"+e+"/tracks",null]}]],allow_artist_guessing:!0});var N=function(){};o.extendTo(N,{init:function(e,t){this._super(e,t),this.playlist_type="artist",this.playlist_artist=this.map_parent.head.artist},"nest_req-songs-list":[f.lfm.getTracks("toptracks"),["lfm","get",function(){return["artist.getTopTracks",{artist:this.head.artist_name}]}]]});var C=function(){};o.extendTo(C,{"nest_req-songs-list":[[function(t){var n=e.toRealArray(e.getTargetField(t,"rss.channel.item")),r=[];if(n)for(var i=0;i<n.length;i++){var s=n[i],o=e.getTargetField(s,"enclosure.url");if(o)continue;var u=a.guessArtist(s.title,s["itunes:author"]);!u.track,!u.artist,r.push(u)}return r}],["lfm","get",function(){return["artist.getPodcast",{artist:this.playlist_artist}]}]]});var k=function(){};i.Model.extendTo(k,{model_name:"artcard",getURL:function(){return"/catalog/"+this.app.encodeURLPart(this.head.artist_name)},complex_states:{nav_title:[["artist_name"]],url_part:[["artist_name"],function(e){return e&&"/catalog/"+this.app.encodeURLPart(e)}],selected_image:{depends_on:["lfm_image","lfm_img","profile_image"],fn:function(e,t,n){return n||t||e}}},"compx-available_images":[["selected_image","images"],function(e,t){return t||e&&[e]}],sub_pa:{_:{constr:N,title:l("Top-tracks")},"+similar":{constr:c,getTitle:function(){return l("Similar to «%artist%» artists").replace("%artist%",this.head.artist_name)}},tags:{constr:v,title:l("Tags")},albums:{constr:g,title:l("Albums from Discogs")},albums_lfm:{constr:y,getTitle:function(){return l("Albums of %artist% from last.fm").replace("%artist%",this.head.artist_name)}},soundcloud:{constr:T,title:l("Art-sc-songs")},soundcloud_likes:{constr:x,title:l("Art-sc-likes")},fresh:{constr:b,title:l("Fresh songs")},most_favorites:{constr:w,title:l("Most Favorites")},blogged:{constr:E,title:l("Most Reblogged")}},"nest-tags_list":["tags",!1,"init_ext"],"nest-similar_artists":["+similar",!1,"init_ext"],"nest-top_songs":["_",!0,"init_heavy"],"nest-dgs_albums":["albums",!0,"init_heavy"],"nest-albums_list":["albums_lfm",!0,"init_heavy"],"nest-soundc_prof":["soundcloud",!0,"init_heavy"],"nest-soundc_likes":["soundcloud_likes",!0,"init_heavy"],"nest-hypem_new":["fresh",!0,"init_heavy"],"nest-hypem_fav":["most_favorites",!0,"init_heavy"],"nest-hypem_reblog":["blogged",!0,"init_heavy"],initHeavy:t.getOCF("heavy_oi",function(){this.albums_models={},t.update(this,"init_heavy",!0)}),getTagsModel:function(){return this.getSPI("tags",!0)},showTopTacks:function(e){var t;e&&(t={artist:this.head.artist_name,track:e});var n=this.getTopTracks();n.showOnMap();if(t){var r=n.findMustBePresentDataItem(t);r.showOnMap(),n.preloadStart()}return n},showSimilarArtists:function(e){var t=this.getSimilarArtists();return t.showOnMap(),t},showAlbum:function(e){e.album_artist||(e.album_artist=this.head.artist_name);var t=this.getSPI("albums_lfm",!0).getSPI(e.album_artist+","+e.album_name,!0);return t.showOnMap(),t},preloadChildren:function(e){var t=e&&e.length&&e||[this.top_songs,this.hypem_new,this.hypem_fav,this.hypem_reblog,this.albums,this.soundc_prof,this.soundc_likes,this.dgs_albums];for(var n=0;n<t.length;n++)t[n].preloadStart()},loadInfo:function(){if(this.info_loaded)return;this.info_loaded=!0;var n=this;t.update(this,"sc_profile_searching",!0),r.chain([function(){var r=this;n.addRequest(n.app.goog_sc.get("soundcloud "+n.head.artist_name).done(function(t){var i,s=e.toRealArray(e.getTargetField(t,"responseData.results"));for(var o=0;o<s.length;o++){var u=s[o].url,a=document.createElement("a");a.href=u;var f=a.pathname.replace(/^\//,"").split("/");if(f.length==1){i=f[0];break}break}i?r.done(i):n.updateManyStates({no_soundcloud_profile:!0,sc_profile_searching:!1})}).fail(function(){t.update(n,"sc_profile_searching",!1)}))},function(e){n.addRequest(n.app.sc_api.get("resolve",{"_status_code_map[302]":200,_status_format:"json",url:"http://soundcloud.com/"+e}).done(function(e){if(e.location){var r=e.location.match(/users\/(\d+)/),i=r[1];i?(t.update(n,"sc_profile_searching",!1),t.update(n,"soundcloud_profile",i),n.preloadNestings(["soundc_prof","soundc_likes"])):t.update(n,"no_soundcloud_profile",!0)}}).always(function(){t.update(n,"sc_profile_searching",!1)}))}]),this.requestState("bio"),this.requestState("discogs_id")},req_map:[[["images"],function(t){var n=e.toRealArray(e.getTargetField(t,"images.image"));return[n]},["lfm","get",function(){return["artist.getImages",{artist:this.head.artist_name}]}]],[["profile_image","bio","listeners","playcount","similar_artists_list","tags_list"],function(t){var r=n.parseArtistInfo(t),i=this.app.art_images.getImageWrap(e.getTargetField(t,"artist.image")),s;if(r.similars){var o=[];for(var u=0;u<r.similars.length;u++){var a=r.similars[u];o.push({artist_name:a.name,lfm_image:this.app.art_images.getImageWrap(a.image)})}s=o}return[i,r.bio,e.getTargetField(t,"artist.stats.listeners"),e.getTargetField(t,"artist.stats.playcount"),s,r.tags]},["lfm","get",function(){return["artist.getInfo",{artist:this.head.artist_name}]}]],[["discogs_id"],function(e){var t=this.head.artist_name,n=function(e){return e.replace(/\([\s\S]*?\)/,"").split(/\s|,/).sort().join("").toLowerCase()},r=e&&e.results,i,s=n(t);for(var o=0;o<r.length;o++){var u=r[o];if(s==n(u.title)&&u.thumb&&u.thumb.indexOf("images/record90")==-1){i={artist_name:u.title,image_url:u.thumb,id:u.id};break}}return{discogs_id:i&&i.id}},["discogs","get",function(){return["/database/search",{q:this.head.artist_name,type:"artist"}]}]]],getTopTracks:function(){if(this.top_songs)return this.top_songs;var e=this.getSPI("_",!0);return this.top_songs=e,t.updateNesting(this,"top_songs",e),e},getAlbum:function(t){var n=e.stringifyParams({artist:t.album_artist,name:t.album_name},!1,"=","&");if(this.albums_models[n])return this.albums_models[n];var r=this.initSi(d,{album_artist:t.album_artist,album_name:t.album_name,original_artist:this.head.artist_name});return this.albums_models[n]=r,r},getSimilarArtists:function(){return this.getSPI("+similar",!0)}}),h=function(){},k.extendTo(h,{init:function(e,n){this._super.apply(this,arguments),t.update(this,"init_ext",!0),this.wch(this,"mp_has_focus",function(e){e.value&&(this.initHeavy(),this.loadInfo())},!0)}});var L=function(){};k.extendTo(L,{net_head:["artist_name"],skip_map_init:!0,showArtcard:function(){this.app.showArtcardPage(this.head.artist_name)}});var A=function(){};o.extendTo(A,{page_limit:null,items_comparing_props:[["artist_name","artist_name"]],"compx-has_data_loader":[["^has_data_loader"],function(e){return e}],requestMoreData:function(){var e=this.map_parent["nest_req-"+this.map_parent.main_list_name];e?this.requestNesting(e,this.main_list_name):this._super()},getRqData:function(){return this.map_parent.getRqData.apply(this.map_parent,arguments)}});var O=function(){};return s.extendTo(O,{model_name:"artslist",main_list_name:"artists_list",createRPlist:function(){if(!this.ran_playlist){var e=this.getSPI("~",!0);this.ran_playlist=e}return this.ran_playlist},sub_pa:{"~":{constr:A,getTitle:function(){return this.state("nav_title")}}},requestRandomPlaylist:function(e){var n=t.getModelById(e);n.followTo(this.createRPlist()._provoda_id)},"nest_rqc-artists_list":L,makeDataItem:function(e){return this.initSi(L,e)}}),O.extendTo(c,{page_limit:100,init:function(e,t){this._super.apply(this,arguments),this.wch(this,"preview_list",function(e){e.value&&this.setPreviewList(e.value)})},"compx-preview_loading":[["^similar_artists_list__loading"],function(e){return e}],"compx-preview_list":[["^similar_artists_list"],function(e){return e}],getRqData:function(e){return{artist:this.head.artist_name,limit:e.page_limit}},"nest_req-artists_list":[f.lfm.getArtists("similarartists",!0),["lfm","get",function(e){return["artist.getSimilar",this.getRqData(e.paging)]}]],setPreviewList:function(e){var n=this.getNesting(this.preview_mlist_name);if(!n||!n.length){n=[];for(var r=0;r<e.length;r++)n.push(this.initSi(L,{network_states:e[r]}));t.updateNesting(this,this.preview_mlist_name,n)}}}),h.AlbumsList=p,h.ArtistsList=O,h}),define("js/models/user_music_lfm",["app_serv","js/libs/BrowseMap","./LoadableList","spv","./SongsList","./ArtCard","js/LfmAuth","js/modules/declr_parsers","jquery","pv"],function(e,t,n,r,i,s,o,u,a,f){var l=s.ArtistsList,c=s.AlbumsList,h=e.localize,p=f.update,d=r.cloneObj,v=function(){};o.LfmLogin.extendTo(v,{beforeRequest:function(){var e=this.getNesting("auth");p(e,"requested_by",this._provoda_id)},"compx-active":[["has_session","@one:requested_by:auth"],function(e,t){return e&&t==this._provoda_id}]});var m={depends_on:["userid"],fn:function(e){return!e}},g={"compx-has_no_access":m,pmd_switch_is_parent:!0,"nest-auth_part":[v,!0,"for_current_user"],"compx-userid":[["lfm_userid","#lfm_userid","for_current_user"],function(e,t,n){return(n?t:e)||null}],"compx-has_lfm_auth":[["for_current_user","@one:has_session:auth_part"],function(e,t){return e&&t}],"compx-parent_focus":[["^mp_has_focus"]],"stch-has_lfm_auth":function(e,t){t&&e.switchPmd(!1)},"stch-parent_focus":function(e,t){t||e.switchPmd(!1)},"stch-lfm_userid":function(e,t){t&&e.updateNesting("auth_part",null)},"compx-acess_ready":[["has_no_access","@one:active:auth_part"],function(e,t){return!e&&t}],"stch-acess_ready":function(e,t){t&&(e.loadStart(),e.showOnMap())}},y=function(){};i.extendTo(y,d({"nest_req-songs-list":[u.lfm.getTracks("tracks"),["lfm","get",function(){return["library.getTracks",{user:this.state("userid"),artist:this.head.artist_name}]}]]},g));var b=function(e){return"/"+e},w=function(){};t.Model.extendTo(w,d({model_name:"lula",netdata_as_states:{url_part:[b,"artist"],nav_title:"artist",artist_name:"artist",playcount:null,lfm_image:"lfm_img"},net_head:["artist_name"],"nest-all_time":["all_time",!0],"compx-selected_image":{depends_on:["lfm_image"],fn:function(e){return e}},sub_pa:{all_time:{constr:y,title:"All Time"}}},g));var E=function(){};n.extendTo(E,{model_name:"lulas",main_list_name:"artists","nest_rqc-artists":w,"compx-has_no_access":m});var S=function(){};E.extendTo(S,d({"nest_rqc-artists":w,"nest_req-artists":[u.lfm.getArtists("topartists"),["lfm","get",function(){return["user.getTopArtists",{user:this.state("userid"),period:this.head.timeword}]}]],head_by_urlname:{timeword:"name_spaced"}},g));var x=function(){};i.extendTo(x,d({"nest_req-songs-list":[u.lfm.getTracks("toptracks"),["lfm","get",function(){return["user.getTopTracks",{user:this.state("userid"),period:this.head.timeword}]}]],head_by_urlname:{timeword:"name_spaced"}},g));var T=function(){};i.extendTo(T,d({access_desc:h("grant-love-lfm-access"),"nest_req-songs-list":[u.lfm.getTracks("lovedtracks"),["lfm","get",function(){return["user.getLovedTracks",{user:this.state("userid")}]}]]},g));var N=function(){};l.extendTo(N,d({page_limit:30,access_desc:h("lastfm-reccoms-access"),"compx-loader_disallowed":[["loader_disallowed"],function(){return!e.app_env.cross_domain_allowed}],"nest_req-artists_list":[[function(e){var t=[],n=a(e).find("channel item title");if(n&&n.length)for(var r=0,i=n.length<30?n.length:30;r<i;r++){var s=a(n[r]).text();t.push({artist:s})}return t}],[function(){return{api_name:"last_fm_xml",source_name:"last.fm",get:function(e){return a.ajax({url:"http://ws.audioscrobbler.com/1.0/"+e,type:"GET",dataType:"xml"})},errors_fields:[]}},"get",function(){return["user/"+this.state("userid")+"/systemrecs.rss"]}]]},g));var C=function(){};N.extendTo(C,{"compx-loader_disallowed":null,"nest_req-artists_list":[u.lfm.getArtists("recommendations"),["lfm","get",function(){return["user.getRecommendedArtists",{sk:this.app.lfm.sk}]}]]});var k=["recommended","top:7day","top:3month","top:6month","top:12month","top:overall"],L=function(){};t.Model.extendTo(L,{model_name:"lfm_listened_artists","nest-lists_list":[k],"nest-preview_list":[k,!0],sub_pa:{recommended:{constr:N,getTitle:function(){return h("reccoms-for")+" "+this.head.userid}},"top:7day":{constr:S,title:"top of 7day"},"top:3month":{constr:S,title:"top of 3 months"},"top:6month":{constr:S,title:"top of 6 months"},"top:12month":{constr:S,title:"top of 12 months"},"top:overall":{constr:S,title:" overall top"}}}),L.LfmUserArtistsForCU=function(){},L.extendTo(L.LfmUserArtistsForCU,{"sub_pa-recommended":{constr:C,title:h("reccoms-for-you")}});var A=function(){};i.extendTo(A,d({getRqData:function(){return this.slice_time_end||(this.slice_time_end=(new Date/1e3).toFixed()),{user:this.state("userid"),extended:1,to:this.slice_time_end,nowplaying:!0}},"nest_req-songs-list":[u.lfm.getTracks("recenttracks"),["lfm","get",function(){return["user.getRecentTracks",this.getRqData()]}]]},g));var O=["loved","recent","top:7day","top:3month","top:6month","top:12month","top:overall"],M=function(){};t.Model.extendTo(M,{model_name:"lfm_listened_tracks","nest-lists_list":[O],"nest-preview_list":[O,!0],sub_pa:{loved:{constr:T,getTitle:function(){return h("loved-tracks")}},recent:{constr:A,title:"Recently listened"},"top:7day":{constr:x,title:"top of 7day"},"top:3month":{constr:x,title:"top of 3 months"},"top:6month":{constr:x,title:"top of 6 months"},"top:12month":{constr:x,title:"top of 12 months"},"top:overall":{constr:x,title:"overall top"}}});var _=function(){};c.extendTo(_,d({access_desc:h("lastfm-reccoms-access"),page_limit:50,"nest_req-albums_list":[u.lfm.getAlbums("albums"),["lfm","get",function(){return["user.getNewReleases",{user:this.state("userid"),userecs:this.recomms?1:0}]}]]},g));var D=function(){};_.extendTo(D,{});var P=function(){};_.extendTo(P,{recomms:!0});var H=function(){};c.extendTo(H,d({head_by_urlname:{timeword:"name_spaced"},"nest_req-albums_list":[u.lfm.getAlbums("topalbums"),["lfm","get",function(){return["user.getTopAlbums",{user:this.state("userid"),period:this.head.timeword}]}]]},g));var B=["recommended","new_releases","top:7day","top:3month","top:6month","top:12month","top:overall"],j=function(){};t.Model.extendTo(j,{model_name:"lfm_listened_albums","nest-lists_list":[B],"nest-preview_list":[B,!0],sub_pa:{recommended:{constr:P,getTitle:function(){var e="new releases of artists recommended for ";return e+(this.head.for_current_user?"you":this.head.lfm_userid)}},new_releases:{constr:D,getTitle:function(){var e="new releases of artists from %user% library";return e.replace("%user%",this.head.for_current_user?"your":this.head.lfm_userid)}},"top:7day":{constr:H,title:"Top of 7 days"},"top:3month":{constr:H,title:"Top of 3 months"},"top:6month":{constr:H,title:"Top of 6 months"},"top:12month":{constr:H,title:"Top of 12 months"},"top:overall":{constr:H,title:"Overall top"}}});var F=function(){};i.extendTo(F,d({"nest_req-songs-list":[u.lfm.getTracks("taggings.tracks",!1,"taggings"),["lfm","get",function(){return["user.getPersonalTags",{user:this.state("userid"),taggingtype:"track",tag:this.head.tag_name}]}]]},g));var I=function(){};l.extendTo(I,d({"nest_req-artists_list":[u.lfm.getArtists("taggings.artists",!1,"taggings"),["lfm","get",function(){return["user.getPersonalTags",{user:this.state("userid"),taggingtype:"artist",tag:this.head.tag_name}]}]]},g));var q=function(){};c.extendTo(q,d({page_limit:50,"nest_req-albums_list":[u.lfm.getAlbums("taggings.albums",!1,"taggings"),["lfm","get",function(){return["user.getPersonalTags",{user:this.state("userid"),taggingtype:"album",tag:this.head.tag_name}]}]]},g));var R=["artists","tracks","albums"],U=function(){};t.Model.extendTo(U,{model_name:"lfm_user_tag",net_head:["tag_name"],"nest-lists_list":[R],"nest-preview_list":[R,!0],sub_pa:{tracks:{constr:F,title:"Tracks"},artists:{constr:I,title:"Artists"},albums:{constr:q,title:"Albums"}}});var z=function(){};n.extendTo(z,d({model_name:"lfm_listened_tags",main_list_name:"tags",page_limit:3e3,"nest_req-tags":[[{is_array:!0,source:"toptags.tag",props_map:{nav_title:"name",url_part:"name",tag_name:"name",count:null}}],["lfm","get",function(){return["user.getTopTags",{user:this.state("userid")}]}]],"nest_rqc-tags":U,tagsParser:function(e,t){var n=[],i=r.toRealArray(r.getTargetField(e,t));for(var s=0;s<i.length;s++)n.push({tag_name:i[s].name,count:i[s].count});return n}},g));var W=function(){};t.Model.extendTo(W,{init:function(e,t){this._super.apply(this,arguments);var n,i,s=r.getTargetField(t,"recenttrack.artist.name");s&&(n=s+" - "+r.getTargetField(t,"recenttrack.name"),i=r.getTargetField(t,"recenttrack.@attr.uts"),i&&(i=new Date(i*1e3)));var o=t.lfm_img||t.lfm_image&&this.app.art_images.getImageRewrap(t.lfm_image);this.initStates({selected_image:o,nav_title:t.userid,userid:t.userid,registered:t.registered,realname:t.realname,age:t.age,gender:t.gender,country:t.country,lfm_img:o,song:n,song_time:i&&i.toLocaleString(),song_time_raw:i,scrobbler:t.scrobblesource}),this.rawdata=t},"compx-big_desc":[["realname","age","gender","country"],function(e,t,n,r){var i=[],s=[e,t,n,r];for(var o=0;o<s.length;o++)s[o]&&i.push(s[o]);return i.join(", ")}],getRelativeModel:function(){var e=this.app.getLastfmUser(this.state("userid"));return e.setProfileData(this.rawdata),e},showOnMap:function(){var e=this.getRelativeModel();e.showOnMap()}});var X=function(){};n.extendTo(X,{"nest_rqc-list_items":W,main_list_name:"list_items",model_name:"lfm_users",page_limit:200});var V=function(){};X.extendTo(V,d({},g));var $=function(){};V.extendTo($,{beforeReportChange:function(e){return e.sort(function(e,t){return r.sortByRules(e,t,[{field:function(e){switch(e.states.gender){case"f":return 1;case"m":return 2;default:return 3}}},{field:"states.song_time_raw",reverse:!0}])}),e},"nest_req-list_items":[u.lfm.getUsers("friends"),["lfm","get",function(){return["user.getFriends",{recenttracks:!0,user:this.state("userid")}]}]]});var J=function(){};return V.extendTo(J,{getRqData:function(){return{user:this.state("userid")}},"nest_req-list_items":[u.lfm.getUsers("neighbours"),["lfm","get",function(){return["user.getNeighbours",this.getRqData()]}]]}),{LfmUserArtists:L,LfmUserTracks:M,LfmUserTags:z,LfmUserAlbums:j,LfmUsersList:X,LfmFriendsList:$,LfmNeighboursList:J}}),define("js/models/Cloudcasts",["pv","spv","app_serv","js/libs/BrowseMap","./SongsList","./LoadableList"],function(e,t,n,r,i,s){var o=n.localize,u=/[\u0000-\u0080]+/g,a=/[^a-zA-Z0-9_-]/g,f=function(e){return e.replace(a,"")},l=function(e){return e&&e.toLowerCase().replace(/\s/g,"-").replace(u,f).replace(/-+/g,"-")},c=function(){};i.extendTo(c,{init:function(e,t){this._super.apply(this,arguments),this.initStates(t),this.wch(this,"mp_show",function(e){e.value&&this.requestState("nav_title")})},req_map:[[["nav_title"],{props_map:{nav_title:"name"}},["mixcloud","get",function(){return[this.state("key")]}]]],"nest_req-songs-list":[[{is_array:!0,source:"sections",props_map:{artist:"track.artist.name",track:"track.name"}}],["mixcloud","get",function(){return[this.state("key")]}]],addRawData:function(t){e.update(this,"nav_title",t.nav_title)}});var h=function(){};s.extendTo(h,{"compx-artist_key":[["artist_name"],l],"compx-track_key":[["track_name"],l],model_name:"cloudcasts_list",makeDataItem:function(e){var t=this.app.start_page.getSPI("cloudcasts/"+this.app.encodeURLPart(e.key),!0);return t.addRawData(e),t},"nest_req-lists_list":[[{is_array:!0,source:"data",props_map:{nav_title:"name",key:"key"}},!0],["mixcloud","get",function(){return[["track",this.state("artist_key"),this.state("track_key"),this.tcl_type].join("/")+"/",null]}]]});var p=function(){};h.extendTo(p,{tcl_type:"new"});var d=function(){};h.extendTo(d,{tcl_type:"popular"});var v=function(){};h.extendTo(v,{tcl_type:"hot"});var m=["new","hot","popular"],g=function(){};return r.Model.extendTo(g,{"nest-lists_list":[m,!0],model_name:"songcard_cloudcasts",sub_pa:{"new":{constr:p,title:"New"},hot:{constr:v,title:"Hot"},popular:{constr:d,title:"Popular"}}}),c.SongcardCloudcasts=g,c}),define("js/models/SeesuListening",["pv","./comd","app_serv"],function(e,t,n){var r=n.localize,i=e.update,s=e.behavior({access_desc:r("to-meet-man-vk-short"),beforeRequest:function(){var e=this.getNesting("auth");i(e,"requested_by",this._provoda_id)},"compx-active":[["has_session","@one:requested_by:auth"],function(e,t){return e&&t==this._provoda_id}]},t.VkLoginB,function(){});return e.behavior({"nest-user":["#users/su:[:user]"],"compx-is_current_user":[["#su_userid","user"],function(e,t){return e==t}],pmd_switch_is_parent:!0,"compx-rel":[["#relations_likes","#relations_invites","user"],function(e,t,n){if(!n)return;var r=e&&e[n]&&e[n][0],i=t&&t[n]&&t[n][0];return r||i}],"compx-remain_time_desc":[["rel","just_accepted_est"],function(e,t){var r=t||e&&e.item.est;if(!r)return;return n.getRemainTimeText(r,!0)}],"nest-auth_part":[s,!0,"pmd_vswitched"],"compx-current_user":[["#vk_userid"]],"compx-has_vk_auth":[["@one:has_session:auth_part"]],"compx-current_user_has_photo":[["current_su_user_info"],function(e){return e&&e.photo_big}],"compx-current_su_user_info":[["#current_su_user_info"]],setLike:function(){var e=this;i(e,"sending_like",!0),this.api("relations.setLike",{to:this.state("user")}).done(function(t){if(!t.done)return;i(e,"like_just_sended",!0)}).always(function(){i(e,"sending_like",!1)})},acceptInvite:function(){var e=this;i(e,"sending_accept",!0),this.api("relations.acceptInvite",{from:this.state("user")}).done(function(t){if(!t.done)return;i(e,"invite_accepted",!0),i(e,"just_accepted_est",t.done.est)}).always(function(){i(e,"sending_accept",!1)})}},e.HModel,function(){})}),define("js/models/SongCard",["pv","spv","app_serv","js/libs/BrowseMap","js/libs/morph_helpers","./user_music_lfm","./Cloudcasts","./LoadableListBase","./SongsList","./SeesuListening","js/modules/declr_parsers"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.localize,h=n.complexEach,p=e.update,d=t.getSortFunc([{field:function(e){var t=e.state("lfm_img");return t=t&&(t.lfm_id||t.url),t&&t.search(/gif$/)==-1?1:t?3:2}}]),v=function(){};s.LfmUsersList.extendTo(v,{getRqData:function(){return{artist:this.state("artist_name"),track:this.state("track_name")}},"nest_req-list_items":[l.lfm.getUsers("topfans",!0),["lfm","get",function(){return["track.getTopFans",this.getRqData()]}]],beforeReportChange:function(e){return e.sort(d),e}});var m=t.mmap({props_map:{artist:"artist",track:"title",side_file:{artist:"artist",track:"title",from:["vk"],media_type:["mp3"],duration:["seconds","duration"],link:"url"}}},i),g=function(){};a.extendTo(g,{init:function(e,t){this._super.apply(this,arguments),this.initStates(t),this.app.watchVKCharacter(this,t.post_type=="reply"?t.from_id:t.owner_id,"owner_info"),t.owner_id!=t.from_id&&this.app.watchVKCharacter(this,t.from_id,"author_info")},"compx-date_desc":[["date"],function(e){return e&&(new Date(e)).toLocaleString()}]});var y=t.getSortFunc([{field:function(e){return e.owner_id>0},reverse:!0},{field:"date"}]),b=function(){};u.extendTo(b,{init:function(t,n){this._super.apply(this,arguments),this.initStates(n),this.on("child_change-lists_list",function(t){var n=t.value&&t.value.slice().sort(y);e.updateNesting(this,"sorted_list",n)})},"compx-image_previews":[["@owner_info:sorted_list"],function(e){if(!e)return;var n=[];for(var r=0;r<e.length;r++){var i=e[r];if(!i)continue;n.push(i.photo_medium_rec||i.photo_50)}return t.collapseAll(n)}],model_name:"vk_posts","nest_rqc-lists_list":g,"nest_rq_split-lists_list":function(e,n){return[e.props,{subitems:{"songs-list":t.getTargetField(e,"attachments.songs")},subitems_source_name:{"songs-list":n}}]},"nest_req-lists_list":[[{is_array:!0,source:"response.items",props_map:{props:{nav_title:"owner_id",url_part:["urlp","owner_id"],from_id:"from_id",owner_id:"owner_id",date:["timestamp","date"],post_type:"post_type",text_body:"text",likes:"likes.count",reposts:"reposts.count",photos:[function(e){if(!e)return;var t=[];for(var n=0;n<e.length;n++){var r=e[n];r.type=="photo"&&t.push(r.photo)}return t},"attachments"]},attachments:[function(e){if(!e)return;var t=[];for(var n=0;n<e.length;n++){var r=e[n];r.type=="audio"&&t.push(m(r.audio))}return{songs:t}},"attachments"]}},!0,[["vk_users",function(e){return e.response.profiles}],["vk_groups",function(e){return e.response.groups}]]],["vktapi","get",function(){return["newsfeed.search",{q:this.head.artist_name+" "+this.head.track_name+" has:audio",extended:1},null]}]]});var w=e.utils.isDepend,E=function(){};return u.extendTo(E,{model_name:"songcard","compx-nav_title":{depends_on:["artist_name","track_name"],fn:function(e,t){return e+" - "+t}},"compx-nest_need":[["need_for_song","songcard-for-active_song"],function(e,t){return e||w(t)}],"compx-wide_need":[["nest_need","mp_has_focus"],function(e,t){return t||e}],"compx-load_listeners":[["wide_need","artist_name","track_name"],function(e,t,n){return e&&t&&n&&{artist_name:t,track_name:n}}],"stch-load_listeners":function(e,t){t&&e.requestMoreData("listenings")},"compx-vswitched_select":[["vswitched"]],"stch-vswitched_select":function(t,n){e.updateNesting(t,"selected",n&&e.getModelById(n))},"compx-current_su_user_info":[["#current_su_user_info"]],"nest_rqc-listenings":f,"nest_req-listenings":[[function(e){if(!e||!e.done)return;var t=e.done;return h([t[1],t[2]],function(e,t,n){return t&&e.push(t),n&&e.push(n),e})},!1,[["su_users",function(e){var t=e.done&&e.done[1],n=e.done&&e.done[2],r=[];t&&(r=r.concat(t)),n&&(r=r.concat(n));for(var i=0;i<r.length;i++){var s=r[i].info;s.user=r[i].user,r[i]=s}return r}]]],["s","api",function(){return["track.getListeners",{artist:this.head.artist_name,title:this.head.track_name}]}]],"nest-fans":["fans","wide_need","wide_need"],"nest-cloudcasts":["cloudcasts",!1,"wide_need"],"nest-vk_posts":["vk_posts","nest_need","nest_need"],"nest-artist":["#catalog/[:artist_name]",!1,"mp_has_focus"],sub_pa:{fans:{constr:v,title:c("Top fans")},cloudcasts:{constr:o.SongcardCloudcasts,title:"Cloudcasts"},vk_posts:{constr:b,title:"Posts from vk.com"}}}),E}),define("js/models/TagPage",["spv","app_serv","js/libs/BrowseMap","./ArtCard","./LoadableList","./SongsList","js/modules/declr_parsers","js/lastfm_data"],function(e,t,n,r,i,s,o,u){function p(e){var t=/\s|-/gi,n=e.match(t);return n&&n.length>=2?e.replace(t," "):e}var a=t.localize,f=r.AlbumsList,l=r.ArtistsList,c=function(){};i.TagsList.extendTo(c,{"nest_req-tags_list":[[{is_array:!0,source:"similartags.tag",props_map:{count:null,name:null}}],["lfm","get",function(){return["tag.getSimilar",{tag:this.head.tag_name}]}]]});var h=function(){};f.extendTo(h,{page_limit:50,"nest_req-albums_list":[o.lfm.getAlbums("topalbums"),["lfm","get",function(){return["tag.getTopAlbums",{tag:this.head.tag_name}]}]]});var d=function(){};s.HypemPlaylist.extendTo(d,{"nest_req-songs-list":[o.hypem.tracks,["hypem","get",function(e){var t="/playlist/tags/"+p(this.head.tag_name)+"/json/"+e.paging.next_page+"/data.js";return[t,this.send_params]}]]});var v=function(){};d.extendTo(v,{send_params:{fav_from:25,fav_to:250}});var m=function(){};d.extendTo(m,{send_params:{fav_from:250,fav_to:1e5}});var g=function(){};d.extendTo(g,{});var y=function(){};s.extendTo(y,{"nest_req-songs-list":[[{is_array:!0,source:"playlist.trackList.track",props_map:{artist:"creator",track:"title",lfm_img:["lfm_image","image"]}},!1,[["files",{is_array:!0,source:"playlist.trackList.track",props_map:{artist:"creator",track:"title",link:"location"}}]]],["lfm","get",function(){return["playlist.fetch",{playlistURL:"lastfm://playlist/tag/"+this.head.tag_name+"/freetracks"}]}]]});var b=function(){};s.extendTo(b,{"nest_req-songs-list":[o.lfm.getTracks("toptracks"),["lfm","get",function(){return["tag.getTopTracks",{tag:this.head.tag_name}]}]]});var w=function(){};n.Model.extendTo(w,{"nest-lists_list":[["_","free","blogged","blogged?fav_from=25&fav_to=250","blogged?fav_from=250&fav_to=100000"],!0],model_name:"tag_songs",sub_pa:{_:{constr:b,title:a("Top")},free:{constr:y,title:a("Free-songs")},blogged:{constr:g,title:a("Blogged-all-hypem")},"blogged?fav_from=25&fav_to=250":{constr:v,title:a("Blogged-25-hypem")},"blogged?fav_from=250&fav_to=100000":{constr:m,title:a("Blogged-250-hypem")}}});var E=function(){};l.extendTo(E,{page_limit:130,getRqData:function(e){return{tag:this.head.tag_name,limit:e.page_limit}},"nest_req-artists_list":[o.lfm.getArtists("weeklyartistchart",!0),["lfm","get",function(e){return["tag.getWeeklyArtistChart",this.getRqData(e.paging)]}]]});var S=function(){};l.extendTo(S,{page_limit:130,getRqData:function(e){return{tag:this.head.tag_name,limit:e.page_limit}},"nest_req-artists_list":[o.lfm.getArtists("topartists",!0),["lfm","get",function(e){return["tag.getTopArtists",this.getRqData(e.paging)]}]]});var x=function(){};n.Model.extendTo(x,{"nest-lists_list":[["_","week"],!0],model_name:"tag_artists",sub_pa:{_:{constr:S,title:a("Top")},week:{constr:E,title:a("Week-chart")}}});var T=function(){};n.Model.extendTo(T,{"nest-artists_lists":["artists"],"nest-songs_list":["songs"],"nest-albums_list":["albums"],"nest-similar_tags":["similar"],"nest-pwis":[["albums","similar"],!0],model_name:"tag_page",sub_pa:{similar:{constr:c,getTitle:function(){return a("Similar-to")+" "+this.head.tag_name+" "+a("Tags").toLowerCase()}},artists:{constr:x,title:a("Artists")},songs:{constr:w,title:a("Songs")},albums:{constr:h,getTitle:function(){return a("Top")+" "+this.head.tag_name+" "+a("Albums")}}}});var N=function(){};return i.TagsList.extendTo(N,{init:function(){this._super.apply(this,arguments),u.toptags&&this.setPreview(u.toptags.map(function(e){return{name:e}}))},"nest_req-tags_list":[[{is_array:!0,source:"toptags.tag",props_map:{count:null,name:null}}],["lfm","get",function(e){return["tag.getTopTags",{limit:e.paging.page_limit}]}]],getSPC:function(){return T},subPager:function(e){var t=e;if(!this.sub_pages[t]){var n=this.getSPC(),r=new n;return this.sub_pages[t]=r,[r,{states:{nav_title:a("Tag")+" "+t,url_part:"/"+t},head:{tag_name:t}}]}return this.sub_pages[t]},page_limit:150}),N}),define("js/models/UserAcquaintancesLists",["pv","app_serv","spv","js/libs/BrowseMap"],function(e,t,n,r){var i=t.localize,s=function(){};e.Model.extendTo(s,{init:function(t,n){this._super.apply(this,arguments),this.sender=n.sender,this.user_photo=n.user_photo,this.receiver=n.sender,this.remainded_date=n.remainded_date,e.update(this,"remainded_date",n.remainded_date),this.accepted=n.accepted,e.update(this,"user_info",n.info),e.update(this,"user_photo",n.user_photo),this.current_user_is_sender=n.current_user_is_sender,e.update(this,"current_user_is_sender",n.current_user_is_sender),e.update(this,"accepted",n.accepted)},complex_states:{userlink:{depends_on:["accepted","user_info"],fn:function(e,t){if(e&&t&&t.full_name&&(t.domain||t.uid))return{href:"#/users/vk:"+t.uid,text:t.full_name}}},after_accept_desc:{depends_on:["accepted","remainded_date","userlink"],fn:function(e,n,r){if(e&&!r)return t.getRemainTimeText(n,!0)}},needs_accept_b:{depends_on:["accepted","current_user_is_sender"],fn:function(e,t){if(!e&&!t)return!0}}},acceptInvite:function(){var t=this,n=this.app;n.s.api("relations.acceptInvite",{from:this.sender},function(r){r.done&&(e.update(t,"remainded_date",r.done.est),e.update(t,"accepted",!0),n.trackEvent("people likes","accepted",!1,5),new Date(r.done.est)<new Date&&n.s.susd.ri.getData())})}});var o=function(){};return r.Model.extendTo(o,{model_name:"user_acqs_list",init:function(){this._super.apply(this,arguments);var e=this;this.wch(this.app,"su_userid","current_user");var t=this.app;t.on("state_change-su_server_api",function(t){t.value&&e.bindDataSteams()}),this.initStates()},"compx-wait_me_desc":{depends_on:["@every:accepted:acqs_from_someone"],fn:function(e){if(!e)return i("if-you-accept-one-i")+" "+i("will-get-link")}},"compx-wait_someone_desc":{depends_on:["@every:accepted:acqs_from_me"],fn:function(e){if(!e)return i("if-one-accept-i")+" "+i("will-get-link")}},bindDataSteams:function(){if(this.data_st_binded)return;this.data_st_binded=!0;var e=this;this.app.s.susd.rl.regCallback("user_acqes",function(t){e.replaceChildrenArray("acqs_from_me",t.done)}),this.app.s.susd.ri.regCallback("user_acqes",function(t){e.replaceChildrenArray("acqs_from_someone",t.done)})},replaceChildrenArray:function(t,r){if(!this.state("current_user"))throw new Error("there is no current_user!");var i=n.filter(r,"item.accepted",function(e){return!!e}),o=[].concat(i,i.not);for(var u=0;u<o.length;u++){var a=o[u],f=new s;f.init({app:this.app},{current_user_is_sender:this.state("current_user")==a.item.from,sender:a.item.from,receiver:a.item.to,sended_date:a.item.ts,accepted_date:a.item.ats,remainded_date:a.item.est,accepted:a.item.accepted,info:a.info,user_photo:a.info&&a.info.photo}),o[u]=f}this.removeChildren(t),e.updateNesting(this,t,o)},removeChildren:function(e){var t=this.getNesting(e)||[];for(var n=0;n<t.length;n++)t[n].die()}}),o}),define("js/models/UserPlaylists",["js/libs/BrowseMap","spv","./SongsList","pv"],function(e,t,n,r){var i=function(){};n.extendTo(i,{});var s=function(){};return e.Model.extendTo(s,{model_name:"user_playlists",init:function(e){this._super.apply(this,arguments),this.playlists=[],r.updateNesting(this,"lists_list",this.playlists)},getSPC:function(){return i},subPager:function(e){return this.matchTitleStrictly(e)},savePlaylists:function(){var e=this;this.save_timeout&&clearTimeout(this.save_timeout),this.save_timeout=setTimeout(function(){var t=[],n=e.playlists;for(var r=0;r<n.length;r++)t.push(n[r].simplify());e.saveToStore(t)},10)},matchTitleStrictly:function(e){var t;for(var n=0;n<this.playlists.length;n++){var r=this.playlists[n];if(r.state("nav_title")==e){t=r;break}}return t},findAddPlaylist:function(e,t){var n=this.matchTitleStrictly(e);n=n||this.createUserPlaylist(e),n.add(t)},createUserPlaylist:function(e){var t=this.initSi(i,{nav_title:e,url_part:"/"+e});return this.watchOwnPlaylist(t),this.playlists.push(t),r.updateNesting(this,"lists_list",this.playlists),this.trigger("playlists-change",this.playlists),t},watchOwnPlaylist:function(e){var t=this;e.on("child_change-songs-list",function(){this.trigger("each-playlist-change"),t.savePlaylists()},{skip_reg:!0})},removePlaylist:function(e){var n=this.playlists.length;this.playlists=t.arrayExclude(this.playlists,e),this.playlists.length!=n&&(this.trigger("playlists-change",this.playlists),r.updateNesting(this,"lists_list",this.playlists),this.savePlaylists())},rebuildPlaylist:function(e){var t=this.initSi(i,{nav_title:e.playlist_title,url_part:"/"+e.playlist_title},{subitems:{"songs-list":e}});return this.watchOwnPlaylist(t),t},setSavedPlaylists:function(e){var t=[];if(e)for(var n=0;n<e.length;n++)t[n]=this.rebuildPlaylist(e[n]);this.playlists=t,this.trigger("playlists-change",this.playlists),r.updateNesting(this,"lists_list",this.playlists)}}),s}),define("js/models/SuUsersPlaylists",["./UserPlaylists","app_serv"],function(e,t){var n=t.localize,r=function(){};return e.extendTo(r,{init:function(e){this._super.apply(this,arguments),this.on("each-playlist-change",function(){su.trackEvent("song actions","add to playlist")}),this.updateManyStates({nav_title:n("playlists"),url_part:"/playlists"}),this.app.gena=this;var r=t.store("user_playlists");r&&this.setSavedPlaylists(r)},saveToStore:function(e){t.store("user_playlists",e,!0)},createEnvPlaylist:function(e){return this.app.createSonglist(this,e)}}),r}),define("js/models/user_music_vk",["pv","spv","app_serv","./comd","./SongsList","js/common-libs/htmlencoding","js/libs/BrowseMap","./LoadableList","js/modules/declr_parsers"],function(e,t,n,r,i,s,o,u,a){var f=n.localize,l=e.update,c=t.cloneObj,h=function(){};r.VkLoginB.extendTo(h,{access_desc:f("to-play-vk-audio"),beforeRequest:function(){var e=this.getNesting("auth");l(e,"requested_by",this._provoda_id)},"compx-active":[["has_session","@one:requested_by:auth"],function(e,t){return e&&t==this._provoda_id}]});var p={depends_on:["userid"],fn:function(e){return!e}},d={"compx-has_no_access":p,pmd_switch_is_parent:!0,"nest-auth_part":[h,!0,"for_current_user"],"compx-userid":[["vk_userid","#vk_userid","for_current_user"],function(e,t,n){return(n?t:e)||null}],"compx-has_vk_auth":[["for_current_user","@one:has_session:auth_part"],function(e,t){return e&&t}],"compx-parent_focus":[["^mp_has_focus"]],"stch-has_vk_auth":function(e,t){t&&e.switchPmd(!1)},"stch-parent_focus":function(e,t){t||e.switchPmd(!1)},"stch-vk_userid":function(e,t){t&&e.updateNesting("auth_part",null)},"compx-acess_ready":[["has_no_access","@one:active:auth_part"],function(e,t){return!e&&t}],"stch-acess_ready":function(e,t){t&&(e.loadStart(),e.showOnMap())}},v=function(){};i.extendTo(v,c({},d));var m=function(){};v.extendTo(m,{"nest_req-songs-list":[[a.vk.getTracksFn("response"),function(e){return e&&e.response&&!!e.response.length}],["vktapi","get",function(){return["audio.getRecommendations",{user_id:this.state("userid")}]}]]});var g=function(){};v.extendTo(g,{"nest_req-songs-list":[[a.vk.getTracksFn("response.items"),{props_map:{total:["num","response.count"],has_data_holes:[!0]}}],["vktapi","get",function(){return["audio.get",{oid:this.state("userid")}]}]]});var y=["my","recommended"],b=function(){};o.Model.extendTo(b,{model_name:"vk_users_tracks","nest-lists_list":[y],"nest-preview_list":[y,!0],sub_pa:{my:{constr:g,getTitle:function(){return f("vk-audio")}},recommended:{constr:m,title:f("VK-Recommended")}}});var w=function(){};o.Model.extendTo(w,{init_stmp:{userid:"id",first_name:"first_name",last_name:"last_name",photo:"photo","ava_image.url":"photo_medium","selected_image.url":"photo"},"compx-nav_title":{depends_on:["big_desc"],fn:function(e){return e}},"compx-big_desc":{depends_on:["first_name","last_name"],fn:function(e,t){return[e,t].join(" ")}},init:function(e,t){this._super.apply(this,arguments),this.mapStates(this.init_stmp,t,!0),this.initStates(),this.rawdata=t},getRelativeModel:function(){var e=this.app.getVkUser(this.state("userid"));return e.setProfileData(this.mapStates(this.init_stmp,this.rawdata,{})),e},showOnMap:function(){var e=this.getRelativeModel();e.showOnMap()}});var E=function(){};return u.extendTo(E,c({main_list_name:"list_items",model_name:"vk_users",page_limit:200,"nest_rqc-list_items":w,"nest_req-list_items":[[function(e){return t.getTargetField(e,"response.items")},{props_map:{total:["num","response.count"]}}],["vktapi","get",function(){return["friends.get",{user_id:this.state("userid"),fields:["id","first_name","last_name","sex","photo","photo_medium","photo_big"].join(",")}]}]]},d)),{VkUserTracks:b,VKFriendsList:E}}),define("js/models/UserCard",["pv","spv","app_serv","./comd","js/libs/BrowseMap","./SongsList","js/common-libs/htmlencoding","./UserAcquaintancesLists","./SuUsersPlaylists","./user_music_lfm","./user_music_vk"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.localize,h=function(){};i.Model.extendTo(h,{});var p=function(){};i.Model.extendTo(p,{model_name:"usercard",sub_pa:{"vk:tracks":{constr:l.VkUserTracks,title:c("vk.com tracks")},"vk:friends":{constr:l.VKFriendsList,title:c("vk.com friends")},playlists:{constr:a},acquaintances:{constr:u,title:c("Acquaintances")},"lfm:friends":{constr:f.LfmFriendsList,title:c("Last.fm friends")},"lfm:neighbours":{constr:f.LfmNeighboursList,title:c("Neighbours")},"lfm:artists":{constr:f.LfmUserArtists.LfmUserArtistsForCU,title:c("Artists")},"lfm:tracks":{constr:f.LfmUserTracks,title:c("Tracks")},"lfm:tags":{constr:f.LfmUserTags,title:c("Tags")},"lfm:albums":{constr:f.LfmUserAlbums,title:c("Albums")}},nest:function(){var e={"user-playlists":["playlists"],users_acqutes:["acquaintances"],preload_list:[["vk:friends","lfm:tags","lfm:friends","lfm:neighbours"],!0]},t=["vk:tracks","vk:friends","lfm:friends","lfm:neighbours","lfm:artists","lfm:tracks","lfm:tags","lfm:albums"];for(var n=0;n<t.length;n++){var r=t[n];e[r.replace(":","__")]=[r]}return e}(),"compx-can_expand":[["^can_expand","for_current_user"],function(e,t){return t&&e}],init:function(){this._super.apply(this,arguments);var t=this,n=this.getSPI("playlists",!0),r=function(n){e.update(t,"has_playlists",!!n.length)};return r(this.app.gena.playlists),this.app.gena.on("playlists-change",r),this}});var d=function(){};i.Model.extendTo(d,{model_name:"vk_usercard",sub_pa:{tracks:{constr:l.VkUserTracks,title:c("Tracks")},friends:{constr:l.VKFriendsList,title:c("Friends")}},"compx-big_desc":{depends_on:["first_name","last_name"],fn:function(e,t){return[e,t].join(" ")}},"compx-p_nav_title":[["vk_userid"],function(e){return"Vk.com user: "+e}],"compx-nav_title":{depends_on:["big_desc","p_nav_title"],fn:function(e,t){return e&&"Vk.com user: "+e||t}},setProfileData:function(e){var t={};for(var n in e)this.state(n)||(t[n]=e[n]);this.updateManyStates(t)},nest:function(){var e={},t=["friends","tracks"];for(var n=0;n<t.length;n++){var r=t[n];e["vk__"+r]=[r]}return e}(),req_map:[[["first_name","last_name","photo","ava_image","selected_image"],{source:"response.0",props_map:{first_name:"first_name",last_name:"last_name",photo:"photo","ava_image.url":"photo_medium","selected_image.url":"photo"}},["vktapi","get",function(){return["users.get",{user_ids:[this.state("vk_userid")],fields:["id","first_name","last_name","sex","photo","photo_medium","photo_big"].join(",")}]}]]],"stch-mp_has_focus":function(e,t){if(t){e.requestState("first_name","last_name","photo","ava_image");var n=[e.getNesting("vk__friends")];for(var r=0;r<n.length;r++){var i=n[r];i&&i.preloadStart()}}}});var v=function(){};i.Model.extendTo(v,{model_name:"lfm_usercard","compx-nav_title":[["lfm_userid"],function(e){return"Last.fm user: "+e}],nest:function(){var e={},t=["friends","neighbours","artists","tracks","tags","albums"];for(var n=0;n<t.length;n++){var r=t[n];e["lfm__"+r]=[r]}return e}(),sub_pa:{friends:{constr:f.LfmFriendsList,title:c("Friends")},neighbours:{constr:f.LfmNeighboursList,title:c("Neighbours")},artists:{constr:f.LfmUserArtists,title:c("Artists")},tracks:{constr:f.LfmUserTracks,title:c("Tracks")},tags:{constr:f.LfmUserTags,title:c("Tags")},albums:{constr:f.LfmUserAlbums,title:c("Albums")}},setProfileData:function(e){e.lfm_image&&(e.lfm_image=this.app.art_images.getImageRewrap(e.lfm_image));var t={};for(var n in e)this.state(n)||(t[n]=e[n]);this.updateManyStates(t)},"compx-big_desc":[["realname","age","gender","country"],function(e,t,n,r){var i=[],s=[e,t,n,r];for(var o=0;o<s.length;o++)s[o]&&i.push(s[o]);return i.join(", ")}],req_map:[[["userid","realname","country","age","gender","playcount","playlists","lfm_img","registered","scrobblesource","recenttrack"],{source:"user",props_map:{userid:"name",realname:null,country:null,age:["num","age"],gender:null,playcount:["num","playcount"],playlists:["num","playlists"],lfm_img:["lfm_image","image"],registered:["timestamp","registered"],scrobblesource:null,recenttrack:null}},["lfm","get",function(){return["user.getInfo",{user:this.state("lfm_userid")}]}]]],"stch-mp_has_focus":function(e,t){if(t){e.requestState("realname","country","age","gender");var n=[e.getNesting("lfm__tags"),e.getNesting("lfm__friends"),e.getNesting("lfm__neighbours")];for(var r=0;r<n.length;r++){var i=n[r];i&&i.preloadStart()}}}}),p.LfmUserCard=v,p.VkUserCard=d;var m=function(){};return e.Model.extendTo(m,{init:function(e,t){this.app=e.app,this.userdata=t.data},showFullPreview:function(){}}),p}),define("js/models/MusicConductor",["spv","app_serv","./SongsList","./ArtCard","js/libs/BrowseMap","js/lastfm_data","js/modules/declr_parsers","pv"],function(e,t,n,r,i,s,o,u){var a=[["^mp_has_focus"]],f=function(e,t){t&&e.heavyInit()},l,c=n.HypemPlaylist,h=r.ArtistsList,p=t.localize,d=function(){};c.extendTo(d,{"nest_req-songs-list":[o.hypem.tracks,["hypem","get",function(e){var t="/playlist/latest/all/json/"+e.paging.next_page+"/data.js";return[t,null]}]],page_limit:30});var v=function(){};c.extendTo(v,{"nest_req-songs-list":[o.hypem.tracks,["hypem","get",function(e){var t="/playlist/latest/remix/json/"+e.paging.next_page+"/data.js";return[t,null]}]]});var m=function(){};c.extendTo(m,{"nest_req-songs-list":[o.hypem.tracks,["hypem","get",function(e){var t="/playlist/popular/3day/json/"+e.paging.next_page+"/data.js";return[t,null]}]]});var g=function(){};n.extendTo(g,{"nest_req-songs-list":[o.lfm.getTracks("tracks"),["lfm","get",function(){return["chart.getTopTracks",null]}]]});var y=function(){};n.extendTo(y,{"nest_req-songs-list":[o.lfm.getTracks("tracks"),["lfm","get",function(){return["chart.getHypedTracks",null]}]]});var b=function(){};n.extendTo(b,{"nest_req-songs-list":[o.lfm.getTracks("tracks"),["lfm","get",function(){return["chart.getLovedTracks",null]}]]});var w=function(){};i.Model.extendTo(w,{"nest-lists_list":[["latest","latest:remix","topnow_hypem","_","hyped","loved"],!0],sub_pa:{latest:{constr:d,title:p("Latest Blogged music from hypem.com")},"latest:remix":{constr:v,title:p("Latest Blogged remixes from hypem.com")},topnow_hypem:{constr:m,title:p("Popular Now on hypem.com")},_:{constr:g,title:p("Top")},hyped:{constr:y,title:p("Hyped")},loved:{constr:b,title:p("Most Loved")}},model_name:"songs_lists"});var E=function(){};h.extendTo(E,{"nest_req-artists_list":[o.lfm.getArtists("artists"),["lfm","get",function(){return["chart.getHypedArtists",null]}]]});var S=function(){};h.extendTo(S,{"nest_req-artists_list":[o.lfm.getArtists("artists"),["lfm","get",function(){return["chart.getTopArtists",null]}]]});var x=function(){};i.Model.extendTo(x,{"nest-lists_list":[["hyped","_"],!0],model_name:"artists_lists",sub_pa:{_:{constr:S,title:p("Top")},hyped:{constr:E,title:p("Hyped")}}});var T=function(){};i.Model.extendTo(T,{model_name:"allplaces","nest-songs_lists":["songs"],"nest-artists_lists":["artists"],"nest-lists_list":[["songs","artists"]],sub_pa:{songs:{constr:w,title:p("Songs")},artists:{constr:x,title:p("Artists")}}});var N=function(e){return{metro:e.head.city_name,country:e.head.country_name}},C=function(){};h.extendTo(C,{"nest_req-artists_list":[o.lfm.getArtists("topartists"),["lfm","get",function(){return["geo.getMetroArtistChart",N(this)]}]]});var k=function(){};h.extendTo(k,{"nest_req-artists_list":[o.lfm.getArtists("topartists"),["lfm","get",function(){return["geo.getMetroHypeArtistChart",N(this)]}]]});var L=function(){};h.extendTo(L,{"nest_req-artists_list":[o.lfm.getArtists("topartists"),["lfm","get",function(){return["geo.getMetroUniqueArtistChart",N(this)]}]]});var A=function(){};i.Model.extendTo(A,{model_name:"artists_lists","nest-lists_list":[["_","hyped","unique"],!0],sub_pa:{_:{constr:C,title:p("Top")},hyped:{constr:k,title:p("Hyped")},unique:{constr:L,title:p("Unique")}}});var O=function(){};n.extendTo(O,{"nest_req-songs-list":[o.lfm.getTracks("toptracks"),["lfm","get",function(){return["geo.getMetroTrackChart",N(this)]}]]});var M=function(){};n.extendTo(M,{"nest_req-songs-list":[o.lfm.getTracks("toptracks"),["lfm","get",function(){return["geo.getMetroHypeTrackChart",N(this)]}]]});var _=function(){};n.extendTo(_,{"nest_req-songs-list":[o.lfm.getTracks("toptracks"),["lfm","get",function(){return["geo.getMetroUniqueTrackChart",N(this)]}]]});var D=function(){};i.Model.extendTo(D,{model_name:"songs_lists","nest-lists_list":[["_","hyped","unique"],!0],sub_pa:{_:{constr:O,title:p("Top")},hyped:{constr:M,title:p("Hyped")},unique:{constr:_,title:p("Unique")}}});var P=function(){};i.Model.extendTo(P,{model_name:"city_place",hp_bound:{country_name:null,city_name:null},data_by_hp:!0,"nest-lists_list":[["artists","songs"]],sub_pa:{artists:{constr:A,title:p("Artists lists")},songs:{constr:D,title:p("Songs lists")}}});var H=function(){};i.Model.extendTo(H,{model_name:"cities_list","compx-parent_focus":a,"stch-parent_focus":f,"stch-mp_has_focus":f,data_by_hp:!0,heavyInit:function(){if(this.heavy_inited)return;this.heavy_inited=!0;var e=[],t=s.сountries[this.head.country_name];for(var n=0;n<t.length;n++){var r=t[n],i=this.getSPI(r,!0);e.push(i)}u.updateNesting(this,"lists_list",e)},"nest_posb-lists_list":[P],getSPC:function(){return P},subPager:function(t){var n=e.capitalize(t);if(this.sub_pages[n])return this.sub_pages[n];var r=this.getSPC(),i=new r;return this.sub_pages[n]=i,[i,{states:{nav_title:n+", "+this.head.country_name,url_part:"/"+t},head:{city_name:n}}]}});var B=function(){};h.extendTo(B,{"nest_req-artists_list":[o.lfm.getArtists("topartists"),["lfm","get",function(){return["geo.getTopArtists",{country:this.head.country_name}]}]]});var j=function(){};n.extendTo(j,{"nest_req-songs-list":[o.lfm.getTracks("toptracks"),["lfm","get",function(){return["geo.getTopTracks",{country:this.head.country_name}]}]]});var F=function(){};i.Model.extendTo(F,{model_name:"country_place","compx-parent_focus":a,"stch-parent_focus":f,"stch-mp_has_focus":f,"nest-lists_list":[["artists_top","songs_top","cities"],!1,"mp_alhf"],"nest-pwis":[["artists_top","songs_top"],!0,"mp_alhf"],sub_pa:{songs_top:{constr:j,title:p("Top Songs")},artists_top:{constr:B,title:p("Top Artists")},cities:{constr:H,getTitle:function(){return p("Cities of %country%").replace("%country%",this.head.country_name)}}},heavyInit:function(){if(this.heavy_inited)return;this.heavy_inited=!0,u.update(this,"mp_alhf",!0)}});var I=function(){};return i.Model.extendTo(I,{model_name:"сountries_list",init:function(){this._super.apply(this,arguments);var e=[];for(var t in s.сountries){var n=this.getSPI(t,!0);e.push(n)}u.updateNesting(this,"lists_list",e)},"nest_posb-lists_list":[F],getSPC:function(){return F},subPager:function(t){var n=e.capitalize(t);if(!this.sub_pages[n]){var r=this.getSPC(),i=new r;return this.sub_pages[n]=i,[i,{states:{nav_title:n,url_part:"/"+t},head:{country_name:n}}]}return this.sub_pages[n]}}),l=function(){},i.Model.extendTo(l,{model_name:"mconductor","compx-can_expand":[["^can_expand"],function(e){return e}],"compx-can_load_previews":[["^mp_has_focus"],function(e){return!!e}],"compx-preview_images":[["@selected_image:preview_playlists.songs-list"],function(e){if(!e)return;var t={},n=[];for(var r=0;r<e.length;r++){var i=e[r];if(!i)continue;var s=i.lfm_id||i.url;if(t.hasOwnProperty(s))continue;t[s]=!0,n.push(i)}return n}],"nest-preview_playlists":[["world/songs/topnow_hypem","world/songs/_"],"can_load_previews"],"nest-preview_list":[["world/songs","world/songs/topnow_hypem","world/songs/_","world/artists","world"]],"nest-allpas":["world"],"nest-сountries":["сountries"],sub_pa:{"сountries":{title:p("Countries"),constr:I},world:{constr:T,title:p("All-a-world")}}}),l}),define("js/models/SeesuUser",["pv"],function(e){return e.behavior({},!1,function(){})}),define("js/models/StartPage",["js/libs/BrowseMap","./ArtCard","./SongCard","./TagPage","./UserCard","./MusicConductor","app_serv","./Cloudcasts","./SeesuUser","pv"],function(e,t,n,r,i,s,o,u,a,f){var l=o.app_env,c=o.localize,h=o.complexEach,p=f.update,d=l.lang,v=function(e){var t=new Array(e.length);for(var n=0;n<e.length;n++){var r=e[n][d]||e[n].original;t[n]={date:r[5],header:r[1],body:r[2],link:r[3],link_text:r[4]||"details"}}return t},m=e.Model.extendTo(function(){},{model_name:"app_news",init:function(){return this._super.apply(this,arguments),this.initStates(),this}});m.converNews=v;var g=function(){},y=function(e,t,n){return n||(n={}),n.url_part="/"+t,[e,n]};return e.Model.extendTo(g,{model_name:"start_page",zero_map_level:!0,showPlaylists:function(){this.app.search(":playlists")},refreshListeners:function(){this.app.s.susd.ligs.getData()},init:function(e){this._super.apply(this,arguments),this.su=e.app,f.update(this,"needs_search_from",!0),f.update(this,"nav_title","Seesu start page"),f.update(this,"nice_artist_hint",this.app.popular_artists[(Math.random()*10).toFixed(0)]);var t=this;return this.app.s.susd.ligs.regCallback("start-page",function(e){if(!e)return;var n=h([e[1],e[2]],function(e,t,n){return t&&e.push(t),n&&e.push(n),e});p(t,"users_listenings",n),p(t,"users_listenings_loading",!1)},function(){p(t,"users_listenings_loading",!0)}),this.closed_messages=o.store("closed-messages")||{},this},"nest-pstuff":["users/me"],"nest-muco":["conductor"],"nest-tags":["tags"],"nest-news":["news"],rpc_legacy:{requestSearchHint:function(){var e=this.state("nice_artist_hint");this.app.search(e),f.update(this,"nice_artist_hint",this.app.popular_artists[(Math.random()*10).toFixed(0)]),this.app.trackEvent("Navigation","hint artist")},changeSearchHint:function(){f.update(this,"nice_artist_hint",this.app.popular_artists[(Math.random()*10).toFixed(0)])}},sub_pages_routes:{catalog:function(e){return[t,{head:{artist_name:e}}]},tracks:function(e,t){var r="tracks/"+t,i=this.app.getCommaParts(t);if(!i[1]||!i[0])return;return[n,{states:{url_part:"/"+r},head:{artist_name:i[0],track_name:i[1]}}]},users:function(e){var t="users/"+e;if(e=="me")return[i,{states:{nav_title:c("your-pmus-f-aq"),url_part:"/"+t},head:{for_current_user:!0}}];var n=e.split(":"),r=n[0];if(r=="lfm")return[i.LfmUserCard,{states:{url_part:"/"+t},head:{lfm_userid:n[1]}}];if(r=="vk")return[i.VkUserCard,{states:{url_part:"/"+t},head:{vk_userid:n[1]}}];if(r=="su")return[a,{states:{url_part:"/"+t},head:{vk_userid:n[1]}}]},cloudcasts:function(e){var t="cloudcasts/"+this.app.encodeURLPart(e);return y(u,t,{key:e})}},sub_pa:{tags:{title:c("Pop-tags"),constr:r},conductor:{title:c("music-cond"),constr:s},news:{title:c("News"),constr:m}},getSPC:function(e,t){var n=t.split("/"),r=n[0],i=this.sub_pages_routes[r];return i&&i.call(this,decodeURIComponent(n[1]),n[1])},subPager:function(e,t){var n=t.split("/"),r=n[0],i=r;n[1]&&(i+="/"+n[1]);if(!this.sub_pages[i]){if(!n[1])return;var s=this.getSPC(e,t),o;return s&&(Array.isArray(s)?o=new s[0]:o=s),o&&(this.sub_pages[i]=o),s.splice(0,1,o),s}return this.sub_pages[i]},short_title:"Seesu",getTitle:function(){return this.short_title},messages:{"rating-help":function(e){this.app.app_pages[l.app_type]&&(e?f.update(this,"ask-rating-help",this.app.app_pages[l.app_type]):f.update(this,"ask-rating-help",!1))}},closeMessage:function(e){this.messages[e]&&!this.closed_messages[e]&&(this.closed_messages[e]=!0,o.store("closed-messages",this.closed_messages,!0),this.messages[e].call(this,!1))},showMessage:function(e){this.messages[e]&&!this.closed_messages[e]&&this.messages[e].call(this,!0)}}),g.AppNews=m,g}),define("js/SeesuServerAPI",["pv","jquery","spv","hex_md5","app_serv"],function(e,t,n,r,i){var s=e.update,o=function(e,t,n,r){this._getDataFunc=e,this._interval=n,this._freshness=t,r?this._store=r:this._store=!1,this._processing=!1,this._timestamp=!1,this._callbacks={},this._onetime_callbacks=[]};o.prototype={_request:function(){if(this._getDataFunc){var e=this;this._processing=!0,this._fireCallbacks(),this._getDataFunc(function(t){e.setNewData(t),e._processing=!1})}},setNewData:function(e){this._timestamp=1*new Date,this._store=e,this._fireCallbacks(!0)},init:function(){if(!this._inited){var e=this;this._interval&&setInterval(function(){e._request()},this._interval),this._request(),this._inited=!0}},getData:function(e,t,n){!t&&e&&this._freshness&&this._store&&this._timestamp+this._freshness>1*new Date?e(this._store):(e&&this.regCallback(!1,e,n),this._processing||this._request())},removeCallback:function(e,t){this._callbacks[e]&&this._callbacks[e].cb===t&&(this._callbacks[e]=null)},regCallback:function(e,t,n){if(e)if(t){this._callbacks[e]={cb:t,lcb:n};if(this._store){var r=this;setTimeout(function(){t(r._store)},10)}}else delete this._callbacks[e];else t&&this._onetime_callbacks.push({cb:t,lcb:n})},_fireCallbacks:function(e){var t;for(var n in this._callbacks){t=this._callbacks[n];if(!t)continue;t=e?t.cb:t.lcb,t&&t(this._store)}for(var r=this._onetime_callbacks.length-1;r>=0;r--){t=this._onetime_callbacks.pop();if(!t)continue;t=e?t.cb:t.lcb,t&&t(this._store)}}};var u=function(e,t,r){var i=n.makeIndexByField(t,"user");e.susd.relations[r]=i,s(e.app,"relations_"+r,i)},a=function(e,r,i){this.app=e,this.init();var s=this;this.url=i,r&&this.setAuth(r,!0);var a=24e4;this.susd.rl=new o(function(e){s.api("relations.getLikes",function(t){u(s,t.done,"likes"),e&&e(t)})},a,a),this.susd.ri=new o(function(e){s.api("relations.getInvites",function(t){u(s,t.done,"invites"),e&&e(t)})},a,a),this.auth.regCallback("relations.likes",function(){s.susd.rl.init(),s.susd.ri.init()}),this.susd.ligs=new o(function(e){t.ajax({url:s.url+"last_listenings/",type:"GET",dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"},error:function(){e()},success:function(t){e(t)}})},a,a),n.domReady(window.document,function(){s.susd.ligs.init()})};return e.Eventor.extendTo(a,{source_name:"seesu.me",errors_fields:["error"],susd:{rl:!1,ri:!1,ligs:!1,relations:{likes:{},invites:{}},addLike:function(e){this.relations.likes[e]||(this.relations.likes[e]=[{}])},addInvite:function(e){this.relations.likes[e]||(this.relations.likes[e]=[{}])},updateRelationsInvites:function(e){this.relations.invites=n.makeIndexByField(e,"user")},updateRelationsLikes:function(e){this.relations.likes=n.makeIndexByField(e,"user")},didUserInviteMe:function(e){var t=this.relations.invites[e];return t&&t[0]},isUserLiked:function(e){var t=this.relations.likes[e];return t&&t[0]},user_info:{}},auth:new o(!1,!1,!1),getInfo:function(e){return this.susd.user_info[e]},setInfo:function(e,t){this.susd.user_info[e]=t,this.trigger("info-change."+e,t)},getId:function(){return this.auth._store&&this.auth._store.userid},loggedIn:function(){var e=this.auth._store;return!!(e.secret&&e.sid&&e.userid)},setAuth:function(t,n){n||i.store("dg_auth",t,!0),this.auth.setNewData(t),e.update(this.app,"su_userid",t.userid)},getAuth:function(e,t){var n=this;this.api("user.getAuth",{type:"vk",ver:.3,vk_user:e},function(e){e.secret_container&&e.sid&&n.app.vk_api.get("storage.get",{key:e.secret_container}).done(function(r){r&&r.response&&(n.setAuth({userid:e.userid,secret:r.response,sid:e.sid}),n.app.trigger("dg-auth"),t&&t())})})},api:function(e,i,s,o){var u=typeof i=="object"&&i||{},a=s||typeof i=="function"&&i,f=this;u.method=e;var l=this.auth._store;if(["track.getListeners","user.getAuth"].indexOf(e)==-1){if(!l)return!1;u.sid=l.sid,u.sig=r(n.stringifyParams(u,["sid"])+l.secret)}return t.ajax({type:"GET",url:f.url+"api/",data:u,headers:{"X-Requested-With":"XMLHttpRequest"},success:function(e){e&&(!e.error||!e.error[0]||e.error[0]!="wrong signature")&&typeof a=="function"&&a(e)},error:o})}}),a}),define("js/libs/VkAuth",["pv","jquery","spv","hex_md5"],function(e,t,n,r){"use strict";function o(e,t){e.app_id=t.app_id,e.urls=t.urls,e.permissions=n.toRealArray(t.permissions),e.open_api=!!t.open_api,e.display_type=t.display_type,e.vksite_app=!!t.vksite_app,e.vksite_settings=e.vksite_app&&t.vksite_settings&&parseFloat(t.vksite_settings),e.deep_sanbdox=!!t.deep_sanbdox,i(e,"settings_bits",e.vksite_settings),e.on("vk-site-api",function(e){var t=this;t.vksite_app&&(i("settings_bits",this.vksite_settings),e.addCallback("onSettingsChanged",function(e){t.vksite_settings=e,setTimeout(function(){i(t,"settings_bits",e),t.trigger("settings-change",e)},500)})),t.VK=e})}var i=e.update,s=function(e,t){t=t===Object(t)?t:JSON.parse(t),t.expires_in=parseFloat(t.expires_in)*1e3,n.cloneObj(this,t),this.app_id=e},u=function(){};return e.Model.extendTo(u,{init:function(e){this._super(),o(this,e)},checkSettings:function(e){if(this.vksite_app&&this.vksite_settings&&(this.vksite_settings&e)*1)return!0},requestAuth:function(e){if(this.vksite_app){if(!e.settings_bits)throw new Error("give me settings bits");return this.VK&&this.VK.callMethod("showSettingsBox",e.settings_bits),!0}return this.authInit(e||{})},bindAuthReady:function(e,t,n){var r;this.vksite_app?(r=e?"settings-change."+e:"settings-change",this.on(r,function(e){n?(e&n)*1&&t.call(this):t.call(this)},{exlusive:!!e})):(r=e?"full-ready."+e:"full-ready",this.on(r,t,{exlusive:!!e}))},startIndicating:function(){},stopIndicating:function(){},getInitAuthData:function(e){var t={},n=this.open_api?"https://api.vk.com/oauth/authorize?":"http://oauth.vk.com/authorize?",i=this.display_type||"page";t.link=n+"client_id="+this.app_id+"&scope="+this.permissions.join(",")+"&display="+i+"&response_type=token";var s=this.urls.callbacker;return this.deep_sanbdox||(t.bridgekey=r(Math.random()+"bridgekey"+Math.random()),s+="?key="+t.bridgekey),t.link+="&redirect_uri="+encodeURIComponent(s),t},waitData:function(){this.trigger("data_wait"),this.data_wait=!0},createAuthFrame:function(e){var r=this;if(this.auth_inited)return!1;var i=this.auth_frame=document.createElement("iframe");n.addEvent(window,"message",function(t){var n=r.auth_frame&&r.auth_frame.contentWindow;if(t.source!=n)return;t.data=="vk_bridge_ready:"?(r.trigger("vk-bridge-ready"),t.source.postMessage("add_keys:"+e,"*")):t.data.indexOf("vk_token:")===0?(r.trigger("vk-token-receive",t.data.replace("vk_token:","")),seesu.trackEvent("Auth to vk","end")):t.data=="vk_error:"&&r.trigger("vk-token-error")}),t(i).addClass("hidden"),i.src=this.urls.bridge,t(function(){document.body.appendChild(i)}),this.auth_inited=!0},setAuthBridgeKey:function(e){this.auth_inited?this.auth_frame.contentWindow.postMessage("add_keys:"+e,"*"):this.createAuthFrame(e)},authInit:function(e){var t=this,n=this.getInitAuthData(e);return n.bridgekey&&this.setAuthBridgeKey(n.bridgekey),e.not_open?(this.startIndicating(),setTimeout(function(){t.stopIndicating()},1e4)):(this.trigger("want-open-url",n.link,n),this.waitData()),n}}),u.VkTokenAuth=s,u}),define("js/libs/VkApi",["spv","js/modules/aReq","js/modules/wrapRequest","hex_md5","js/common-libs/htmlencoding","js/libs/Mp3Search","jquery"],function(e,t,n,r,i,s,o){"use strict";var u=function(){};e.Class.extendTo(u,{init:function(e){e=e||{},e.jsonp&&(this.jsonp=!0),e.onAuthLost&&(this.onAuthLost=e.onAuthLost)},checkResponse:function(e){return!e||!!e.error},link:"https://api.vk.com/method/",setAccessToken:function(e){this.access_token=e},removeAccessToken:function(){delete this.access_token},hasAccessToken:function(){return!!this.access_token},get:function(){return this.send.apply(this,arguments)},source_name:"vk.com",cache_namespace:"vk_api",send:function(i,s,o){var u=this;if(i){o=o||{},s=s||{},o&&o.paging&&(s.count=o.paging.page_limit,s.offset=o.paging.page_limit*(o.paging.next_page-1)),o.cache_key=o.cache_key||r(i+e.stringifyParams(s)),s.v||(s.v="5.0"),this.access_token&&(s.access_token=this.access_token);var a=n({url:this.link+i,type:"GET",dataType:this.jsonp?"jsonp":"json",data:s,timeout:2e4,context:o.context},{cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},responseFn:function(e){return e&&e.error&&e.error.error_code==5&&u.onAuthLost&&u.onAuthLost(),e},queue:this.queue});return a.complex}}});var a=function(e){this.api=e.api,this.mp3_search=e.mp3_search};a.prototype={constructor:a,name:"vk",description:"vkontakte.ru",slave:!1,preferred:null,s:{name:"vk",key:"nice",type:"mp3"},dmca_url:"https://vk.com/dmca",makeSongFile:function(e){return this.makeSong(e)},makeSong:function(e,t){if(e&&e.url){var n={artist:i.decode(e.artist?e.artist:e.audio.artist),duration:parseFloat(typeof e.duration=="number"?e.duration:e.audio.duration)*1e3,link:e.url?e.url:e.audio.url,track:i.decode(e.title?e.title:e.audio.title),from:"vk",downloadable:!1,_id:e.owner_id+"_"+e.id,type:"mp3",media_type:"mp3"};return n}},makeMusicList:function(e,t){var n=[];for(var r=1,i=e.length;r<i;r++){var o=this.makeSong(e[r],t);o&&!o.link.match(/audio\/.mp3$/)&&!s.hasMusicCopy(n,o)&&n.push(o)}return n},findAudio:function(e,t){var n=this,r=o.Deferred(),i={abort:function(){this.aborted=!0,r.reject("abort"),a&&a.abort()}},s=e.q?e.q:(e.artist||"")+" - "+(e.track||"");t=t||{},t.cache_key=t.cache_key||s,r.promise(i);var u={};u.q=s,u.count=30;var a=this.api.get("audio.search",u,t).done(function(t){if(t.error)r.reject.apply(r,arguments);else if(t.response.items&&t.response.items.length){var i=n.makeMusicList(t.response.items,e);r.resolve.call(r,!!i.length&&i,"mp3")}else r.resolve.call(r)}).fail(function(){r.reject.apply(r,arguments)});return a.queued&&(i.queued=a.queued),a.cache_used&&(i.cache_used=a.cache_used),i}};var f=function(e,t){this.init(t);var n=t||{};n.cache_ajax&&(this.cache_ajax=n.cache_ajax),e&&this.setAccessToken(e.access_token),n.queue&&(this.queue=n.queue),this.asearch=new a({api:this,mp3_search:t.mp3_search})};return u.extendTo(f,{search_source:{name:"vk",key:"nice"}}),f.VkSearch=a,f}),define("js/modules/initVk",["app_serv","js/libs/VkAuth","jquery","pv"],function(e,t,n,r){var i=e.app_env,s=r.update,o=function(t){var n=e.store("vk_token_info");n&&n.access_token==t&&e.store("vk_token_info","",!0)},u=function(t,n){e.loadJS("https://vk.com/js/api/openapi.js",function(){VK.init({apiId:t},function(){}),setTimeout(function(){n.trigger("vk-site-api")},500)})},a=function(n){var o=n._url;if(i.vkontakte){n.vk_app_mode=!0;var a=new t.VkTokenAuth(o.api_id,{user_id:o.user_id,access_token:o.access_token}),f=(o.api_settings&8)*1,l=f,c=n.connectVKApi(a,f,!0);e.loadJS("https://vk.com/js/api/xd_connection.js",function(){VK.init(function(){n.trigger("vk-site-api")})}),n.vk_auth.on("settings-change",function(e){(e&8)*1?l||(l=!0,n.mp3_search.add(c.asearch,!0)):l&&n.mp3_search.remove(c.asearch,!0)})}else{var h=e.store("vk_token_info");h&&(n.vk_auth.api=n.connectVKApi(new t.VkTokenAuth(n.vkappid,h),!0),i.web_app&&u(n.vkappid,n),s(n.vk_auth,"has_token",!0),n.vk_auth.trigger("full-ready",!0)),n.vk_auth.on("vk-token-receive",function(e){var r=new t.VkTokenAuth(n.vkappid,e);this.api=n.connectVKApi(r,!0),i.web_app&&u(n.vkappid,n),s(this,"has_token",!0),this.trigger("full-ready",!0)}).on("want-open-url",function(e){i.showWebPage?i.openURL(e):i.openURL(e),r.update(n,"wait-vk-login",!0),n.trackEvent("Auth to vk","start")})}};return a.checkDeadSavedToken=o,a}),define("js/modules/PlayerBase",["pv"],function(e){"use strict";var t=function(){};return e.Eventor.extendTo(t,{constructor:t,global_volume:!0,init:function(){this._super(),this.song_files={},this.attached={}},"regfr-cready":{event_name:"core-ready",fn:function(){if(this.core)return!0}},"regfr-cfail":{event_name:"core-fail",fn:function(){if(this.core_failed)return!0}},setFail:function(){this.core_failed=!0,this.trigger("core-fail")},setCore:function(e){if(e==this.core)return;if(!this.subscriber){var t=this;this.subscriber=function(){t.fireCoreEvent.apply(t,arguments)}}this.core&&this.core.desubscribe(this.subscriber),this.core=e,e.subscribe(this.subscriber),this.core_failed=null,this.trigger("core-ready")},fireCoreEvent:function(e,t,n){var r=this.song_files[t],i=this.attached[t];r&&r.events&&r.events[e]&&r.events[e].call(r,n),r&&i&&this.events&&this.events[e]&&this.events[e].call(this,{song_file:r,song_id:t,opts:n}),this.trigger(e,{song_file:r,song_id:t,opts:n})},attachSong:function(e){this.song_files[e.uid]=e,this.attached[e.uid]=!0},dettachSong:function(e){delete this.attached[e.uid]},create:function(e){if(e&&this.core){if(!e.link)throw new Error("give me url of file!");return this.core.callSongMethod("create",e.uid,{url:e.link}),!0}},play:function(e){if(e&&this.core)return this.core.callSongMethod("play",e.uid),this.global_volume&&(this.volume||this.volume_fac)&&this.setVolume(e,this.volume,this.volume_fac),!0},pause:function(e){if(e&&this.core)return this.core.callSongMethod("pause",e.uid),!0},setVolume:function(e,t,n){t=parseFloat(t),(!n||n.length<2)&&isNaN(t)&&(t=100,console.log("wrong volume value")),e&&this.core&&this.core.callSongMethod("setVolume",e.uid,t,n),this.global_volume&&(this.volume_fac=n,this.volume=t);if(this.core)return!0},setPosition:function(e,t,n){if(e&&this.core)return this.core.callSongMethod("setPosition",e.uid,t,n),!0},load:function(e){if(e&&this.core)return this.core.callSongMethod("load",e.uid),!0},unload:function(e){if(e&&this.core)return this.core.callSongMethod("unload",e.uid),!0},remove:function(e){if(e&&this.core)return this.core.callSongMethod("remove",e.uid),!0}}),t}),define("js/modules/PlayerComplex",["./PlayerBase","pv","../libs/BrowseMap"],function(e,t,n){"use strict";var r=function(e){e.wanted_song&&(t.update(e.wanted_song,"want_to_play",!1),e.wanted_song=null)},i=function(){};return e.extendTo(i,{constructor:i,playNext:function(e,t){e.playNext(t)},playPrev:function(e){e.playPrev()},onPlaybackFinish:function(){this.resolved.playNext()},onPlaybackError:function(e,t){var n=this.resolved,r=n&&n.state("current_song"),i=n&&n.state("expected_song"),s=r==e||i==e;if(!s)return;this.nextTick(function(){t||e.isSearchAllowed()&&e.state("search_complete")&&n.playNext()})},setWaitingPlaylist:function(e){this.waiting_playlist=e;var t=this;this.once("now_playing-signal",function(){t.waiting_playlist==e&&(t.waiting_playlist=null)})},requestPlay:function(e){this.req&&t.update(this.req,"active",!1),this.req=e,this.req&&t.update(this.req,"active",!0)},wantSong:function(e){throw new Error("NOT USE THIS!, use requestPlay");var n},changeNowPlaying:function(e,i){this.setPlayMark&&this.setPlayMark(i);var s=this.req,o=this.resolved,u=s&&s.state("expected_song")==e,a=o&&o.getNesting("possible_song")==e,f=o&&o.state("current_song")==e;if(!(u||a||f))throw new Error("do not expect this!");u&&(this.resolved&&this.resolved!=this.req&&t.update(this.resolved,"active",!1),t.update(this.req,"resolved",!0),this.resolved=this.req,this.req=null),t.update(this.resolved,"current_song",e);var l=this.c_song;if(l!=e){r(this);if(l&&o){var c=o.getNesting("bwlev"),h=n.getConnectedBwlev(c,l.map_parent),p=h&&n.getBwlevFromParentBwlev(h,l);p&&p.state("mp_show")&&h.followTo(e._provoda_id)}l&&l.state("mp_show")&&this.c_song!=e,l&&(l.stop(),t.update(l,"player_song",!1)),this.nowPlaying&&this.nowPlaying(e);var c=this.resolved.getNesting("bwlev"),h=n.getConnectedBwlev(c,e.map_parent);h&&n.freeze(h),this.c_song=e,t.update(e,"player_song",!0)}this.trigger("now_playing-signal",l!=e,e,l)}}),i}),define("js/modules/AudioCoreHTML5",["spv"],function(e){var t=function(t,n,r){var i=new Audio(n);i.volume=1,e.addEvent(i,"play",function(){r("play",t)}),e.addEvent(i,"pause",function(){r("pause",t)}),e.addEvent(i,"ended",function(){r("finish",t)}),e.addEvent(i,"timeupdate",function(){var e=i.currentTime*1e3,n=i.duration*1e3;r("playing",t,{duration:n,position:e});if(i.loadme&&i.networkState===1){var s=i.buffered.length&&i.buffered.end(0)*1e3;s&&s<n&&s-e<1.5}});var s,o=function(){r("loading",t,{duration:i.duration*1e3,fetched:i.buffered.length&&i.buffered.end(0)*1e3})};return e.addEvent(i,"progress",function(){clearTimeout(s),i.buffered.length&&(o(),i.buffered.end(0)/i.duration!=1&&(s=setTimeout(function(){o()},5e3)))}),e.addEvent(i,"error",function(){r("error",t)}),i},n=function(e,t){this.url=e.url,this.id=e.id,this.cb=t,this.requireAE()};n.prototype={requireAE:function(){this.a?this.a.src||(this.a.src=this.url):this.a=t(this.id,this.url,this.cb)},clearLoad:function(){this.a&&this.a.loadme&&(this.a.loadme=!1)},unload:function(){if(this.a){this.clearLoad();try{this.a.pause()}catch(e){}delete this.a.src}},play:function(){this.requireAE(),this.a.play()},load:function(){this.requireAE(),this.a.networkState===0&&this.a.load()},stop:function(){try{this.clearLoad(),this.a.pause(),this.a.currentTime=0}catch(e){}},pause:function(){this.a.pause()},setVolume:function(e,t){t?this.a.volume=t[0]/t[1]:this.a.volume=e/100},setPosition:function(e,t){var n,r,i;try{r=this.a.buffered.length&&this.a.buffered.end(0),t?i=this.a.duration*t[0]/t[1]:i=e,r&&(i>r?r>2&&(n=Math.min(r-2,i)):n=Math.max(0,i),this.a.currentTime=n)}catch(s){}}};var r=function(e,t){var n=this;this.sounds_store={},this.feedBack=function(){n.subr&&n.subr.apply(n,arguments)}};return r.prototype={subscribe:function(e){return this.subr=e,this},desubscribe:function(e){this.subr===e&&delete this.subr},createSound:function(e){this.sounds_store[e.id]||(this.sounds_store[e.id]=new n(e,this.feedBack))},removeSound:function(e){this.sounds_store[e]&&(this.sounds_store[e].unload(),delete this.sounds_store[e])},getSound:function(e){return this.sounds_store[e]},plc:{create:function(e,t){if(!e||e.url!=t.url)this.removeSound(t.id),this.createSound(t)},remove:function(e){e&&this.removeSound(e.id)},play:function(e){e.play()},stop:function(e){e&&e.stop()},pause:function(e){e&&e.pause()},setVolume:function(e,t,n){e&&e.setVolume(parseFloat(t),n)},setPosition:function(e,t,n){e&&e.setPosition(parseFloat(t),n)},load:function(e){e&&e.load()},unload:function(e){e&&e.unload()}},callCore:function(t,n,r,i){t&&this.plc[t]&&n&&(r&&r===Object(r)&&e.cloneObj(r,{id:n}),this.plc[t].call(this,this.getSound(n),r,i))},callSongMethod:function(){this.callCore.apply(this,arguments)}},r}),define("js/modules/AudioCoreWmp",["spv","jquery"],function(e,t){var n=function(){var e=window.document.createElement("object");return e.classid="CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95",e.width=1,e.height=1,e.style.display="none",t(window.document.body).append(e),e.EnableContextMenu=!1,e.SendPlayStateChangeEvents=!0,e.ShowControls=!1,e.autostart=!1,e.Volume=0,e},r={0:"nothing",1:"loading",3:"enough",4:"complete"},i={0:"stopped",1:"paused",2:"playing",3:"waiting",4:"scan_forward",5:"scan_reverse",6:"next",7:"prev",8:"closed"},s=function(e,t,s){var o=n(),u,a=function(){u&&clearTimeout(u),u=setInterval(function(){o.IsDurationValid&&s("playing",e,{duration:o.Duration*1e3,position:o.CurrentPosition*1e3})},250)};return o.attachEvent("ReadyStateChange",function(e){console.log("ReadyStateChange: "+r[e]),r[e]=="complete"}),o.attachEvent("Error",function(t){s("error",e),console.log(t)}),o.attachEvent("EndOfStream",function(){s("finish",e),console.log("EndOfStream")}),o.attachEvent("PlayStateChange",function(t,n){var r=i[n];console.log("StateChange: "+r),i[t]=="waiting",r=="stopped"&&s("stop",e),r=="paused"&&s("pause",e),r=="playing"?(a(),o.autostart=!1,s("play",e)):u&&clearTimeout(u)}),o.attachEvent("Buffering",function(t){s("buffering",e,t)}),o.Open(t),o},o=function(e,t){this.url=e.url,this.id=e.id,this.cb=t};o.prototype={requireAE:function(){this.a||(this.a=s(this.id,this.url,this.cb))},unload:function(){this.a&&(this.a.autostart=!1,this.a.Cancel(),this.a.FileName="",delete this.a)},play:function(){this.requireAE(),this.a.autostart=!0,this.a.Play()},load:function(){this.requireAE(),this.a.Open(this.url)},stop:function(){this.a.autostart=!1,this.a.Stop()},pause:function(){this.a.autostart=!1,this.a.Pause()},setVolume:function(e){this.a.Volume=e/100*1e4-1e4},setPosition:function(e,t){if(this.a){var n=this.a.IsDurationValid&&this.a.Duration;n&&this.a.CanSeek&&(this.a.CurrentPosition=typeof t=="number"?this.a.Duration*t:e)}}};var u=function(){var e=this;this.sounds_store={},this.feedBack=function(){e.subr&&e.subr.apply(e,arguments)}};return u.prototype={subscribe:function(e){return this.subr=e,this},desubscribe:function(e){this.subr===e&&delete this.subr},createSound:function(e){this.sounds_store[e.id]||(this.sounds_store[e.id]=new o(e,this.feedBack))},removeSound:function(e){this.sounds_store[e]&&(this.sounds_store[e].unload(),delete this.sounds_store[e])},getSound:function(e){return this.sounds_store[e]},plc:{create:function(e,t){if(!e||e.url!=t.url)this.removeSound(t.id),this.createSound(t)},remove:function(e){e&&this.removeSound(e.id)},play:function(e){e.play()},stop:function(e){e&&e.stop()},pause:function(e){e&&e.pause()},setVolume:function(e,t){e&&e.setVolume(parseFloat(t))},setPosition:function(e,t,n){e&&e.setPosition(parseFloat(t),parseFloat(n))},load:function(e){e&&e.load()},unload:function(e){e&&e.unload()}},callCore:function(t,n,r,i){t&&this.plc[t]&&n&&(r&&r===Object(r)&&e.cloneObj(r,{id:n}),this.plc[t].call(this,this.getSound(n),r,i))},callSongMethod:function(){this.callCore.apply(this,arguments)}},u}),define("js/modules/AudioCoreSm2Proxy",["spv","jquery"],function(e,t){"use strict";var n=function(n,r,i){var s=this;this.origin=n,e.addEvent(window,"message",function(e){s.frame&&s.frame.contentWindow==e.source&&(e.origin.indexOf(s.origin)===0?s.handleFrameMessage.apply(s,e.data===Object(e.data)?e.data:JSON.parse(e.data)):s.fail())});if(i&&i===Object(i)){var o=e.stringifyParams(i,!1,"=","&");o&&(r=r+"#"+o)}this.modern_messaging=i.modern_messaging,this.frame=document.createElement("iframe"),this.frame.src=this.origin+r,this.def=t.Deferred()};return n.prototype={fail:function(e){return this.def.fail(e),this},done:function(e){return this.def.done(e),this},getC:function(){return this.frame},handleFrameMessage:function(e){e&&(e==="sm2loaded"?e?this.def.resolve():this.def.reject():this.subr&&this.subr.apply(this,arguments))},subscribe:function(e){return this.subr=e,this},desubscribe:function(e){this.subr===e&&delete this.subr},sendMsg:function(){var e=Array.prototype.slice.call(arguments);e.length&&this.frame.contentWindow.postMessage(this.modern_messaging?e:JSON.stringify(e),"*")},callSongMethod:function(){this.sendMsg.apply(this,arguments)}},n}),define("js/modules/PlayerSeesu",["./PlayerComplex","app_serv","jquery","spv","js/modules/AudioCoreHTML5","js/modules/AudioCoreWmp","js/modules/AudioCoreSm2Proxy"],function(e,t,n,r,i,s,o){var u=t.app_env,a,f={};u.chrome_like_ext||(u.opera_extension?(f.wmode="opaque",f.useHighPerformance=!1):u.opera_widget&&(f.wmode="transparent"));var l,c=function(e){l||e()},h=function(e,t){t?a.trackVar(3,"canplay","yes",1):e&&a.trackVar(3,"canplay","no",1)},p=["html5mp3","sm2-proxy","wmpactivex"],d={features_states:{},setAsAccessible:function(e,t){this.features_states[e]=t,this.checkReadyFeature()},setAsInaccessible:function(e){this.features_states[e]="fail",this.checkReadyFeature()},canLoad:function(e){v(e)},checkReadyFeature:function(){var e;for(var t=0;t<p.length;t++){var n=this.features_states[p[t]];if(!n)break;if(n=="fail")continue;e=n;break}h(e,p.length==t),e&&a.p.setCore(e),!e&&p.length==t&&a.p.setFail()}},v=function(e){switch(e){case"html5mp3":c(function(){d.setAsAccessible(e,new i)});break;case"wmpactivex":c(function(){d.setAsAccessible(e,new s)});break;case"sm2-proxy":c(function(){r.domReady(window.document,function(){var t=!1;try{window.postMessage({toString:function(){t=!0}},"*")}catch(r){}f.modern_messaging=!t;var i=new o("http://arestov.github.io","/SoundManager2/?"+a.version,f),s=n(i.getC()),u;s.addClass("sm2proxy").attr("scrolling","no"),s.on("load",function(){setTimeout(function(){u||(s.addClass("long-appearance"),d.setAsInaccessible(e))},7e3)}),i.done(function(){u=!0,setTimeout(function(){s.addClass("sm2-complete")},1e3),d.setAsAccessible(e,i)}).fail(function(){u=!0,s.addClass("hidden"),d.setAsInaccessible(e)}),n(function(){n(document.body).append(s)})})});break;case"sm2-internal":}},m=r.filter(r.toRealArray(navigator.plugins),"name","Shockwave Flash"),g=[function(e){e=(e=document.createElement("audio"))&&!!e.canPlayType&&!!e.canPlayType("audio/mpeg;").replace(/no/,""),e?d.canLoad("html5mp3"):d.setAsInaccessible("html5mp3")},function(e){e=document.createElement("object"),e.classid="CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95","EnableContextMenu"in e&&e.attachEvent?d.canLoad("wmpactivex"):d.setAsInaccessible("wmpactivex")}],y,b=function(){while(!l&&g.length)g.shift()()};l||r.domReady(document,function(){g.push(function(){return;var e},function(){m.length&&u.iframe_support&&!u.tizen_app?d.canLoad("sm2-proxy"):d.setAsInaccessible("sm2-proxy")},function(){return}),y&&b()});var w=function(){};return e.extendTo(w,{init:function(e){this._super(),this.app=e,a=e,this.on("finish",function(e){e.song_file.mo.submitPlayed()}).on("song-play-error",function(e,t){this.c_song==e&&this.onPlaybackError(e,t)}).on("play",function(e){e.song_file.mo.submitNowPlaying()});var t=this,n=function(e){t.c_song?t.c_song.setVolume(!1,e):t.setVolume(!1,!1,e)};a.on("state_change-settings-volume",function(e){if(!e.value)return;n(e.value)}),y=!0,b()},events:{finish:function(e){this.c_song==e.song_file.mo&&this.onPlaybackFinish(e.song_file.mo)},play:function(e){this.c_song==e.song_file.mo&&(this.playing(),this.changeAppMode(!0))},pause:function(e){this.c_song==e.song_file.mo&&(this.notPlaying(),this.changeAppMode())},stop:function(e){this.c_song==e.song_file.mo&&(this.notPlaying(),this.changeAppMode())},playing:function(){}},setPlayMark:function(e){e?this.playing():this.notPlaying()},notPlaying:function(){a.notPlaying()},playing:function(){a.playing()},changeAppMode:function(e){e?window.btapp&&window.btapp.properties.set("background",!0):window.btapp&&window.btapp.properties.set("background",!1)},nowPlaying:function(e){a.nowPlaying(e)}}),w}),define("js/libs/ProspApi",["spv","js/modules/aReq","js/modules/wrapRequest","hex_md5","js/common-libs/htmlencoding","js/libs/Mp3Search"],function(e,t,n,r,i,s){var o=function(e,t,n){this.queue=e,this.crossdomain=t,this.cache_ajax=n};o.prototype={constructor:o,source_name:"pleer.com",cache_namespace:"pleer.com",thisOriginAllowed:!1,get:function(i,s,o){if(i){o=o||{},o.cache_key=o.cache_key||r(i+e.stringifyParams(s));var u=s||{},a=n({headers:null,url:"http://pleer.com/browser-extension/"+i,type:"GET",dataType:this.crossdomain?"json":"jsonp",data:u,timeout:2e4,afterChange:function(e){e.dataType=="json"&&(e.headers=null)},context:o.context},{cache_ajax:this.cache_ajax,nocache:o.nocache,cache_key:o.cache_key,cache_timeout:o.cache_timeout,cache_namespace:this.cache_namespace,requestFn:function(){return t.apply(this,arguments)},queue:this.queue});return a.complex}}};var u=new e.MorphMap({is_array:!0,source:"tracks",props_map:{_id:"id",page_link:"link",artist:"artist",track:"track",link:"file",duration:"length"}}),a=function(e){this.api=e.api,this.mp3_search=e.mp3_search},f={from:"pleer.com",type:"mp3",media_type:"mp3"};return a.prototype={constructor:a,name:"pleer.com",description:"pleer.com",slave:!1,s:{name:"pleer.com",key:0,type:"mp3"},dmca_url:"http://pleer.com/feedback",preferred:null,makeSongFile:function(e){return this.makeSong(e)},makeSong:function(t,n){t.artist=t.artist+"",t.duration=t.duration&&t.duration*1e3,e.cloneObj(t,f);if(!t.artist){var r=s.guessArtist(t.track,n&&n.artist);r.artist&&(t.artist=r.artist,t.track=r.track)}return t},findAudio:function(e,t){var n=this,r=e.q?e.q:(e.artist||"")+(e.track?" - "+e.track:"");r=r.replace(/\'/g,"").replace(/\//g," "),t=t||{};var i=e.limit||30;t.cache_key=t.cache_key||r+"_"+i;var s={page:1,limit:i,q:r},o=this.api.get("search",s,t),a=o.done,f;return o.done=function(t){return a.call(this,function(r){if(!f){var i=u(r),s=[];for(var o=0;o<i.length;o++){var a=n.makeSong(i[o],e);s.push(a)}f=s}t(f,"mp3")}),this},o}},o.ProspMusicSearch=a,o});var su,seesu;define("su",["require","spv","app_serv","pv","jquery","js/libs/navi","js/libs/BrowseMap","js/modules/net_apis","js/libs/Mp3Search","js/libs/ScApi","js/modules/torrent_searches","js/libs/FuncsQueue","js/libs/LastfmAPIExtended","js/models/AppModel","js/models/comd","js/LfmAuth","js/models/StartPage","js/SeesuServerAPI","js/libs/VkAuth","js/libs/VkApi","js/modules/initVk","js/modules/PlayerSeesu","js/models/invstg","cache_ajax","js/libs/ProspApi"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T){var N=4.8,C=n.localize,k=n.app_env,L=[],A=function(){return this.reverse_default_prio=!0,L.push(this),this},O=function(e){su.resortQueue(e)};i.ajaxSetup({cache:!0,global:!1,timeout:4e4}),i.support.cors=!0;var M=r.update,_=new h;_.init(n.getPreloadedNK("lfm_key"),n.getPreloadedNK("lfm_secret"),function(e){return n.store(e)},function(e,t){return n.store(e,t,!0)},x,k.cross_domain_allowed,new c({time:[700],resortQueue:O,init:A})),_.checkMethodResponse=function(e,t,n){su.art_images.checkLfmData(e,n)};var D=window.chrome,P=function(){};r.View.extendTo(P,{state_change:{playing:function(e,t){t?D.browserAction.setIcon({path:"/icons/icon19p.png"}):D.browserAction.setIcon({path:"/icons/icon19.png"})},now_playing:function(e,t){D.browserAction.setTitle({title:C("now_playing","Now Playing")+": "+t})}}});var H=function(){};r.View.extendTo(H,{state_change:{playing:function(e,t){t?e.opts.opera_ext_b.icon="/icons/icon18p.png":e.opts.opera_ext_b.icon="/icons/icon18.png"},now_playing:function(e,t){e.opts.opera_ext_b.title=C("now_playing","Now Playing")+": "+t}}});var B=function(){};p.extendTo(B,{initAPIs:function(){var e=this;this.lfm_auth=this.initSi(v,{lfm:_},{deep_sanbdox:k.deep_sanbdox,callback_url:"http://seesu.me/lastfm/callbacker.html",bridge_url:"http://seesu.me/lastfm/bridge.html"}),this.lfm_auth.once("session",function(){e.setSetting("lfm-scrobbling",!0)}),this.vk_auth=new y,this.vk_auth.init({app_id:this.vkappid,urls:{bridge:"http://seesu.me/vk/bridge.html",callbacker:"http://seesu.me/vk/callbacker.html"},permissions:["friends","video","offline","audio","wall","photos"],open_api:!1,deep_sanbdox:k.deep_sanbdox,vksite_app:k.vkontakte,vksite_settings:this._url.api_settings,display_type:k.tizen_app&&"mobile"}),this.once("vk-site-api",function(){window.documentScrollSizeChangeHandler=function(e){window.VK.callMethod("resizeWindow",800,Math.max(700,e))},e.vk_auth.trigger("vk-site-api",window.VK)}),this.vk_queue=new c({time:[700,8e3,7],resortQueue:O,init:A}),this.vk_open_api=new b(null,{queue:e.vk_queue,jsonp:!k.cross_domain_allowed,cache_ajax:x}),this.vktapi=this.vk_open_api,this.hypem=new u.HypemApi,this.hypem.init({xhr2:k.xhr2,crossdomain:k.cross_domain_allowed,cache_ajax:x,queue:new c({time:[1700,4e3,4],resortQueue:O,init:A})}),this.goog_sc=new u.GoogleSoundcloud,this.goog_sc.init({crossdomain:k.cross_domain_allowed,cache_ajax:x,queue:new c({time:[1e3,3e3,4],resortQueue:O,init:A})}),this.discogs=new u.DiscogsApi,this.discogs.init({crossdomain:k.cross_domain_allowed,cache_ajax:x,queue:new c({time:[2e3,4e3,4],resortQueue:O,init:A}),key:n.getPreloadedNK("dgs_key"),secret:n.getPreloadedNK("dgs_secret")}),this.mixcloud=new u.MixcloudApi,this.mixcloud.init({crossdomain:k.cross_domain_allowed,cache_ajax:x,queue:new c({time:[2e3,4e3,4],resortQueue:O,init:A})}),this.s=new g(this,n.store("dg_auth"),this.server_url),r.update(this,"su_server_api",!0),this.s.on("info-change.vk",function(t){r.update(e,"vk_info",t),r.update(e,"vk_userid",t&&t.id)}),this.on("vk-api",function(t,n){t&&e.getAuthAndTransferVKInfo(t,n)});var i=t.debounce(function(t){e.trackVar(4,"search",t,1)},300);this.mp3_search.on("list-changed",function(e){e=t.filter(e,"name").sort();for(var n=0;n<e.length;n++)e[n]=e[n].slice(0,2);i(e.join(","))}),this.updateNesting("lfm_auth",this.lfm_auth),this.lfm.username&&r.update(this,"lfm_userid",this.lfm.username),this.lfm_auth.on("session.ga_tracking",function(){e.trackEvent("Auth to lfm","end")}),this.lfm_auth.on("want-open-url",function(t){k.showWebPage?k.openURL(t):k.openURL(t),e.trackEvent("Auth to lfm","start")}),t.domReady(window.document,function(){e.lfm_auth.try_to_login(),_.sk||e.lfm_auth.get_lfm_token()})},"stch-session@lfm_auth":function(e,t){t&&M(e,"lfm_userid",e.lfm.username)},tickStat:function(e){window._gaq.push(e)},init:function(e){this._super(),this.version=e,this.lfm=_,this._url=n.get_url_parameters(location.search,!0),this.settings={},this.settings_timers={},this.all_queues=L;var i=this;this.trackStat=function(){return window._gaq=window._gaq||[],window._gaq.sV=t.debounce(function(e){n.store("ga_store",e,!0)},130),window._gaq.gV=function(){return n.store("ga_store")},window._gaq.push(["_setAccount","UA-17915703-1"]),window._gaq.push(["_setCustomVar",1,"environmental",k.unknown_app?"unknown_app":k.app_type,1]),window._gaq.push(["_setCustomVar",2,"version",e,1]),t.domReady(window.document,function(){n.loadJS("js-sep/ga.mod.min.js",function(){console.log("ga done")})}),function(e){i.nextTick(i.tickStat,[e])}}();var u=n.store("su-usage-last");this.last_usage=u&&new Date(u)||new Date*1-27e5,this.usage_counter=parseFloat(n.store("su-usage-counter"))||0,setInterval(function(){var e=new Date;(e-i.last_usage)/36e5>4&&(i.checkStats(),n.store("su-usage-last",(i.last_usage=new Date).toUTCString(),!0),n.store("su-usage-counter",++i.usage_counter,!0))},12e5),setInterval(function(){return},12e4),this.popular_artists=["The Beatles","Radiohead","Muse","Lady Gaga","Eminem","Coldplay","Red Hot Chili Peppers","Arcade Fire","Metallica","Katy Perry","Linkin Park"],this.mp3_search=new a({app:this},{vk:5,"pleer.com":4,nigma:1,exfm:0,soundcloud:-5,lastfm:-10,torrents:-15}),this.vk={},this.notf=new d.GMessagesStore(function(e){return n.store("notification",e,!0)},function(){return n.store("notification")}),this.initAPIs(),this.p=new E,this.p.init(this),this.player=this.p,this.app_md=this,this.art_images=new d.LastFMArtistImagesSelector,this.art_images.init(),this.vk_users=(new r.Model).init(),this.vk_groups=(new r.Model).init(),k.check_resize&&r.update(this,"slice-for-height",!0),k.deep_sanbdox&&r.update(this,"deep_sandbox",!0),this.start_page=(new m).init({app:this}),this.initMapTree(this.start_page,k.needs_url_history,s).on("nav-change",function(e){this.trackPage(e.md.model_name)},this.getContextOptsI()).makeMainLevel(),k.tizen_app&&t.addEvent(window,"tizenhwkey",function(e){if(e.keyName=="back"){var t=window.history;if(!t.state){var n=window.tizen.application.getCurrentApplication();n.exit()}else t.back()}});var f=function(e,t,n){var r=new e,s=i.connectMPX();s.addView(r,t),r.init({mpx:s},n),r.requestAll()};k.chrome_like_ext?f(P,"chrome_ext"):k.opera_extension&&window.opera_extension_button&&(this.opera_ext_b=window.opera_extension_button,f(H,"opera_ext",{opera_ext_b:window.opera_extension_button})),setTimeout(function(){i.checkStats()},100),setTimeout(function(){for(var t=i.supported_settings.length-1;t>=0;t--){var r=i.supported_settings[t],s=n.store("settings."+r);if(s)try{s=JSON.parse(s)}catch(o){}typeof s=="string"&&(s=="true"?s=!0:s=="false"&&(s=!1)),i.letAppKnowSetting(r,s)}var u=n.store("last-su-ver");i.migrateStorage(u),n.store("last-su-ver",e,!0)},200),k.needs_url_history&&(s.init(function(e){var t=e.newURL;i.map.startChangesCollecting({skip_url_change:!0});var n=s.findHistory(e.newURL);if(n)n.data.showOnMap();else{var r=o.getUserInterest(t.replace(/\ ?\$...$/,""),i.start_page);o.showInterest(i.map,r)}i.map.finishChangesCollecting()}),function(){var e=window.location&&location.hash.replace(/^\#/,"");e&&i.on("handle-location",function(){s.hashchangeHandler({newURL:e},!0)})}()),n.app_env.nodewebkit&&r.update(this,"disallow_seesu_listeners",!0),this.on("child_change-current_mp_md",function(e){this.closeNavHelper()})},watchVKCharacter:function(e,t,n){var r,i;t>0?(r=this.vk_users,i=t):(r=this.vk_groups,i=t*-1),e.wch(r,i,n)},migrateStorage:function(e){if(!e){var t=n.store("lfm_scrobbling_enabled");t&&(n.store("lfm_scrobbling_enabled","",!0),this.setSetting("lfm-scrobbling",t))}typeof this.settings["volume"]=="number"&&this.setSetting("volume",[this.settings.volume,100])},checkStats:function(){return this.usage_counter>2&&this.start_page.showMessage("rating-help"),this},supported_settings:["lfm-scrobbling","dont-rept-pl","rept-song","volume","files_sources","pl-shuffle"],letAppKnowSetting:function(e,t){this.settings[e]=t,r.update(this,"settings-"+e,t)},storeSetting:function(e,t){clearTimeout(this.settings_timers[e]),this.settings_timers[e]=setTimeout(function(){n.store("settings."+e,t,!0)},333)},setSetting:function(e,t){this.supported_settings.indexOf(e)!=-1&&(this.letAppKnowSetting(e,t),this.storeSetting(e,t))},showPlaylists:function(){this.search(":playlists")},fs:{},env:k,server_url:"http://seesu.me/",encodeURLPart:function(e){var t=e.split(" ");return i.each(t,function(e,n){t[e]=encodeURIComponent(n)}),t.join("+")},decodeURLPart:function(e){var t=e.split("+");return i.each(t,function(e,n){t[e]=decodeURIComponent(n)}),t.join(" ")},joinCommaParts:function(e){return e.map(function(e){return this.encodeURLPart(e)},this).join(",")},getCommaParts:function(e){var t=e.split(",");for(var n=0;n<t.length;n++)t[n]=this.decodeURLPart(t[n]);return t},app_pages:{chrome_extension:"https://chrome.google.com/webstore/detail/nhonlochieibnkmfpombklkgjpkeckhi/reviews",chrome_app:"https://chrome.google.com/webstore/detail/fagoonkbbneajjbhdlklhdammdfkjfko/reviews",opera_widget:"http://widgets.opera.com/widget/15872/",opera_extension:"https://addons.opera.com/addons/extensions/details/seesu-music",pokki_app:"https://www.pokki.com/app/Seesu"},trackEvent:function(){var e=this.current_page||"(nonono)",t=Array.prototype.slice.call(arguments);this.trackStat.call(this,function(){var n=_gat._getTrackerByName(e);n._trackEvent.apply(n,t)})},rootv_field:["mpx","views_index","root","length"],trackPage:function(e){this.current_page=e;var t=Array.prototype.slice.call(arguments);t.unshift("_trackPageview");if(!this.app_view_id){this.last_page_tracking_data=t;return}this.trackStat.call(this,t)},checkPageTracking:function(){this.app_view_id&&this.last_page_tracking_data&&(this.trackStat.call(this,this.last_page_tracking_data),this.last_page_tracking_data=null)},trackTime:function(){var e=Array.prototype.slice.call(arguments),t=this.current_page||"(nonono)";this.trackStat.call(this,function(){var n=_gat._getTrackerByName(t);n._trackTiming.apply(n,e)})},trackVar:function(){var e=Array.prototype.slice.call(arguments);e.unshift("_setCustomVar"),this.trackStat.call(this,e)},setVkApi:function(e,t){this.vk_api=e,this.vktapi=e,this.trigger("vk-api",e,t)},createSearchPage:function(){var e=new S.SearchPage;return e.init({app:this,map_parent:this.start_page}),e},getPlaylists:function(e){var n=[],r;if(this.gena)for(r=0;r<this.gena.playlists.length;r++){var i=this.gena.playlists[r];e?i.state("nav_title")==e?n.unshift(i):i.state("nav_title")&&i.state("nav_title").match(t.getStringPattern(e))&&n.push(i):n.push(i)}return n},attachUI:function(e){this.app_view_id=e,this.checkPageTracking()},detachUI:function(e){this.p&&this.p.c_song&&this.showNowPlaying(!0),this.app_view_id===e&&(this.app_view_id=null)},vkappid:2271620,getAuthAndTransferVKInfo:function(e,n){if(!n)throw new Error("want to get photo but have not user id :(");var r=this;e.get("getProfiles",{uids:n,fields:"uid, first_name, last_name, domain, sex, city, country, timezone, photo, photo_medium, photo_big"},{nocache:!0}).done(function(e){e=e.response&&e.response[0];if(e){r.s.vk_id=n;var i=t.cloneObj({data_source:"vkontakte"},e);r.s.setInfo("vk",i),M(r,"current_su_user_info",i),r.s.loggedIn()?r.s.api("user.update",i):r.s.getAuth(n,function(){r.s.api("user.update",i)})}}).fail(function(){})},getPhotoFromVK:function(){this.getAuthAndTransferVKInfo(this.vk_api,this.s.vk_id)},getVKFriends:function(){var e=this;if(!this.vk_api)return;this.vk_fr_req||(this.vk_fr_req=this.vk_api.get("friends.get",{fields:"uid, photo"},{cache_timeout:3e5}).done(function(){delete e.vk_fr_req})),this.vk_fr_req.done(function(t){e.trigger("vk-friends",t&&t.response.items)}).fail(function(){})},updateLVTime:function(){this.last_view_time=new Date*1},vkSessCode:function(e){if(e){var t=new y.VkTokenAuth(su.vkappid,e);su.vk_auth.api=su.connectVKApi(t,!0),M(su.vk_auth,"has_token",!0),su.vk_auth.trigger("full-ready",!0)}},connectVKApi:function(e,r,i){var s=this,o=function(e){s.mp3_search.remove(e.asearch),e.asearch.dead=e.asearch.disabled=!0,s.vk_api==e&&(s.vk_api=null,s.vktapi=s.vk_open_api,s.trigger("vk-api",null))},u=new b(e,{queue:s.vk_queue,jsonp:!k.cross_domain_allowed,cache_ajax:x,onAuthLost:function(){o(u),w.checkDeadSavedToken(e)},mp3_search:s.mp3_search});return s.setVkApi(u,e.user_id),r&&s.mp3_search.add(u.asearch,!0),e.expires_in&&setTimeout(function(){o(u)},e.expires_in),i||n.store("vk_token_info",t.cloneObj({},e,!1,["access_token","expires_in","user_id"]),!0),u},createLFMFile:function(e,t,n){return{link:n,artist:e,track:t,from:"lastfm",media_type:"mp3"}},checkUpdates:function(){var e=this;i.ajax({url:this.s.url+"update",global:!1,type:"POST",dataType:"json",data:{ver:this.version,app_type:k.app_type}}).done(function(t){if(!t)return;var n=t.latest_version.number;if(n>e.version){var r="Suddenly, Seesu "+n+" has come. "+"You have version "+e.version+". ",s=t.latest_version.link;s.indexOf("http")!=-1&&i("#promo").append('<a id="update-star" href="'+s+'" title="'+r+'"><img src="/i/update_star.png" alt="update start"/></a>')}console.log("lv: "+n+" reg link: "+(e.vkReferer=t.vk_referer))})},nsd_handlers:{su_users:function(e){var t=this;for(var n=0;n<e.length;n++){var r=e[n].user,i=t.routePathByModels("users/su:"+r);i.updateManyStates(e[n])}},vk_groups:function(e){var t=this.vk_groups;for(var n=0;n<e.length;n++)r.update(t,e[n].id,e[n])},vk_users:function(e){var t=this.vk_users;for(var n=0;n<e.length;n++)r.update(t,e[n].id,e[n])},files:function(e,t,n){var r=n&&n.model_name=="song"&&{artist:n.state("artist"),track:n.state("track")};for(var i=0;i<e.length;i++){var s=e[i];if(!s.link)continue;s.from||(s.from=t),s.media_type||(s.media_type="mp3"),this.mp3_search.addFileToInvestg(s,s),r&&this.mp3_search.addFileToInvestg(s,r)}}},handleNetworkSideData:function(e,t,n,r){this.nsd_handlers[t]?this.nsd_handlers[t].call(this,n,e,r):console.log(e,t,n)},suggestNavHelper:function(){this.showNowPlaying(),this.state("played_playlists_length")>1&&r.update(this,"nav_helper_is_needed",!0)},closeNavHelper:function(){r.update(this,"nav_helper_is_needed",!1)}}),seesu=su=new B,su.init(N),r.sync_s.setRootModel(su),function(){su.sc_api=new f(n.getPreloadedNK("sc_key"),new c({time:[3500,5e3,4],resortQueue:O,init:A}),k.cross_domain_allowed,x),su.mp3_search.add(new f.ScMusicSearch({api:su.sc_api,mp3_search:su.mp3_search})),k.cross_domain_allowed&&su.mp3_search.add(new T.ProspMusicSearch({api:new T(new c({time:[3500,5e3,4],resortQueue:O,init:A}),k.cross_domain_allowed,x),mp3_search:su.mp3_search}));if(k.nodewebkit)requirejs(["js/libs/TorrentsAudioSearch"],function(e){su.mp3_search.add(new e({cache_ajax:x,queue:new c({time:[100,150,4],resortQueue:O,init:A}),mp3_search:su.mp3_search,torrent_search:new l.BtdiggTorrentSearch({queue:new c({time:[3500,5e3,4],resortQueue:O,init:A}),cache_ajax:x,mp3_search:su.mp3_search})}))});else{var e=k.nodewebkit;e&&!(k.chrome_app||k.chrome_ext||k.tizen_app)&&(k.torrents_support?su.mp3_search.add(new l.BtdiggTorrentSearch({queue:new c({time:[3500,5e3,4],resortQueue:O,init:A}),cache_ajax:x,mp3_search:su.mp3_search})):k.cross_domain_allowed?su.mp3_search.add(new l.isohuntTorrentSearch({cache_ajax:x,mp3_search:su.mp3_search})):su.mp3_search.add(new l.googleTorrentSearch({crossdomain:k.cross_domain_allowed,mp3_search:su.mp3_search,cache_ajax:x})))}}();var j=function(e,r,s){var o=document.createElement("iframe");t.addEvent(window,"message",function(e){e.source==o.contentWindow&&r(e.data)}),n.app_env.nodewebkit&&(o.nwdisable=!s,o.nwfaketop=!s),i(o).css({position:"absolute",width:"1px",height:"1px",visibility:"hidden","z-index":-10}),o.src=e,i(window.document.body).append(o)};return t.domReady(window.document,function(){w(su),su.checkUpdates();var t=new c({time:[700]});t.add(function(){j("https://arestov.github.io/su_news_iframe/",function(e){if(!e)return;r.update(su.start_page.getNesting("news"),"news_list",m.AppNews.converNews(e))})}),t.add(function(){j("https://arestov.github.io/su_blocked_music/",function(e){if(!e)return;var t={};for(var n in e){var i=n.toLowerCase();if(e[n]===!0){t[i]=!0;continue}var s=t[i]=t[i]||{};for(var o=0;o<e[n].length;o++){var u=e[n][o];if(!u||typeof u!="string")continue;s[i][e[n][o].toLowerCase()]=!0}}r.update(su,"forbidden_by_copyrh",t)})}),t.add(function(){n.app_env.nodewebkit&&j("https://arestov.github.io/su_update_iframe/",function(t){if(!t)return;if(t.last_ver&&t.last_ver>N&&t.package_url){var n=e("fs").readdirSync(e("path").resolve(e("nw.gui").App.manifest.main,".."));n.indexOf(".git")==-1&&e("nodejs/update-receiver")(t.package_url,N)}})})}),su}),define("js/views/nav",["pv"],function(e){var t=function(){};e.View.extendTo(t,{dom_rp:!0,base_tree:{sample_name:"common-nav"},"compx-nav_clickable":{depends_on:["mp_stack","mp_has_focus"],fn:function(e,t){return!t&&(e==Boolean(e)||e=="top")}},tpl_events:{zoomOut:function(){this.state("nav_clickable")&&this.parent_view.RPCLegacy("zoomOut")}}});var n=function(){};t.extendTo(n,{base_tree:{sample_name:"start_page-nav"}});var r=function(){};return t.extendTo(r,{base_tree:{sample_name:"search_page-nav"}}),{baseNavUI:t,StartPageNavView:n,investgNavUI:r}}),define("js/views/etc_views",["pv","app_serv","jquery"],function(e,t,n){var r=e.update,i=t.localize,s=function(e){this.m={c:e.addClass("hidden"),active:!1},this.arrow=e.children(".rc-arrow"),this.parts={}};s.prototype={getC:function(){return this.m.c},addPart:function(e,t){t&&(this.parts[t]={c:e.addClass("hidden"),d:{},active:!1})},C:function(e){return this.parts[e]&&this.parts[e].c},D:function(e,t,n){if(e&&this.parts[e]){if(typeof n!="undefined"&&t)return this.parts[e].d[t]=n;if(t)return this.parts[e].d[t]}},isActive:function(e){return!!this.parts[e].active},showPart:function(e,t){this.parts[e].active||(this.hide(!0),this.parts[e].c.removeClass("hidden"),this.parts[e].active=!0,this.m.active||(this.m.c.removeClass("hidden"),this.m.active=!0));if(t){this.arrow.removeClass("hidden");var n=t(),r=this.arrow.offsetParent().offset();this.arrow.css("left",n.left+n.owidth/2-r.left+"px")}},hide:function(e,t){e||this.m.active&&(this.m.c.addClass("hidden"),this.m.active=!1);for(var n in this.parts)this.parts[n].active&&(this.parts[n].c.addClass("hidden"),this.parts[n].active=!1);t||this.arrow.addClass("hidden")}};var o=function(){};e.View.extendTo(o,{});var u=function(){};e.View.extendTo(u,{state_change:{data_wait:function(e,t){t?e.c.addClass("waiting-auth"):e.c.removeClass("waiting-auth")},request_description:function(e,t){e.login_desc.text(t||"")},deep_sandbox:function(e,t){e.c.toggleClass("deep-sandbox",!!t)}},"stch-has_notify_closer":function(e,t){e.c.toggleClass("has_notify_closer",!!t)},"stch-notify_readed":function(e,t){e.c.toggleClass("notf-readed",!!t)},"stch-has_session":function(e,t){t?e.c.addClass("hidden"):e.c.removeClass("hidden")},createBase:function(){this.c=this.root_view.getSample("vklc");var e=this,t=this.c.find(".sign-in-to-vk").click(function(t){e.RPCLegacy("requestAuth"),t.preventDefault()});this.login_desc=this.c.find(".login-request-desc"),this.addWayPoint(t,{canUse:function(){}});var n=this.c.find(".vk-code");this.c.find(".use-vk-code").click(function(){var t=n.val();e.root_view.RPCLegacy("vkSessCode",t)}),this.addWayPoint(n,{canUse:function(){}}),this.c.find(".notify-closer").click(function(){e.RPCLegacy("removeNotifyMark")});var r=this.c.find(".js-input-code").click(function(){e.RPCLegacy("waitData")});r[0]&&this.addWayPoint(r)}});var a=function(){};e.View.extendTo(a,{"stch-has_session":function(e,t){t?e.c.addClass("hidden"):e.c.removeClass("hidden")},"stch-deep_sandbox":function(e,t){e.c.toggleClass("deep-sandbox",!!t)},"stch-data_wait":function(e,t){t?e.c.addClass("waiting-auth"):e.c.removeClass("waiting-auth")},"stch-request_description":function(e,t){e.c.find(".lfm-auth-request-desc").text(t||"")},createBase:function(){this.c=this.root_view.getSample("lfm_authsampl"),this.auth_block=this.c.children(".auth-block");var e=this,t=this.auth_block.find(".lastfm-auth-bp a").click(function(t){e.RPCLegacy("requestAuth"),t.preventDefault()});this.addWayPoint(t),this.code_input=this.auth_block.find(".lfm-code");var n=this.auth_block.find(".use-lfm-code").click(function(){var t=e.code_input.val();return t&&e.RPCLegacy("useCode",t),!1});this.addWayPoint(n)}});var f=function(){};a.extendTo(f,{createBase:function(){this._super();var e=this,t=n('<div class="add-to-lfmfav"></div>');this.nloveb=this.root_view.createNiceButton(),this.nloveb.c.appendTo(t),this.nloveb.b.click(function(){e.nloveb._enabled&&e.RPCLegacy("makeLove")}),this.addWayPoint(this.nloveb.b),this.nloveb.b.text(i("addto-lfm-favs")),this.c.append(t)},"stch-has_session":function(e,t){t=!!t,e.c.toggleClass("has_session",t),e.auth_block.toggleClass("hidden",t),e.nloveb.toggle(t)},"stch-wait_love_done":function(e,t){e.c.toggleClass("wait_love_done",!!t)}});var l=function(){};a.extendTo(l,{createBase:function(){this._super(),this.scrobbling_switchers=this.root_view.getSample("lfm_scrobling").appendTo(this.c),this.chbx_enabl=this.scrobbling_switchers.find(".enable-scrobbling"),this.chbx_disabl=this.scrobbling_switchers.find(".disable-scrobbling");var e=this;this.chbx_enabl.click(function(){e.RPCLegacy("setScrobbling",!0)}),this.chbx_disabl.click(function(){e.RPCLegacy("setScrobbling",!1)}),this.addWayPoint(this.chbx_enabl,{}),this.addWayPoint(this.chbx_disabl,{})},"stch-has_session":function(e,t){t=!!t,e.c.toggleClass("has_session",t),e.auth_block.toggleClass("hidden",t),e.chbx_enabl.add(e.chbx_disabl).prop("disabled",!t)},"stch-scrobbling":function(e,t){e.chbx_enabl.prop("checked",!!t),e.chbx_disabl.prop("checked",!t)}});var c=function(){};return e.View.extendTo(c,{bindBase:function(){},getCurrentButton:function(){var e=this.state("active_part");if(e)return this.tpl.ancs["bt"+e]},getArPaOffset:function(){return this.tpl.ancs.arrow.offsetParent().offset()},getCurrentButtonOWidth:function(){var e=this.getCurrentButton();return e.outerWidth()},getCurrentButtonOffset:function(){var e=this.getCurrentButton();return e.offset()},"compx-key-button_owidth":[["#workarea_width","active_part"],function(e,t){if(e&&t)return this.getBoxDemensionKey("button_owidth",t)}],"compx-key-button_offset":[["#workarea_width","active_part"],function(e,t){if(e&&t)return this.getBoxDemensionKey("button_offset",e,t)}],"compx-key-arrow_parent_offset":[["#workarea_width","active_part"],function(e,t){if(e&&t)return this.getBoxDemensionKey("arrow_parent_offset",e)}],"stch-key-button_owidth":function(e,t){t&&r(e,"button_owidth",e.getBoxDemensionByKey(e.getCurrentButtonOWidth,t))},"stch-key-button_offset":function(e,t){t&&r(e,"button_offset",e.getBoxDemensionByKey(e.getCurrentButtonOffset,t))},"stch-key-arrow_parent_offset":function(e,t){t&&r(e,"arrow_parent_offset",e.getBoxDemensionByKey(e.getArPaOffset,t))},"compx-arrow_pos":{depends_on:["button_owidth","button_offset","arrow_parent_offset"],fn:function(e,t,n){if(t&&n)return t.left+e/2-n.left+"px"}}}),{LfmLoginView:a,LfmScrobbleView:l,LfmLoveItView:f,VkLoginUI:u,contextRow:s,ActionsRowUI:c}}),define("js/views/coct",["spv","pv","jquery","./etc_views"],function(e,t,n,r){var i=t.update,s=function(){};r.VkLoginUI.extendTo(s,{createBase:function(){this._super(),this.c.removeClass("attention-focuser")}});var o=function(){};t.View.extendTo(o,{useBase:function(e){this.c=e,this.bindBase()},bindBase:function(){this.createTemplate();var t=this,n=e.getTargetField(this,"tpl.ancs.button_area")||this.c;n.click(function(){t.requestPage()}),this.addWayPoint(n)},"stch-list_loading":function(e,t){if(!e.tpl.ancs.listc)return;e.tpl.ancs.listc.toggleClass("list_loading",!!t)},"stch-mp_show":function(t,n){var r=e.getTargetField(t,"tpl.ancs.button_area")||t.c;r.toggleClass("button_selected",!!n)},base_tree:{sample_name:"area_for_button"}});var u=function(){};t.View.extendTo(u,{base_tree:{sample_name:"preview_line"},expandBase:function(){this.setVisState("img_allowed",this.extended_viewing)},"compx-selected_title":{depends_on:["nav_title","nav_short_title"],fn:function(e,t){return t||e}}});var a=function(){};o.extendTo(a,{createBase:function(){this._super(),this.c.addClass("tag_artists-preview")},children_views:{lists_list:u},"collch-lists_list":"tpl.ancs.listc"});var f=function(){};t.View.extendTo(f,{"compx-lvmp_show":[["^vmp_show"],function(e){return e}],"compx-mp_show_end":{depends_on:["^mp_show_end"],fn:function(e){return e}}});var l=function(){};f.extendTo(l,{"stch-vmp_show":function(e,t){e.c.toggleClass("hidden",!t)},createBase:function(){this.c=n('<div class="usual_page"></div>')}});var c=function(){};u.extendTo(c,{extended_viewing:!0});var h=function(){};o.extendTo(h,{children_views:{preview_list:u},children_views_by_mn:{auth_part:{auth_block_lfm:r.LfmLoginView,auth_block_vk:s}},"stch-pmd_vswitched":function(e,t){e.c.toggleClass("access-request",t)},"collch-preview_list":{place:"tpl.ancs.listc",limit:9},"collch-auth_part":{place:"tpl.ancs.auth_con",by_model_name:!0}});var p=function(){};h.extendTo(p,{children_views:{preview_list:c}});var d=function(){};o.extendTo(d,{children_views:{preview_list:c,lists_list:u},"collch-preview_list":{place:"tpl.ancs.listc",limit:9}});var v=function(){};p.extendTo(v,{base_tree:{sample_name:"preview_area"}});var m=function(){};l.extendTo(m,{base_tree:{sample_name:"lilists"},children_views:{lists_list:h},"collch-lists_list":"tpl.ancs.lilists_con"});var g=function(){};l.extendTo(g,{base_tree:{sample_name:"lilists"},children_views:{lists_list:v},"collch-lists_list":"tpl.ancs.lilists_con"});var y=function(){};t.View.extendTo(y,{createBase:function(){this.c=n('<img class="album_preview" src=""/>')},"stch-selected_image":function(e,t){var n=t.lfm_id?"http://userserve-ak.last.fm/serve/126s/"+t.lfm_id:t.url;if(n){var r=e.c[0],i=e.root_view.loadImage({url:n,cache_allowed:!0}).done(function(){r.src=n}).fail(function(){});e.addRequest(i),e.on("die",function(){i.abort()})}else e.c.attr("src","")}});var b=t.View.extendTo(function(){},{"stch-selected_image":function(e,t){var n=t.lfm_id?"http://userserve-ak.last.fm/serve/126s/"+t.lfm_id:t.url;if(n){i(e,"queued_image$loading",!0);var r=e.root_view.loadImage({url:n,cache_allowed:!0}).done(function(){i(e,"queued_image",t)}).fail(function(){}).always(function(){i(e,"queued_image$loading",!1)});e.addRequest(r),e.on("die",function(){r.abort()})}else i(e,"queued_image",null)}}),w=function(){};t.View.extendTo(w,{base_tree:{sample_name:"alb_prev_big"},"stch-selected_image":function(e,t){var n=t.lfm_id?"http://userserve-ak.last.fm/serve/126s/"+t.lfm_id:t.url;if(n){var r=e.tpl.ancs.imgc[0],i=e.root_view.loadImage({url:n,cache_allowed:!0}).done(function(){r.src=n}).fail(function(){});e.addRequest(i),e.on("die",function(){i.abort()})}else e.tpl.ancs.imgc.attr("src","")}});var E=function(){};l.extendTo(E,{base_tree:{sample_name:"albums_page"},children_views:{preview_list:w},"collch-preview_list":"tpl.ancs.albums_list_c"});var S=function(){};d.extendTo(S,{createBase:function(){this._super(),this.tpl.ancs.listc.addClass("albums_previews")},children_views:{preview_list:y},"collch-preview_list":{place:"tpl.ancs.listc",limit:15}});var x=function(e,t){e.tpl.ancs.listc.empty();var r=document.createDocumentFragment();for(var i=0;i<t.length;i++)n(r).append(e.createTagLink(t[i].name)),n(r).append(document.createTextNode(" "));e.tpl.ancs.listc.append(r)},T=function(){};o.extendTo(T,{"stch-simple_tags_list":x,createTagLink:function(e){return n("<span></span>").text(e)}});var N=function(){};l.extendTo(N,{base_tree:{sample_name:"vk_posts_page"}});var C=function(){};return l.extendTo(C,{base_tree:{sample_name:"app-news"}}),{ImageLoader:b,ListPreview:o,LiListsPreview:a,ListPreviewLine:u,SPView:f,PageView:l,ArtistsListPreviewLine:c,ItemOfLL:d,SimpleListOfListsView:m,ListOfListsView:g,AlbumsListPreviewItem:y,BigAlbumPreview:w,AlbumsListView:E,AlbumsListPreview:S,TagsListPreview:T,ListSimplePreview:h,ImagedListPreview:p,VKPostsView:N,AppNewsView:C,SoftVkLoginUI:s}}),define("js/views/uacq",["pv","jquery","app_serv","./coct"],function(e,t,n,r){var i=n.localize,s=function(){};e.View.extendTo(s,{createBase:function(){this.c=t('<li class="people-list-item"></li>');var e=this.c;this.userphoto_c=t('<div class="people-image"></div>').appendTo(e),this.userphoto_img=t("<img/>").attr("src","https://vk.com/images/camera_b.gif").appendTo(this.userphoto_c),this.button_place=t('<div class="button-place-people-el"></div>').appendTo(e),this.link_place=t('<div class="p-link-place"></div>').appendTo(e)},"stch-user_photo":function(e,t){t&&e.userphoto_img.attr("src",t)},"stch-needs_accept_b":function(e,t){if(t){if(!e.button_c){var n=e.root_view.createNiceButton();n.b.text(i("accept-inv","Accept invite")),n.enable(),n.b.click(function(){e.RPCLegacy("acceptInvite")}),e.button_c=n.c,n.c.appendTo(e.button_place)}}else e.button_c&&e.button_c.remove()},"stch-userlink":function(e,n){n?(e.ulink||(e.ulink=t('<a class=""></a>').appendTo(e.link_place)),e.ulink.attr("href",n.href).text(n.text)):e.ulink&&e.ulink.remove()},"stch-after_accept_desc":function(e,n){n?(e.af_ac_desc||(e.af_ac_desc=t('<span class="desc"></span>').appendTo(e.link_place)),e.af_ac_desc.text(n)):e.af_ac_desc&&e.af_ac_desc.remove()}});var o=function(){};r.PageView.extendTo(o,{createBase:function(){this._super();var e=t('<div class="relations-invites-wrap"></div>').appendTo(this.c);t("<h3></h3>").text(i("rels-people-you")).appendTo(e),this.from_someone_c=t('<ul class="people-list people-l-wide"></ul>').appendTo(e);var n=t('<div class="relations-likes-wrap"></div>').appendTo(this.c);t("<h3></h3>").text(i("rels-you-people")).appendTo(n),this.from_me_c=t('<ul class="people-list people-l-wide"></ul>').appendTo(n)},children_views:{acqs_from_someone:{main:s},acqs_from_me:{main:s}},"collch-acqs_from_someone":"from_someone_c","collch-acqs_from_me":"from_me_c"});var u=function(){};e.View.extendTo(u,{dom_rp:!0,createBase:function(){this.c=t("<span></span>"),this.userimg=t("<img/>").attr("src","https://vk.com/images/camera_b.gif").appendTo(this.c),this.dom_related_props.push("userimg")},"stch-user_photo":function(e,t){t&&e.userimg.attr("src",t)}});var a=function(){};return e.View.extendTo(a,{dom_rp:!0,createBase:function(){this.c=t('<div class="user_acqes-preview"></div>'),this.sended_tome_c=t("<span></span>").appendTo(this.c);var e=this;this.c.click(function(){e.requestPage()}),this.acqs_frsmone_c=t("<span></span>").appendTo(this.c),this.acqs_frme_c=t("<span></span>").appendTo(this.c),this.dom_related_props.push("sended_tome_c","acqs_frsmone_c","acqs_frme_c")},children_views:{acqs_from_someone:{main:u},acqs_from_me:{main:u}},"collch-acqs_from_someone":"acqs_frsmone_c","collch-acqs_from_me":"acqs_frme_c"}),{UserAcquaintanceView:s,UserAcquaintancesListView:o,UserAcqPreview:u,UserAcquaintancesListPreview:a}}),define("js/views/UserCardPreview",["pv","jquery","app_serv","./uacq"],function(e,t,n,r){var i=function(){};return e.View.extendTo(i,{dom_rp:!0,createBase:function(){this.c=this.root_view.els.pestf_preview,this.aqc_preview_c=this.c.find(".aqc_preview");var e=this,t=this.c.find(".to-open-block").click(function(){e.requestPage()});this.addWayPoint(t),this.button=t,this.dom_related_props.push("button")},"stch-mp_show":function(e,t){e.button.toggleClass("button_selected",!!t)},children_views:{users_acqutes:{main:r.UserAcquaintancesListPreview}},"collch-users_acqutes":"aqc_preview_c"}),i}),define("js/views/StartPageView",["pv","spv","jquery","app_serv","./UserCardPreview","./coct"],function(e,t,n,r,i,s){var o=r.localize,u=function(){};return s.SPView.extendTo(u,{createDetails:function(){this.els=this.root_view.els,this.c=this.els.start_screen,this.createTemplate(),this.addWayPoint(this.tpl.ancs["hint-query"],{});var e=this,t=function(t){t&&e.nextLocalTick(e.tickCheckFocus)};this.on("state_change-autofocus",function(e){t(e.value)},{immediately:!0})},tickCheckFocus:function(){this.isAlive()&&(this.root_view.search_input[0].focus(),this.root_view.search_input[0].select())},"collch-muco":!0,"collch-pstuff":!0,"collch-tags":!0,children_views:{pstuff:{main:i},tags:s.ListPreview},"compx-autofocus":{depends_on:["mp_show_end","mp_has_focus"],fn:function(e,t){return t&&e}},state_change:{can_expand:function(e,t){t&&e.requirePart("start-page-blocks")},"ask-rating-help":function(e,r){if(r){var i=e.tpl.ancs["start-page-messages"];e.message_arh_c=n('<div class="attention-message"></div>'),n("<a class='close-message'>×</a>").appendTo(e.message_arh_c).click(function(){e.RPCLegacy("closeMessage","rating-help")}),n('<img class="message-image"/>').attr({src:"http://cs9767.userapi.com/u198193/b_b379d470.jpg",width:100,height:126,alt:"Gleb Arestov"}).appendTo(e.message_arh_c);var s=n("<a class='external'></a>").attr("href",r).text(o("at-this-page"));e.message_arh_c.append(t.createComlexText(o("ask-rating-help")).setVar("app_url",s[0])),i.append(e.message_arh_c)}else e.message_arh_c&&e.message_arh_c.remove()}},parts_builder:{"start-page-blocks":function(){return!0}}}),u}),define("js/views/SearchPageView",["pv"],function(e){"use strict";var t=function(){};return e.View.extendTo(t,{base_tree:{sample_name:"search_results-container"}}),t}),define("js/views/modules/Panoramator",["jquery"],function(e){var t=document.body.style,n;["transform","-o-transform","-webkit-transform","-moz-transform"].forEach(function(e){!n&&e in t&&(n=e)});var r,i,s,o=/(px)|\(|\)/gi,u,a=function(e){u=e};r=function(t){if(typeof u=="undefined"){var n=e(t).css("margin-left");u=parseFloat(n.replace(o,""))}return u},i=function(e,t){u=t,e.css("margin-left",t+"px")},s=function(e,t,n){e.animate({"margin-left":t+"px"},{step:a,duration:n})};var f=function(e,t){this.cpos=e,this.time=t},l=function(e){this.total_width=null,this.viewport_width=null,this.lift_items=[],this.onUseEnd=null,e.onUseEnd&&(this.onUseEnd=e.onUseEnd),this.getFastLiftWidth=null,e.getFastLiftWidth&&(this.getFastLiftWidth=e.getFastLiftWidth);var t=this;this.viewport=e.viewport,this.viewport.on("mousedown",function(e){if(e.which&&e.which!=1)return!0;t.refreshLiftWidth(),e.preventDefault(),t.handleUserStart(e)}),this.improved_con=e.improved_con,this.lift=e.lift,this.mouseMove=function(e){if(e.which&&e.which!=1)return!0;t.cursorMove(e)},this.mouseUp=function(e){if(e.which&&e.which!=1)return!0;t.handleUserEnd(e)},this.path_points=[],this.move_star_lift_pos=null};return l.prototype={constructor:l,limit_difficult:3,mininmal_speed:.5,normal_speed:.7,standart_animation_time:150,getMoveData:function(e){if(e>0||this.total_width<this.viewport_width)return{main:0,above_limit:e};var t=this.total_width-this.viewport_width;return-e>t?{main:-t,above_limit:t+e}:{main:e,above_limit:0}},cursorMove:function(e){this.path_points.push(new f(e.pageX,e.timeStamp));var t=this.path_points[0].cpos-e.pageX,n=-this.move_star_lift_pos-t,r=this.getMoveData(n);i(this.lift,r.main+r.above_limit/this.limit_difficult)},checkVectorAndSpeed:function(){var e=this.path_points[0],t=this.path_points[this.path_points.length-1],n=t.cpos-e.cpos,r=n/(t.time-e.time);if(Math.abs(n)>5)return Math.abs(r)>this.mininmal_speed?r>0?!this.prev(r):!this.next(r):!0;var i=0;for(var s=1;s<this.path_points.length;s++)i+=Math.abs(this.path_points[s].cpos-this.path_points[s-1].cpos);if(i>5)return!0;var o=this.viewport.offset().left,u=t.cpos-o;u=this.viewport_width/2-u;var a=u*(1/(this.viewport_width/2));return a>0?this.prev(!1,300-220*Math.abs(a)):a<0&&this.next(!1,300-220*Math.abs(a)),!0},handleUserEnd:function(t){var n=this.path_points[0].cpos-this.path_points[this.path_points.length-1].cpos,r=-this.move_star_lift_pos-n;this.path_points.push(new f(t.pageX,t.timeStamp));if(this.checkVectorAndSpeed()){var i=this.getMoveData(r);i.above_limit&&s(this.lift,i.main,this.standart_animation_time)}e(this.viewport[0].ownerDocument).off("mouseup",this.mouseUp).off("mousemove",this.mouseMove),this.viewport.removeClass("touching-this"),this.onUseEnd&&this.onUseEnd(),this.path_points.length=0},handleUserStart:function(t){this.lift.stop(),this.move_star_lift_pos=this.getLiftPos(),this.path_points.push(new f(t.pageX,t.timeStamp)),this.viewport.addClass("touching-this"),e(this.viewport[0].ownerDocument).on("mousemove",this.mouseMove).on("mouseup",this.mouseUp)},setCollection:function(e,t){this.lift_items=e,!t&&!this.improved_con},checkViewportWidth:function(){return this.viewport.width()},checkTotalWidth:function(){if(this.improved_con)return this.lift[0].scrollWidth;var t=0;return e.each(this.lift_items,function(n,r){t+=e(r).outerWidth(!0)}),t},refreshLiftWidth:function(){this.getFastLiftWidth?this.setTotalWidth(this.getFastLiftWidth()):this.setTotalWidth(this.checkTotalWidth())},setTotalWidth:function(e){if(this.total_width==e)return;this.total_width=e,this.improved_con||this.lift.css({width:this.total_width+"px"})},setViewportWidth:function(e){this.viewport_width=e},checkSize:function(){this.setViewportWidth(this.checkViewportWidth())},isEdgeElem:function(t,n,r){var i=e(t),s=i.position().left,o=i.outerWidth();if(r?s+o>this.viewport_width+n:s<n)return{el:i,left:s,owidth:o}},getTargetPos:function(e,t){var n=-e.left+(this.viewport_width-e.owidth)/2;return t?Math.max(n,-(this.total_width-this.viewport_width)):Math.min(n,0)},getBestLiftPos:function(){},setBestLiftPos:function(){},getLiftPos:function(){return-r(this.lift)||0},toStart:function(){},toEnd:function(){},getNextEdgeElem:function(e){var t;for(var n=0;n<this.lift_items.length;n++){t=this.isEdgeElem(this.lift_items[n],e,!0);if(t)break}return t},getPrevEdgeElem:function(e){var t;for(var n=this.lift_items.length-1;n>=0;n--){t=this.isEdgeElem(this.lift_items[n],e);if(t)break}return t},getAnimationTime:function(e,t,n){return(e-t)/(n*1.5)},next:function(e,t){this.lift.stop(!1,!0);var n=this.getLiftPos(),r=this.getNextEdgeElem(n);if(r){var i=this.getTargetPos(r,!0);return s(this.lift,i,e?this.getAnimationTime(i,-n,e):t||this.standart_animation_time),!0}return!1},prev:function(e,t){this.lift.stop(!1,!0);var n=this.getLiftPos(),r=this.getPrevEdgeElem(n);if(r){var i=this.getTargetPos(r);return s(this.lift,i,e?this.getAnimationTime(i,-n,e):t||this.standart_animation_time),!0}return!1}},l}),define("js/views/ArtcardUI",["pv","jquery","./coct","app_serv","view_serv","./modules/Panoramator","spv"],function(e,t,n,r,i,s,o){var u=r.localize,a=r.app_env,f=function(){};e.View.extendTo(f,{die:function(){this._super()},children_views:{albums_list:n.AlbumsListPreview,dgs_albums:n.AlbumsListPreview},state_change:{selected_image:function(e,n){if(!n)return;var r=n.lfm_id?"http://userserve-ak.last.fm/serve/500/"+n.lfm_id:n.url;r&&(e.tpl.ancs.bigimagec.empty(),e.tpl.ancs.bigimagec.append(t("<img/>").attr("src",r)))},bio:function(e,n){if(n){var r=document.createElement("div");r.innerHTML=n.replace(/([^\n])\n+/gi,"$1<br/><br/>"),t(r).find("script").remove(),e.tpl.ancs.bio.empty().append(r),e.root_view.bindLfmTextClicks(e.tpl.ancs.bio)}}},base_tree:{sample_name:"artcard"}});var l=o.getSortFunc(["num"]),c=function(){};e.View.extendTo(c,{bindBase:function(){},tpl_r_events:{preview_list:{showTag:function(e,t,n){e.preventDefault(),this.RPCLegacy("showTag",n.tag.name)}}}});var h=function(){};e.View.extendTo(h,{tpl_r_events:{similars:{showArtcardPage:function(e,t,n){e.preventDefault(),this.RPCLegacy("showArtcardPage",n.artist.name)}}}});var p=function(){};return e.View.extendTo(p,{dom_rp:!0,children_views:{tags_list:c,similar_artists:h},bindBase:function(){this.photo_data={},this.dom_related_props.push("photo_data")},"compx-parent_vmp_show":[["^vmp_show"],function(e){return e}],"stch-parent_vmp_show":function(e,t){t||e.setVisState("wamo_info",!1)},"compx-infb_text":{depends_on:["artist_name","playcount","listeners","bio"],fn:function(e,t,n,r){if(!e)return;if(t||n||r)return u("more-ab-info").replace("%s",e)}},"compx-usable_artist_image":{depends_on:["selected_image","vis_cool_photos"],fn:function(e,t){if(!t){var n="";return a.opera_widget&&(n="?somer="+Math.random()),!!e&&e+n}return!1}},"stch-bio":function(e,n){var r=e.tpl.ancs.artbio;if(!r)return;if(n){var i=document.createElement("div");i.innerHTML=t.trim(n).replace(/([^\n])\n+/gi,"$1<br/><br/>"),t(i).find("script").remove(),r.empty().append(i),e.root_view.bindLfmTextClicks(r)}},"compx-pvm_key":{depends_on:["^mp_show_end","mp_has_focus"],fn:function(e,t){if(e)return t?1:2}},getPamoramaWidth:function(){return this.img_panorama.checkViewportWidth()},"stch-key-panorama_width":function(t,n){n&&e.update(t,"panorama_width",t.getBoxDemensionByKey(t.getPamoramaWidth,n))},"compx-key-panorama_width":[["panorama","#workarea_width","pvm_key"],function(e,t,n){if(e&&n)return this.getBoxDemensionKey("panorama_width",t,n)}],"stch-panorama_width":function(e,t){t&&e.img_panorama&&e.img_panorama.setViewportWidth(t)},getPamoramaLiftWidth:function(){return this.img_panorama.checkTotalWidth()},getFastPamoramaLiftWidth:function(){return this.getBoxDemensionByKey(this.getPamoramaLiftWidth,this.state("panorama_lift_width_key"))},"compx-panorama_lift_width_key":{depends_on:["panorama","artist_name","images_combination","#window_height","pvm_key"],fn:function(e,t,n,r,i){if(!e||!t||!n||!i)return;return this.getBoxDemensionKey("panorama_lift_width",t,r,i,n)}},img_sample:t('<img class="artist_image hidden" alt=""/>'),updatePanoramaIMGs:function(t,n,r){r.setCollection(t,!0),e.update(this,"images_combination",n)},"stch-images":function(n,r){if(!r||!r.length)return;var u=n.tpl.ancs.phocoli;if(!u)return;var a=function(e){e===0&&(n.tpl.ancs["first-image"].remove(),n.tpl.ancs["first-image"]=null)},f=function(){return n.isAlive()},c=n.root_view.lfm_imgq;r=o.toRealArray(r),n.setVisState("cool_photos",!0),n.photo_data.cool_photos=r,n.dom_related_props.push("img_panorama");if(r.length){var h=document.createDocumentFragment();n.img_requests=[];var p=n.img_requests,d=u.parent();n.img_panorama=new s({viewport:d,lift:u,improved_con:!0,getFastLiftWidth:function(){return n.getFastPamoramaLiftWidth()},onUseEnd:function(){n.root_view.trackEvent("Panoramator","artist photos")}}),e.update(n,"panorama",!0);var v=[],m=o.debounce(function(){v.sort(l);var e=o.filter(v,"num").join("_");n.nextLocalTick(n.updatePanoramaIMGs,[o.filter(v,"item"),e,n.img_panorama])},100),g=function(e,t){var r=o.toRealArray(e.sizes.size),s=n.img_sample.clone(),u=(r[5]||r[0])["#text"],l=i.loadImage({url:u,timeout:4e4,queue:c,cache_allowed:!0}).done(function(){if(!f())return;s[0].src=u,a(t),s.removeClass("hidden"),v.push({num:t,item:s}),m()}).fail(function(){s.remove()});return h.appendChild(s[0]),l};r[0]&&p.push(g(r[0],0)),t.each(r.slice(1,10),function(e,t){p.push(g(t,e+1))}),u.append(h),d.addClass("loading-images");for(var y=0;y<p.length;y++)n.addRequest(p[y],{order:p.length-y+1});t.when.apply(t,p).always(function(){if(!f())return;d.removeClass("loading-images")})}},tpl_events:{showMoreInfo:function(e){var t=this.state("vis_wamo_info");this.setVisState("wamo_info",!t),e.preventDefault()}}}),f.ArtistInSongConstroller=p,f}),define("js/views/ArtistListView",["pv","jquery"],function(e){var t=function(){};return e.View.extendTo(t,{base_tree:{sample_name:"artists_list"}}),t}),define("js/views/SongActTaggingControl",["./etc_views","jquery","app_serv","spv","pv"],function(e,t,n,r,i){var s=function(e,t,n){e.preventDefault(),this.RPCLegacy("addTag",n.tag.name||n.tag)},o=function(){};e.LfmLoginView.extendTo(o,{createBase:function(){this._super();var e=this.root_view.getSample("song-act-tagging");this.tpl=this.createTemplate(e),this.c.append(e)},tpl_r_events:{petags_result:{addTag:s},toptags:{addTag:s},artist_tags:{addTag:s}},tpl_events:{changeTags:r.debounce(function(e,t){var n=t.value;this.overrideStateSilently("user_tags_string",n),this.RPCLegacy("changeTags",n)})},"stch-user_tags_string":function(e,t){e.tpl.ancs["tags-input"].val(t)},"stch-has_session":function(e,t){t=!!t,e.c.toggleClass("has_session",t),e.auth_block.toggleClass("hidden",t)}});var u=function(){};return i.View.extendTo(u,{children_views:{lfm_tagsong:o},"collch-$ondemand-lfm_tagsong":{place:"c",needs_expand_state:"active_view"}}),u}),define("js/views/SongActionsRowUI",["pv","jquery","spv","app_serv","./etc_views","./SongActTaggingControl"],function(e,t,n,r,i,s){var o=r.localize,u=e.update,a=function(){};e.View.extendTo(a,{base_tree:{sample_name:"song_acting_playlist_add"}});var f=function(){};e.View.extendTo(f,{toggleVisState:function(e,t){var n;typeof t=="undefined"?n=!this.state("vis_"+e):n=!!t,this.setVisState(e,n)},toggleVisStateTPL:function(e,t,n){var r=n[2];this.toggleVisState(n[1],r)},tpl_events:{requestFullView:function(){this.toggleVisState("full_view_mode",!0)},toggleVisState:function(e,t,n){this.toggleVisStateTPL(e,t,n)}}});var l=function(){};f.extendTo(l,{children_views:{vk_auth:i.VkLoginUI},"stch-needs_vk_auth":function(e,t){t&&(e.tpl.ancs.vk_auth.append(e.getAFreeCV("vk_auth")),e.requestAll())}});var c=function(){};f.extendTo(c,{});var h=function(){};e.View.extendTo(h,{children_views:{lfm_auth:i.LfmLoginView},children_views_by_mn:{section:{"section-vk-users":l,"section-lfm-friends":c}},"collch-lfm_auth":"tpl.ancs.lfm_auth_con"});var p=function(){};e.View.extendTo(p,{dom_rp:!0,children_views:{searcher:h},bindBase:function(){var e,t=this,r=n.debounce(function(){var n=this.value;e!==n&&(t.RPCLegacy("search",n),e=n)},100);this.tpl.ancs.vk_share_search.bind("keyup change search mousemove",r),this.tpl.ancs.share_input.bind("click focus",function(){this.select()})},focusToInput:function(){this.tpl.ancs.share_input[0].focus()},"stch-active_view":function(e,t){t&&e.expand&&e.expand(),t&&e.nextLocalTick(e.focusToInput)},expand:function(){if(this.expanded)return;this.expanded=!0}});var d=function(){};e.View.extendTo(d,{"compx-need_creation_button":{depends_on:["query","has_full_match"],fn:function(e,t){return e&&!t}},tpl_events:{input_search:n.debounce(function(e,t){this.RPCLegacy("search",t.value)},100)}});var v=function(){};e.View.extendTo(v,{children_views:{lfm_loveit:i.LfmLoveItView},"collch-$ondemand-lfm_loveit":{place:"c",needs_expand_state:"active_view"}});var m=function(){};e.View.extendTo(m,{children_views:{lfm_scrobble:i.LfmScrobbleView},"collch-$ondemand-lfm_scrobble":{place:"c",needs_expand_state:"active_view"}});var g=function(){};return i.ActionsRowUI.extendTo(g,{dom_rp:!0,bindBase:function(){this._super(),this.createVolumeControl(),this.wch(this.parent_view,"mp_show_end",function(e){this.setVisState("is_visible",!!e.value)})},"compx-p_mpshe":[["^mp_show_end"],function(e){return e}],children_views_by_mn:{context_parts:{"row-lastfm":m,"row-love":v,"row-share":p,"row-tag":s,"row-playlist-add":d}},getVHoleWidth:function(){return this.tpl.ancs["v-hole"].width()},getVBarOuterWidth:function(){return this.tpl.ancs["v-bar"].outerWidth()},getVBarWidth:function(){return this.tpl.ancs["v-bar"].width()},"stch-key_vol_hole_w":function(e,t){t&&u(e,"vis_volume-hole-width",e.getBoxDemensionByKey(e.getVHoleWidth,t))},"stch-vis_volume-hole-width":function(e,t){t&&e.updateManyStates({"v-bar-o-width":e.getBoxDemension(e.getVBarOuterWidth,"v-bar-o-width"),"v-bar-width":e.getBoxDemension(e.getVBarWidth,"v-bar-width")})},complex_states:{key_vol_hole_w:[["vis_is_visible","vis_con_appended"],function(e,t){if(e&&t)return this.getBoxDemensionKey("volume-hole-width")}],"vis_volume-bar-max-width":{depends_on:["vis_volume-hole-width","v-bar-o-width","v-bar-width"],fn:function(e,t,n){if(e)return e-(t-n)}},vis_volume:{depends_on:["volume","vis_volume-bar-max-width"],fn:function(e,t){return typeof e=="undefined"?"auto":t?Math.floor(e*t)+"px":e*100+"%"}}},createVolumeControl:function(){this.vol_cc=this.tpl.ancs["volume-control"];var e=this.vol_cc,n=this.tpl.ancs["v-hole"];this.dom_related_props.push("vol_cc","tpl");var r=this,i=function(e,n){var r=e.pageX-t(n).offset().left;return r},s,o=function(){var e=s[s.length-1],t=r.state("vis_volume-hole-width");t||console.log("no width :!((");var n=Math.min(t,Math.max(0,e.cpos));r.promiseStateUpdate("volume",n/t),r.RPCLegacy("setVolume",[n,t])},u=function(t){s=[],t.preventDefault(),s.push({cpos:i(t,n),time:t.timeStamp}),o(),e.addClass("interactive-state")},a=function(e){if(e.which&&e.which!=1)return!0;e.preventDefault(),s.push({cpos:i(e,n),time:e.timeStamp}),o()},f=function(n){if(n.which&&n.which!=1)return!0;t(e[0].ownerDocument).off("mouseup",f).off("mousemove",a);var r;!r,e.removeClass("interactive-state"),s=null};e.on("mousedown",function(n){t(e[0].ownerDocument).off("mouseup",f).off("mousemove",a);if(n.which&&n.which!=1)return!0;t(e[0].ownerDocument).on("mouseup",f).on("mousemove",a),u(n)})}}),g}),define("js/views/MfCorUI",["pv","jquery","spv","./etc_views"],function(e,t,n,r){"use strict";var i=e.update,s=function(){};e.View.extendTo(s,{createBase:function(){this.c=t('<span class="notifier hidden"></span>')},state_change:{counter:function(e,t){e.c.toggleClass("hidden",!t)}}});var o=document.createElement("li"),u=function(){};e.View.extendTo(u,{"stch-infoHash":function(e,t){e.c.text(t)},createBase:function(){this.c=t(o.cloneNode())}});var a=function(){};e.View.extendTo(a,{state_change:{"download-pressed":function(e,t){t&&e.downloadlink.addClass("download-pressed")},overstock:function(e,t){t?e.c.addClass("overstocked"):e.c.removeClass("overstocked")},full_title:function(e,t){e.f_text.text(t)},torrent_link:function(e,t){e.downloadlink.attr("href",t)}},createBase:function(){var e=this;this.c=t("<li></li>"),t('<span class="play-button-place"></span>').appendTo(this.c);var n=t('<span class="mf-progress"></span>');this.f_text=t('<span class="mf-text"></span>').appendTo(n),this.downloadlink=t('<a class="external download-song-link"></a>').click(function(t){t.stopPropagation(),t.preventDefault(),e.RPCLegacy("download")}).text("torrent").appendTo(this.c),this.addWayPoint(this.downloadlink,{}),n.appendTo(this.c)}});var f=function(){};e.View.extendTo(f,{dom_rp:!0,getProgressWidth:function(){return this.tpl.ancs.progress_c.width()},"stch-key-progress-c-width":function(e,t){t?i(e,"vis_progress-c-width",e.getBoxDemensionByKey(e.getProgressWidth,t)):i(e,"vis_progress-c-width",0)},complex_states:{"can-progress":{depends_on:["^^vis_is_visible","vis_con_appended","selected"],fn:function(e,t,n){var r=e&&t&&n;return r}},vis_wp_usable:{depends_on:["overstock","^^want_more_songs","^show_overstocked"],fn:function(e,t,n){return e?t&&n:t}},"key-progress-c-width":[["can-progress","^^want_more_songs","#workarea_width","^^must_be_expandable"],function(e,t,n,r){return e?this.getBoxDemensionKey("progress_c-width",n,!!t,!!r):!1}],vis_loading_p:{depends_on:["vis_progress-c-width","loading_progress"],fn:function(e,t){return t?e?Math.floor(t*e)+"px":t*100+"%":"auto"}},vis_playing_p:{depends_on:["vis_progress-c-width","playing_progress"],fn:function(e,t){return t?e?Math.floor(t*e)+"px":t*100+"%":"auto"}}},base_tree:{sample_name:"song-file"},expandBase:function(){var e=this.tpl.ancs.progress_c,n=this,r,i=function(){var e=r[r.length-1],t=n.state("vis_progress-c-width");t||console.log("no width for pb :!(("),t&&n.RPCLegacy("setPositionByFactor",[e.cpos,t])},s=function(e,n){var r=e.pageX-t(n).offset().left;return r},o=function(t){r=[],t.preventDefault(),r.push({cpos:s(t,e[0]),time:t.timeStamp}),i()},u=function(t){if(!n.state("selected"))return!0;if(t.which&&t.which!=1)return!0;t.preventDefault(),r.push({cpos:s(t,e[0]),time:t.timeStamp}),i()},a=function(i){if(!n.state("selected"))return!0;if(i.which&&i.which!=1)return!0;t(e[0].ownerDocument).off("mouseup",a).off("mousemove",u);var s;!s,r=null};e.on("mousedown",function(r){t(e[0].ownerDocument).off("mouseup",a).off("mousemove",u);if(!n.state("selected"))return!0;if(r.which&&r.which!=1)return!0;t(e[0].ownerDocument).on("mouseup",a).on("mousemove",u),o(r)})},tpl_events:{selectFile:function(){this.state("selected")||this.RPCLegacy("requestPlay",e.$v.getBwlevId(this))},switchPlay:function(t){t.stopPropagation(),this.RPCLegacy("switchPlay",e.$v.getBwlevId(this))}}});var l=function(){};e.View.extendTo(l,{tpl_events:{changeTune:function(e,t){var n=t.name;this.overrideStateSilently(n,t.checked),this.RPCLegacy("changeTune",n,t.checked)}}});var c=function(){};e.View.extendTo(c,{children_views:{vis_tuner:l}});var h=function(){};e.View.extendTo(h,{children_views:{pioneer:c},children_views_by_mn:{moplas_list_start:{"file-torrent-promise":u,"file-torrent":a,"file-http":f},moplas_list_end:{"file-torrent-promise":u,"file-torrent":a,"file-http":f}},"collch-moplas_list_start":{place:"tpl.ancs.listc-start",by_model_name:!0},"collch-moplas_list_end":{place:"tpl.ancs.listc-end",by_model_name:!0}});var p=function(){};return e.View.extendTo(p,{children_views:{notifier:s,vk_auth:r.VkLoginUI,sorted_completcs:h},"collch-vk_auth":{place:"tpl.ancs.messages_c",strict:!0},"compx-vis_is_visible":{depends_on:["^^^mp_show_end"],fn:function(e){return!!e}}}),p}),define("js/views/SongcardPage",["pv","./etc_views","app_serv","jquery","spv","./ArtcardUI","./coct"],function(e,t,n,r,i,s,o){var u=n.localize,a=e.update,f=function(){};o.SPView.extendTo(f,{base_tree:{sample_name:"songcard_page",children_by_selector:[{sample_name:"artist_preview-base",selector:".nested_artist",children_by_selector:[{sample_name:"photo-cont",selector:".possible_images_con"}]}]},children_views:{fans:o.ImagedListPreview,cloudcasts:o.ImagedListPreview,artist:s.ArtistInSongConstroller}});var l=function(){};e.View.extendTo(l,{"compx-can_use_image":{depends_on:["vis_image_loaded","selected_image"],fn:function(e,t){return!!e&&!!t}},"stch-selected_image":function(e,t){var n=e.tpl.ancs["user-image"];n.src="";if(t){var r=t.lfm_id?"http://userserve-ak.last.fm/serve/64s/"+t.lfm_id:t.url;if(r.lastIndexOf(".gif")==r.length-4)return;var i=e.root_view.loadImage({url:r,cache_allowed:!0}).done(function(){n[0].src=r,e.setVisState("image_loaded",!0)});e.addRequest(i)}}});var c=function(){};e.View.extendTo(c,{children_views:{list_items:l}});var h=e.View.extendTo(function(){},{children_views:{auth_part:o.SoftVkLoginUI},"collch-auth_part":{place:"tpl.ancs.auth_con"}}),p=function(){};return e.View.extendTo(p,{dom_rp:!0,children_views:{artist:s.ArtistInSongConstroller,fans:c,selected:h},"compx-disallow_seesu_listeners":[["#disallow_seesu_listeners"],function(e){return e}],"compx-can_expand_listeners":[["^vmp_show","artist_name","track_name","disallow_seesu_listeners","expanded"],function(e,t,n,r,i){return e&&t&&n&&i&&!r}]}),f.SongcardController=p,f}),define("js/views/SongUI",["pv","spv","jquery","app_serv","./SongActionsRowUI","./MfCorUI","./ArtcardUI","./SongcardPage","./coct"],function(e,t,n,r,i,s,o,u,a){var f=function(){};a.SPView.extendTo(f,{"compx-vmp_show":[["^^vmp_show","bmp_show","^^map_level_num"],function(e,t,n){return t&&t[n+1]&&e}],tpl_events:{showSong:function(t){t.preventDefault(),this.expand&&this.expand(),this.RPCLegacy("requestPlay",e.$v.getBwlevId(this)),this.requestPage()}}});var l=function(){};f.extendTo(l,{canUseDeepWaypoints:function(){return!!this.state("vmp_show")},dom_rp:!0,state_change:{vmp_show:function(e,t,n){t?e.activate():n&&e.deactivate()}},"compx-mp_show_end":[["^mp_show_end"]],"compx-must_expand":[["can_expand","vmp_show","vis_can_expand"],function(e,t,n){return e||t||n}],deactivate:function(){var e=this.getMdChild("actionsrow");e&&e.hideAll(),this.getMdChild("mf_cor").collapseExpanders()},children_views:{actionsrow:i,mf_cor:s,artist:o.ArtistInSongConstroller,songcard:u.SongcardController},activate:function(){},parts_builder:{context:"track-context",mf_cor_con:function(){var e=this.requirePart("context"),t=n("<div></div>");return e.prepend(t),t}},base_tree:{sample_name:"song-view"}});var c=function(){};return f.extendTo(c,{canUseDeepWaypoints:function(){return!1},expandBase:function(){this.setVisState("lite_view",!0)},base_tree:{sample_name:"song-view"}}),l.SongViewLite=c,l}),define("js/views/SongsListView",["pv","jquery","./SongUI","./etc_views","./coct"],function(e,t,n,r,i){"use strict";var s=function(){};e.View.extendTo(s,{"stch-dont_rept_pl":function(e,t){e.dont_rept_pl_chbx.prop("checked",!!t)},bindBase:function(){var e=this;this.dont_rept_pl_chbx=this.tpl.ancs["dont-rept-pl"].click(function(){e.RPCLegacy("setDnRp",t(this).prop("checked"))})}});var o=function(){};r.ActionsRowUI.extendTo(o,{canUseWaypoints:function(){return this.parent_view.state("mp_has_focus")},children_views_by_mn:{context_parts:{"row-multiatcs":e.View,"row-pl-settings":s}}});var u=function(){};i.SPView.extendTo(u,{"collch-songs-list":{place:"tpl.ancs.lc",space:"main"},"coll-prio-songs-list":function(e){var t=[],n=[],r=[];for(var i=e.length-1;i>=0;i--){var s=e[i],o=s.states;o.mp_show||o.mpl_attached?t.push(s):o.marked_as?n.push(s):o.player_song&&r.push(s)}var u=[];return t.length&&u.push(t),n.length&&u.push(n),r.length&&u.push(r),u}});var a=function(){};u.extendTo(a,{base_tree:{sample_name:"playlist-container"},children_views:{plarow:o,"songs-list":n.SongViewLite},expandBase:function(){this.setVisState("overview",!0)}});var f=function(){};return u.extendTo(f,{base_tree:{sample_name:"playlist-container"},children_views:{plarow:o,"songs-list":n}}),a.SongsListDetailedView=f,a}),define("js/views/UserCardPage",["pv","jquery","./coct","./uacq","env"],function(e,t,n,r,i){var s=i,o=function(){};n.PageView.extendTo(o,{base_tree:{sample_name:"user_page"},children_views:{users_acqutes:r.UserAcquaintancesListPreview},"collch-users_acqutes":"tpl.ancs.users_acqutes"});var u=function(){};e.View.extendTo(u,{base_tree:{sample_name:"lfm_user_page"},children_views:{}});var a=function(){};e.View.extendTo(a,{base_tree:{sample_name:"vk_user_page"},children_views:{}});var f=function(){};e.View.extendTo(f,{tpl_events:{open_link:function(e,n){e.preventDefault(),e.stopPropagation(),s.openURL(t(n).attr("href")),this.root_view.trackEvent("Links","just link")}}});var l=function(){};return e.View.extendTo(l,{base_tree:{sample_name:"vk_users_page"},children_views:{list_items:f}}),o.LfmUsercardPageView=u,o.VkUsercardPageView=a,o.VkUsersPageView=l,o}),define("js/views/MusicConductorPage",["./coct"],function(e){var t=function(){};return e.PageView.extendTo(t,{base_tree:{sample_name:"music_conductor_page"}}),t}),define("js/views/TagPageView",["pv","./coct","jquery"],function(e,t,n){var r=function(){};t.PageView.extendTo(r,{base_tree:{sample_name:"tag_page"},children_views:{albums_list:t.AlbumsListPreview}});var i=function(){};return t.PageView.extendTo(i,{base_tree:{sample_name:"tags_list_page"}}),r.TagsListPage=i,r}),define("js/views/YoutubeVideoView",["pv","jquery","./coct"],function(e,t,n){var r=function(){};return n.PageView.extendTo(r,{full_page:!0,createBase:function(){this.c=t('<div class="youtube-video-page"></div>')},"stch-yt_id":function(e,n){t(e.root_view.create_youtube_video(n)).appendTo(e.c)}}),r}),define("js/views/lul",["pv","./coct","env","jquery"],function(e,t,n,r){var i=n,s=function(){};e.View.extendTo(s,{base_tree:{sample_name:"lula_page"},children_views:{all_time:t.ImagedListPreview}});var o=function(){};e.View.extendTo(o,{base_tree:{sample_name:"lulas_page"}});var u=function(){};e.View.extendTo(u,{base_tree:{sample_name:"user_tags_page"}});var a=function(){};e.View.extendTo(a,{tpl_events:{open_link:function(e,t){e.preventDefault(),e.stopPropagation(),i.openURL(r(t).attr("href")),this.root_view.trackEvent("Links","just link")}}});var f=function(){};return e.View.extendTo(f,{base_tree:{sample_name:"lfm_users_page"},children_views:{list_items:a}}),{LULAPageVIew:s,LULAsPageVIew:o,UserTagsPageView:u,LfmUsersPageView:f}}),define("js/views/modules/filters",[],function(){var e={limitTo:function(e,t){return Array.isArray(e)?e.slice(0,t):typeof e=="string"?t?t>=0?e.slice(0,t):e.slice(t,e.length):"":e},notGIF:function(e){if(e.lastIndexOf(".gif")==e.length-4)return;return e}};return e}),define("js/views/modules/getUsageTree",["spv"],function(e){var t=function(){return{basetree:null,states:{stch:[],compx_deps:[],deep_compx_deps:[]},constr_children:{children:{},children_by_mn:{}},tree_children:{},m_children:{},merged_states:[],base_from_parent:null,base_root_constr_id:null,collch_selectors:{},collch_dclrs:{}}},n=function(e,t,n,r,i){var s=["children",t,n];r[s.join("{}")]||i.push(s)},r=function(e,t,n,r,i,s){var o=["children_by_mn",t,n,r];i[o.join("{}")]||s.push(o)},i=function(e,t,n,r){for(var i in e)for(var s in e[i])t(e[i][s],i,s,n,r)},s=function(e,t,n,r){for(var i in e)for(var s in e[i])for(var o in e[i][s])t(e[i][s][o],i,s,o,n,r)},o=function(u,a,f){var l=a,c={},h=[];l&&(l.children&&i(l.children,n,c,h),l.children_by_mn&&s(l.children_by_mn,r,c,h)),a&&a.states&&(u.merged_states=e.collapseAll(u.merged_states,a.states));for(var p=0;p<h.length;p++){var d=h[p],v=u.basetree?e.getTargetField(u.basetree,d):a&&e.getTargetField(a,d),m=t();e.setTargetField(u.tree_children,d,m),e.setTargetField(u.m_children,d,m),o(m,v,f),m.base_from_parent=v,m.base_root_constr_id=f,!f}},u=function(u,a,f,l){u=u||this.getUsageTree;var c=t();for(var h in this.dclrs_fpckgs){var p=this.dclrs_fpckgs[h];p.solving&&(c.collch_dclrs[h]=p.solving)}c.collch_selectors=this.dclrs_selectors||null;var d=Array.prototype.push;c.states.stch=function(){return this.stch_hs_list&&this.stch_hs_list.slice()||[]}.call(this),c.states.compx_deps=function(){if(!this.full_comlxs_list)return[];var t=[],n=[];for(var r=0;r<this.full_comlxs_list.length;r++)d.apply(t,this.full_comlxs_list[r].depends_on),n.push(this.full_comlxs_list[r].name);return e.collapseAll(e.arrayExclude(t,n))}.call(this),c.merged_states=e.collapseAll(c.states.stch,c.states.compx_deps),c.basetree=function(){if(this.base_tree_list){var t,n,r=[];for(t=0;t<this.base_tree_list.length;t++){n=this.base_tree_list[t];var i=n.sample_name;!i&&n.part_name&&typeof this.parts_builder[n.part_name]=="string"&&(i=this.parts_builder[n.part_name]);if(!i)throw new Error("can't get sampler");var s=a.getSampler(i),o=s.getStructure(n.parse_as_tplpart);r.push(o)}var u={node_id:null,children:null,children_by_mn:null,states:null},f=function(t,n,r){var i=e.getTargetField(t,n);i||e.setTargetField(t,n,r)},l,c,h,p,v=[];for(t=0;t<r.length;t++){n=r[t],v.push(n.node_id),n.states&&(u.states||(u.states=[]),d.apply(u.states,n.states));if(n.children){u.children||(u.children={});for(l in n.children)for(c in n.children[l])h=[l,c],f(u.children,h,e.getTargetField(n.children,h))}if(n.children_by_mn){u.children_by_mn||(u.children_by_mn={});for(l in n.children_by_mn){u.children_by_mn[l]||(u.children_by_mn[l]={});for(p in n.children_by_mn[l])for(c in n.children_by_mn[l][p])h=[l,p,c],f(u.children_by_mn,h,e.getTargetField(n.children_by_mn,h))}}}return u.node_id=v.join("&"),u}return null}.call(this),c.basetree&&c.basetree.states&&(c.merged_states=e.collapseAll(c.merged_states,c.basetree.states));var v={},m=[];this.children_views&&i(this.children_views,n,v,m),this.children_views_by_mn&&s(this.children_views_by_mn,r,v,m);var g=c.basetree||f;g&&(g.children&&i(g.children,n,v,m),g.children_by_mn&&s(g.children_by_mn,r,v,m)),f&&f.children;var y={children:this.children_views,children_by_mn:this.children_views_by_mn};for(var b=0;b<m.length;b++){var w=m[b],E=e.getTargetField(y,w),S,x,T=c.basetree&&e.getTargetField(c.basetree,w);c.basetree?(S=T,x=this.constr_id):(S=f&&e.getTargetField(f,w),x=l);if(E){var N=u.call(E.prototype,u,a,S,S&&x);e.setTargetField(c.constr_children,w,N),e.setTargetField(c.m_children,w,N)}else if(S){var N=t();e.setTargetField(c.tree_children,w,N),e.setTargetField(c.m_children,w,N),o(N,S,S&&x),N.base_from_parent=S,N.base_root_constr_id=x}}return c.base_from_parent=f||null,c.base_root_constr_id=l||null,c.base_from_parent&&c.base_from_parent.states&&(c.merged_states=e.collapseAll(c.merged_states,c.base_from_parent.states)),c};return u}),define("js/views/AppBaseView",["pv","spv","jquery","./modules/filters","app_serv","./modules/getUsageTree","view_serv"],function(e,t,n,r,i,s,o){var u=o.css.transform,a=u?[u]:[],f={};a.forEach(function(e){f[e]=""});var l=o.css.transform&&o.css.transition;e.setTplFilterGetFn(function(e){if(r[e])return r[e];throw new Error("no filter: "+e)});var c=function(t,n){var r=e.state(t,"map_level_num");n.nesting_space=="detailed"&&++r;var i=this.getLevelContainer(r);return n.wayp_scan_stop=!0,i.material},h=function(e,n,r,i,s){this.c=e,this.scroll_con=n,this.material=r,this.tpl=i,this.context=s,this.callbacks=[];var o=this;l&&t.addEvent(this.c[0],l,function(){o.completeAnimation()})};h.prototype={onTransitionEnd:function(e){this.callbacks.push(e)},completeAnimation:function(){while(this.callbacks.length){var e=this.callbacks.shift();this.context.nextLocalTick(e)}}};var p=function(){};e.BaseRootView.extendTo(p,{dom_rp:!0,createDetails:function(){this.root_view=this,this.d=this.opts.d,this.dom_related_props.push("calls_flow");var e=this;this.opts.can_die&&t.getDefaultView(this.d)&&(this.can_die=!0,this.checkLiveState=function(){if(!t.getDefaultView(e.d))return e.reportDomDeath(),!0},this.lst_interval=setInterval(this.checkLiveState,1e3))},reportDomDeath:function(){this.can_die&&!this.dead&&(this.dead=!0,clearInterval(this.lst_interval),this.die(),console.log("DOM dead! "+this.nums))},isAlive:function(){return this.dead?!1:!this.checkLiveState||!this.checkLiveState()}});var d={sync_tpl:!0},v=function(){};v.BrowserAppRootView=p,v.viewOnLevelP=c,p.extendTo(v,{location_name:"root_view",createDetails:function(){this._super();var t=function(e){return function(t,n,r){return e.getSample(t,n,r)}}(this),n=e.dom.template.templator(this._getCallsFlow(),t);this.pvtemplate=n.template,this.pvsampler=n.sampler,this.tpls=[],this.els={},this.samples={},this.lev_containers={},this.max_level_num=-1,this.dom_related_props.push("samples","lev_containers","els","struc_store"),this.completely_rendered_once={}},completeDomBuilding:function(){this.connectStates(),this.connectChildrenModels(),this.requestAll()},getLevelContainer:function(e){if(this.lev_containers[e])return this.lev_containers[e];if(e==-1)throw new Error("start_screen must exist");var t=this.getSample("complex-page"),n=this.pvtemplate(t,!1,!1,{$lev_num:e});this.tpls.push(n),n.setStates(this.states);var r;for(var i=e;i<=this.max_level_num;i++)if(this.lev_containers[i]){r=this.lev_containers[i];break}r?t.insertBefore(r.c):t.appendTo(this.els.app_map_con);var s=new h(t,n.ancs.scroll_con,n.ancs.material,n,this);return this.lev_containers[e]=s,this.max_level_num=Math.max(this.max_level_num,e),s},manual_states_connect:!0,getLevByNum:function(e,t){return e<-1?!1:t?e==-1?!1:this.getLevelContainer(e):this.getLevelContainer(e)},hideLevNum:function(e){var t=this.getLevByNum(e);t&&t.c.addClass("inactive-page").removeClass("full-page")},showLevNum:function(e){var t=this.getLevByNum(e);t&&t.c.removeClass("inactive-page").addClass("full-page")},removePageOverviewMark:function(e){var t=this.getLevByNum(e);t&&t.c.removeClass("page-scheme")},addPageOverviewMark:function(e){var t=this.getLevByNum(e);t&&t.c.addClass("page-scheme")},getScrollVP:function(){return this.els.scrolling_viewport},scollNeeded:function(){return document.body.scrollHeight>document.body.clientHeight},scrollTo:function(e,t,n){if(!e)return!1;if(!e[0])return;var r=n&&n.vp_limit||1,i=t||this.getScrollVP(),s=i.offset?i.node:i.node,o=s.scrollTop(),u=i.node.height(),a=u*(1-r)/2,f=o+u,l=o+a,c=f-a,h,p=e.offset().top;if(i.offset)h=p;else{var d=s.offset().top;h=o+(p-d)}var v;if(h<l||h>c){var m=Math.min(e.height(),u);v=h-m/2-u/2}v&&(n&&n.animate?s.stop(!1,!0).animate({scrollTop:v},n.animate):s.scrollTop(v))},getSampler:function(e){var t=this.samples[e],r;t||(r=this.els.ui_samples.children("."+e),r=r[0],r&&(t=this.samples[e]=this.pvsampler(r))),t||(r=n(this.requirePart(e)),r=r[0],r&&(t=this.samples[e]=this.pvsampler(r)));if(!t)throw new Error("no such sample");return t},getSample:function(e,t,r){var i=this.getSampler(e);if(i.getClone)return t?i.getClone(r):n(i.getClone(r));if(r)throw new Error("not support options here");return n(i).clone()},"compx-map_animating":[["map_animation_num_started","map_animation_num_completed"],function(e,t){return typeof e=="number"&&e!=t}],markAnimationStart:function(t,n){e.update(this,"map_animation_num_started",n,d);for(var r=0;r<t.length;r++)e.mpx.update(this.getStoredMpx(t[r].getMD()),"animation_started",n,d)},markAnimationEnd:function(t,n){this.state("map_animation_num_started")==n&&e.update(this,"map_animation_num_completed",n,d);for(var r=0;r<t.length;r++){var i=this.getStoredMpx(t[r].getMD());i.state("animation_started")==n&&e.mpx.update(i,"animation_completed",n,d)}},getMapSliceView:function(t,n){var r=e.$v.selecPoineertDeclr(this.dclrs_fpckgs,this.dclrs_selectors,"map_slice",n.model_name,this.nesting_space),i=r.is_wrapper_parent?t.map_parent:t;return this.findMpxViewInChildren(this.getStoredMpx(i),r.space,"map_slice")},getMapSliceChildInParenView:function(e,t){var n=e.map_parent,r=t.map_parent,i=this.getMapSliceView(n,r),s=i&&i.findMpxViewInChildren(this.getStoredMpx(r));if(!s)return;var o=s.findMpxViewInChildren(this.getStoredMpx(t));if(!o){var u=s.getChildViewsByMpx(this.getStoredMpx(t));o=u&&u[0]}return o},getMapSliceChildInParenViewOLD:function(e){var t=e.map_parent,n=this.getMapSliceView(t);if(!n)return;var r=n.findMpxViewInChildren(this.getStoredMpx(e));if(!r){var i=n.getChildViewsByMpx(this.getStoredMpx(e));r=i&&i[0]}return r},getNavOHeight:function(){return this.els.navs.outerHeight()},getAMCWidth:function(){return this.els.app_map_con.width()},getAMCOffset:function(){return this.els.app_map_con.offset()},readMapSliceAnimationData:function(t){if(t&&t.bwlev){var n=t.bwlev.getMD(),r=e.state(n,"map_level_num"),i=t.array.length==1&&t.array[0].name=="zoom-in"&&t.array[0].changes.length<3,s;if(l&&r!=-1&&i){var o=this.getMapSliceChildInParenView(n,t.target.getMD());if(o){var u=o.getC(),f=this.getBoxDemension(this.getAMCOffset,"screens_offset"),c=o.getBoxDemension(function(){return u.offset()},"con_offset",o._lbr.innesting_pos_current,this.state("window_height"),this.state("workarea_width")),h=o.getBoxDemension(function(){return u.outerWidth()},"con_width",this.state("window_height"),this.state("workarea_width")),p=o.getBoxDemension(function(){return u.outerHeight()},"con_height",this.state("window_height"),this.state("workarea_width")),d=c.top-f.top,v=this.state("window_height")-this.getBoxDemension(this.getNavOHeight,"navs_height"),m=this.getBoxDemension(this.getAMCWidth,"screens_width",this.state("workarea_width")),g=h/m,y=p/v,b=Math.min(g,y),w=h/2-b*m/2,E=p/2-b*v/2;s=this.getLevelContainer(r);var S={},x="translate("+(c.left+w)+"px, "+(d+E)+"px)  scale("+b+")";return a.forEach(function(e){S[e]=x}),{lc:s,transform_values:S}}}}},setVMpshow:function(t,n){e.mpx.update(t,"vmp_show",n,d)},"model-mapch":{"move-view":function(e){var t=e.bwlev.getMD().getParentMapModel();t,this.setVMpshow(this.getStoredMpx(e.bwlev.getMD()),e.value)},"zoom-out":function(e){this.setVMpshow(this.getStoredMpx(e.bwlev.getMD()),!1)},destroy:function(e){var t=e.bwlev.getMD();this.setVMpshow(this.getStoredMpx(t),!1)}},animateMapSlice:function(){var n=Array.prototype,r=n.concat,i=function(e){return r.apply(n,e)},s=function(e,t){return e.hasOwnProperty(t)&&e[t]!==!1},o=function(e){var t={},n,r,i,o,u=[];for(n=0;n<e.length;n++)r=e[n],i=r.bwlev.getMD(),o=i._provoda_id,r.type=="destroy"?t[o]=i:t[o]=!1;for(n=e.length-1;n>=0;n--)r=e[n],i=r.bwlev.getMD(),o=i._provoda_id,r.type=="destroy"&&s(t,o)&&(t[o]=!1,u.unshift(i));return u};return function(n,r){var s=t.filter(n.array,"changes");s=i(s);var u=t.filter(s,"target"),a,l;this.markAnimationStart(u,n.changes_number);var c=o(s);for(a=c.length-1;a>=0;a--)this.removeChildViewsByMd(this.getStoredMpx(c[a]),"map_slice");for(a=0;a<s.length;a++){var h=s[a],p=this["model-mapch"][h.type];p&&p.call(this,h)}if(n.bwlev){var v=n.bwlev.getMD(),m=e.state(v,"map_level_num");r&&(e.update(this,"disallow_animation",!0,d),r.lc.c.css(r.transform_values),e.update(this,"disallow_animation",!1,d)),e.update(this,"current_lev_num",m,d),r&&r.lc&&(r.lc.c.height(),r.lc.c.css(f),r.lc.c.height())}var g=this,y=function(){g.markAnimationEnd(u,n.changes_number)};setTimeout(y,1344),r?r.lc.onTransitionEnd(y):this.markAnimationEnd(u,n.changes_number)}}(),"collch-$spec_det-map_slice":{is_wrapper_parent:"^",space:"detailed",place:v.viewOnLevelP},"collch-$spec_common-map_slice":{place:v.viewOnLevelP},"sel-coll-map_slice":"$spec_common-map_slice","coll-prio-map_slice":function(e){return e},findBMapTarget:function(e){var t,n;for(n=0;n<e.length;n++)if(this.getStoredMpx(e[n]).states.mp_has_focus){t=e[n];break}return t},"collch-map_slice":function(t,n,r){var i,s=n.residents_struc&&n.residents_struc.bwlevs,o=n.transaction;s=this.getRendOrderedNesting(t,s)||s;var u,a,f=this.readMapSliceAnimationData(o);for(u=s.length-1;u>=0;u--){var l=n.residents_struc.items[u];a=s[u];var c=e.$v.selecPoineertDeclr(this.dclrs_fpckgs,this.dclrs_selectors,t,l.model_name,this.nesting_space);this.callCollectionChangeDeclaration(c,t,a)}if(this.completely_rendered_once.map_slice&&r&&r.transaction.changes_number+1===n.transaction.changes_number)o&&(this.animateMapSlice(o,f),o.bwlev||(i=this.findBMapTarget(s),i&&e.update(this,"current_lev_num",e.state(i,"map_level_num"),d)));else{var h=new Array(s.length);for(u=0;u<s.length;u++)h[u]=s[u].md_replacer;i=this.findBMapTarget(s);if(!i)throw new Error("there is no model with focus!");this.markAnimationStart(h,-1);for(u=0;u<s.length;u++)this.setVMpshow(this.getStoredMpx(s[u]),n.residents_struc.mp_show_states[u]);e.update(this,"current_lev_num",e.state(i,"map_level_num"),d),this.markAnimationEnd(h,-1),this.completely_rendered_once.map_slice=!0}},transform_props:a,"stch-current_mp_bwlev":function(e){var t=e.getNesting("current_mp_md"),n=e.getNesting("current_mp_bwlev");setTimeout(function(){if(!e.isAlive()){e=null;return}var r=t.getParentMapModel();if(r){var i=e.getMapSliceChildInParenView(n,t),s=i&&i.getC();s&&s.height()?e.scrollTo(i.getC(),{node:e.getLevByNum(t.map_level_num-1).scroll_con},{vp_limit:.4,animate:117}):e.getLevByNum(t.map_level_num-1).scroll_con.scrollTop(0)}},150)}});var m=function(){};v.extendTo(m,{createDetails:function(){this._super(),this.root_view_uid=Date.now();var e=this;setTimeout(function(){t.domReady(e.d,function(){e.buildAppDOM(),e.onDomBuild(),e.completeDomBuilding(),e.RPCLegacy("attachUI",e.root_view_uid)})}),this.on("die",function(){this.RPCLegacy("detachUI",this.root_view_uid)}),this.on("state_change-current_mp_bwlev",function(){e.resortQueue()}),function(){var n=this.getWindow(),r=t.debounce(function(){e.updateManyStates({window_height:n.innerHeight,window_width:n.innerWidth})},150);t.addEvent(n,"resize",r),this.onDie(function(){t.removeEvent(n,"resize",r),n=null})}.call(this),this.onDie(function(){e=null})},remove:function(){this._super();if(this.d){var e=this.getWindow();n(e).off(),n(e).remove(),e=null,this.d.body&&this.d.body.firstChild&&this.d.body.firstChild.parentNode&&n(this.d.body).off().find("*").remove(),n(this.d).off(),n(this.d).remove()}this.d=null},resortQueue:function(){var t=function(t,n){var r=n.map_parent&&this.getMapSliceView(n,t);if(r){var i=this.getStoredMpx(t).getViews();return e.$v.matchByParent(i,r)}};return function(e){if(e)e.removePrioMarks();else if(this.all_queues)for(var n=0;n<this.all_queues.length;n++)this.all_queues[n].removePrioMarks();var r=this.getNesting("current_mp_md"),i=r&&t.call(this,r,this.getNesting("current_mp_bwlev"));i&&i.setPrio()}}(),onDomBuild:function(){this.used_data_structure=s.call(this,s,this),this.RPCLegacy("knowViewingDataStructure",this.constr_id,this.used_data_structure),console.log(this.used_data_structure)},wrapStartScreen:function(e){var t=e.parent(),n=t.parent(),r=this.pvtemplate(n,!1,!1,{$lev_num:-1});this.tpls.push(r),this.lev_containers[-1]={c:n,material:e,scroll_con:t}},buildAppDOM:function(){this.c=n(this.d.body);var e=this,t=this.getWindow();e.updateManyStates({window_height:t.innerHeight,window_width:t.innerWidth}),this.ui_samples_csel&&(this.els.ui_samples=this.c.find(this.ui_samples_csel))},ui_samples_csel:"#ui-samples"}),v.WebAppView=m;var g=function(){};return v.WebAppView.extendTo(g,{"collch-current_mp_md":function(t,n){e.update(this,"current_mp_md",n._provoda_id)},"collch-current_mp_bwlev":function(t,n){e.update(this,"current_mp_bwlev",n._provoda_id)},"collch-navigation":{place:"nav.daddy"},"stch-full_page_need":function(e,t){e.els.screens.toggleClass("full_page_need",!!t)},"stch-root-lev-search-form":function(e,t){e.els.search_form.toggleClass("root-lev-search-form",!!t)},"stch-show_search_form":function(e,t){t||e.search_input[0].blur()},remove:function(){this._super()},buildAppDOM:t.precall(v.WebAppView.prototype.buildAppDOM,function(){this.selectKeyNodes(),this.buildNav(),this.buildSearchForm(),this.handleSearchForm(this.els.search_form)}),onDomBuild:function(){this._super(),this.c.addClass("app-loaded");var e=this.els.search_input.val();this.RPCLegacy("checkUserInput",{ext_search_query:e})},handleSearchForm:function(e){var t=this.createTemplate(e);this.tpls.push(t)},buildNav:function(){var e=this.els.navs,t=e.find(".daddy");return this.nav={justhead:e,daddy:t},this.dom_related_props.push("nav"),this.nav.daddy.empty().removeClass("not-inited"),this.nav},buildSearchForm:function(){var e=n("#search",this.d);this.els.search_form=e,e.submit(function(){return!1});var r=n("#q",e);this.search_input=this.els.search_input=r,this.dom_related_props.push("search_input");var i=this;r.on("keyup change input",t.throttle(function(){var e=this.value;i.overrideStateSilently("search_query",e),i.RPCLegacy("search",e)},100)),r.on("keyup",t.throttle(function(e){e.keyCode==13&&i.RPCLegacy("refreshSearchRequest",Date.now())},100)),r.on("activate_waypoint",function(){r.focus()}),this.onDie(function(){r.off(),r=null})}}),v.WebComplexTreesView=g,v}),define("js/views/modules/WPBox",["spv","jquery"],function(e,t){var n=function(){};return e.Class.extendTo(n,{init:function(e,t,n,r,i,s){this.root_view=e,this.getStartModel=t,this.press=r,this.select=n,this.getRelativeWP=i,this.removeWP=s},wp_dirs:{all:{Up:!0,Down:!0,Left:!0,Right:!0},horizontal:{Left:!0,Right:!0},backward:{Up:!0,Left:!0},forward:{Down:!0,Right:!0}},wayPointsNav:function(e,t){var n=this.getStartModel(),r=n&&this.root_view.getStoredMpx(n).getRooConPresentation(this.root_view,!0)||this.root_view;if(r){var i=this.getRelativeWP();if(e=="Enter")i&&this.press(i);else if(this.wp_dirs.all[e]){var s={};if(i){var o=!1;while(i&&!o)if(!this.getWPDemsForStorage(i,s)){this.removeWP(i);var u=this.getRelativeWP();u!=i?i=u:i=null}else o=!0}if(!i){var a=r,f=[];while(!f.length&&a)f=this.getWPPack(a,s),a=a.parent_view;this.select(f[0],t)}else{var l=i&&s[i.wpid];if(!l)throw new Error("there is no demensions!");var c=this.getAnyPossibleWaypoints(i,e,s),h=c[0];h&&this.select(h,t)}}}},getAnyPossibleWaypoints:function(e,t,n){var r=[],i=0;while(!r.length&&i<90){var s=[],o=e.view;while(!s.length&&o){var u=this.getWPPack(o,n);s=this.getWPCorridor(e,t,u,n,Math.min(i,89)),o=o.parent_view}r=s,i+=5}return r},isWPAvailable:function(e){return this.getWPDemsForStorage(e)&&e},getWPEndPoint:function(e,t,n){var r=n[e.wpid],i={};return this.wp_dirs.horizontal[t]?(i.top=r.offset.top,this.wp_dirs.forward[t]?i.left=r.offset.left:i.left=r.offset.left+r.width):(i.left=r.offset.left,this.wp_dirs.forward[t]?i.top=r.offset.top:i.top=r.offset.top+r.height),i},getWPDemsForStorage:function(e,t){if(!e.wpid)throw new Error('waypoint must have ID (".wpid")');var n=this.getWPDems(e);return t&&(t[e.wpid]=n||{disabled:!0}),n},getWPDems:function(e){if(e.canUse&&!e.canUse())return;var n=t(e.node),r=n.height();if(!r)return;var i=n.width();if(!i)return;var s=n.offset();if(!s.top&&!s.left)return;var o={height:r,width:i,offset:s};return e.simple_check?this.canUseWaypoint(e,o):o},canUseWaypoint:function(e,n){var r=t(e.node);if(r.css("display")=="none")return;var i=n.height,s=n.width,o=r.position();if(o.top+i<=0)return;if(o.left+s<=0)return;var u=[],a=r.parent();while(a[0]){if(!a[0].ownerDocument)break;u.push(a),a=a.parent()}var f=!1,l;for(l=0;l<u.length;l++)if(u[l].css("display")=="none"){f=!0;break}if(f)return;var c=[],h=e.view;while(h){if(h.wayp_scan_stop){var p=h.getC();p&&c.push(p[0]||p)}h=h.parent_view}var d=!1;for(l=0;l<u.length;l++){if(u[l].css("overflow")=="hidden"){d=u[l];break}if(c.indexOf(u[l][0])!=-1)break}var v=r.offset();if(d){var m=d.offset();if(v.top+i<m.top)return;if(v.left+s<m.left)return;if(v.top>m.top+d.height())return;if(v.left>m.left+d.width())return}return{height:i,width:s,offset:v}},getWPPack:function(t,n){var r=[];t.getAllWaypoints(r);var i=[];for(var s=0;s<r.length;s++){var o=r[s];if(!o)continue;var u=o.wpid;if(!n[u]){var a=this.getWPDemsForStorage(o,n);if(!a)continue}n[u].disabled||i.push(o)}var f=this;return i.sort(function(t,r){return e.sortByRules(t,r,[function(e){var t=n[e.wpid];return f.getLenthBtwPoints({left:0,top:0},t.offset)}])}),i},sortWPCorridor:function(t,n,r,i){var s={};this.wp_dirs.horizontal[r]?(s.top=t.offset.top,this.wp_dirs.forward[r]?s.left=t.offset.left:s.left=t.offset.left+t.width):(s.left=t.offset.left,this.wp_dirs.forward[r]?s.top=t.offset.top:s.top=t.offset.top+t.height);var o=this;n.sort(function(t,n){return e.sortByRules(t,n,[function(e){var t=o.getWPEndPoint(e,r,i),n=Math.abs(t.top-s.top),u=Math.abs(t.left-s.left),a=Math.sqrt(Math.pow(n,2)+Math.pow(u,2)),f=o.wp_dirs.horizontal[r]?u:n;return(a+f)/2}])})},getLenthBtwPoints:function(e,t){var n=Math.abs(t.top-e.top),r=Math.abs(t.left-e.left),i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return i},matchWPForTriangles:function(t,n,r,i,s){var o=t[r.wpid],u={},a={},f={},l;a=this.getWPEndPoint(i,n,t);if(this.wp_dirs.horizontal[n]){u.top=o.offset.top+o.height,l=o.height,f={left:a.left,top:u.top};if(this.wp_dirs.forward[n]){u.left=o.offset.left+o.width;if(f.left<u.left)return!1}else{u.left=o.offset.left;if(f.left>u.left)return!1}}else{u.left=o.offset.left+o.width,l=o.width,f={left:u.left,top:a.top};if(this.wp_dirs.forward[n]){u.top=o.offset.top+o.height;if(f.top<u.top)return!1}else{u.top=o.offset.top;if(f.top>u.top)return!1}}var c=this.getALength(e.cloneObj({},u),e.cloneObj({},f),s),h=this.matchTrianglesByPoints(u,f,n,c,!1,a);return h||(h=this.matchTrianglesByPoints(u,f,n,c,l,a)),h},matchTriaPoArray:function(e){for(var t=0;t<e.length;t++){if(e[t]===0)return!0;if(e[t+1]&&e[t+1]*e[t]<=0)return!1}return!0},matchTrianglesByPoints:function(e,t,n,r,i,s){var o={},u,a;this.wp_dirs.horizontal[n]?(a="left",u="top"):(a="top",u="left"),o[a]=t[a],typeof i=="number"?(t[u]-=i,e[u]-=i,o[u]=t[u]-r):o[u]=t[u]+r;var f=this.triangleHasPoint(e,o,t,s);return this.matchTriaPoArray(f)},triangleHasPoint:function(e,t,n,r){var i=(e.left-r.left)*(t.top-e.top)-(t.left-e.left)*(e.top-r.top),s=(t.left-r.left)*(n.top-t.top)-(n.left-t.left)*(t.top-r.top),o=(n.left-r.left)*(e.top-n.top)-(e.left-n.left)*(n.top-r.top);return[i,s,o]},getALength:function(e,t,n){var r=function(e){return e*(Math.PI/180)},i=90,s=180-i-n,o=this.getLenthBtwPoints(e,t)*Math.sin(r(n))/Math.sin(r(s));return o},getWPCorridor:function(e,t,n,r,i){var s=[],o,u,a,f=r[e.wpid];if(this.wp_dirs.horizontal[t])for(o=0;o<n.length;o++){u=n[o];if(!u)continue;a=r[u.wpid];if(u==e||u.node==e.node)continue;if(this.wp_dirs.forward[t]){if(a.offset.left+a.width<=f.offset.left+f.width)continue}else if(a.offset.left>=f.offset.left)continue;if(!i){if(a.offset.top+a.height<=f.offset.top)continue;if(a.offset.top>=f.offset.top+f.height)continue}else if(!this.matchWPForTriangles(r,t,e,u,i))continue;s.push(u)}else for(o=0;o<n.length;o++){u=n[o];if(!u)continue;a=r[u.wpid];if(u==e||u.node==e.node)continue;if(this.wp_dirs.forward[t]){if(a.offset.top+a.height<=f.offset.top+f.height)continue}else if(a.offset.top>=f.offset.top)continue;if(!i){if(a.offset.left+a.width<=f.offset.left)continue;if(a.offset.left>=f.offset.left+f.width)continue}else if(!this.matchWPForTriangles(r,t,e,u,i))continue;s.push(u)}return this.sortWPCorridor(f,s,t,r),s}}),n}),define("js/views/AppView",["pv","spv","jquery","app_serv","js/libs/FuncsQueue","./nav","./coct","./uacq","./StartPageView","./SearchPageView","./ArtcardUI","./ArtistListView","./SongsListView","./UserCardPage","./MusicConductorPage","./TagPageView","./YoutubeVideoView","./lul","./SongcardPage","./AppBaseView","./modules/WPBox","view_serv"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){function C(){}function k(){}var S=r.app_env,x=r.localize,T=function(){};b.BrowserAppRootView.extendTo(T,{location_name:"exposed_root_view","stch-doc_title":function(e,t){e.d.title=t||""},"stch-playing":function(e,t){S.need_favicon&&(t?e.changeFavicon("playing"):e.changeFavicon("usual"))},changeFaviconNode:function(e,t,n){var r=e.createElement("link"),i=this.favicon_node||e.getElementById("dynamic-favicon");r.id="dynamic-favicon",r.rel="shortcut icon",n&&(r.type=n),r.href=t,e.head.replaceChild(r,i),this.favicon_node=r},changeFavicon:t.debounce(function(e){this.isAlive()&&(e&&this.favicon_states[e]?this.changeFaviconNode(this.d,this.favicon_states[e],"image/png"):this.changeFaviconNode(this.d,this.favicon_states.usual,"image/png"))},300),favicon_states:{playing:"icons/icon16p.png",usual:"icons/icon16.png"}});var N={$default:o.ListOfListsView,start_page:a,invstg:f,artcard:l,artslist:c,playlist:{main:h,"all-sufficient-details":h.SongsListDetailedView},vk_usercard:p.VkUsercardPageView,lfm_usercard:p.LfmUsercardPageView,usercard:p,allplaces:o.SimpleListOfListsView,mconductor:d,tag_page:v,tagslist:v.TagsListPage,user_playlists:o.ListOfListsView,songs_lists:o.ListOfListsView,artists_lists:o.ListOfListsView,"сountries_list":o.SimpleListOfListsView,city_place:o.SimpleListOfListsView,cities_list:o.SimpleListOfListsView,country_place:o.ListOfListsView,tag_artists:o.ListOfListsView,tag_songs:o.ListOfListsView,youtube_video:m,vk_users:p.VkUsersPageView,lfm_users:g.LfmUsersPageView,lfm_listened_artists:o.ListOfListsView,lfm_listened_tracks:o.ListOfListsView,lfm_listened_albums:o.ListOfListsView,lfm_listened_tags:g.UserTagsPageView,vk_users_tracks:o.ListOfListsView,lfm_user_tag:o.ListOfListsView,user_acqs_list:u.UserAcquaintancesListView,albslist:o.AlbumsListView,lula:g.LULAPageVIew,lulas:g.LULAsPageVIew,songcard:y,justlists:o.ListOfListsView,vk_posts:o.VKPostsView,songcard_cloudcasts:o.ListOfListsView,cloudcasts_list:o.ListOfListsView,blogs_conductor:o.ListOfListsView,blogs_list:o.ListOfListsView,music_blog:o.ListOfListsView,app_news:o.AppNewsView};e.View.extendTo(C,{children_views_by_mn:{pioneer:N},controllers:{image_loader:o.ImageLoader},base_tree:{sample_name:"browse_lev_con"},"collch-$spec_common-pioneer":{by_model_name:!0,place:"c"},"collch-$spec_det-pioneer":{space:"all-sufficient-details",by_model_name:!0,place:"c"},"collch-$spec_noplace-pioneer":{by_model_name:!0},"sel-coll-pioneer//detailed":"$spec_det-pioneer","sel-coll-pioneer/start_page":"$spec_noplace-pioneer","sel-coll-pioneer":"$spec_common-pioneer","compx-mp_show_end":{depends_on:["animation_started","animation_completed","vmp_show"],fn:function(e,t,n){return e?e==t?n:!1:n}}}),e.View.extendTo(k,{base_tree:{sample_name:"brow_lev_nav"},children_views_by_mn:{pioneer:{$default:s.baseNavUI,start_page:s.StartPageNavView,invstg:s.investgNavUI}},"collch-pioneer":{by_model_name:!0,place:"c"}});var L=function(){};return b.WebComplexTreesView.extendTo(L,{"sel-coll-map_slice/song":"$spec_det-map_slice",children_views:{map_slice:{main:C,detailed:C},navigation:k},state_change:{"wait-vk-login":function(e,t){e.toggleBodyClass(t,"wait-vk-login")},"vk-waiting-for-finish":function(e,t){e.toggleBodyClass(t,"vk-waiting-for-finish")},"slice-for-height":function(e,t){e.toggleBodyClass(t,"slice-for-height")},deep_sandbox:function(e,t){e.toggleBodyClass(t,"deep-sandbox")},search_query:function(e,t){e.search_input.val(t||"")}},"compx-now_playing_text":{depends_on:["now_playing"],fn:function(e){return x("now_playing","Now Playing")+": "+e}},createDetails:function(){this._super();var e=this;this.wp_box=new w,this.wp_box.init(this,function(){return e.getNesting("current_mp_md")},function(t){e.setVisState("current_wpoint",t)},function(t){n(t.node).click(),n(t.node).trigger("activate_waypoint"),setTimeout(function(){if(e.state("vis_current_wpoint")!=t)return;var n=e.wp_box.isWPAvailable(t);n?e.scrollToWP(n):e.setVisState("current_wpoint",!1)},100)},function(){return e.state("vis_current_wpoint")},function(t){var n=e.state("vis_current_wpoint");n==t&&e.setVisState("current_wpoint",!1)}),e.dom_related_props.push("favicon_node","wp_box"),this.all_queues=[];var t=function(){return this.reverse_default_prio=!0,e.all_queues.push(this),this},r=function(t){e.resortQueue(t)};this.lfm_imgq=new i({time:[700],init:t,resortQueue:r}),this.dgs_imgq=new i({time:[1200],init:t,resortQueue:r}),this.dgs_imgq_alt=new i({time:[250],init:t,resortQueue:r}),this.on("vip_state_change-current_mp_md",function(){var t=this.state("vis_current_wpoint");t&&t.canUse&&!t.canUse()&&e.setVisState("current_wpoint",!1)},{skip_reg:!0,immediately:!0})},toggleBodyClass:function(e,t){e?this.c.addClass(t):this.c.removeClass(t)},parts_builder:{alb_prev_big:function(){return this.els.ui_samples.children(".album_preview-big")},"song-view":function(){return this.els.ui_samples.children("ul").children(".song-view")},artcard:function(){return this.els.ui_samples.children(".art_card")},lfm_authsampl:function(){return this.els.ui_samples.children(".lfm-auth-module")},lfm_scrobling:function(){return this.els.ui_samples.children(".scrobbling-switches")}},buildWidthStreamer:function(e){(function(e){var r=n("#pages_area_width_streamer",e.d),i=r[0].contentWindow,s=i.document.documentElement.style;s.padding=0,s.margin=0,s.border=0,s.background="transparent",e.updateManyStates({workarea_width:i.innerWidth});var o=t.debounce(function(){e.updateManyStates({workarea_width:i.innerWidth})},150);t.addEvent(i,"resize",o),e.onDie(function(){t.removeEvent(i,"resize",o),i=null,e=null})})(e)},buildVKSamples:function(){var e=this.els.ui_samples.children(".vk-login-context"),n=this;t.cloneObj(n.samples,{vklc:e})},checkSizeDetector:function(){var e=this;if(S.check_resize){var t=function(e){return e?n(e).outerHeight():0},r=function(){var t=e.getNesting("current_mp_md");return t&&e.getStoredMpx(t).getRooConPresentation(this,!0,!0).getC()},i=function(){e.rsd_rz&&clearInterval(e.rsd_rz);var i=t(r()),s,o=function(){if(typeof documentScrollSizeChangeHandler=="function"){var e=t(r());if(i!=e){if(typeof s=="undefined"){var o=n(r()).offset();s=o&&o.top||0}documentScrollSizeChangeHandler((i=e)+s)}}};e.rsd_rz=setInterval(o,100),e.on("vip_state_change-current_mp_md.resize-check",function(){o()},{exlusive:!0,immediately:!0})};i()}},calculateScrollingViewport:function(e){var t;return e.css("overflow")=="auto"?t={node:e}:S.as_application?t={node:e}:S.lg_smarttv_app?t={node:e}:t={node:n(this.d.body),offset:!0},t},buildNowPlayingButton:function(){var t=this,n=this.nav.justhead.find(".np-button").detach();t.tpls.push(e.$v.createTemplate(this,n)),this.nav.daddy.append(n)},"stch-nav_helper_is_needed":function(t,n){n||e.update(t,"nav_helper_full",!1)},tpl_events:{showFullNavHelper:function(){e.update(this,"nav_helper_full",!0)}},buildNavHelper:function(){this.tpls.push(e.$v.createTemplate(this,this.els.nav_helper))},selectKeyNodes:function(){var e=this.d.getElementById("slider"),r=n("#screens",this.d),i=r.children(".app_map_con"),s=this.calculateScrollingViewport(r),o=n("#start-screen",this.d);t.cloneObj(this.els,{screens:r,app_map_con:i,scrolling_viewport:s,slider:e,navs:n(e).children(".navs"),nav_helper:n(e).children().children("#nav-helper"),start_screen:o,pestf_preview:o.children(".personal-stuff-preview")})},buildAppDOM:t.precall(b.WebComplexTreesView.prototype.buildAppDOM,function(){var e=this,t=this.d;console.log("dom ready"),e.checkSizeDetector(),e.nextTick(e.buildWidthStreamer),e.els.search_form.find("#app_type").val(S.app_type),e.wrapStartScreen(this.els.start_screen),n("#widget-url",t).val(location.href.replace("index.html","")),S.bro.browser.opera&&typeof window.opera.version=="function"&&parseFloat(window.opera.version())<=10.1&&n('<a id="close-widget">&times;</a>',t).click(function(){window.close()}).prependTo(e.els.slider),e.buildVKSamples(),e.buildNowPlayingButton(),e.buildNavHelper();var r=function(t){t.preventDefault(),S.openURL(n(this).attr("href")),e.trackEvent("Links","just link")};n(t).on("click",".external",r),e.onDie(function(){n(t).off("click",r)});var i=function(n){if(t.activeElement&&t.activeElement.nodeName=="BUTTON")return;if(t.activeElement&&t.activeElement.nodeName=="INPUT"&&n.keyCode==27){t.activeElement.blur(),n.preventDefault();return}e.arrowsKeysNav(n)};n(t).on("keydown",i),e.onDie(function(){n(t).off("keydown",i)}),e.onDie(function(){e=null,t=null})}),inputs_names:["input"],key_codes_map:{13:"Enter",37:"Left",39:"Right",40:"Down",63233:"Down",38:"Up",63232:"Up"},arrowsKeysNav:function(e){var t,n=e.keyCode,r;this.inputs_names.indexOf(e.target.nodeName.toLowerCase())==-1&&(r=!0),t=this.key_codes_map[e.keyCode],t&&r&&e.preventDefault(),t&&this.wp_box.wayPointsNav(t,e)},scrollToWP:function(e){if(e){var t=this.getNesting("current_mp_md"),r=t.getParentMapModel();r&&e.view.getAncestorByRooViCon("main")==this.getStoredMpx(r).getRooConPresentation(this)&&this.scrollTo(n(e.node),{node:this.getLevByNum(r.map_level_num).scroll_con},{vp_limit:.6,animate:117}),this.scrollTo(n(e.node),!1,{vp_limit:.6,animate:117})}},"stch-vis_current_wpoint":function(e,t,r){r&&n(r.node).removeClass("surf_nav"),t&&(n(t.node).addClass("surf_nav"),e.scrollToWP(t))},appendStyle:function(e){var t=this.d.createElement("style");t.setAttribute("title","button_menu"),t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(this.d.createTextNode(e)),this.d.documentElement.firstChild.appendChild(t)},verticalAlign:function(e,t){var r=t.real_height||e.naturalHeight||e.height;if(r){var i=(t.target_height-r)/2;return i&&(t.animate?n(e).animate({"margin-top":i+"px"},t.animate_time||200):n(e).css({"margin-top":i+"px"})),i}},preloadImage:function(e,t,r,i){var s=document.createElement("img");return t&&(s.alt=t),s.onload=function(){r&&r(s)},i&&n(i).append(s),s.src=e,s.complete&&setTimeout(function(){r&&r(s)},10),s},trackEvent:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("trackEvent"),this.RPCLegacy.apply(this,e)},getAcceptedDesc:function(e){var t=e.info.domain&&"https://vk.com/"+e.info.domain;if(t&&e.info.full_name)return n('<a class="external"></a>').attr("href",t).text(e.info.full_name);if(e.item.est)return n("<span class='desc'></span>").text(r.getRemainTimeText(e.item.est,!0))},create_youtube_video:function(e){var t=document.createElement("embed");return S.chrome_like_ext||(S.opera_widget?t.setAttribute("wmode","transparent"):S.opera_extension&&t.setAttribute("wmode","opaque")),t.setAttribute("type","application/x-shockwave-flash"),t.setAttribute("src","https://www.youtube.com/v/"+e+"&autoplay=1"),t.setAttribute("allowfullscreen","true"),t.setAttribute("class","you-tube-video"),t},bindLfmTextClicks:function(e){var t=this;e.on("click","a",function(e){var r=n(this),i=r.attr("href");if(r.is(".bbcode_artist")){e.preventDefault();var s=decodeURIComponent(i.replace("http://www.last.fm/music/","").replace(/\+/g," "));t.RPCLegacy("showArtcardPage","artist_name"),t.trackEvent("Artist navigation","bbcode_artist",s)}else if(r.is(".bbcode_tag")){e.preventDefault();var o=decodeURIComponent(i.replace("http://www.last.fm/tag/","").replace(/\+/g," "));t.RPCLegacy("show_tag","artist_name"),t.trackEvent("Artist navigation","bbcode_tag",o)}else e.preventDefault(),S.openURL(i),t.trackEvent("Links","just link")})},loadImage:function(e){if(e.url){var t;return e.url.indexOf("last.fm")!=-1?t=this.lfm_imgq:e.url.indexOf("discogs.com")!=-1?t=this.dgs_imgq:e.url.indexOf("http://s.pixogs.com")!=-1&&(t=this.dgs_imgq_alt),e.timeout=e.timeout||4e4,e.queue=e.queue||t,E.loadImage(e)}},createNiceButton:function(e){var t=n('<span class="button-hole"><a class="nicebutton"></a></span>'),r=t.children("a");e=="left"?t.addClass("bposition-l"):e=="right"&&t.addClass("bposition-r");var i={c:t,b:r,_enabled:!0,enable:function(){return this._enabled||(this.b.addClass("nicebutton").removeClass("disabledbutton"),this.b.data("disabled",!1),this._enabled=!0),this},disable:function(){return this._enabled&&(this.b.removeClass("nicebutton").addClass("disabledbutton"),this.b.data("disabled",!0),this._enabled=!1),this},toggle:function(e){typeof e!="undefined"&&(e?this.enable():this.disable())}};return i.disable(),i}}),L.AppExposedView=T,L}),function(){requirejs.config({packages:[{name:"pv",location:"js/libs/provoda",main:"provoda"}],paths:{spv:"js/libs/spv",su:"js/seesu",jquery:"js/common-libs/jquery-2.1.4.min",localizer:"js/libs/localizer",cache_ajax:"js/libs/cache_ajax",app_serv:"js/app_serv",view_serv:"js/views/modules/view_serv",env:"js/env",hex_md5:"js/common-libs/md5.min"},shim:{hex_md5:{exports:"hex_md5"}},waitSeconds:window.tizen&&0}),window._gaq=window._gaq||[],function(){var e,t=window.opera,n=window.chrome;window.chrome&&n.extension?e=n.extension.getBackgroundPage():window.opera&&t.extension&&t.extension.bgProcess&&(e=t.extension.bgProcess);var r=(!e||e!=window)&&(!t||!t.contexts);r&&requirejs(["spv","view_serv"],function(e,t){t.handleDocument(window.document)}),r||t&&(window.opera_extension_button=t.contexts.toolbar.createItem({disabled:!1,title:"Seesu - search and listen music",icon:"icons/icon18.png",popup:{href:"index.html",width:600,height:570}}),t.contexts.toolbar.addItem(window.opera_extension_button)),requirejs(["su"],function(){}),r&&requirejs(["su","js/views/AppView","pv"],function(e,t,n){var r=!1,i=e,s=Date.now(),o=n.views_proxies;o.addSpaceById(s,i);var u=o.getMPX(s,i);i.updateLVTime(),function(){var e=new t;u.addView(e,"root"),e.init({mpx:u,proxies_space:s},{d:window.document,can_die:r}),e.onDie(function(){e=null}),e.requestAll()}(),function(){var e=new t.AppExposedView;u.addView(e,"exp_root"),e.init({mpx:u,proxies_space:s},{d:window.document,can_die:r,usual_flow:!0}),e.requestAll()}()})}()}(),define("loader.js",function(){});